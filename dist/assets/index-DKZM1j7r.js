(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(o){if(o.ep)return;o.ep=!0;const h=n(o);fetch(o.href,h)}})();var xA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wA={exports:{}},Yv={},bA={exports:{}},Bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qg=Symbol.for("react.element"),ON=Symbol.for("react.portal"),FN=Symbol.for("react.fragment"),BN=Symbol.for("react.strict_mode"),VN=Symbol.for("react.profiler"),jN=Symbol.for("react.provider"),UN=Symbol.for("react.context"),$N=Symbol.for("react.forward_ref"),qN=Symbol.for("react.suspense"),HN=Symbol.for("react.memo"),GN=Symbol.for("react.lazy"),DE=Symbol.iterator;function ZN(t){return t===null||typeof t!="object"?null:(t=DE&&t[DE]||t["@@iterator"],typeof t=="function"?t:null)}var TA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},SA=Object.assign,EA={};function Tp(t,e,n){this.props=t,this.context=e,this.refs=EA,this.updater=n||TA}Tp.prototype.isReactComponent={};Tp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Tp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function IA(){}IA.prototype=Tp.prototype;function T1(t,e,n){this.props=t,this.context=e,this.refs=EA,this.updater=n||TA}var S1=T1.prototype=new IA;S1.constructor=T1;SA(S1,Tp.prototype);S1.isPureReactComponent=!0;var zE=Array.isArray,PA=Object.prototype.hasOwnProperty,E1={current:null},CA={key:!0,ref:!0,__self:!0,__source:!0};function AA(t,e,n){var r,o={},h=null,f=null;if(e!=null)for(r in e.ref!==void 0&&(f=e.ref),e.key!==void 0&&(h=""+e.key),e)PA.call(e,r)&&!CA.hasOwnProperty(r)&&(o[r]=e[r]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var S=Array(l),A=0;A<l;A++)S[A]=arguments[A+2];o.children=S}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)o[r]===void 0&&(o[r]=l[r]);return{$$typeof:qg,type:t,key:h,ref:f,props:o,_owner:E1.current}}function WN(t,e){return{$$typeof:qg,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function I1(t){return typeof t=="object"&&t!==null&&t.$$typeof===qg}function KN(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var NE=/\/+/g;function $x(t,e){return typeof t=="object"&&t!==null&&t.key!=null?KN(""+t.key):e.toString(36)}function wy(t,e,n,r,o){var h=typeof t;(h==="undefined"||h==="boolean")&&(t=null);var f=!1;if(t===null)f=!0;else switch(h){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case qg:case ON:f=!0}}if(f)return f=t,o=o(f),t=r===""?"."+$x(f,0):r,zE(o)?(n="",t!=null&&(n=t.replace(NE,"$&/")+"/"),wy(o,e,n,"",function(A){return A})):o!=null&&(I1(o)&&(o=WN(o,n+(!o.key||f&&f.key===o.key?"":(""+o.key).replace(NE,"$&/")+"/")+t)),e.push(o)),1;if(f=0,r=r===""?".":r+":",zE(t))for(var l=0;l<t.length;l++){h=t[l];var S=r+$x(h,l);f+=wy(h,e,n,S,o)}else if(S=ZN(t),typeof S=="function")for(t=S.call(t),l=0;!(h=t.next()).done;)h=h.value,S=r+$x(h,l++),f+=wy(h,e,n,S,o);else if(h==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return f}function H_(t,e,n){if(t==null)return t;var r=[],o=0;return wy(t,r,"","",function(h){return e.call(n,h,o++)}),r}function XN(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var xo={current:null},by={transition:null},YN={ReactCurrentDispatcher:xo,ReactCurrentBatchConfig:by,ReactCurrentOwner:E1};function kA(){throw Error("act(...) is not supported in production builds of React.")}Bn.Children={map:H_,forEach:function(t,e,n){H_(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return H_(t,function(){e++}),e},toArray:function(t){return H_(t,function(e){return e})||[]},only:function(t){if(!I1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Bn.Component=Tp;Bn.Fragment=FN;Bn.Profiler=VN;Bn.PureComponent=T1;Bn.StrictMode=BN;Bn.Suspense=qN;Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YN;Bn.act=kA;Bn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=SA({},t.props),o=t.key,h=t.ref,f=t._owner;if(e!=null){if(e.ref!==void 0&&(h=e.ref,f=E1.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(S in e)PA.call(e,S)&&!CA.hasOwnProperty(S)&&(r[S]=e[S]===void 0&&l!==void 0?l[S]:e[S])}var S=arguments.length-2;if(S===1)r.children=n;else if(1<S){l=Array(S);for(var A=0;A<S;A++)l[A]=arguments[A+2];r.children=l}return{$$typeof:qg,type:t.type,key:o,ref:h,props:r,_owner:f}};Bn.createContext=function(t){return t={$$typeof:UN,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:jN,_context:t},t.Consumer=t};Bn.createElement=AA;Bn.createFactory=function(t){var e=AA.bind(null,t);return e.type=t,e};Bn.createRef=function(){return{current:null}};Bn.forwardRef=function(t){return{$$typeof:$N,render:t}};Bn.isValidElement=I1;Bn.lazy=function(t){return{$$typeof:GN,_payload:{_status:-1,_result:t},_init:XN}};Bn.memo=function(t,e){return{$$typeof:HN,type:t,compare:e===void 0?null:e}};Bn.startTransition=function(t){var e=by.transition;by.transition={};try{t()}finally{by.transition=e}};Bn.unstable_act=kA;Bn.useCallback=function(t,e){return xo.current.useCallback(t,e)};Bn.useContext=function(t){return xo.current.useContext(t)};Bn.useDebugValue=function(){};Bn.useDeferredValue=function(t){return xo.current.useDeferredValue(t)};Bn.useEffect=function(t,e){return xo.current.useEffect(t,e)};Bn.useId=function(){return xo.current.useId()};Bn.useImperativeHandle=function(t,e,n){return xo.current.useImperativeHandle(t,e,n)};Bn.useInsertionEffect=function(t,e){return xo.current.useInsertionEffect(t,e)};Bn.useLayoutEffect=function(t,e){return xo.current.useLayoutEffect(t,e)};Bn.useMemo=function(t,e){return xo.current.useMemo(t,e)};Bn.useReducer=function(t,e,n){return xo.current.useReducer(t,e,n)};Bn.useRef=function(t){return xo.current.useRef(t)};Bn.useState=function(t){return xo.current.useState(t)};Bn.useSyncExternalStore=function(t,e,n){return xo.current.useSyncExternalStore(t,e,n)};Bn.useTransition=function(){return xo.current.useTransition()};Bn.version="18.3.1";bA.exports=Bn;var ut=bA.exports;const QN=Xv(ut);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JN=ut,eO=Symbol.for("react.element"),tO=Symbol.for("react.fragment"),nO=Object.prototype.hasOwnProperty,iO=JN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rO={key:!0,ref:!0,__self:!0,__source:!0};function MA(t,e,n){var r,o={},h=null,f=null;n!==void 0&&(h=""+n),e.key!==void 0&&(h=""+e.key),e.ref!==void 0&&(f=e.ref);for(r in e)nO.call(e,r)&&!rO.hasOwnProperty(r)&&(o[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)o[r]===void 0&&(o[r]=e[r]);return{$$typeof:eO,type:t,key:h,ref:f,props:o,_owner:iO.current}}Yv.Fragment=tO;Yv.jsx=MA;Yv.jsxs=MA;wA.exports=Yv;var Lt=wA.exports,$w={},RA={exports:{}},xa={},LA={exports:{}},DA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(lt,Qt){var Tt=lt.length;lt.push(Qt);e:for(;0<Tt;){var nn=Tt-1>>>1,rn=lt[nn];if(0<o(rn,Qt))lt[nn]=Qt,lt[Tt]=rn,Tt=nn;else break e}}function n(lt){return lt.length===0?null:lt[0]}function r(lt){if(lt.length===0)return null;var Qt=lt[0],Tt=lt.pop();if(Tt!==Qt){lt[0]=Tt;e:for(var nn=0,rn=lt.length,cn=rn>>>1;nn<cn;){var vn=2*(nn+1)-1,Jt=lt[vn],on=vn+1,xi=lt[on];if(0>o(Jt,Tt))on<rn&&0>o(xi,Jt)?(lt[nn]=xi,lt[on]=Tt,nn=on):(lt[nn]=Jt,lt[vn]=Tt,nn=vn);else if(on<rn&&0>o(xi,Tt))lt[nn]=xi,lt[on]=Tt,nn=on;else break e}}return Qt}function o(lt,Qt){var Tt=lt.sortIndex-Qt.sortIndex;return Tt!==0?Tt:lt.id-Qt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;t.unstable_now=function(){return h.now()}}else{var f=Date,l=f.now();t.unstable_now=function(){return f.now()-l}}var S=[],A=[],O=1,U=null,H=3,$=!1,ie=!1,me=!1,Me=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ge(lt){for(var Qt=n(A);Qt!==null;){if(Qt.callback===null)r(A);else if(Qt.startTime<=lt)r(A),Qt.sortIndex=Qt.expirationTime,e(S,Qt);else break;Qt=n(A)}}function je(lt){if(me=!1,ge(lt),!ie)if(n(S)!==null)ie=!0,Yt(rt);else{var Qt=n(A);Qt!==null&&vi(je,Qt.startTime-lt)}}function rt(lt,Qt){ie=!1,me&&(me=!1,ce(Q),Q=-1),$=!0;var Tt=H;try{for(ge(Qt),U=n(S);U!==null&&(!(U.expirationTime>Qt)||lt&&!Pe());){var nn=U.callback;if(typeof nn=="function"){U.callback=null,H=U.priorityLevel;var rn=nn(U.expirationTime<=Qt);Qt=t.unstable_now(),typeof rn=="function"?U.callback=rn:U===n(S)&&r(S),ge(Qt)}else r(S);U=n(S)}if(U!==null)var cn=!0;else{var vn=n(A);vn!==null&&vi(je,vn.startTime-Qt),cn=!1}return cn}finally{U=null,H=Tt,$=!1}}var qe=!1,fe=null,Q=-1,ue=5,ve=-1;function Pe(){return!(t.unstable_now()-ve<ue)}function Ve(){if(fe!==null){var lt=t.unstable_now();ve=lt;var Qt=!0;try{Qt=fe(!0,lt)}finally{Qt?Ee():(qe=!1,fe=null)}}else qe=!1}var Ee;if(typeof le=="function")Ee=function(){le(Ve)};else if(typeof MessageChannel<"u"){var Xt=new MessageChannel,tr=Xt.port2;Xt.port1.onmessage=Ve,Ee=function(){tr.postMessage(null)}}else Ee=function(){Me(Ve,0)};function Yt(lt){fe=lt,qe||(qe=!0,Ee())}function vi(lt,Qt){Q=Me(function(){lt(t.unstable_now())},Qt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(lt){lt.callback=null},t.unstable_continueExecution=function(){ie||$||(ie=!0,Yt(rt))},t.unstable_forceFrameRate=function(lt){0>lt||125<lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ue=0<lt?Math.floor(1e3/lt):5},t.unstable_getCurrentPriorityLevel=function(){return H},t.unstable_getFirstCallbackNode=function(){return n(S)},t.unstable_next=function(lt){switch(H){case 1:case 2:case 3:var Qt=3;break;default:Qt=H}var Tt=H;H=Qt;try{return lt()}finally{H=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(lt,Qt){switch(lt){case 1:case 2:case 3:case 4:case 5:break;default:lt=3}var Tt=H;H=lt;try{return Qt()}finally{H=Tt}},t.unstable_scheduleCallback=function(lt,Qt,Tt){var nn=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?nn+Tt:nn):Tt=nn,lt){case 1:var rn=-1;break;case 2:rn=250;break;case 5:rn=1073741823;break;case 4:rn=1e4;break;default:rn=5e3}return rn=Tt+rn,lt={id:O++,callback:Qt,priorityLevel:lt,startTime:Tt,expirationTime:rn,sortIndex:-1},Tt>nn?(lt.sortIndex=Tt,e(A,lt),n(S)===null&&lt===n(A)&&(me?(ce(Q),Q=-1):me=!0,vi(je,Tt-nn))):(lt.sortIndex=rn,e(S,lt),ie||$||(ie=!0,Yt(rt))),lt},t.unstable_shouldYield=Pe,t.unstable_wrapCallback=function(lt){var Qt=H;return function(){var Tt=H;H=Qt;try{return lt.apply(this,arguments)}finally{H=Tt}}}})(DA);LA.exports=DA;var sO=LA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oO=ut,va=sO;function Et(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var zA=new Set,cg={};function Ld(t,e){op(t,e),op(t+"Capture",e)}function op(t,e){for(cg[t]=e,t=0;t<e.length;t++)zA.add(e[t])}var ac=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qw=Object.prototype.hasOwnProperty,aO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,OE={},FE={};function lO(t){return qw.call(FE,t)?!0:qw.call(OE,t)?!1:aO.test(t)?FE[t]=!0:(OE[t]=!0,!1)}function uO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function cO(t,e,n,r){if(e===null||typeof e>"u"||uO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wo(t,e,n,r,o,h,f){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=h,this.removeEmptyString=f}var Ms={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ms[t]=new wo(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ms[e]=new wo(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ms[t]=new wo(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ms[t]=new wo(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ms[t]=new wo(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ms[t]=new wo(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ms[t]=new wo(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ms[t]=new wo(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ms[t]=new wo(t,5,!1,t.toLowerCase(),null,!1,!1)});var P1=/[\-:]([a-z])/g;function C1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(P1,C1);Ms[e]=new wo(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(P1,C1);Ms[e]=new wo(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(P1,C1);Ms[e]=new wo(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ms[t]=new wo(t,1,!1,t.toLowerCase(),null,!1,!1)});Ms.xlinkHref=new wo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ms[t]=new wo(t,1,!1,t.toLowerCase(),null,!0,!0)});function A1(t,e,n,r){var o=Ms.hasOwnProperty(e)?Ms[e]:null;(o!==null?o.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(cO(e,n,o,r)&&(n=null),r||o===null?lO(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,r=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var yc=oO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,G_=Symbol.for("react.element"),Rf=Symbol.for("react.portal"),Lf=Symbol.for("react.fragment"),k1=Symbol.for("react.strict_mode"),Hw=Symbol.for("react.profiler"),NA=Symbol.for("react.provider"),OA=Symbol.for("react.context"),M1=Symbol.for("react.forward_ref"),Gw=Symbol.for("react.suspense"),Zw=Symbol.for("react.suspense_list"),R1=Symbol.for("react.memo"),qc=Symbol.for("react.lazy"),FA=Symbol.for("react.offscreen"),BE=Symbol.iterator;function wm(t){return t===null||typeof t!="object"?null:(t=BE&&t[BE]||t["@@iterator"],typeof t=="function"?t:null)}var ur=Object.assign,qx;function Dm(t){if(qx===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);qx=e&&e[1]||""}return`
`+qx+t}var Hx=!1;function Gx(t,e){if(!t||Hx)return"";Hx=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(A){var r=A}Reflect.construct(t,[],e)}else{try{e.call()}catch(A){r=A}t.call(e.prototype)}else{try{throw Error()}catch(A){r=A}t()}}catch(A){if(A&&r&&typeof A.stack=="string"){for(var o=A.stack.split(`
`),h=r.stack.split(`
`),f=o.length-1,l=h.length-1;1<=f&&0<=l&&o[f]!==h[l];)l--;for(;1<=f&&0<=l;f--,l--)if(o[f]!==h[l]){if(f!==1||l!==1)do if(f--,l--,0>l||o[f]!==h[l]){var S=`
`+o[f].replace(" at new "," at ");return t.displayName&&S.includes("<anonymous>")&&(S=S.replace("<anonymous>",t.displayName)),S}while(1<=f&&0<=l);break}}}finally{Hx=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Dm(t):""}function hO(t){switch(t.tag){case 5:return Dm(t.type);case 16:return Dm("Lazy");case 13:return Dm("Suspense");case 19:return Dm("SuspenseList");case 0:case 2:case 15:return t=Gx(t.type,!1),t;case 11:return t=Gx(t.type.render,!1),t;case 1:return t=Gx(t.type,!0),t;default:return""}}function Ww(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Lf:return"Fragment";case Rf:return"Portal";case Hw:return"Profiler";case k1:return"StrictMode";case Gw:return"Suspense";case Zw:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case OA:return(t.displayName||"Context")+".Consumer";case NA:return(t._context.displayName||"Context")+".Provider";case M1:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case R1:return e=t.displayName||null,e!==null?e:Ww(t.type)||"Memo";case qc:e=t._payload,t=t._init;try{return Ww(t(e))}catch{}}return null}function dO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ww(e);case 8:return e===k1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gh(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function BA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fO(t){var e=BA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,h=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(f){r=""+f,h.call(this,f)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(f){r=""+f},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Z_(t){t._valueTracker||(t._valueTracker=fO(t))}function VA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=BA(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Xy(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Kw(t,e){var n=e.checked;return ur({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function VE(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=gh(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function jA(t,e){e=e.checked,e!=null&&A1(t,"checked",e,!1)}function Xw(t,e){jA(t,e);var n=gh(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Yw(t,e.type,n):e.hasOwnProperty("defaultValue")&&Yw(t,e.type,gh(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jE(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Yw(t,e,n){(e!=="number"||Xy(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var zm=Array.isArray;function Hf(t,e,n,r){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&r&&(t[n].defaultSelected=!0)}else{for(n=""+gh(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,r&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Qw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Et(91));return ur({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function UE(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Et(92));if(zm(n)){if(1<n.length)throw Error(Et(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:gh(n)}}function UA(t,e){var n=gh(e.value),r=gh(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function $E(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $A(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jw(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$A(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var W_,qA=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(W_=W_||document.createElement("div"),W_.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=W_.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function hg(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Hm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pO=["Webkit","ms","Moz","O"];Object.keys(Hm).forEach(function(t){pO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Hm[e]=Hm[t]})});function HA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Hm.hasOwnProperty(t)&&Hm[t]?(""+e).trim():e+"px"}function GA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=HA(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,o):t[n]=o}}var mO=ur({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eb(t,e){if(e){if(mO[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Et(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Et(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Et(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Et(62))}}function tb(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nb=null;function L1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ib=null,Gf=null,Zf=null;function qE(t){if(t=Zg(t)){if(typeof ib!="function")throw Error(Et(280));var e=t.stateNode;e&&(e=n0(e),ib(t.stateNode,t.type,e))}}function ZA(t){Gf?Zf?Zf.push(t):Zf=[t]:Gf=t}function WA(){if(Gf){var t=Gf,e=Zf;if(Zf=Gf=null,qE(t),e)for(t=0;t<e.length;t++)qE(e[t])}}function KA(t,e){return t(e)}function XA(){}var Zx=!1;function YA(t,e,n){if(Zx)return t(e,n);Zx=!0;try{return KA(t,e,n)}finally{Zx=!1,(Gf!==null||Zf!==null)&&(XA(),WA())}}function dg(t,e){var n=t.stateNode;if(n===null)return null;var r=n0(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Et(231,e,typeof n));return n}var rb=!1;if(ac)try{var bm={};Object.defineProperty(bm,"passive",{get:function(){rb=!0}}),window.addEventListener("test",bm,bm),window.removeEventListener("test",bm,bm)}catch{rb=!1}function gO(t,e,n,r,o,h,f,l,S){var A=Array.prototype.slice.call(arguments,3);try{e.apply(n,A)}catch(O){this.onError(O)}}var Gm=!1,Yy=null,Qy=!1,sb=null,_O={onError:function(t){Gm=!0,Yy=t}};function yO(t,e,n,r,o,h,f,l,S){Gm=!1,Yy=null,gO.apply(_O,arguments)}function vO(t,e,n,r,o,h,f,l,S){if(yO.apply(this,arguments),Gm){if(Gm){var A=Yy;Gm=!1,Yy=null}else throw Error(Et(198));Qy||(Qy=!0,sb=A)}}function Dd(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function QA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function HE(t){if(Dd(t)!==t)throw Error(Et(188))}function xO(t){var e=t.alternate;if(!e){if(e=Dd(t),e===null)throw Error(Et(188));return e!==t?null:t}for(var n=t,r=e;;){var o=n.return;if(o===null)break;var h=o.alternate;if(h===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===h.child){for(h=o.child;h;){if(h===n)return HE(o),t;if(h===r)return HE(o),e;h=h.sibling}throw Error(Et(188))}if(n.return!==r.return)n=o,r=h;else{for(var f=!1,l=o.child;l;){if(l===n){f=!0,n=o,r=h;break}if(l===r){f=!0,r=o,n=h;break}l=l.sibling}if(!f){for(l=h.child;l;){if(l===n){f=!0,n=h,r=o;break}if(l===r){f=!0,r=h,n=o;break}l=l.sibling}if(!f)throw Error(Et(189))}}if(n.alternate!==r)throw Error(Et(190))}if(n.tag!==3)throw Error(Et(188));return n.stateNode.current===n?t:e}function JA(t){return t=xO(t),t!==null?ek(t):null}function ek(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=ek(t);if(e!==null)return e;t=t.sibling}return null}var tk=va.unstable_scheduleCallback,GE=va.unstable_cancelCallback,wO=va.unstable_shouldYield,bO=va.unstable_requestPaint,Sr=va.unstable_now,TO=va.unstable_getCurrentPriorityLevel,D1=va.unstable_ImmediatePriority,nk=va.unstable_UserBlockingPriority,Jy=va.unstable_NormalPriority,SO=va.unstable_LowPriority,ik=va.unstable_IdlePriority,Qv=null,fu=null;function EO(t){if(fu&&typeof fu.onCommitFiberRoot=="function")try{fu.onCommitFiberRoot(Qv,t,void 0,(t.current.flags&128)===128)}catch{}}var Dl=Math.clz32?Math.clz32:CO,IO=Math.log,PO=Math.LN2;function CO(t){return t>>>=0,t===0?32:31-(IO(t)/PO|0)|0}var K_=64,X_=4194304;function Nm(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ev(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,o=t.suspendedLanes,h=t.pingedLanes,f=n&268435455;if(f!==0){var l=f&~o;l!==0?r=Nm(l):(h&=f,h!==0&&(r=Nm(h)))}else f=n&~o,f!==0?r=Nm(f):h!==0&&(r=Nm(h));if(r===0)return 0;if(e!==0&&e!==r&&!(e&o)&&(o=r&-r,h=e&-e,o>=h||o===16&&(h&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Dl(e),o=1<<n,r|=t[n],e&=~o;return r}function AO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,o=t.expirationTimes,h=t.pendingLanes;0<h;){var f=31-Dl(h),l=1<<f,S=o[f];S===-1?(!(l&n)||l&r)&&(o[f]=AO(l,e)):S<=e&&(t.expiredLanes|=l),h&=~l}}function ob(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function rk(){var t=K_;return K_<<=1,!(K_&4194240)&&(K_=64),t}function Wx(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Hg(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Dl(e),t[e]=n}function MO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-Dl(n),h=1<<o;e[o]=0,r[o]=-1,t[o]=-1,n&=~h}}function z1(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Dl(n),o=1<<r;o&e|t[r]&e&&(t[r]|=e),n&=~o}}var bi=0;function sk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ok,N1,ak,lk,uk,ab=!1,Y_=[],ih=null,rh=null,sh=null,fg=new Map,pg=new Map,Gc=[],RO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ZE(t,e){switch(t){case"focusin":case"focusout":ih=null;break;case"dragenter":case"dragleave":rh=null;break;case"mouseover":case"mouseout":sh=null;break;case"pointerover":case"pointerout":fg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pg.delete(e.pointerId)}}function Tm(t,e,n,r,o,h){return t===null||t.nativeEvent!==h?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:h,targetContainers:[o]},e!==null&&(e=Zg(e),e!==null&&N1(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function LO(t,e,n,r,o){switch(e){case"focusin":return ih=Tm(ih,t,e,n,r,o),!0;case"dragenter":return rh=Tm(rh,t,e,n,r,o),!0;case"mouseover":return sh=Tm(sh,t,e,n,r,o),!0;case"pointerover":var h=o.pointerId;return fg.set(h,Tm(fg.get(h)||null,t,e,n,r,o)),!0;case"gotpointercapture":return h=o.pointerId,pg.set(h,Tm(pg.get(h)||null,t,e,n,r,o)),!0}return!1}function ck(t){var e=ad(t.target);if(e!==null){var n=Dd(e);if(n!==null){if(e=n.tag,e===13){if(e=QA(n),e!==null){t.blockedOn=e,uk(t.priority,function(){ak(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ty(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=lb(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);nb=r,n.target.dispatchEvent(r),nb=null}else return e=Zg(n),e!==null&&N1(e),t.blockedOn=n,!1;e.shift()}return!0}function WE(t,e,n){Ty(t)&&n.delete(e)}function DO(){ab=!1,ih!==null&&Ty(ih)&&(ih=null),rh!==null&&Ty(rh)&&(rh=null),sh!==null&&Ty(sh)&&(sh=null),fg.forEach(WE),pg.forEach(WE)}function Sm(t,e){t.blockedOn===e&&(t.blockedOn=null,ab||(ab=!0,va.unstable_scheduleCallback(va.unstable_NormalPriority,DO)))}function mg(t){function e(o){return Sm(o,t)}if(0<Y_.length){Sm(Y_[0],t);for(var n=1;n<Y_.length;n++){var r=Y_[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ih!==null&&Sm(ih,t),rh!==null&&Sm(rh,t),sh!==null&&Sm(sh,t),fg.forEach(e),pg.forEach(e),n=0;n<Gc.length;n++)r=Gc[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Gc.length&&(n=Gc[0],n.blockedOn===null);)ck(n),n.blockedOn===null&&Gc.shift()}var Wf=yc.ReactCurrentBatchConfig,tv=!0;function zO(t,e,n,r){var o=bi,h=Wf.transition;Wf.transition=null;try{bi=1,O1(t,e,n,r)}finally{bi=o,Wf.transition=h}}function NO(t,e,n,r){var o=bi,h=Wf.transition;Wf.transition=null;try{bi=4,O1(t,e,n,r)}finally{bi=o,Wf.transition=h}}function O1(t,e,n,r){if(tv){var o=lb(t,e,n,r);if(o===null)rw(t,e,r,nv,n),ZE(t,r);else if(LO(o,t,e,n,r))r.stopPropagation();else if(ZE(t,r),e&4&&-1<RO.indexOf(t)){for(;o!==null;){var h=Zg(o);if(h!==null&&ok(h),h=lb(t,e,n,r),h===null&&rw(t,e,r,nv,n),h===o)break;o=h}o!==null&&r.stopPropagation()}else rw(t,e,r,null,n)}}var nv=null;function lb(t,e,n,r){if(nv=null,t=L1(r),t=ad(t),t!==null)if(e=Dd(t),e===null)t=null;else if(n=e.tag,n===13){if(t=QA(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return nv=t,null}function hk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(TO()){case D1:return 1;case nk:return 4;case Jy:case SO:return 16;case ik:return 536870912;default:return 16}default:return 16}}var Qc=null,F1=null,Sy=null;function dk(){if(Sy)return Sy;var t,e=F1,n=e.length,r,o="value"in Qc?Qc.value:Qc.textContent,h=o.length;for(t=0;t<n&&e[t]===o[t];t++);var f=n-t;for(r=1;r<=f&&e[n-r]===o[h-r];r++);return Sy=o.slice(t,1<r?1-r:void 0)}function Ey(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Q_(){return!0}function KE(){return!1}function wa(t){function e(n,r,o,h,f){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=h,this.target=f,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(h):h[l]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Q_:KE,this.isPropagationStopped=KE,this}return ur(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Q_)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Q_)},persist:function(){},isPersistent:Q_}),e}var Sp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},B1=wa(Sp),Gg=ur({},Sp,{view:0,detail:0}),OO=wa(Gg),Kx,Xx,Em,Jv=ur({},Gg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:V1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Em&&(Em&&t.type==="mousemove"?(Kx=t.screenX-Em.screenX,Xx=t.screenY-Em.screenY):Xx=Kx=0,Em=t),Kx)},movementY:function(t){return"movementY"in t?t.movementY:Xx}}),XE=wa(Jv),FO=ur({},Jv,{dataTransfer:0}),BO=wa(FO),VO=ur({},Gg,{relatedTarget:0}),Yx=wa(VO),jO=ur({},Sp,{animationName:0,elapsedTime:0,pseudoElement:0}),UO=wa(jO),$O=ur({},Sp,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),qO=wa($O),HO=ur({},Sp,{data:0}),YE=wa(HO),GO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ZO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function KO(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=WO[t])?!!e[t]:!1}function V1(){return KO}var XO=ur({},Gg,{key:function(t){if(t.key){var e=GO[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ey(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ZO[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:V1,charCode:function(t){return t.type==="keypress"?Ey(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ey(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),YO=wa(XO),QO=ur({},Jv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),QE=wa(QO),JO=ur({},Gg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:V1}),e3=wa(JO),t3=ur({},Sp,{propertyName:0,elapsedTime:0,pseudoElement:0}),n3=wa(t3),i3=ur({},Jv,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),r3=wa(i3),s3=[9,13,27,32],j1=ac&&"CompositionEvent"in window,Zm=null;ac&&"documentMode"in document&&(Zm=document.documentMode);var o3=ac&&"TextEvent"in window&&!Zm,fk=ac&&(!j1||Zm&&8<Zm&&11>=Zm),JE=" ",eI=!1;function pk(t,e){switch(t){case"keyup":return s3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Df=!1;function a3(t,e){switch(t){case"compositionend":return mk(e);case"keypress":return e.which!==32?null:(eI=!0,JE);case"textInput":return t=e.data,t===JE&&eI?null:t;default:return null}}function l3(t,e){if(Df)return t==="compositionend"||!j1&&pk(t,e)?(t=dk(),Sy=F1=Qc=null,Df=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return fk&&e.locale!=="ko"?null:e.data;default:return null}}var u3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!u3[t.type]:e==="textarea"}function gk(t,e,n,r){ZA(r),e=iv(e,"onChange"),0<e.length&&(n=new B1("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Wm=null,gg=null;function c3(t){Pk(t,0)}function e0(t){var e=Of(t);if(VA(e))return t}function h3(t,e){if(t==="change")return e}var _k=!1;if(ac){var Qx;if(ac){var Jx="oninput"in document;if(!Jx){var nI=document.createElement("div");nI.setAttribute("oninput","return;"),Jx=typeof nI.oninput=="function"}Qx=Jx}else Qx=!1;_k=Qx&&(!document.documentMode||9<document.documentMode)}function iI(){Wm&&(Wm.detachEvent("onpropertychange",yk),gg=Wm=null)}function yk(t){if(t.propertyName==="value"&&e0(gg)){var e=[];gk(e,gg,t,L1(t)),YA(c3,e)}}function d3(t,e,n){t==="focusin"?(iI(),Wm=e,gg=n,Wm.attachEvent("onpropertychange",yk)):t==="focusout"&&iI()}function f3(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return e0(gg)}function p3(t,e){if(t==="click")return e0(e)}function m3(t,e){if(t==="input"||t==="change")return e0(e)}function g3(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ol=typeof Object.is=="function"?Object.is:g3;function _g(t,e){if(Ol(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!qw.call(e,o)||!Ol(t[o],e[o]))return!1}return!0}function rI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function sI(t,e){var n=rI(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=rI(n)}}function vk(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?vk(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function xk(){for(var t=window,e=Xy();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Xy(t.document)}return e}function U1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function _3(t){var e=xk(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&vk(n.ownerDocument.documentElement,n)){if(r!==null&&U1(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,h=Math.min(r.start,o);r=r.end===void 0?h:Math.min(r.end,o),!t.extend&&h>r&&(o=r,r=h,h=o),o=sI(n,h);var f=sI(n,r);o&&f&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==f.node||t.focusOffset!==f.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),h>r?(t.addRange(e),t.extend(f.node,f.offset)):(e.setEnd(f.node,f.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var y3=ac&&"documentMode"in document&&11>=document.documentMode,zf=null,ub=null,Km=null,cb=!1;function oI(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;cb||zf==null||zf!==Xy(r)||(r=zf,"selectionStart"in r&&U1(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Km&&_g(Km,r)||(Km=r,r=iv(ub,"onSelect"),0<r.length&&(e=new B1("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=zf)))}function J_(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Nf={animationend:J_("Animation","AnimationEnd"),animationiteration:J_("Animation","AnimationIteration"),animationstart:J_("Animation","AnimationStart"),transitionend:J_("Transition","TransitionEnd")},ew={},wk={};ac&&(wk=document.createElement("div").style,"AnimationEvent"in window||(delete Nf.animationend.animation,delete Nf.animationiteration.animation,delete Nf.animationstart.animation),"TransitionEvent"in window||delete Nf.transitionend.transition);function t0(t){if(ew[t])return ew[t];if(!Nf[t])return t;var e=Nf[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in wk)return ew[t]=e[n];return t}var bk=t0("animationend"),Tk=t0("animationiteration"),Sk=t0("animationstart"),Ek=t0("transitionend"),Ik=new Map,aI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Th(t,e){Ik.set(t,e),Ld(e,[t])}for(var tw=0;tw<aI.length;tw++){var nw=aI[tw],v3=nw.toLowerCase(),x3=nw[0].toUpperCase()+nw.slice(1);Th(v3,"on"+x3)}Th(bk,"onAnimationEnd");Th(Tk,"onAnimationIteration");Th(Sk,"onAnimationStart");Th("dblclick","onDoubleClick");Th("focusin","onFocus");Th("focusout","onBlur");Th(Ek,"onTransitionEnd");op("onMouseEnter",["mouseout","mouseover"]);op("onMouseLeave",["mouseout","mouseover"]);op("onPointerEnter",["pointerout","pointerover"]);op("onPointerLeave",["pointerout","pointerover"]);Ld("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ld("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ld("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ld("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ld("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ld("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Om="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),w3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Om));function lI(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,vO(r,e,void 0,t),t.currentTarget=null}function Pk(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],o=r.event;r=r.listeners;e:{var h=void 0;if(e)for(var f=r.length-1;0<=f;f--){var l=r[f],S=l.instance,A=l.currentTarget;if(l=l.listener,S!==h&&o.isPropagationStopped())break e;lI(o,l,A),h=S}else for(f=0;f<r.length;f++){if(l=r[f],S=l.instance,A=l.currentTarget,l=l.listener,S!==h&&o.isPropagationStopped())break e;lI(o,l,A),h=S}}}if(Qy)throw t=sb,Qy=!1,sb=null,t}function Zi(t,e){var n=e[mb];n===void 0&&(n=e[mb]=new Set);var r=t+"__bubble";n.has(r)||(Ck(e,t,2,!1),n.add(r))}function iw(t,e,n){var r=0;e&&(r|=4),Ck(n,t,r,e)}var ey="_reactListening"+Math.random().toString(36).slice(2);function yg(t){if(!t[ey]){t[ey]=!0,zA.forEach(function(n){n!=="selectionchange"&&(w3.has(n)||iw(n,!1,t),iw(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ey]||(e[ey]=!0,iw("selectionchange",!1,e))}}function Ck(t,e,n,r){switch(hk(e)){case 1:var o=zO;break;case 4:o=NO;break;default:o=O1}n=o.bind(null,e,n,t),o=void 0,!rb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),r?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function rw(t,e,n,r,o){var h=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var f=r.tag;if(f===3||f===4){var l=r.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(f===4)for(f=r.return;f!==null;){var S=f.tag;if((S===3||S===4)&&(S=f.stateNode.containerInfo,S===o||S.nodeType===8&&S.parentNode===o))return;f=f.return}for(;l!==null;){if(f=ad(l),f===null)return;if(S=f.tag,S===5||S===6){r=h=f;continue e}l=l.parentNode}}r=r.return}YA(function(){var A=h,O=L1(n),U=[];e:{var H=Ik.get(t);if(H!==void 0){var $=B1,ie=t;switch(t){case"keypress":if(Ey(n)===0)break e;case"keydown":case"keyup":$=YO;break;case"focusin":ie="focus",$=Yx;break;case"focusout":ie="blur",$=Yx;break;case"beforeblur":case"afterblur":$=Yx;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=XE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=BO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=e3;break;case bk:case Tk:case Sk:$=UO;break;case Ek:$=n3;break;case"scroll":$=OO;break;case"wheel":$=r3;break;case"copy":case"cut":case"paste":$=qO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=QE}var me=(e&4)!==0,Me=!me&&t==="scroll",ce=me?H!==null?H+"Capture":null:H;me=[];for(var le=A,ge;le!==null;){ge=le;var je=ge.stateNode;if(ge.tag===5&&je!==null&&(ge=je,ce!==null&&(je=dg(le,ce),je!=null&&me.push(vg(le,je,ge)))),Me)break;le=le.return}0<me.length&&(H=new $(H,ie,null,n,O),U.push({event:H,listeners:me}))}}if(!(e&7)){e:{if(H=t==="mouseover"||t==="pointerover",$=t==="mouseout"||t==="pointerout",H&&n!==nb&&(ie=n.relatedTarget||n.fromElement)&&(ad(ie)||ie[lc]))break e;if(($||H)&&(H=O.window===O?O:(H=O.ownerDocument)?H.defaultView||H.parentWindow:window,$?(ie=n.relatedTarget||n.toElement,$=A,ie=ie?ad(ie):null,ie!==null&&(Me=Dd(ie),ie!==Me||ie.tag!==5&&ie.tag!==6)&&(ie=null)):($=null,ie=A),$!==ie)){if(me=XE,je="onMouseLeave",ce="onMouseEnter",le="mouse",(t==="pointerout"||t==="pointerover")&&(me=QE,je="onPointerLeave",ce="onPointerEnter",le="pointer"),Me=$==null?H:Of($),ge=ie==null?H:Of(ie),H=new me(je,le+"leave",$,n,O),H.target=Me,H.relatedTarget=ge,je=null,ad(O)===A&&(me=new me(ce,le+"enter",ie,n,O),me.target=ge,me.relatedTarget=Me,je=me),Me=je,$&&ie)t:{for(me=$,ce=ie,le=0,ge=me;ge;ge=xf(ge))le++;for(ge=0,je=ce;je;je=xf(je))ge++;for(;0<le-ge;)me=xf(me),le--;for(;0<ge-le;)ce=xf(ce),ge--;for(;le--;){if(me===ce||ce!==null&&me===ce.alternate)break t;me=xf(me),ce=xf(ce)}me=null}else me=null;$!==null&&uI(U,H,$,me,!1),ie!==null&&Me!==null&&uI(U,Me,ie,me,!0)}}e:{if(H=A?Of(A):window,$=H.nodeName&&H.nodeName.toLowerCase(),$==="select"||$==="input"&&H.type==="file")var rt=h3;else if(tI(H))if(_k)rt=m3;else{rt=f3;var qe=d3}else($=H.nodeName)&&$.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(rt=p3);if(rt&&(rt=rt(t,A))){gk(U,rt,n,O);break e}qe&&qe(t,H,A),t==="focusout"&&(qe=H._wrapperState)&&qe.controlled&&H.type==="number"&&Yw(H,"number",H.value)}switch(qe=A?Of(A):window,t){case"focusin":(tI(qe)||qe.contentEditable==="true")&&(zf=qe,ub=A,Km=null);break;case"focusout":Km=ub=zf=null;break;case"mousedown":cb=!0;break;case"contextmenu":case"mouseup":case"dragend":cb=!1,oI(U,n,O);break;case"selectionchange":if(y3)break;case"keydown":case"keyup":oI(U,n,O)}var fe;if(j1)e:{switch(t){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else Df?pk(t,n)&&(Q="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Q="onCompositionStart");Q&&(fk&&n.locale!=="ko"&&(Df||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&Df&&(fe=dk()):(Qc=O,F1="value"in Qc?Qc.value:Qc.textContent,Df=!0)),qe=iv(A,Q),0<qe.length&&(Q=new YE(Q,t,null,n,O),U.push({event:Q,listeners:qe}),fe?Q.data=fe:(fe=mk(n),fe!==null&&(Q.data=fe)))),(fe=o3?a3(t,n):l3(t,n))&&(A=iv(A,"onBeforeInput"),0<A.length&&(O=new YE("onBeforeInput","beforeinput",null,n,O),U.push({event:O,listeners:A}),O.data=fe))}Pk(U,e)})}function vg(t,e,n){return{instance:t,listener:e,currentTarget:n}}function iv(t,e){for(var n=e+"Capture",r=[];t!==null;){var o=t,h=o.stateNode;o.tag===5&&h!==null&&(o=h,h=dg(t,n),h!=null&&r.unshift(vg(t,h,o)),h=dg(t,e),h!=null&&r.push(vg(t,h,o))),t=t.return}return r}function xf(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function uI(t,e,n,r,o){for(var h=e._reactName,f=[];n!==null&&n!==r;){var l=n,S=l.alternate,A=l.stateNode;if(S!==null&&S===r)break;l.tag===5&&A!==null&&(l=A,o?(S=dg(n,h),S!=null&&f.unshift(vg(n,S,l))):o||(S=dg(n,h),S!=null&&f.push(vg(n,S,l)))),n=n.return}f.length!==0&&t.push({event:e,listeners:f})}var b3=/\r\n?/g,T3=/\u0000|\uFFFD/g;function cI(t){return(typeof t=="string"?t:""+t).replace(b3,`
`).replace(T3,"")}function ty(t,e,n){if(e=cI(e),cI(t)!==e&&n)throw Error(Et(425))}function rv(){}var hb=null,db=null;function fb(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var pb=typeof setTimeout=="function"?setTimeout:void 0,S3=typeof clearTimeout=="function"?clearTimeout:void 0,hI=typeof Promise=="function"?Promise:void 0,E3=typeof queueMicrotask=="function"?queueMicrotask:typeof hI<"u"?function(t){return hI.resolve(null).then(t).catch(I3)}:pb;function I3(t){setTimeout(function(){throw t})}function sw(t,e){var n=e,r=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){t.removeChild(o),mg(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);mg(e)}function oh(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function dI(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ep=Math.random().toString(36).slice(2),hu="__reactFiber$"+Ep,xg="__reactProps$"+Ep,lc="__reactContainer$"+Ep,mb="__reactEvents$"+Ep,P3="__reactListeners$"+Ep,C3="__reactHandles$"+Ep;function ad(t){var e=t[hu];if(e)return e;for(var n=t.parentNode;n;){if(e=n[lc]||n[hu]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=dI(t);t!==null;){if(n=t[hu])return n;t=dI(t)}return e}t=n,n=t.parentNode}return null}function Zg(t){return t=t[hu]||t[lc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Of(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Et(33))}function n0(t){return t[xg]||null}var gb=[],Ff=-1;function Sh(t){return{current:t}}function Ki(t){0>Ff||(t.current=gb[Ff],gb[Ff]=null,Ff--)}function Ui(t,e){Ff++,gb[Ff]=t.current,t.current=e}var _h={},Js=Sh(_h),Ho=Sh(!1),bd=_h;function ap(t,e){var n=t.type.contextTypes;if(!n)return _h;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var o={},h;for(h in n)o[h]=e[h];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Go(t){return t=t.childContextTypes,t!=null}function sv(){Ki(Ho),Ki(Js)}function fI(t,e,n){if(Js.current!==_h)throw Error(Et(168));Ui(Js,e),Ui(Ho,n)}function Ak(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in e))throw Error(Et(108,dO(t)||"Unknown",o));return ur({},n,r)}function ov(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||_h,bd=Js.current,Ui(Js,t),Ui(Ho,Ho.current),!0}function pI(t,e,n){var r=t.stateNode;if(!r)throw Error(Et(169));n?(t=Ak(t,e,bd),r.__reactInternalMemoizedMergedChildContext=t,Ki(Ho),Ki(Js),Ui(Js,t)):Ki(Ho),Ui(Ho,n)}var Xu=null,i0=!1,ow=!1;function kk(t){Xu===null?Xu=[t]:Xu.push(t)}function A3(t){i0=!0,kk(t)}function Eh(){if(!ow&&Xu!==null){ow=!0;var t=0,e=bi;try{var n=Xu;for(bi=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Xu=null,i0=!1}catch(o){throw Xu!==null&&(Xu=Xu.slice(t+1)),tk(D1,Eh),o}finally{bi=e,ow=!1}}return null}var Bf=[],Vf=0,av=null,lv=0,Va=[],ja=0,Td=null,Yu=1,Qu="";function nd(t,e){Bf[Vf++]=lv,Bf[Vf++]=av,av=t,lv=e}function Mk(t,e,n){Va[ja++]=Yu,Va[ja++]=Qu,Va[ja++]=Td,Td=t;var r=Yu;t=Qu;var o=32-Dl(r)-1;r&=~(1<<o),n+=1;var h=32-Dl(e)+o;if(30<h){var f=o-o%5;h=(r&(1<<f)-1).toString(32),r>>=f,o-=f,Yu=1<<32-Dl(e)+o|n<<o|r,Qu=h+t}else Yu=1<<h|n<<o|r,Qu=t}function $1(t){t.return!==null&&(nd(t,1),Mk(t,1,0))}function q1(t){for(;t===av;)av=Bf[--Vf],Bf[Vf]=null,lv=Bf[--Vf],Bf[Vf]=null;for(;t===Td;)Td=Va[--ja],Va[ja]=null,Qu=Va[--ja],Va[ja]=null,Yu=Va[--ja],Va[ja]=null}var _a=null,ga=null,Ji=!1,Al=null;function Rk(t,e){var n=$a(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function mI(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,_a=t,ga=oh(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,_a=t,ga=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Td!==null?{id:Yu,overflow:Qu}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=$a(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,_a=t,ga=null,!0):!1;default:return!1}}function _b(t){return(t.mode&1)!==0&&(t.flags&128)===0}function yb(t){if(Ji){var e=ga;if(e){var n=e;if(!mI(t,e)){if(_b(t))throw Error(Et(418));e=oh(n.nextSibling);var r=_a;e&&mI(t,e)?Rk(r,n):(t.flags=t.flags&-4097|2,Ji=!1,_a=t)}}else{if(_b(t))throw Error(Et(418));t.flags=t.flags&-4097|2,Ji=!1,_a=t}}}function gI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;_a=t}function ny(t){if(t!==_a)return!1;if(!Ji)return gI(t),Ji=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!fb(t.type,t.memoizedProps)),e&&(e=ga)){if(_b(t))throw Lk(),Error(Et(418));for(;e;)Rk(t,e),e=oh(e.nextSibling)}if(gI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Et(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ga=oh(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ga=null}}else ga=_a?oh(t.stateNode.nextSibling):null;return!0}function Lk(){for(var t=ga;t;)t=oh(t.nextSibling)}function lp(){ga=_a=null,Ji=!1}function H1(t){Al===null?Al=[t]:Al.push(t)}var k3=yc.ReactCurrentBatchConfig;function Im(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Et(309));var r=n.stateNode}if(!r)throw Error(Et(147,t));var o=r,h=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===h?e.ref:(e=function(f){var l=o.refs;f===null?delete l[h]:l[h]=f},e._stringRef=h,e)}if(typeof t!="string")throw Error(Et(284));if(!n._owner)throw Error(Et(290,t))}return t}function iy(t,e){throw t=Object.prototype.toString.call(e),Error(Et(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function _I(t){var e=t._init;return e(t._payload)}function Dk(t){function e(ce,le){if(t){var ge=ce.deletions;ge===null?(ce.deletions=[le],ce.flags|=16):ge.push(le)}}function n(ce,le){if(!t)return null;for(;le!==null;)e(ce,le),le=le.sibling;return null}function r(ce,le){for(ce=new Map;le!==null;)le.key!==null?ce.set(le.key,le):ce.set(le.index,le),le=le.sibling;return ce}function o(ce,le){return ce=ch(ce,le),ce.index=0,ce.sibling=null,ce}function h(ce,le,ge){return ce.index=ge,t?(ge=ce.alternate,ge!==null?(ge=ge.index,ge<le?(ce.flags|=2,le):ge):(ce.flags|=2,le)):(ce.flags|=1048576,le)}function f(ce){return t&&ce.alternate===null&&(ce.flags|=2),ce}function l(ce,le,ge,je){return le===null||le.tag!==6?(le=fw(ge,ce.mode,je),le.return=ce,le):(le=o(le,ge),le.return=ce,le)}function S(ce,le,ge,je){var rt=ge.type;return rt===Lf?O(ce,le,ge.props.children,je,ge.key):le!==null&&(le.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===qc&&_I(rt)===le.type)?(je=o(le,ge.props),je.ref=Im(ce,le,ge),je.return=ce,je):(je=Ry(ge.type,ge.key,ge.props,null,ce.mode,je),je.ref=Im(ce,le,ge),je.return=ce,je)}function A(ce,le,ge,je){return le===null||le.tag!==4||le.stateNode.containerInfo!==ge.containerInfo||le.stateNode.implementation!==ge.implementation?(le=pw(ge,ce.mode,je),le.return=ce,le):(le=o(le,ge.children||[]),le.return=ce,le)}function O(ce,le,ge,je,rt){return le===null||le.tag!==7?(le=pd(ge,ce.mode,je,rt),le.return=ce,le):(le=o(le,ge),le.return=ce,le)}function U(ce,le,ge){if(typeof le=="string"&&le!==""||typeof le=="number")return le=fw(""+le,ce.mode,ge),le.return=ce,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case G_:return ge=Ry(le.type,le.key,le.props,null,ce.mode,ge),ge.ref=Im(ce,null,le),ge.return=ce,ge;case Rf:return le=pw(le,ce.mode,ge),le.return=ce,le;case qc:var je=le._init;return U(ce,je(le._payload),ge)}if(zm(le)||wm(le))return le=pd(le,ce.mode,ge,null),le.return=ce,le;iy(ce,le)}return null}function H(ce,le,ge,je){var rt=le!==null?le.key:null;if(typeof ge=="string"&&ge!==""||typeof ge=="number")return rt!==null?null:l(ce,le,""+ge,je);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case G_:return ge.key===rt?S(ce,le,ge,je):null;case Rf:return ge.key===rt?A(ce,le,ge,je):null;case qc:return rt=ge._init,H(ce,le,rt(ge._payload),je)}if(zm(ge)||wm(ge))return rt!==null?null:O(ce,le,ge,je,null);iy(ce,ge)}return null}function $(ce,le,ge,je,rt){if(typeof je=="string"&&je!==""||typeof je=="number")return ce=ce.get(ge)||null,l(le,ce,""+je,rt);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case G_:return ce=ce.get(je.key===null?ge:je.key)||null,S(le,ce,je,rt);case Rf:return ce=ce.get(je.key===null?ge:je.key)||null,A(le,ce,je,rt);case qc:var qe=je._init;return $(ce,le,ge,qe(je._payload),rt)}if(zm(je)||wm(je))return ce=ce.get(ge)||null,O(le,ce,je,rt,null);iy(le,je)}return null}function ie(ce,le,ge,je){for(var rt=null,qe=null,fe=le,Q=le=0,ue=null;fe!==null&&Q<ge.length;Q++){fe.index>Q?(ue=fe,fe=null):ue=fe.sibling;var ve=H(ce,fe,ge[Q],je);if(ve===null){fe===null&&(fe=ue);break}t&&fe&&ve.alternate===null&&e(ce,fe),le=h(ve,le,Q),qe===null?rt=ve:qe.sibling=ve,qe=ve,fe=ue}if(Q===ge.length)return n(ce,fe),Ji&&nd(ce,Q),rt;if(fe===null){for(;Q<ge.length;Q++)fe=U(ce,ge[Q],je),fe!==null&&(le=h(fe,le,Q),qe===null?rt=fe:qe.sibling=fe,qe=fe);return Ji&&nd(ce,Q),rt}for(fe=r(ce,fe);Q<ge.length;Q++)ue=$(fe,ce,Q,ge[Q],je),ue!==null&&(t&&ue.alternate!==null&&fe.delete(ue.key===null?Q:ue.key),le=h(ue,le,Q),qe===null?rt=ue:qe.sibling=ue,qe=ue);return t&&fe.forEach(function(Pe){return e(ce,Pe)}),Ji&&nd(ce,Q),rt}function me(ce,le,ge,je){var rt=wm(ge);if(typeof rt!="function")throw Error(Et(150));if(ge=rt.call(ge),ge==null)throw Error(Et(151));for(var qe=rt=null,fe=le,Q=le=0,ue=null,ve=ge.next();fe!==null&&!ve.done;Q++,ve=ge.next()){fe.index>Q?(ue=fe,fe=null):ue=fe.sibling;var Pe=H(ce,fe,ve.value,je);if(Pe===null){fe===null&&(fe=ue);break}t&&fe&&Pe.alternate===null&&e(ce,fe),le=h(Pe,le,Q),qe===null?rt=Pe:qe.sibling=Pe,qe=Pe,fe=ue}if(ve.done)return n(ce,fe),Ji&&nd(ce,Q),rt;if(fe===null){for(;!ve.done;Q++,ve=ge.next())ve=U(ce,ve.value,je),ve!==null&&(le=h(ve,le,Q),qe===null?rt=ve:qe.sibling=ve,qe=ve);return Ji&&nd(ce,Q),rt}for(fe=r(ce,fe);!ve.done;Q++,ve=ge.next())ve=$(fe,ce,Q,ve.value,je),ve!==null&&(t&&ve.alternate!==null&&fe.delete(ve.key===null?Q:ve.key),le=h(ve,le,Q),qe===null?rt=ve:qe.sibling=ve,qe=ve);return t&&fe.forEach(function(Ve){return e(ce,Ve)}),Ji&&nd(ce,Q),rt}function Me(ce,le,ge,je){if(typeof ge=="object"&&ge!==null&&ge.type===Lf&&ge.key===null&&(ge=ge.props.children),typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case G_:e:{for(var rt=ge.key,qe=le;qe!==null;){if(qe.key===rt){if(rt=ge.type,rt===Lf){if(qe.tag===7){n(ce,qe.sibling),le=o(qe,ge.props.children),le.return=ce,ce=le;break e}}else if(qe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===qc&&_I(rt)===qe.type){n(ce,qe.sibling),le=o(qe,ge.props),le.ref=Im(ce,qe,ge),le.return=ce,ce=le;break e}n(ce,qe);break}else e(ce,qe);qe=qe.sibling}ge.type===Lf?(le=pd(ge.props.children,ce.mode,je,ge.key),le.return=ce,ce=le):(je=Ry(ge.type,ge.key,ge.props,null,ce.mode,je),je.ref=Im(ce,le,ge),je.return=ce,ce=je)}return f(ce);case Rf:e:{for(qe=ge.key;le!==null;){if(le.key===qe)if(le.tag===4&&le.stateNode.containerInfo===ge.containerInfo&&le.stateNode.implementation===ge.implementation){n(ce,le.sibling),le=o(le,ge.children||[]),le.return=ce,ce=le;break e}else{n(ce,le);break}else e(ce,le);le=le.sibling}le=pw(ge,ce.mode,je),le.return=ce,ce=le}return f(ce);case qc:return qe=ge._init,Me(ce,le,qe(ge._payload),je)}if(zm(ge))return ie(ce,le,ge,je);if(wm(ge))return me(ce,le,ge,je);iy(ce,ge)}return typeof ge=="string"&&ge!==""||typeof ge=="number"?(ge=""+ge,le!==null&&le.tag===6?(n(ce,le.sibling),le=o(le,ge),le.return=ce,ce=le):(n(ce,le),le=fw(ge,ce.mode,je),le.return=ce,ce=le),f(ce)):n(ce,le)}return Me}var up=Dk(!0),zk=Dk(!1),uv=Sh(null),cv=null,jf=null,G1=null;function Z1(){G1=jf=cv=null}function W1(t){var e=uv.current;Ki(uv),t._currentValue=e}function vb(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Kf(t,e){cv=t,G1=jf=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(qo=!0),t.firstContext=null)}function Ka(t){var e=t._currentValue;if(G1!==t)if(t={context:t,memoizedValue:e,next:null},jf===null){if(cv===null)throw Error(Et(308));jf=t,cv.dependencies={lanes:0,firstContext:t}}else jf=jf.next=t;return e}var ld=null;function K1(t){ld===null?ld=[t]:ld.push(t)}function Nk(t,e,n,r){var o=e.interleaved;return o===null?(n.next=n,K1(e)):(n.next=o.next,o.next=n),e.interleaved=n,uc(t,r)}function uc(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Hc=!1;function X1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ok(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function nc(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ah(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ti&2){var o=r.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),r.pending=e,uc(t,n)}return o=r.interleaved,o===null?(e.next=e,K1(r)):(e.next=o.next,o.next=e),r.interleaved=e,uc(t,n)}function Iy(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,z1(t,n)}}function yI(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,h=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};h===null?o=h=f:h=h.next=f,n=n.next}while(n!==null);h===null?o=h=e:h=h.next=e}else o=h=e;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:h,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hv(t,e,n,r){var o=t.updateQueue;Hc=!1;var h=o.firstBaseUpdate,f=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var S=l,A=S.next;S.next=null,f===null?h=A:f.next=A,f=S;var O=t.alternate;O!==null&&(O=O.updateQueue,l=O.lastBaseUpdate,l!==f&&(l===null?O.firstBaseUpdate=A:l.next=A,O.lastBaseUpdate=S))}if(h!==null){var U=o.baseState;f=0,O=A=S=null,l=h;do{var H=l.lane,$=l.eventTime;if((r&H)===H){O!==null&&(O=O.next={eventTime:$,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var ie=t,me=l;switch(H=e,$=n,me.tag){case 1:if(ie=me.payload,typeof ie=="function"){U=ie.call($,U,H);break e}U=ie;break e;case 3:ie.flags=ie.flags&-65537|128;case 0:if(ie=me.payload,H=typeof ie=="function"?ie.call($,U,H):ie,H==null)break e;U=ur({},U,H);break e;case 2:Hc=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,H=o.effects,H===null?o.effects=[l]:H.push(l))}else $={eventTime:$,lane:H,tag:l.tag,payload:l.payload,callback:l.callback,next:null},O===null?(A=O=$,S=U):O=O.next=$,f|=H;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;H=l,l=H.next,H.next=null,o.lastBaseUpdate=H,o.shared.pending=null}}while(!0);if(O===null&&(S=U),o.baseState=S,o.firstBaseUpdate=A,o.lastBaseUpdate=O,e=o.shared.interleaved,e!==null){o=e;do f|=o.lane,o=o.next;while(o!==e)}else h===null&&(o.shared.lanes=0);Ed|=f,t.lanes=f,t.memoizedState=U}}function vI(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(Et(191,o));o.call(r)}}}var Wg={},pu=Sh(Wg),wg=Sh(Wg),bg=Sh(Wg);function ud(t){if(t===Wg)throw Error(Et(174));return t}function Y1(t,e){switch(Ui(bg,e),Ui(wg,t),Ui(pu,Wg),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Jw(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Jw(e,t)}Ki(pu),Ui(pu,e)}function cp(){Ki(pu),Ki(wg),Ki(bg)}function Fk(t){ud(bg.current);var e=ud(pu.current),n=Jw(e,t.type);e!==n&&(Ui(wg,t),Ui(pu,n))}function Q1(t){wg.current===t&&(Ki(pu),Ki(wg))}var or=Sh(0);function dv(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var aw=[];function J1(){for(var t=0;t<aw.length;t++)aw[t]._workInProgressVersionPrimary=null;aw.length=0}var Py=yc.ReactCurrentDispatcher,lw=yc.ReactCurrentBatchConfig,Sd=0,ar=null,Qr=null,ls=null,fv=!1,Xm=!1,Tg=0,M3=0;function Zs(){throw Error(Et(321))}function eT(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ol(t[n],e[n]))return!1;return!0}function tT(t,e,n,r,o,h){if(Sd=h,ar=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Py.current=t===null||t.memoizedState===null?z3:N3,t=n(r,o),Xm){h=0;do{if(Xm=!1,Tg=0,25<=h)throw Error(Et(301));h+=1,ls=Qr=null,e.updateQueue=null,Py.current=O3,t=n(r,o)}while(Xm)}if(Py.current=pv,e=Qr!==null&&Qr.next!==null,Sd=0,ls=Qr=ar=null,fv=!1,e)throw Error(Et(300));return t}function nT(){var t=Tg!==0;return Tg=0,t}function lu(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ls===null?ar.memoizedState=ls=t:ls=ls.next=t,ls}function Xa(){if(Qr===null){var t=ar.alternate;t=t!==null?t.memoizedState:null}else t=Qr.next;var e=ls===null?ar.memoizedState:ls.next;if(e!==null)ls=e,Qr=t;else{if(t===null)throw Error(Et(310));Qr=t,t={memoizedState:Qr.memoizedState,baseState:Qr.baseState,baseQueue:Qr.baseQueue,queue:Qr.queue,next:null},ls===null?ar.memoizedState=ls=t:ls=ls.next=t}return ls}function Sg(t,e){return typeof e=="function"?e(t):e}function uw(t){var e=Xa(),n=e.queue;if(n===null)throw Error(Et(311));n.lastRenderedReducer=t;var r=Qr,o=r.baseQueue,h=n.pending;if(h!==null){if(o!==null){var f=o.next;o.next=h.next,h.next=f}r.baseQueue=o=h,n.pending=null}if(o!==null){h=o.next,r=r.baseState;var l=f=null,S=null,A=h;do{var O=A.lane;if((Sd&O)===O)S!==null&&(S=S.next={lane:0,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),r=A.hasEagerState?A.eagerState:t(r,A.action);else{var U={lane:O,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null};S===null?(l=S=U,f=r):S=S.next=U,ar.lanes|=O,Ed|=O}A=A.next}while(A!==null&&A!==h);S===null?f=r:S.next=l,Ol(r,e.memoizedState)||(qo=!0),e.memoizedState=r,e.baseState=f,e.baseQueue=S,n.lastRenderedState=r}if(t=n.interleaved,t!==null){o=t;do h=o.lane,ar.lanes|=h,Ed|=h,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function cw(t){var e=Xa(),n=e.queue;if(n===null)throw Error(Et(311));n.lastRenderedReducer=t;var r=n.dispatch,o=n.pending,h=e.memoizedState;if(o!==null){n.pending=null;var f=o=o.next;do h=t(h,f.action),f=f.next;while(f!==o);Ol(h,e.memoizedState)||(qo=!0),e.memoizedState=h,e.baseQueue===null&&(e.baseState=h),n.lastRenderedState=h}return[h,r]}function Bk(){}function Vk(t,e){var n=ar,r=Xa(),o=e(),h=!Ol(r.memoizedState,o);if(h&&(r.memoizedState=o,qo=!0),r=r.queue,iT($k.bind(null,n,r,t),[t]),r.getSnapshot!==e||h||ls!==null&&ls.memoizedState.tag&1){if(n.flags|=2048,Eg(9,Uk.bind(null,n,r,o,e),void 0,null),cs===null)throw Error(Et(349));Sd&30||jk(n,e,o)}return o}function jk(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ar.updateQueue,e===null?(e={lastEffect:null,stores:null},ar.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Uk(t,e,n,r){e.value=n,e.getSnapshot=r,qk(e)&&Hk(t)}function $k(t,e,n){return n(function(){qk(e)&&Hk(t)})}function qk(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ol(t,n)}catch{return!0}}function Hk(t){var e=uc(t,1);e!==null&&zl(e,t,1,-1)}function xI(t){var e=lu();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sg,lastRenderedState:t},e.queue=t,t=t.dispatch=D3.bind(null,ar,t),[e.memoizedState,t]}function Eg(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ar.updateQueue,e===null?(e={lastEffect:null,stores:null},ar.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Gk(){return Xa().memoizedState}function Cy(t,e,n,r){var o=lu();ar.flags|=t,o.memoizedState=Eg(1|e,n,void 0,r===void 0?null:r)}function r0(t,e,n,r){var o=Xa();r=r===void 0?null:r;var h=void 0;if(Qr!==null){var f=Qr.memoizedState;if(h=f.destroy,r!==null&&eT(r,f.deps)){o.memoizedState=Eg(e,n,h,r);return}}ar.flags|=t,o.memoizedState=Eg(1|e,n,h,r)}function wI(t,e){return Cy(8390656,8,t,e)}function iT(t,e){return r0(2048,8,t,e)}function Zk(t,e){return r0(4,2,t,e)}function Wk(t,e){return r0(4,4,t,e)}function Kk(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Xk(t,e,n){return n=n!=null?n.concat([t]):null,r0(4,4,Kk.bind(null,e,t),n)}function rT(){}function Yk(t,e){var n=Xa();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&eT(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Qk(t,e){var n=Xa();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&eT(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Jk(t,e,n){return Sd&21?(Ol(n,e)||(n=rk(),ar.lanes|=n,Ed|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,qo=!0),t.memoizedState=n)}function R3(t,e){var n=bi;bi=n!==0&&4>n?n:4,t(!0);var r=lw.transition;lw.transition={};try{t(!1),e()}finally{bi=n,lw.transition=r}}function eM(){return Xa().memoizedState}function L3(t,e,n){var r=uh(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},tM(t))nM(e,n);else if(n=Nk(t,e,n,r),n!==null){var o=vo();zl(n,t,r,o),iM(n,e,r)}}function D3(t,e,n){var r=uh(t),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(tM(t))nM(e,o);else{var h=t.alternate;if(t.lanes===0&&(h===null||h.lanes===0)&&(h=e.lastRenderedReducer,h!==null))try{var f=e.lastRenderedState,l=h(f,n);if(o.hasEagerState=!0,o.eagerState=l,Ol(l,f)){var S=e.interleaved;S===null?(o.next=o,K1(e)):(o.next=S.next,S.next=o),e.interleaved=o;return}}catch{}finally{}n=Nk(t,e,o,r),n!==null&&(o=vo(),zl(n,t,r,o),iM(n,e,r))}}function tM(t){var e=t.alternate;return t===ar||e!==null&&e===ar}function nM(t,e){Xm=fv=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function iM(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,z1(t,n)}}var pv={readContext:Ka,useCallback:Zs,useContext:Zs,useEffect:Zs,useImperativeHandle:Zs,useInsertionEffect:Zs,useLayoutEffect:Zs,useMemo:Zs,useReducer:Zs,useRef:Zs,useState:Zs,useDebugValue:Zs,useDeferredValue:Zs,useTransition:Zs,useMutableSource:Zs,useSyncExternalStore:Zs,useId:Zs,unstable_isNewReconciler:!1},z3={readContext:Ka,useCallback:function(t,e){return lu().memoizedState=[t,e===void 0?null:e],t},useContext:Ka,useEffect:wI,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Cy(4194308,4,Kk.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Cy(4194308,4,t,e)},useInsertionEffect:function(t,e){return Cy(4,2,t,e)},useMemo:function(t,e){var n=lu();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=lu();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=L3.bind(null,ar,t),[r.memoizedState,t]},useRef:function(t){var e=lu();return t={current:t},e.memoizedState=t},useState:xI,useDebugValue:rT,useDeferredValue:function(t){return lu().memoizedState=t},useTransition:function(){var t=xI(!1),e=t[0];return t=R3.bind(null,t[1]),lu().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ar,o=lu();if(Ji){if(n===void 0)throw Error(Et(407));n=n()}else{if(n=e(),cs===null)throw Error(Et(349));Sd&30||jk(r,e,n)}o.memoizedState=n;var h={value:n,getSnapshot:e};return o.queue=h,wI($k.bind(null,r,h,t),[t]),r.flags|=2048,Eg(9,Uk.bind(null,r,h,n,e),void 0,null),n},useId:function(){var t=lu(),e=cs.identifierPrefix;if(Ji){var n=Qu,r=Yu;n=(r&~(1<<32-Dl(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Tg++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=M3++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},N3={readContext:Ka,useCallback:Yk,useContext:Ka,useEffect:iT,useImperativeHandle:Xk,useInsertionEffect:Zk,useLayoutEffect:Wk,useMemo:Qk,useReducer:uw,useRef:Gk,useState:function(){return uw(Sg)},useDebugValue:rT,useDeferredValue:function(t){var e=Xa();return Jk(e,Qr.memoizedState,t)},useTransition:function(){var t=uw(Sg)[0],e=Xa().memoizedState;return[t,e]},useMutableSource:Bk,useSyncExternalStore:Vk,useId:eM,unstable_isNewReconciler:!1},O3={readContext:Ka,useCallback:Yk,useContext:Ka,useEffect:iT,useImperativeHandle:Xk,useInsertionEffect:Zk,useLayoutEffect:Wk,useMemo:Qk,useReducer:cw,useRef:Gk,useState:function(){return cw(Sg)},useDebugValue:rT,useDeferredValue:function(t){var e=Xa();return Qr===null?e.memoizedState=t:Jk(e,Qr.memoizedState,t)},useTransition:function(){var t=cw(Sg)[0],e=Xa().memoizedState;return[t,e]},useMutableSource:Bk,useSyncExternalStore:Vk,useId:eM,unstable_isNewReconciler:!1};function Pl(t,e){if(t&&t.defaultProps){e=ur({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function xb(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ur({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var s0={isMounted:function(t){return(t=t._reactInternals)?Dd(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=vo(),o=uh(t),h=nc(r,o);h.payload=e,n!=null&&(h.callback=n),e=ah(t,h,o),e!==null&&(zl(e,t,o,r),Iy(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=vo(),o=uh(t),h=nc(r,o);h.tag=1,h.payload=e,n!=null&&(h.callback=n),e=ah(t,h,o),e!==null&&(zl(e,t,o,r),Iy(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=vo(),r=uh(t),o=nc(n,r);o.tag=2,e!=null&&(o.callback=e),e=ah(t,o,r),e!==null&&(zl(e,t,r,n),Iy(e,t,r))}};function bI(t,e,n,r,o,h,f){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,h,f):e.prototype&&e.prototype.isPureReactComponent?!_g(n,r)||!_g(o,h):!0}function rM(t,e,n){var r=!1,o=_h,h=e.contextType;return typeof h=="object"&&h!==null?h=Ka(h):(o=Go(e)?bd:Js.current,r=e.contextTypes,h=(r=r!=null)?ap(t,o):_h),e=new e(n,h),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=s0,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=h),e}function TI(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&s0.enqueueReplaceState(e,e.state,null)}function wb(t,e,n,r){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs={},X1(t);var h=e.contextType;typeof h=="object"&&h!==null?o.context=Ka(h):(h=Go(e)?bd:Js.current,o.context=ap(t,h)),o.state=t.memoizedState,h=e.getDerivedStateFromProps,typeof h=="function"&&(xb(t,e,h,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&s0.enqueueReplaceState(o,o.state,null),hv(t,n,o,r),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function hp(t,e){try{var n="",r=e;do n+=hO(r),r=r.return;while(r);var o=n}catch(h){o=`
Error generating stack: `+h.message+`
`+h.stack}return{value:t,source:e,stack:o,digest:null}}function hw(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function bb(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var F3=typeof WeakMap=="function"?WeakMap:Map;function sM(t,e,n){n=nc(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){gv||(gv=!0,Rb=r),bb(t,e)},n}function oM(t,e,n){n=nc(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var o=e.value;n.payload=function(){return r(o)},n.callback=function(){bb(t,e)}}var h=t.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(n.callback=function(){bb(t,e),typeof r!="function"&&(lh===null?lh=new Set([this]):lh.add(this));var f=e.stack;this.componentDidCatch(e.value,{componentStack:f!==null?f:""})}),n}function SI(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new F3;var o=new Set;r.set(e,o)}else o=r.get(e),o===void 0&&(o=new Set,r.set(e,o));o.has(n)||(o.add(n),t=Q3.bind(null,t,e,n),e.then(t,t))}function EI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function II(t,e,n,r,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=nc(-1,1),e.tag=2,ah(n,e,1))),n.lanes|=1),t)}var B3=yc.ReactCurrentOwner,qo=!1;function _o(t,e,n,r){e.child=t===null?zk(e,null,n,r):up(e,t.child,n,r)}function PI(t,e,n,r,o){n=n.render;var h=e.ref;return Kf(e,o),r=tT(t,e,n,r,h,o),n=nT(),t!==null&&!qo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,cc(t,e,o)):(Ji&&n&&$1(e),e.flags|=1,_o(t,e,r,o),e.child)}function CI(t,e,n,r,o){if(t===null){var h=n.type;return typeof h=="function"&&!dT(h)&&h.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=h,aM(t,e,h,r,o)):(t=Ry(n.type,null,r,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(h=t.child,!(t.lanes&o)){var f=h.memoizedProps;if(n=n.compare,n=n!==null?n:_g,n(f,r)&&t.ref===e.ref)return cc(t,e,o)}return e.flags|=1,t=ch(h,r),t.ref=e.ref,t.return=e,e.child=t}function aM(t,e,n,r,o){if(t!==null){var h=t.memoizedProps;if(_g(h,r)&&t.ref===e.ref)if(qo=!1,e.pendingProps=r=h,(t.lanes&o)!==0)t.flags&131072&&(qo=!0);else return e.lanes=t.lanes,cc(t,e,o)}return Tb(t,e,n,r,o)}function lM(t,e,n){var r=e.pendingProps,o=r.children,h=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ui($f,pa),pa|=n;else{if(!(n&1073741824))return t=h!==null?h.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ui($f,pa),pa|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=h!==null?h.baseLanes:n,Ui($f,pa),pa|=r}else h!==null?(r=h.baseLanes|n,e.memoizedState=null):r=n,Ui($f,pa),pa|=r;return _o(t,e,o,n),e.child}function uM(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Tb(t,e,n,r,o){var h=Go(n)?bd:Js.current;return h=ap(e,h),Kf(e,o),n=tT(t,e,n,r,h,o),r=nT(),t!==null&&!qo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,cc(t,e,o)):(Ji&&r&&$1(e),e.flags|=1,_o(t,e,n,o),e.child)}function AI(t,e,n,r,o){if(Go(n)){var h=!0;ov(e)}else h=!1;if(Kf(e,o),e.stateNode===null)Ay(t,e),rM(e,n,r),wb(e,n,r,o),r=!0;else if(t===null){var f=e.stateNode,l=e.memoizedProps;f.props=l;var S=f.context,A=n.contextType;typeof A=="object"&&A!==null?A=Ka(A):(A=Go(n)?bd:Js.current,A=ap(e,A));var O=n.getDerivedStateFromProps,U=typeof O=="function"||typeof f.getSnapshotBeforeUpdate=="function";U||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==r||S!==A)&&TI(e,f,r,A),Hc=!1;var H=e.memoizedState;f.state=H,hv(e,r,f,o),S=e.memoizedState,l!==r||H!==S||Ho.current||Hc?(typeof O=="function"&&(xb(e,n,O,r),S=e.memoizedState),(l=Hc||bI(e,n,l,r,H,S,A))?(U||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(e.flags|=4194308)):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=S),f.props=r,f.state=S,f.context=A,r=l):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{f=e.stateNode,Ok(t,e),l=e.memoizedProps,A=e.type===e.elementType?l:Pl(e.type,l),f.props=A,U=e.pendingProps,H=f.context,S=n.contextType,typeof S=="object"&&S!==null?S=Ka(S):(S=Go(n)?bd:Js.current,S=ap(e,S));var $=n.getDerivedStateFromProps;(O=typeof $=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==U||H!==S)&&TI(e,f,r,S),Hc=!1,H=e.memoizedState,f.state=H,hv(e,r,f,o);var ie=e.memoizedState;l!==U||H!==ie||Ho.current||Hc?(typeof $=="function"&&(xb(e,n,$,r),ie=e.memoizedState),(A=Hc||bI(e,n,A,r,H,ie,S)||!1)?(O||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(r,ie,S),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(r,ie,S)),typeof f.componentDidUpdate=="function"&&(e.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&H===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&H===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=ie),f.props=r,f.state=ie,f.context=S,r=A):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&H===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&H===t.memoizedState||(e.flags|=1024),r=!1)}return Sb(t,e,n,r,h,o)}function Sb(t,e,n,r,o,h){uM(t,e);var f=(e.flags&128)!==0;if(!r&&!f)return o&&pI(e,n,!1),cc(t,e,h);r=e.stateNode,B3.current=e;var l=f&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&f?(e.child=up(e,t.child,null,h),e.child=up(e,null,l,h)):_o(t,e,l,h),e.memoizedState=r.state,o&&pI(e,n,!0),e.child}function cM(t){var e=t.stateNode;e.pendingContext?fI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&fI(t,e.context,!1),Y1(t,e.containerInfo)}function kI(t,e,n,r,o){return lp(),H1(o),e.flags|=256,_o(t,e,n,r),e.child}var Eb={dehydrated:null,treeContext:null,retryLane:0};function Ib(t){return{baseLanes:t,cachePool:null,transitions:null}}function hM(t,e,n){var r=e.pendingProps,o=or.current,h=!1,f=(e.flags&128)!==0,l;if((l=f)||(l=t!==null&&t.memoizedState===null?!1:(o&2)!==0),l?(h=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),Ui(or,o&1),t===null)return yb(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(f=r.children,t=r.fallback,h?(r=e.mode,h=e.child,f={mode:"hidden",children:f},!(r&1)&&h!==null?(h.childLanes=0,h.pendingProps=f):h=l0(f,r,0,null),t=pd(t,r,n,null),h.return=e,t.return=e,h.sibling=t,e.child=h,e.child.memoizedState=Ib(n),e.memoizedState=Eb,t):sT(e,f));if(o=t.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return V3(t,e,f,r,l,o,n);if(h){h=r.fallback,f=e.mode,o=t.child,l=o.sibling;var S={mode:"hidden",children:r.children};return!(f&1)&&e.child!==o?(r=e.child,r.childLanes=0,r.pendingProps=S,e.deletions=null):(r=ch(o,S),r.subtreeFlags=o.subtreeFlags&14680064),l!==null?h=ch(l,h):(h=pd(h,f,n,null),h.flags|=2),h.return=e,r.return=e,r.sibling=h,e.child=r,r=h,h=e.child,f=t.child.memoizedState,f=f===null?Ib(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},h.memoizedState=f,h.childLanes=t.childLanes&~n,e.memoizedState=Eb,r}return h=t.child,t=h.sibling,r=ch(h,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function sT(t,e){return e=l0({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ry(t,e,n,r){return r!==null&&H1(r),up(e,t.child,null,n),t=sT(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function V3(t,e,n,r,o,h,f){if(n)return e.flags&256?(e.flags&=-257,r=hw(Error(Et(422))),ry(t,e,f,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(h=r.fallback,o=e.mode,r=l0({mode:"visible",children:r.children},o,0,null),h=pd(h,o,f,null),h.flags|=2,r.return=e,h.return=e,r.sibling=h,e.child=r,e.mode&1&&up(e,t.child,null,f),e.child.memoizedState=Ib(f),e.memoizedState=Eb,h);if(!(e.mode&1))return ry(t,e,f,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var l=r.dgst;return r=l,h=Error(Et(419)),r=hw(h,r,void 0),ry(t,e,f,r)}if(l=(f&t.childLanes)!==0,qo||l){if(r=cs,r!==null){switch(f&-f){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|f)?0:o,o!==0&&o!==h.retryLane&&(h.retryLane=o,uc(t,o),zl(r,t,o,-1))}return hT(),r=hw(Error(Et(421))),ry(t,e,f,r)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=J3.bind(null,t),o._reactRetry=e,null):(t=h.treeContext,ga=oh(o.nextSibling),_a=e,Ji=!0,Al=null,t!==null&&(Va[ja++]=Yu,Va[ja++]=Qu,Va[ja++]=Td,Yu=t.id,Qu=t.overflow,Td=e),e=sT(e,r.children),e.flags|=4096,e)}function MI(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),vb(t.return,e,n)}function dw(t,e,n,r,o){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(h.isBackwards=e,h.rendering=null,h.renderingStartTime=0,h.last=r,h.tail=n,h.tailMode=o)}function dM(t,e,n){var r=e.pendingProps,o=r.revealOrder,h=r.tail;if(_o(t,e,r.children,n),r=or.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&MI(t,n,e);else if(t.tag===19)MI(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ui(or,r),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&dv(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),dw(e,!1,o,n,h);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&dv(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}dw(e,!0,n,null,h);break;case"together":dw(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ay(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function cc(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ed|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Et(153));if(e.child!==null){for(t=e.child,n=ch(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ch(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function j3(t,e,n){switch(e.tag){case 3:cM(e),lp();break;case 5:Fk(e);break;case 1:Go(e.type)&&ov(e);break;case 4:Y1(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,o=e.memoizedProps.value;Ui(uv,r._currentValue),r._currentValue=o;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ui(or,or.current&1),e.flags|=128,null):n&e.child.childLanes?hM(t,e,n):(Ui(or,or.current&1),t=cc(t,e,n),t!==null?t.sibling:null);Ui(or,or.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return dM(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Ui(or,or.current),r)break;return null;case 22:case 23:return e.lanes=0,lM(t,e,n)}return cc(t,e,n)}var fM,Pb,pM,mM;fM=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Pb=function(){};pM=function(t,e,n,r){var o=t.memoizedProps;if(o!==r){t=e.stateNode,ud(pu.current);var h=null;switch(n){case"input":o=Kw(t,o),r=Kw(t,r),h=[];break;case"select":o=ur({},o,{value:void 0}),r=ur({},r,{value:void 0}),h=[];break;case"textarea":o=Qw(t,o),r=Qw(t,r),h=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=rv)}eb(n,r);var f;n=null;for(A in o)if(!r.hasOwnProperty(A)&&o.hasOwnProperty(A)&&o[A]!=null)if(A==="style"){var l=o[A];for(f in l)l.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else A!=="dangerouslySetInnerHTML"&&A!=="children"&&A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(cg.hasOwnProperty(A)?h||(h=[]):(h=h||[]).push(A,null));for(A in r){var S=r[A];if(l=o!=null?o[A]:void 0,r.hasOwnProperty(A)&&S!==l&&(S!=null||l!=null))if(A==="style")if(l){for(f in l)!l.hasOwnProperty(f)||S&&S.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in S)S.hasOwnProperty(f)&&l[f]!==S[f]&&(n||(n={}),n[f]=S[f])}else n||(h||(h=[]),h.push(A,n)),n=S;else A==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,l=l?l.__html:void 0,S!=null&&l!==S&&(h=h||[]).push(A,S)):A==="children"?typeof S!="string"&&typeof S!="number"||(h=h||[]).push(A,""+S):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&(cg.hasOwnProperty(A)?(S!=null&&A==="onScroll"&&Zi("scroll",t),h||l===S||(h=[])):(h=h||[]).push(A,S))}n&&(h=h||[]).push("style",n);var A=h;(e.updateQueue=A)&&(e.flags|=4)}};mM=function(t,e,n,r){n!==r&&(e.flags|=4)};function Pm(t,e){if(!Ji)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ws(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function U3(t,e,n){var r=e.pendingProps;switch(q1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(e),null;case 1:return Go(e.type)&&sv(),Ws(e),null;case 3:return r=e.stateNode,cp(),Ki(Ho),Ki(Js),J1(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ny(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Al!==null&&(zb(Al),Al=null))),Pb(t,e),Ws(e),null;case 5:Q1(e);var o=ud(bg.current);if(n=e.type,t!==null&&e.stateNode!=null)pM(t,e,n,r,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Et(166));return Ws(e),null}if(t=ud(pu.current),ny(e)){r=e.stateNode,n=e.type;var h=e.memoizedProps;switch(r[hu]=e,r[xg]=h,t=(e.mode&1)!==0,n){case"dialog":Zi("cancel",r),Zi("close",r);break;case"iframe":case"object":case"embed":Zi("load",r);break;case"video":case"audio":for(o=0;o<Om.length;o++)Zi(Om[o],r);break;case"source":Zi("error",r);break;case"img":case"image":case"link":Zi("error",r),Zi("load",r);break;case"details":Zi("toggle",r);break;case"input":VE(r,h),Zi("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!h.multiple},Zi("invalid",r);break;case"textarea":UE(r,h),Zi("invalid",r)}eb(n,h),o=null;for(var f in h)if(h.hasOwnProperty(f)){var l=h[f];f==="children"?typeof l=="string"?r.textContent!==l&&(h.suppressHydrationWarning!==!0&&ty(r.textContent,l,t),o=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(h.suppressHydrationWarning!==!0&&ty(r.textContent,l,t),o=["children",""+l]):cg.hasOwnProperty(f)&&l!=null&&f==="onScroll"&&Zi("scroll",r)}switch(n){case"input":Z_(r),jE(r,h,!0);break;case"textarea":Z_(r),$E(r);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(r.onclick=rv)}r=o,e.updateQueue=r,r!==null&&(e.flags|=4)}else{f=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$A(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=f.createElement(n,{is:r.is}):(t=f.createElement(n),n==="select"&&(f=t,r.multiple?f.multiple=!0:r.size&&(f.size=r.size))):t=f.createElementNS(t,n),t[hu]=e,t[xg]=r,fM(t,e,!1,!1),e.stateNode=t;e:{switch(f=tb(n,r),n){case"dialog":Zi("cancel",t),Zi("close",t),o=r;break;case"iframe":case"object":case"embed":Zi("load",t),o=r;break;case"video":case"audio":for(o=0;o<Om.length;o++)Zi(Om[o],t);o=r;break;case"source":Zi("error",t),o=r;break;case"img":case"image":case"link":Zi("error",t),Zi("load",t),o=r;break;case"details":Zi("toggle",t),o=r;break;case"input":VE(t,r),o=Kw(t,r),Zi("invalid",t);break;case"option":o=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},o=ur({},r,{value:void 0}),Zi("invalid",t);break;case"textarea":UE(t,r),o=Qw(t,r),Zi("invalid",t);break;default:o=r}eb(n,o),l=o;for(h in l)if(l.hasOwnProperty(h)){var S=l[h];h==="style"?GA(t,S):h==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,S!=null&&qA(t,S)):h==="children"?typeof S=="string"?(n!=="textarea"||S!=="")&&hg(t,S):typeof S=="number"&&hg(t,""+S):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(cg.hasOwnProperty(h)?S!=null&&h==="onScroll"&&Zi("scroll",t):S!=null&&A1(t,h,S,f))}switch(n){case"input":Z_(t),jE(t,r,!1);break;case"textarea":Z_(t),$E(t);break;case"option":r.value!=null&&t.setAttribute("value",""+gh(r.value));break;case"select":t.multiple=!!r.multiple,h=r.value,h!=null?Hf(t,!!r.multiple,h,!1):r.defaultValue!=null&&Hf(t,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=rv)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ws(e),null;case 6:if(t&&e.stateNode!=null)mM(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Et(166));if(n=ud(bg.current),ud(pu.current),ny(e)){if(r=e.stateNode,n=e.memoizedProps,r[hu]=e,(h=r.nodeValue!==n)&&(t=_a,t!==null))switch(t.tag){case 3:ty(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ty(r.nodeValue,n,(t.mode&1)!==0)}h&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[hu]=e,e.stateNode=r}return Ws(e),null;case 13:if(Ki(or),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ji&&ga!==null&&e.mode&1&&!(e.flags&128))Lk(),lp(),e.flags|=98560,h=!1;else if(h=ny(e),r!==null&&r.dehydrated!==null){if(t===null){if(!h)throw Error(Et(318));if(h=e.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(Et(317));h[hu]=e}else lp(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ws(e),h=!1}else Al!==null&&(zb(Al),Al=null),h=!0;if(!h)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||or.current&1?Jr===0&&(Jr=3):hT())),e.updateQueue!==null&&(e.flags|=4),Ws(e),null);case 4:return cp(),Pb(t,e),t===null&&yg(e.stateNode.containerInfo),Ws(e),null;case 10:return W1(e.type._context),Ws(e),null;case 17:return Go(e.type)&&sv(),Ws(e),null;case 19:if(Ki(or),h=e.memoizedState,h===null)return Ws(e),null;if(r=(e.flags&128)!==0,f=h.rendering,f===null)if(r)Pm(h,!1);else{if(Jr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(f=dv(t),f!==null){for(e.flags|=128,Pm(h,!1),r=f.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)h=n,t=r,h.flags&=14680066,f=h.alternate,f===null?(h.childLanes=0,h.lanes=t,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=f.childLanes,h.lanes=f.lanes,h.child=f.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=f.memoizedProps,h.memoizedState=f.memoizedState,h.updateQueue=f.updateQueue,h.type=f.type,t=f.dependencies,h.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ui(or,or.current&1|2),e.child}t=t.sibling}h.tail!==null&&Sr()>dp&&(e.flags|=128,r=!0,Pm(h,!1),e.lanes=4194304)}else{if(!r)if(t=dv(f),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Pm(h,!0),h.tail===null&&h.tailMode==="hidden"&&!f.alternate&&!Ji)return Ws(e),null}else 2*Sr()-h.renderingStartTime>dp&&n!==1073741824&&(e.flags|=128,r=!0,Pm(h,!1),e.lanes=4194304);h.isBackwards?(f.sibling=e.child,e.child=f):(n=h.last,n!==null?n.sibling=f:e.child=f,h.last=f)}return h.tail!==null?(e=h.tail,h.rendering=e,h.tail=e.sibling,h.renderingStartTime=Sr(),e.sibling=null,n=or.current,Ui(or,r?n&1|2:n&1),e):(Ws(e),null);case 22:case 23:return cT(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?pa&1073741824&&(Ws(e),e.subtreeFlags&6&&(e.flags|=8192)):Ws(e),null;case 24:return null;case 25:return null}throw Error(Et(156,e.tag))}function $3(t,e){switch(q1(e),e.tag){case 1:return Go(e.type)&&sv(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return cp(),Ki(Ho),Ki(Js),J1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Q1(e),null;case 13:if(Ki(or),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Et(340));lp()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ki(or),null;case 4:return cp(),null;case 10:return W1(e.type._context),null;case 22:case 23:return cT(),null;case 24:return null;default:return null}}var sy=!1,Ys=!1,q3=typeof WeakSet=="function"?WeakSet:Set,jt=null;function Uf(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){_r(t,e,r)}else n.current=null}function Cb(t,e,n){try{n()}catch(r){_r(t,e,r)}}var RI=!1;function H3(t,e){if(hb=tv,t=xk(),U1(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,h=r.focusNode;r=r.focusOffset;try{n.nodeType,h.nodeType}catch{n=null;break e}var f=0,l=-1,S=-1,A=0,O=0,U=t,H=null;t:for(;;){for(var $;U!==n||o!==0&&U.nodeType!==3||(l=f+o),U!==h||r!==0&&U.nodeType!==3||(S=f+r),U.nodeType===3&&(f+=U.nodeValue.length),($=U.firstChild)!==null;)H=U,U=$;for(;;){if(U===t)break t;if(H===n&&++A===o&&(l=f),H===h&&++O===r&&(S=f),($=U.nextSibling)!==null)break;U=H,H=U.parentNode}U=$}n=l===-1||S===-1?null:{start:l,end:S}}else n=null}n=n||{start:0,end:0}}else n=null;for(db={focusedElem:t,selectionRange:n},tv=!1,jt=e;jt!==null;)if(e=jt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,jt=t;else for(;jt!==null;){e=jt;try{var ie=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(ie!==null){var me=ie.memoizedProps,Me=ie.memoizedState,ce=e.stateNode,le=ce.getSnapshotBeforeUpdate(e.elementType===e.type?me:Pl(e.type,me),Me);ce.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var ge=e.stateNode.containerInfo;ge.nodeType===1?ge.textContent="":ge.nodeType===9&&ge.documentElement&&ge.removeChild(ge.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Et(163))}}catch(je){_r(e,e.return,je)}if(t=e.sibling,t!==null){t.return=e.return,jt=t;break}jt=e.return}return ie=RI,RI=!1,ie}function Ym(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&t)===t){var h=o.destroy;o.destroy=void 0,h!==void 0&&Cb(e,n,h)}o=o.next}while(o!==r)}}function o0(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ab(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function gM(t){var e=t.alternate;e!==null&&(t.alternate=null,gM(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[hu],delete e[xg],delete e[mb],delete e[P3],delete e[C3])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _M(t){return t.tag===5||t.tag===3||t.tag===4}function LI(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_M(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function kb(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=rv));else if(r!==4&&(t=t.child,t!==null))for(kb(t,e,n),t=t.sibling;t!==null;)kb(t,e,n),t=t.sibling}function Mb(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Mb(t,e,n),t=t.sibling;t!==null;)Mb(t,e,n),t=t.sibling}var Is=null,Cl=!1;function Uc(t,e,n){for(n=n.child;n!==null;)yM(t,e,n),n=n.sibling}function yM(t,e,n){if(fu&&typeof fu.onCommitFiberUnmount=="function")try{fu.onCommitFiberUnmount(Qv,n)}catch{}switch(n.tag){case 5:Ys||Uf(n,e);case 6:var r=Is,o=Cl;Is=null,Uc(t,e,n),Is=r,Cl=o,Is!==null&&(Cl?(t=Is,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Is.removeChild(n.stateNode));break;case 18:Is!==null&&(Cl?(t=Is,n=n.stateNode,t.nodeType===8?sw(t.parentNode,n):t.nodeType===1&&sw(t,n),mg(t)):sw(Is,n.stateNode));break;case 4:r=Is,o=Cl,Is=n.stateNode.containerInfo,Cl=!0,Uc(t,e,n),Is=r,Cl=o;break;case 0:case 11:case 14:case 15:if(!Ys&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var h=o,f=h.destroy;h=h.tag,f!==void 0&&(h&2||h&4)&&Cb(n,e,f),o=o.next}while(o!==r)}Uc(t,e,n);break;case 1:if(!Ys&&(Uf(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){_r(n,e,l)}Uc(t,e,n);break;case 21:Uc(t,e,n);break;case 22:n.mode&1?(Ys=(r=Ys)||n.memoizedState!==null,Uc(t,e,n),Ys=r):Uc(t,e,n);break;default:Uc(t,e,n)}}function DI(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new q3),e.forEach(function(r){var o=eF.bind(null,t,r);n.has(r)||(n.add(r),r.then(o,o))})}}function Il(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var h=t,f=e,l=f;e:for(;l!==null;){switch(l.tag){case 5:Is=l.stateNode,Cl=!1;break e;case 3:Is=l.stateNode.containerInfo,Cl=!0;break e;case 4:Is=l.stateNode.containerInfo,Cl=!0;break e}l=l.return}if(Is===null)throw Error(Et(160));yM(h,f,o),Is=null,Cl=!1;var S=o.alternate;S!==null&&(S.return=null),o.return=null}catch(A){_r(o,e,A)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)vM(e,t),e=e.sibling}function vM(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Il(e,t),ou(t),r&4){try{Ym(3,t,t.return),o0(3,t)}catch(me){_r(t,t.return,me)}try{Ym(5,t,t.return)}catch(me){_r(t,t.return,me)}}break;case 1:Il(e,t),ou(t),r&512&&n!==null&&Uf(n,n.return);break;case 5:if(Il(e,t),ou(t),r&512&&n!==null&&Uf(n,n.return),t.flags&32){var o=t.stateNode;try{hg(o,"")}catch(me){_r(t,t.return,me)}}if(r&4&&(o=t.stateNode,o!=null)){var h=t.memoizedProps,f=n!==null?n.memoizedProps:h,l=t.type,S=t.updateQueue;if(t.updateQueue=null,S!==null)try{l==="input"&&h.type==="radio"&&h.name!=null&&jA(o,h),tb(l,f);var A=tb(l,h);for(f=0;f<S.length;f+=2){var O=S[f],U=S[f+1];O==="style"?GA(o,U):O==="dangerouslySetInnerHTML"?qA(o,U):O==="children"?hg(o,U):A1(o,O,U,A)}switch(l){case"input":Xw(o,h);break;case"textarea":UA(o,h);break;case"select":var H=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!h.multiple;var $=h.value;$!=null?Hf(o,!!h.multiple,$,!1):H!==!!h.multiple&&(h.defaultValue!=null?Hf(o,!!h.multiple,h.defaultValue,!0):Hf(o,!!h.multiple,h.multiple?[]:"",!1))}o[xg]=h}catch(me){_r(t,t.return,me)}}break;case 6:if(Il(e,t),ou(t),r&4){if(t.stateNode===null)throw Error(Et(162));o=t.stateNode,h=t.memoizedProps;try{o.nodeValue=h}catch(me){_r(t,t.return,me)}}break;case 3:if(Il(e,t),ou(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{mg(e.containerInfo)}catch(me){_r(t,t.return,me)}break;case 4:Il(e,t),ou(t);break;case 13:Il(e,t),ou(t),o=t.child,o.flags&8192&&(h=o.memoizedState!==null,o.stateNode.isHidden=h,!h||o.alternate!==null&&o.alternate.memoizedState!==null||(lT=Sr())),r&4&&DI(t);break;case 22:if(O=n!==null&&n.memoizedState!==null,t.mode&1?(Ys=(A=Ys)||O,Il(e,t),Ys=A):Il(e,t),ou(t),r&8192){if(A=t.memoizedState!==null,(t.stateNode.isHidden=A)&&!O&&t.mode&1)for(jt=t,O=t.child;O!==null;){for(U=jt=O;jt!==null;){switch(H=jt,$=H.child,H.tag){case 0:case 11:case 14:case 15:Ym(4,H,H.return);break;case 1:Uf(H,H.return);var ie=H.stateNode;if(typeof ie.componentWillUnmount=="function"){r=H,n=H.return;try{e=r,ie.props=e.memoizedProps,ie.state=e.memoizedState,ie.componentWillUnmount()}catch(me){_r(r,n,me)}}break;case 5:Uf(H,H.return);break;case 22:if(H.memoizedState!==null){NI(U);continue}}$!==null?($.return=H,jt=$):NI(U)}O=O.sibling}e:for(O=null,U=t;;){if(U.tag===5){if(O===null){O=U;try{o=U.stateNode,A?(h=o.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(l=U.stateNode,S=U.memoizedProps.style,f=S!=null&&S.hasOwnProperty("display")?S.display:null,l.style.display=HA("display",f))}catch(me){_r(t,t.return,me)}}}else if(U.tag===6){if(O===null)try{U.stateNode.nodeValue=A?"":U.memoizedProps}catch(me){_r(t,t.return,me)}}else if((U.tag!==22&&U.tag!==23||U.memoizedState===null||U===t)&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===t)break e;for(;U.sibling===null;){if(U.return===null||U.return===t)break e;O===U&&(O=null),U=U.return}O===U&&(O=null),U.sibling.return=U.return,U=U.sibling}}break;case 19:Il(e,t),ou(t),r&4&&DI(t);break;case 21:break;default:Il(e,t),ou(t)}}function ou(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_M(n)){var r=n;break e}n=n.return}throw Error(Et(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(hg(o,""),r.flags&=-33);var h=LI(t);Mb(t,h,o);break;case 3:case 4:var f=r.stateNode.containerInfo,l=LI(t);kb(t,l,f);break;default:throw Error(Et(161))}}catch(S){_r(t,t.return,S)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function G3(t,e,n){jt=t,xM(t)}function xM(t,e,n){for(var r=(t.mode&1)!==0;jt!==null;){var o=jt,h=o.child;if(o.tag===22&&r){var f=o.memoizedState!==null||sy;if(!f){var l=o.alternate,S=l!==null&&l.memoizedState!==null||Ys;l=sy;var A=Ys;if(sy=f,(Ys=S)&&!A)for(jt=o;jt!==null;)f=jt,S=f.child,f.tag===22&&f.memoizedState!==null?OI(o):S!==null?(S.return=f,jt=S):OI(o);for(;h!==null;)jt=h,xM(h),h=h.sibling;jt=o,sy=l,Ys=A}zI(t)}else o.subtreeFlags&8772&&h!==null?(h.return=o,jt=h):zI(t)}}function zI(t){for(;jt!==null;){var e=jt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ys||o0(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ys)if(n===null)r.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:Pl(e.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var h=e.updateQueue;h!==null&&vI(e,h,r);break;case 3:var f=e.updateQueue;if(f!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}vI(e,f,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var S=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":S.autoFocus&&n.focus();break;case"img":S.src&&(n.src=S.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var A=e.alternate;if(A!==null){var O=A.memoizedState;if(O!==null){var U=O.dehydrated;U!==null&&mg(U)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Et(163))}Ys||e.flags&512&&Ab(e)}catch(H){_r(e,e.return,H)}}if(e===t){jt=null;break}if(n=e.sibling,n!==null){n.return=e.return,jt=n;break}jt=e.return}}function NI(t){for(;jt!==null;){var e=jt;if(e===t){jt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,jt=n;break}jt=e.return}}function OI(t){for(;jt!==null;){var e=jt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{o0(4,e)}catch(S){_r(e,n,S)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var o=e.return;try{r.componentDidMount()}catch(S){_r(e,o,S)}}var h=e.return;try{Ab(e)}catch(S){_r(e,h,S)}break;case 5:var f=e.return;try{Ab(e)}catch(S){_r(e,f,S)}}}catch(S){_r(e,e.return,S)}if(e===t){jt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,jt=l;break}jt=e.return}}var Z3=Math.ceil,mv=yc.ReactCurrentDispatcher,oT=yc.ReactCurrentOwner,Ga=yc.ReactCurrentBatchConfig,ti=0,cs=null,Nr=null,ks=0,pa=0,$f=Sh(0),Jr=0,Ig=null,Ed=0,a0=0,aT=0,Qm=null,$o=null,lT=0,dp=1/0,Ku=null,gv=!1,Rb=null,lh=null,oy=!1,Jc=null,_v=0,Jm=0,Lb=null,ky=-1,My=0;function vo(){return ti&6?Sr():ky!==-1?ky:ky=Sr()}function uh(t){return t.mode&1?ti&2&&ks!==0?ks&-ks:k3.transition!==null?(My===0&&(My=rk()),My):(t=bi,t!==0||(t=window.event,t=t===void 0?16:hk(t.type)),t):1}function zl(t,e,n,r){if(50<Jm)throw Jm=0,Lb=null,Error(Et(185));Hg(t,n,r),(!(ti&2)||t!==cs)&&(t===cs&&(!(ti&2)&&(a0|=n),Jr===4&&Zc(t,ks)),Zo(t,r),n===1&&ti===0&&!(e.mode&1)&&(dp=Sr()+500,i0&&Eh()))}function Zo(t,e){var n=t.callbackNode;kO(t,e);var r=ev(t,t===cs?ks:0);if(r===0)n!==null&&GE(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&GE(n),e===1)t.tag===0?A3(FI.bind(null,t)):kk(FI.bind(null,t)),E3(function(){!(ti&6)&&Eh()}),n=null;else{switch(sk(r)){case 1:n=D1;break;case 4:n=nk;break;case 16:n=Jy;break;case 536870912:n=ik;break;default:n=Jy}n=CM(n,wM.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function wM(t,e){if(ky=-1,My=0,ti&6)throw Error(Et(327));var n=t.callbackNode;if(Xf()&&t.callbackNode!==n)return null;var r=ev(t,t===cs?ks:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=yv(t,r);else{e=r;var o=ti;ti|=2;var h=TM();(cs!==t||ks!==e)&&(Ku=null,dp=Sr()+500,fd(t,e));do try{X3();break}catch(l){bM(t,l)}while(!0);Z1(),mv.current=h,ti=o,Nr!==null?e=0:(cs=null,ks=0,e=Jr)}if(e!==0){if(e===2&&(o=ob(t),o!==0&&(r=o,e=Db(t,o))),e===1)throw n=Ig,fd(t,0),Zc(t,r),Zo(t,Sr()),n;if(e===6)Zc(t,r);else{if(o=t.current.alternate,!(r&30)&&!W3(o)&&(e=yv(t,r),e===2&&(h=ob(t),h!==0&&(r=h,e=Db(t,h))),e===1))throw n=Ig,fd(t,0),Zc(t,r),Zo(t,Sr()),n;switch(t.finishedWork=o,t.finishedLanes=r,e){case 0:case 1:throw Error(Et(345));case 2:id(t,$o,Ku);break;case 3:if(Zc(t,r),(r&130023424)===r&&(e=lT+500-Sr(),10<e)){if(ev(t,0)!==0)break;if(o=t.suspendedLanes,(o&r)!==r){vo(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=pb(id.bind(null,t,$o,Ku),e);break}id(t,$o,Ku);break;case 4:if(Zc(t,r),(r&4194240)===r)break;for(e=t.eventTimes,o=-1;0<r;){var f=31-Dl(r);h=1<<f,f=e[f],f>o&&(o=f),r&=~h}if(r=o,r=Sr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Z3(r/1960))-r,10<r){t.timeoutHandle=pb(id.bind(null,t,$o,Ku),r);break}id(t,$o,Ku);break;case 5:id(t,$o,Ku);break;default:throw Error(Et(329))}}}return Zo(t,Sr()),t.callbackNode===n?wM.bind(null,t):null}function Db(t,e){var n=Qm;return t.current.memoizedState.isDehydrated&&(fd(t,e).flags|=256),t=yv(t,e),t!==2&&(e=$o,$o=n,e!==null&&zb(e)),t}function zb(t){$o===null?$o=t:$o.push.apply($o,t)}function W3(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],h=o.getSnapshot;o=o.value;try{if(!Ol(h(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Zc(t,e){for(e&=~aT,e&=~a0,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Dl(e),r=1<<n;t[n]=-1,e&=~r}}function FI(t){if(ti&6)throw Error(Et(327));Xf();var e=ev(t,0);if(!(e&1))return Zo(t,Sr()),null;var n=yv(t,e);if(t.tag!==0&&n===2){var r=ob(t);r!==0&&(e=r,n=Db(t,r))}if(n===1)throw n=Ig,fd(t,0),Zc(t,e),Zo(t,Sr()),n;if(n===6)throw Error(Et(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,id(t,$o,Ku),Zo(t,Sr()),null}function uT(t,e){var n=ti;ti|=1;try{return t(e)}finally{ti=n,ti===0&&(dp=Sr()+500,i0&&Eh())}}function Id(t){Jc!==null&&Jc.tag===0&&!(ti&6)&&Xf();var e=ti;ti|=1;var n=Ga.transition,r=bi;try{if(Ga.transition=null,bi=1,t)return t()}finally{bi=r,Ga.transition=n,ti=e,!(ti&6)&&Eh()}}function cT(){pa=$f.current,Ki($f)}function fd(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,S3(n)),Nr!==null)for(n=Nr.return;n!==null;){var r=n;switch(q1(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&sv();break;case 3:cp(),Ki(Ho),Ki(Js),J1();break;case 5:Q1(r);break;case 4:cp();break;case 13:Ki(or);break;case 19:Ki(or);break;case 10:W1(r.type._context);break;case 22:case 23:cT()}n=n.return}if(cs=t,Nr=t=ch(t.current,null),ks=pa=e,Jr=0,Ig=null,aT=a0=Ed=0,$o=Qm=null,ld!==null){for(e=0;e<ld.length;e++)if(n=ld[e],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,h=n.pending;if(h!==null){var f=h.next;h.next=o,r.next=f}n.pending=r}ld=null}return t}function bM(t,e){do{var n=Nr;try{if(Z1(),Py.current=pv,fv){for(var r=ar.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}fv=!1}if(Sd=0,ls=Qr=ar=null,Xm=!1,Tg=0,oT.current=null,n===null||n.return===null){Jr=1,Ig=e,Nr=null;break}e:{var h=t,f=n.return,l=n,S=e;if(e=ks,l.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){var A=S,O=l,U=O.tag;if(!(O.mode&1)&&(U===0||U===11||U===15)){var H=O.alternate;H?(O.updateQueue=H.updateQueue,O.memoizedState=H.memoizedState,O.lanes=H.lanes):(O.updateQueue=null,O.memoizedState=null)}var $=EI(f);if($!==null){$.flags&=-257,II($,f,l,h,e),$.mode&1&&SI(h,A,e),e=$,S=A;var ie=e.updateQueue;if(ie===null){var me=new Set;me.add(S),e.updateQueue=me}else ie.add(S);break e}else{if(!(e&1)){SI(h,A,e),hT();break e}S=Error(Et(426))}}else if(Ji&&l.mode&1){var Me=EI(f);if(Me!==null){!(Me.flags&65536)&&(Me.flags|=256),II(Me,f,l,h,e),H1(hp(S,l));break e}}h=S=hp(S,l),Jr!==4&&(Jr=2),Qm===null?Qm=[h]:Qm.push(h),h=f;do{switch(h.tag){case 3:h.flags|=65536,e&=-e,h.lanes|=e;var ce=sM(h,S,e);yI(h,ce);break e;case 1:l=S;var le=h.type,ge=h.stateNode;if(!(h.flags&128)&&(typeof le.getDerivedStateFromError=="function"||ge!==null&&typeof ge.componentDidCatch=="function"&&(lh===null||!lh.has(ge)))){h.flags|=65536,e&=-e,h.lanes|=e;var je=oM(h,l,e);yI(h,je);break e}}h=h.return}while(h!==null)}EM(n)}catch(rt){e=rt,Nr===n&&n!==null&&(Nr=n=n.return);continue}break}while(!0)}function TM(){var t=mv.current;return mv.current=pv,t===null?pv:t}function hT(){(Jr===0||Jr===3||Jr===2)&&(Jr=4),cs===null||!(Ed&268435455)&&!(a0&268435455)||Zc(cs,ks)}function yv(t,e){var n=ti;ti|=2;var r=TM();(cs!==t||ks!==e)&&(Ku=null,fd(t,e));do try{K3();break}catch(o){bM(t,o)}while(!0);if(Z1(),ti=n,mv.current=r,Nr!==null)throw Error(Et(261));return cs=null,ks=0,Jr}function K3(){for(;Nr!==null;)SM(Nr)}function X3(){for(;Nr!==null&&!wO();)SM(Nr)}function SM(t){var e=PM(t.alternate,t,pa);t.memoizedProps=t.pendingProps,e===null?EM(t):Nr=e,oT.current=null}function EM(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=$3(n,e),n!==null){n.flags&=32767,Nr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Jr=6,Nr=null;return}}else if(n=U3(n,e,pa),n!==null){Nr=n;return}if(e=e.sibling,e!==null){Nr=e;return}Nr=e=t}while(e!==null);Jr===0&&(Jr=5)}function id(t,e,n){var r=bi,o=Ga.transition;try{Ga.transition=null,bi=1,Y3(t,e,n,r)}finally{Ga.transition=o,bi=r}return null}function Y3(t,e,n,r){do Xf();while(Jc!==null);if(ti&6)throw Error(Et(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Et(177));t.callbackNode=null,t.callbackPriority=0;var h=n.lanes|n.childLanes;if(MO(t,h),t===cs&&(Nr=cs=null,ks=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||oy||(oy=!0,CM(Jy,function(){return Xf(),null})),h=(n.flags&15990)!==0,n.subtreeFlags&15990||h){h=Ga.transition,Ga.transition=null;var f=bi;bi=1;var l=ti;ti|=4,oT.current=null,H3(t,n),vM(n,t),_3(db),tv=!!hb,db=hb=null,t.current=n,G3(n),bO(),ti=l,bi=f,Ga.transition=h}else t.current=n;if(oy&&(oy=!1,Jc=t,_v=o),h=t.pendingLanes,h===0&&(lh=null),EO(n.stateNode),Zo(t,Sr()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(gv)throw gv=!1,t=Rb,Rb=null,t;return _v&1&&t.tag!==0&&Xf(),h=t.pendingLanes,h&1?t===Lb?Jm++:(Jm=0,Lb=t):Jm=0,Eh(),null}function Xf(){if(Jc!==null){var t=sk(_v),e=Ga.transition,n=bi;try{if(Ga.transition=null,bi=16>t?16:t,Jc===null)var r=!1;else{if(t=Jc,Jc=null,_v=0,ti&6)throw Error(Et(331));var o=ti;for(ti|=4,jt=t.current;jt!==null;){var h=jt,f=h.child;if(jt.flags&16){var l=h.deletions;if(l!==null){for(var S=0;S<l.length;S++){var A=l[S];for(jt=A;jt!==null;){var O=jt;switch(O.tag){case 0:case 11:case 15:Ym(8,O,h)}var U=O.child;if(U!==null)U.return=O,jt=U;else for(;jt!==null;){O=jt;var H=O.sibling,$=O.return;if(gM(O),O===A){jt=null;break}if(H!==null){H.return=$,jt=H;break}jt=$}}}var ie=h.alternate;if(ie!==null){var me=ie.child;if(me!==null){ie.child=null;do{var Me=me.sibling;me.sibling=null,me=Me}while(me!==null)}}jt=h}}if(h.subtreeFlags&2064&&f!==null)f.return=h,jt=f;else e:for(;jt!==null;){if(h=jt,h.flags&2048)switch(h.tag){case 0:case 11:case 15:Ym(9,h,h.return)}var ce=h.sibling;if(ce!==null){ce.return=h.return,jt=ce;break e}jt=h.return}}var le=t.current;for(jt=le;jt!==null;){f=jt;var ge=f.child;if(f.subtreeFlags&2064&&ge!==null)ge.return=f,jt=ge;else e:for(f=le;jt!==null;){if(l=jt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:o0(9,l)}}catch(rt){_r(l,l.return,rt)}if(l===f){jt=null;break e}var je=l.sibling;if(je!==null){je.return=l.return,jt=je;break e}jt=l.return}}if(ti=o,Eh(),fu&&typeof fu.onPostCommitFiberRoot=="function")try{fu.onPostCommitFiberRoot(Qv,t)}catch{}r=!0}return r}finally{bi=n,Ga.transition=e}}return!1}function BI(t,e,n){e=hp(n,e),e=sM(t,e,1),t=ah(t,e,1),e=vo(),t!==null&&(Hg(t,1,e),Zo(t,e))}function _r(t,e,n){if(t.tag===3)BI(t,t,n);else for(;e!==null;){if(e.tag===3){BI(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(lh===null||!lh.has(r))){t=hp(n,t),t=oM(e,t,1),e=ah(e,t,1),t=vo(),e!==null&&(Hg(e,1,t),Zo(e,t));break}}e=e.return}}function Q3(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=vo(),t.pingedLanes|=t.suspendedLanes&n,cs===t&&(ks&n)===n&&(Jr===4||Jr===3&&(ks&130023424)===ks&&500>Sr()-lT?fd(t,0):aT|=n),Zo(t,e)}function IM(t,e){e===0&&(t.mode&1?(e=X_,X_<<=1,!(X_&130023424)&&(X_=4194304)):e=1);var n=vo();t=uc(t,e),t!==null&&(Hg(t,e,n),Zo(t,n))}function J3(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),IM(t,n)}function eF(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Et(314))}r!==null&&r.delete(e),IM(t,n)}var PM;PM=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ho.current)qo=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return qo=!1,j3(t,e,n);qo=!!(t.flags&131072)}else qo=!1,Ji&&e.flags&1048576&&Mk(e,lv,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ay(t,e),t=e.pendingProps;var o=ap(e,Js.current);Kf(e,n),o=tT(null,e,r,t,o,n);var h=nT();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Go(r)?(h=!0,ov(e)):h=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,X1(e),o.updater=s0,e.stateNode=o,o._reactInternals=e,wb(e,r,t,n),e=Sb(null,e,r,!0,h,n)):(e.tag=0,Ji&&h&&$1(e),_o(null,e,o,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ay(t,e),t=e.pendingProps,o=r._init,r=o(r._payload),e.type=r,o=e.tag=nF(r),t=Pl(r,t),o){case 0:e=Tb(null,e,r,t,n);break e;case 1:e=AI(null,e,r,t,n);break e;case 11:e=PI(null,e,r,t,n);break e;case 14:e=CI(null,e,r,Pl(r.type,t),n);break e}throw Error(Et(306,r,""))}return e;case 0:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pl(r,o),Tb(t,e,r,o,n);case 1:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pl(r,o),AI(t,e,r,o,n);case 3:e:{if(cM(e),t===null)throw Error(Et(387));r=e.pendingProps,h=e.memoizedState,o=h.element,Ok(t,e),hv(e,r,null,n);var f=e.memoizedState;if(r=f.element,h.isDehydrated)if(h={element:r,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},e.updateQueue.baseState=h,e.memoizedState=h,e.flags&256){o=hp(Error(Et(423)),e),e=kI(t,e,r,n,o);break e}else if(r!==o){o=hp(Error(Et(424)),e),e=kI(t,e,r,n,o);break e}else for(ga=oh(e.stateNode.containerInfo.firstChild),_a=e,Ji=!0,Al=null,n=zk(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(lp(),r===o){e=cc(t,e,n);break e}_o(t,e,r,n)}e=e.child}return e;case 5:return Fk(e),t===null&&yb(e),r=e.type,o=e.pendingProps,h=t!==null?t.memoizedProps:null,f=o.children,fb(r,o)?f=null:h!==null&&fb(r,h)&&(e.flags|=32),uM(t,e),_o(t,e,f,n),e.child;case 6:return t===null&&yb(e),null;case 13:return hM(t,e,n);case 4:return Y1(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=up(e,null,r,n):_o(t,e,r,n),e.child;case 11:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pl(r,o),PI(t,e,r,o,n);case 7:return _o(t,e,e.pendingProps,n),e.child;case 8:return _o(t,e,e.pendingProps.children,n),e.child;case 12:return _o(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,o=e.pendingProps,h=e.memoizedProps,f=o.value,Ui(uv,r._currentValue),r._currentValue=f,h!==null)if(Ol(h.value,f)){if(h.children===o.children&&!Ho.current){e=cc(t,e,n);break e}}else for(h=e.child,h!==null&&(h.return=e);h!==null;){var l=h.dependencies;if(l!==null){f=h.child;for(var S=l.firstContext;S!==null;){if(S.context===r){if(h.tag===1){S=nc(-1,n&-n),S.tag=2;var A=h.updateQueue;if(A!==null){A=A.shared;var O=A.pending;O===null?S.next=S:(S.next=O.next,O.next=S),A.pending=S}}h.lanes|=n,S=h.alternate,S!==null&&(S.lanes|=n),vb(h.return,n,e),l.lanes|=n;break}S=S.next}}else if(h.tag===10)f=h.type===e.type?null:h.child;else if(h.tag===18){if(f=h.return,f===null)throw Error(Et(341));f.lanes|=n,l=f.alternate,l!==null&&(l.lanes|=n),vb(f,n,e),f=h.sibling}else f=h.child;if(f!==null)f.return=h;else for(f=h;f!==null;){if(f===e){f=null;break}if(h=f.sibling,h!==null){h.return=f.return,f=h;break}f=f.return}h=f}_o(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,r=e.pendingProps.children,Kf(e,n),o=Ka(o),r=r(o),e.flags|=1,_o(t,e,r,n),e.child;case 14:return r=e.type,o=Pl(r,e.pendingProps),o=Pl(r.type,o),CI(t,e,r,o,n);case 15:return aM(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:Pl(r,o),Ay(t,e),e.tag=1,Go(r)?(t=!0,ov(e)):t=!1,Kf(e,n),rM(e,r,o),wb(e,r,o,n),Sb(null,e,r,!0,t,n);case 19:return dM(t,e,n);case 22:return lM(t,e,n)}throw Error(Et(156,e.tag))};function CM(t,e){return tk(t,e)}function tF(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $a(t,e,n,r){return new tF(t,e,n,r)}function dT(t){return t=t.prototype,!(!t||!t.isReactComponent)}function nF(t){if(typeof t=="function")return dT(t)?1:0;if(t!=null){if(t=t.$$typeof,t===M1)return 11;if(t===R1)return 14}return 2}function ch(t,e){var n=t.alternate;return n===null?(n=$a(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ry(t,e,n,r,o,h){var f=2;if(r=t,typeof t=="function")dT(t)&&(f=1);else if(typeof t=="string")f=5;else e:switch(t){case Lf:return pd(n.children,o,h,e);case k1:f=8,o|=8;break;case Hw:return t=$a(12,n,e,o|2),t.elementType=Hw,t.lanes=h,t;case Gw:return t=$a(13,n,e,o),t.elementType=Gw,t.lanes=h,t;case Zw:return t=$a(19,n,e,o),t.elementType=Zw,t.lanes=h,t;case FA:return l0(n,o,h,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case NA:f=10;break e;case OA:f=9;break e;case M1:f=11;break e;case R1:f=14;break e;case qc:f=16,r=null;break e}throw Error(Et(130,t==null?t:typeof t,""))}return e=$a(f,n,e,o),e.elementType=t,e.type=r,e.lanes=h,e}function pd(t,e,n,r){return t=$a(7,t,r,e),t.lanes=n,t}function l0(t,e,n,r){return t=$a(22,t,r,e),t.elementType=FA,t.lanes=n,t.stateNode={isHidden:!1},t}function fw(t,e,n){return t=$a(6,t,null,e),t.lanes=n,t}function pw(t,e,n){return e=$a(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function iF(t,e,n,r,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wx(0),this.expirationTimes=Wx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wx(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function fT(t,e,n,r,o,h,f,l,S){return t=new iF(t,e,n,l,S),e===1?(e=1,h===!0&&(e|=8)):e=0,h=$a(3,null,null,e),t.current=h,h.stateNode=t,h.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},X1(h),t}function rF(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rf,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function AM(t){if(!t)return _h;t=t._reactInternals;e:{if(Dd(t)!==t||t.tag!==1)throw Error(Et(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Go(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Et(171))}if(t.tag===1){var n=t.type;if(Go(n))return Ak(t,n,e)}return e}function kM(t,e,n,r,o,h,f,l,S){return t=fT(n,r,!0,t,o,h,f,l,S),t.context=AM(null),n=t.current,r=vo(),o=uh(n),h=nc(r,o),h.callback=e??null,ah(n,h,o),t.current.lanes=o,Hg(t,o,r),Zo(t,r),t}function u0(t,e,n,r){var o=e.current,h=vo(),f=uh(o);return n=AM(n),e.context===null?e.context=n:e.pendingContext=n,e=nc(h,f),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ah(o,e,f),t!==null&&(zl(t,o,f,h),Iy(t,o,f)),f}function vv(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function VI(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function pT(t,e){VI(t,e),(t=t.alternate)&&VI(t,e)}var MM=typeof reportError=="function"?reportError:function(t){console.error(t)};function mT(t){this._internalRoot=t}c0.prototype.render=mT.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Et(409));u0(t,e,null,null)};c0.prototype.unmount=mT.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Id(function(){u0(null,t,null,null)}),e[lc]=null}};function c0(t){this._internalRoot=t}c0.prototype.unstable_scheduleHydration=function(t){if(t){var e=lk();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Gc.length&&e!==0&&e<Gc[n].priority;n++);Gc.splice(n,0,t),n===0&&ck(t)}};function gT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function h0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jI(){}function sF(t,e,n,r,o){if(o){if(typeof r=="function"){var h=r;r=function(){var A=vv(f);h.call(A)}}var f=kM(e,r,t,0,null,!1,!1,"",jI);return t._reactRootContainer=f,t[lc]=f.current,yg(t.nodeType===8?t.parentNode:t),Id(),f}for(;o=t.lastChild;)t.removeChild(o);if(typeof r=="function"){var l=r;r=function(){var A=vv(S);l.call(A)}}var S=fT(t,0,!1,null,null,!1,!1,"",jI);return t._reactRootContainer=S,t[lc]=S.current,yg(t.nodeType===8?t.parentNode:t),Id(function(){u0(e,S,n,r)}),S}function d0(t,e,n,r,o){var h=n._reactRootContainer;if(h){var f=h;if(typeof o=="function"){var l=o;o=function(){var S=vv(f);l.call(S)}}u0(e,f,t,o)}else f=sF(n,e,t,o,r);return vv(f)}ok=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Nm(e.pendingLanes);n!==0&&(z1(e,n|1),Zo(e,Sr()),!(ti&6)&&(dp=Sr()+500,Eh()))}break;case 13:Id(function(){var r=uc(t,1);if(r!==null){var o=vo();zl(r,t,1,o)}}),pT(t,1)}};N1=function(t){if(t.tag===13){var e=uc(t,134217728);if(e!==null){var n=vo();zl(e,t,134217728,n)}pT(t,134217728)}};ak=function(t){if(t.tag===13){var e=uh(t),n=uc(t,e);if(n!==null){var r=vo();zl(n,t,e,r)}pT(t,e)}};lk=function(){return bi};uk=function(t,e){var n=bi;try{return bi=t,e()}finally{bi=n}};ib=function(t,e,n){switch(e){case"input":if(Xw(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var o=n0(r);if(!o)throw Error(Et(90));VA(r),Xw(r,o)}}}break;case"textarea":UA(t,n);break;case"select":e=n.value,e!=null&&Hf(t,!!n.multiple,e,!1)}};KA=uT;XA=Id;var oF={usingClientEntryPoint:!1,Events:[Zg,Of,n0,ZA,WA,uT]},Cm={findFiberByHostInstance:ad,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aF={bundleType:Cm.bundleType,version:Cm.version,rendererPackageName:Cm.rendererPackageName,rendererConfig:Cm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=JA(t),t===null?null:t.stateNode},findFiberByHostInstance:Cm.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ay=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ay.isDisabled&&ay.supportsFiber)try{Qv=ay.inject(aF),fu=ay}catch{}}xa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oF;xa.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gT(e))throw Error(Et(200));return rF(t,e,null,n)};xa.createRoot=function(t,e){if(!gT(t))throw Error(Et(299));var n=!1,r="",o=MM;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=fT(t,1,!1,null,null,n,!1,r,o),t[lc]=e.current,yg(t.nodeType===8?t.parentNode:t),new mT(e)};xa.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Et(188)):(t=Object.keys(t).join(","),Error(Et(268,t)));return t=JA(e),t=t===null?null:t.stateNode,t};xa.flushSync=function(t){return Id(t)};xa.hydrate=function(t,e,n){if(!h0(e))throw Error(Et(200));return d0(null,t,e,!0,n)};xa.hydrateRoot=function(t,e,n){if(!gT(t))throw Error(Et(405));var r=n!=null&&n.hydratedSources||null,o=!1,h="",f=MM;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(h=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),e=kM(e,null,t,1,n??null,o,!1,h,f),t[lc]=e.current,yg(t),r)for(t=0;t<r.length;t++)n=r[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new c0(e)};xa.render=function(t,e,n){if(!h0(e))throw Error(Et(200));return d0(null,t,e,!1,n)};xa.unmountComponentAtNode=function(t){if(!h0(t))throw Error(Et(40));return t._reactRootContainer?(Id(function(){d0(null,null,t,!1,function(){t._reactRootContainer=null,t[lc]=null})}),!0):!1};xa.unstable_batchedUpdates=uT;xa.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!h0(n))throw Error(Et(200));if(t==null||t._reactInternals===void 0)throw Error(Et(38));return d0(t,e,n,!1,r)};xa.version="18.3.1-next-f1338f8080-20240426";function RM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(RM)}catch(t){console.error(t)}}RM(),RA.exports=xa;var lF=RA.exports,UI=lF;$w.createRoot=UI.createRoot,$w.hydrateRoot=UI.hydrateRoot;var _T={};Object.defineProperty(_T,"__esModule",{value:!0});_T.parse=mF;_T.serialize=gF;const uF=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,cF=/^[\u0021-\u003A\u003C-\u007E]*$/,hF=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,dF=/^[\u0020-\u003A\u003D-\u007E]*$/,fF=Object.prototype.toString,pF=(()=>{const t=function(){};return t.prototype=Object.create(null),t})();function mF(t,e){const n=new pF,r=t.length;if(r<2)return n;const o=(e==null?void 0:e.decode)||_F;let h=0;do{const f=t.indexOf("=",h);if(f===-1)break;const l=t.indexOf(";",h),S=l===-1?r:l;if(f>S){h=t.lastIndexOf(";",f-1)+1;continue}const A=$I(t,h,f),O=qI(t,f,A),U=t.slice(A,O);if(n[U]===void 0){let H=$I(t,f+1,S),$=qI(t,S,H);const ie=o(t.slice(H,$));n[U]=ie}h=S+1}while(h<r);return n}function $I(t,e,n){do{const r=t.charCodeAt(e);if(r!==32&&r!==9)return e}while(++e<n);return n}function qI(t,e,n){for(;e>n;){const r=t.charCodeAt(--e);if(r!==32&&r!==9)return e+1}return n}function gF(t,e,n){const r=(n==null?void 0:n.encode)||encodeURIComponent;if(!uF.test(t))throw new TypeError(`argument name is invalid: ${t}`);const o=r(e);if(!cF.test(o))throw new TypeError(`argument val is invalid: ${e}`);let h=t+"="+o;if(!n)return h;if(n.maxAge!==void 0){if(!Number.isInteger(n.maxAge))throw new TypeError(`option maxAge is invalid: ${n.maxAge}`);h+="; Max-Age="+n.maxAge}if(n.domain){if(!hF.test(n.domain))throw new TypeError(`option domain is invalid: ${n.domain}`);h+="; Domain="+n.domain}if(n.path){if(!dF.test(n.path))throw new TypeError(`option path is invalid: ${n.path}`);h+="; Path="+n.path}if(n.expires){if(!yF(n.expires)||!Number.isFinite(n.expires.valueOf()))throw new TypeError(`option expires is invalid: ${n.expires}`);h+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(h+="; HttpOnly"),n.secure&&(h+="; Secure"),n.partitioned&&(h+="; Partitioned"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():void 0){case"low":h+="; Priority=Low";break;case"medium":h+="; Priority=Medium";break;case"high":h+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${n.priority}`)}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":h+="; SameSite=Strict";break;case"lax":h+="; SameSite=Lax";break;case"none":h+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${n.sameSite}`)}return h}function _F(t){if(t.indexOf("%")===-1)return t;try{return decodeURIComponent(t)}catch{return t}}function yF(t){return fF.call(t)==="[object Date]"}var HI="popstate";function vF(t={}){function e(r,o){let{pathname:h,search:f,hash:l}=r.location;return Nb("",{pathname:h,search:f,hash:l},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){return typeof o=="string"?o:Pg(o)}return wF(e,n,null,t)}function lr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function bu(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function xF(){return Math.random().toString(36).substring(2,10)}function GI(t,e){return{usr:t.state,key:t.key,idx:e}}function Nb(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ip(e):e,state:n,key:e&&e.key||r||xF()}}function Pg({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ip(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function wF(t,e,n,r={}){let{window:o=document.defaultView,v5Compat:h=!1}=r,f=o.history,l="POP",S=null,A=O();A==null&&(A=0,f.replaceState({...f.state,idx:A},""));function O(){return(f.state||{idx:null}).idx}function U(){l="POP";let Me=O(),ce=Me==null?null:Me-A;A=Me,S&&S({action:l,location:me.location,delta:ce})}function H(Me,ce){l="PUSH";let le=Nb(me.location,Me,ce);A=O()+1;let ge=GI(le,A),je=me.createHref(le);try{f.pushState(ge,"",je)}catch(rt){if(rt instanceof DOMException&&rt.name==="DataCloneError")throw rt;o.location.assign(je)}h&&S&&S({action:l,location:me.location,delta:1})}function $(Me,ce){l="REPLACE";let le=Nb(me.location,Me,ce);A=O();let ge=GI(le,A),je=me.createHref(le);f.replaceState(ge,"",je),h&&S&&S({action:l,location:me.location,delta:0})}function ie(Me){return bF(Me)}let me={get action(){return l},get location(){return t(o,f)},listen(Me){if(S)throw new Error("A history only accepts one active listener");return o.addEventListener(HI,U),S=Me,()=>{o.removeEventListener(HI,U),S=null}},createHref(Me){return e(o,Me)},createURL:ie,encodeLocation(Me){let ce=ie(Me);return{pathname:ce.pathname,search:ce.search,hash:ce.hash}},push:H,replace:$,go(Me){return f.go(Me)}};return me}function bF(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),lr(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Pg(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function LM(t,e,n="/"){return TF(t,e,n,!1)}function TF(t,e,n,r){let o=typeof e=="string"?Ip(e):e,h=hc(o.pathname||"/",n);if(h==null)return null;let f=DM(t);SF(f);let l=null;for(let S=0;l==null&&S<f.length;++S){let A=zF(h);l=LF(f[S],A,r)}return l}function DM(t,e=[],n=[],r=""){let o=(h,f,l)=>{let S={relativePath:l===void 0?h.path||"":l,caseSensitive:h.caseSensitive===!0,childrenIndex:f,route:h};S.relativePath.startsWith("/")&&(lr(S.relativePath.startsWith(r),`Absolute route path "${S.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),S.relativePath=S.relativePath.slice(r.length));let A=ic([r,S.relativePath]),O=n.concat(S);h.children&&h.children.length>0&&(lr(h.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${A}".`),DM(h.children,e,O,A)),!(h.path==null&&!h.index)&&e.push({path:A,score:MF(A,h.index),routesMeta:O})};return t.forEach((h,f)=>{var l;if(h.path===""||!((l=h.path)!=null&&l.includes("?")))o(h,f);else for(let S of zM(h.path))o(h,f,S)}),e}function zM(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,o=n.endsWith("?"),h=n.replace(/\?$/,"");if(r.length===0)return o?[h,""]:[h];let f=zM(r.join("/")),l=[];return l.push(...f.map(S=>S===""?h:[h,S].join("/"))),o&&l.push(...f),l.map(S=>t.startsWith("/")&&S===""?"/":S)}function SF(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:RF(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var EF=/^:[\w-]+$/,IF=3,PF=2,CF=1,AF=10,kF=-2,ZI=t=>t==="*";function MF(t,e){let n=t.split("/"),r=n.length;return n.some(ZI)&&(r+=kF),e&&(r+=PF),n.filter(o=>!ZI(o)).reduce((o,h)=>o+(EF.test(h)?IF:h===""?CF:AF),r)}function RF(t,e){return t.length===e.length&&t.slice(0,-1).every((r,o)=>r===e[o])?t[t.length-1]-e[e.length-1]:0}function LF(t,e,n=!1){let{routesMeta:r}=t,o={},h="/",f=[];for(let l=0;l<r.length;++l){let S=r[l],A=l===r.length-1,O=h==="/"?e:e.slice(h.length)||"/",U=xv({path:S.relativePath,caseSensitive:S.caseSensitive,end:A},O),H=S.route;if(!U&&A&&n&&!r[r.length-1].route.index&&(U=xv({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},O)),!U)return null;Object.assign(o,U.params),f.push({params:o,pathname:ic([h,U.pathname]),pathnameBase:BF(ic([h,U.pathnameBase])),route:H}),U.pathnameBase!=="/"&&(h=ic([h,U.pathnameBase]))}return f}function xv(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=DF(t.path,t.caseSensitive,t.end),o=e.match(n);if(!o)return null;let h=o[0],f=h.replace(/(.)\/+$/,"$1"),l=o.slice(1);return{params:r.reduce((A,{paramName:O,isOptional:U},H)=>{if(O==="*"){let ie=l[H]||"";f=h.slice(0,h.length-ie.length).replace(/(.)\/+$/,"$1")}const $=l[H];return U&&!$?A[O]=void 0:A[O]=($||"").replace(/%2F/g,"/"),A},{}),pathname:h,pathnameBase:f,pattern:t}}function DF(t,e=!1,n=!0){bu(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,l,S)=>(r.push({paramName:l,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),o+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":t!==""&&t!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),r]}function zF(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return bu(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function hc(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function NF(t,e="/"){let{pathname:n,search:r="",hash:o=""}=typeof t=="string"?Ip(t):t;return{pathname:n?n.startsWith("/")?n:OF(n,e):e,search:VF(r),hash:jF(o)}}function OF(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function mw(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function FF(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function NM(t){let e=FF(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function OM(t,e,n,r=!1){let o;typeof t=="string"?o=Ip(t):(o={...t},lr(!o.pathname||!o.pathname.includes("?"),mw("?","pathname","search",o)),lr(!o.pathname||!o.pathname.includes("#"),mw("#","pathname","hash",o)),lr(!o.search||!o.search.includes("#"),mw("#","search","hash",o)));let h=t===""||o.pathname==="",f=h?"/":o.pathname,l;if(f==null)l=n;else{let U=e.length-1;if(!r&&f.startsWith("..")){let H=f.split("/");for(;H[0]==="..";)H.shift(),U-=1;o.pathname=H.join("/")}l=U>=0?e[U]:"/"}let S=NF(o,l),A=f&&f!=="/"&&f.endsWith("/"),O=(h||f===".")&&n.endsWith("/");return!S.pathname.endsWith("/")&&(A||O)&&(S.pathname+="/"),S}var ic=t=>t.join("/").replace(/\/\/+/g,"/"),BF=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),VF=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,jF=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function UF(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var FM=["POST","PUT","PATCH","DELETE"];new Set(FM);var $F=["GET",...FM];new Set($F);var Pp=ut.createContext(null);Pp.displayName="DataRouter";var f0=ut.createContext(null);f0.displayName="DataRouterState";var BM=ut.createContext({isTransitioning:!1});BM.displayName="ViewTransition";var qF=ut.createContext(new Map);qF.displayName="Fetchers";var HF=ut.createContext(null);HF.displayName="Await";var Eu=ut.createContext(null);Eu.displayName="Navigation";var Kg=ut.createContext(null);Kg.displayName="Location";var vc=ut.createContext({outlet:null,matches:[],isDataRoute:!1});vc.displayName="Route";var yT=ut.createContext(null);yT.displayName="RouteError";function GF(t,{relative:e}={}){lr(Xg(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=ut.useContext(Eu),{hash:o,pathname:h,search:f}=Yg(t,{relative:e}),l=h;return n!=="/"&&(l=h==="/"?n:ic([n,h])),r.createHref({pathname:l,search:f,hash:o})}function Xg(){return ut.useContext(Kg)!=null}function zd(){return lr(Xg(),"useLocation() may be used only in the context of a <Router> component."),ut.useContext(Kg).location}var VM="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function jM(t){ut.useContext(Eu).static||ut.useLayoutEffect(t)}function UM(){let{isDataRoute:t}=ut.useContext(vc);return t?s4():ZF()}function ZF(){lr(Xg(),"useNavigate() may be used only in the context of a <Router> component.");let t=ut.useContext(Pp),{basename:e,navigator:n}=ut.useContext(Eu),{matches:r}=ut.useContext(vc),{pathname:o}=zd(),h=JSON.stringify(NM(r)),f=ut.useRef(!1);return jM(()=>{f.current=!0}),ut.useCallback((S,A={})=>{if(bu(f.current,VM),!f.current)return;if(typeof S=="number"){n.go(S);return}let O=OM(S,JSON.parse(h),o,A.relative==="path");t==null&&e!=="/"&&(O.pathname=O.pathname==="/"?e:ic([e,O.pathname])),(A.replace?n.replace:n.push)(O,A.state,A)},[e,n,h,o,t])}ut.createContext(null);function Yg(t,{relative:e}={}){let{matches:n}=ut.useContext(vc),{pathname:r}=zd(),o=JSON.stringify(NM(n));return ut.useMemo(()=>OM(t,JSON.parse(o),r,e==="path"),[t,o,r,e])}function WF(t,e){return $M(t,e)}function $M(t,e,n,r){var le;lr(Xg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o,static:h}=ut.useContext(Eu),{matches:f}=ut.useContext(vc),l=f[f.length-1],S=l?l.params:{},A=l?l.pathname:"/",O=l?l.pathnameBase:"/",U=l&&l.route;{let ge=U&&U.path||"";qM(A,!U||ge.endsWith("*")||ge.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${A}" (under <Route path="${ge}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ge}"> to <Route path="${ge==="/"?"*":`${ge}/*`}">.`)}let H=zd(),$;if(e){let ge=typeof e=="string"?Ip(e):e;lr(O==="/"||((le=ge.pathname)==null?void 0:le.startsWith(O)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${O}" but pathname "${ge.pathname}" was given in the \`location\` prop.`),$=ge}else $=H;let ie=$.pathname||"/",me=ie;if(O!=="/"){let ge=O.replace(/^\//,"").split("/");me="/"+ie.replace(/^\//,"").split("/").slice(ge.length).join("/")}let Me=!h&&n&&n.matches&&n.matches.length>0?n.matches:LM(t,{pathname:me});bu(U||Me!=null,`No routes matched location "${$.pathname}${$.search}${$.hash}" `),bu(Me==null||Me[Me.length-1].route.element!==void 0||Me[Me.length-1].route.Component!==void 0||Me[Me.length-1].route.lazy!==void 0,`Matched leaf route at location "${$.pathname}${$.search}${$.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ce=JF(Me&&Me.map(ge=>Object.assign({},ge,{params:Object.assign({},S,ge.params),pathname:ic([O,o.encodeLocation?o.encodeLocation(ge.pathname).pathname:ge.pathname]),pathnameBase:ge.pathnameBase==="/"?O:ic([O,o.encodeLocation?o.encodeLocation(ge.pathnameBase).pathname:ge.pathnameBase])})),f,n,r);return e&&ce?ut.createElement(Kg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...$},navigationType:"POP"}},ce):ce}function KF(){let t=r4(),e=UF(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:r},h={padding:"2px 4px",backgroundColor:r},f=null;return console.error("Error handled by React Router default ErrorBoundary:",t),f=ut.createElement(ut.Fragment,null,ut.createElement("p",null," Hey developer "),ut.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ut.createElement("code",{style:h},"ErrorBoundary")," or"," ",ut.createElement("code",{style:h},"errorElement")," prop on your route.")),ut.createElement(ut.Fragment,null,ut.createElement("h2",null,"Unexpected Application Error!"),ut.createElement("h3",{style:{fontStyle:"italic"}},e),n?ut.createElement("pre",{style:o},n):null,f)}var XF=ut.createElement(KF,null),YF=class extends ut.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?ut.createElement(vc.Provider,{value:this.props.routeContext},ut.createElement(yT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function QF({routeContext:t,match:e,children:n}){let r=ut.useContext(Pp);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),ut.createElement(vc.Provider,{value:t},n)}function JF(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,h=n==null?void 0:n.errors;if(h!=null){let S=o.findIndex(A=>A.route.id&&(h==null?void 0:h[A.route.id])!==void 0);lr(S>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(h).join(",")}`),o=o.slice(0,Math.min(o.length,S+1))}let f=!1,l=-1;if(n)for(let S=0;S<o.length;S++){let A=o[S];if((A.route.HydrateFallback||A.route.hydrateFallbackElement)&&(l=S),A.route.id){let{loaderData:O,errors:U}=n,H=A.route.loader&&!O.hasOwnProperty(A.route.id)&&(!U||U[A.route.id]===void 0);if(A.route.lazy||H){f=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((S,A,O)=>{let U,H=!1,$=null,ie=null;n&&(U=h&&A.route.id?h[A.route.id]:void 0,$=A.route.errorElement||XF,f&&(l<0&&O===0?(qM("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),H=!0,ie=null):l===O&&(H=!0,ie=A.route.hydrateFallbackElement||null)));let me=e.concat(o.slice(0,O+1)),Me=()=>{let ce;return U?ce=$:H?ce=ie:A.route.Component?ce=ut.createElement(A.route.Component,null):A.route.element?ce=A.route.element:ce=S,ut.createElement(QF,{match:A,routeContext:{outlet:S,matches:me,isDataRoute:n!=null},children:ce})};return n&&(A.route.ErrorBoundary||A.route.errorElement||O===0)?ut.createElement(YF,{location:n.location,revalidation:n.revalidation,component:$,error:U,children:Me(),routeContext:{outlet:null,matches:me,isDataRoute:!0}}):Me()},null)}function vT(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function e4(t){let e=ut.useContext(Pp);return lr(e,vT(t)),e}function t4(t){let e=ut.useContext(f0);return lr(e,vT(t)),e}function n4(t){let e=ut.useContext(vc);return lr(e,vT(t)),e}function xT(t){let e=n4(t),n=e.matches[e.matches.length-1];return lr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function i4(){return xT("useRouteId")}function r4(){var r;let t=ut.useContext(yT),e=t4("useRouteError"),n=xT("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function s4(){let{router:t}=e4("useNavigate"),e=xT("useNavigate"),n=ut.useRef(!1);return jM(()=>{n.current=!0}),ut.useCallback(async(o,h={})=>{bu(n.current,VM),n.current&&(typeof o=="number"?t.navigate(o):await t.navigate(o,{fromRouteId:e,...h}))},[t,e])}var WI={};function qM(t,e,n){!e&&!WI[t]&&(WI[t]=!0,bu(!1,n))}ut.memo(o4);function o4({routes:t,future:e,state:n}){return $M(t,void 0,n,e)}function Fm(t){lr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function a4({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:o,static:h=!1}){lr(!Xg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=t.replace(/^\/*/,"/"),l=ut.useMemo(()=>({basename:f,navigator:o,static:h,future:{}}),[f,o,h]);typeof n=="string"&&(n=Ip(n));let{pathname:S="/",search:A="",hash:O="",state:U=null,key:H="default"}=n,$=ut.useMemo(()=>{let ie=hc(S,f);return ie==null?null:{location:{pathname:ie,search:A,hash:O,state:U,key:H},navigationType:r}},[f,S,A,O,U,H,r]);return bu($!=null,`<Router basename="${f}"> is not able to match the URL "${S}${A}${O}" because it does not start with the basename, so the <Router> won't render anything.`),$==null?null:ut.createElement(Eu.Provider,{value:l},ut.createElement(Kg.Provider,{children:e,value:$}))}function l4({children:t,location:e}){return WF(Ob(t),e)}function Ob(t,e=[]){let n=[];return ut.Children.forEach(t,(r,o)=>{if(!ut.isValidElement(r))return;let h=[...e,o];if(r.type===ut.Fragment){n.push.apply(n,Ob(r.props.children,h));return}lr(r.type===Fm,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),lr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let f={id:r.props.id||h.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(f.children=Ob(r.props.children,h)),n.push(f)}),n}var Ly="get",Dy="application/x-www-form-urlencoded";function p0(t){return t!=null&&typeof t.tagName=="string"}function u4(t){return p0(t)&&t.tagName.toLowerCase()==="button"}function c4(t){return p0(t)&&t.tagName.toLowerCase()==="form"}function h4(t){return p0(t)&&t.tagName.toLowerCase()==="input"}function d4(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function f4(t,e){return t.button===0&&(!e||e==="_self")&&!d4(t)}var ly=null;function p4(){if(ly===null)try{new FormData(document.createElement("form"),0),ly=!1}catch{ly=!0}return ly}var m4=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function gw(t){return t!=null&&!m4.has(t)?(bu(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Dy}"`),null):t}function g4(t,e){let n,r,o,h,f;if(c4(t)){let l=t.getAttribute("action");r=l?hc(l,e):null,n=t.getAttribute("method")||Ly,o=gw(t.getAttribute("enctype"))||Dy,h=new FormData(t)}else if(u4(t)||h4(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let S=t.getAttribute("formaction")||l.getAttribute("action");if(r=S?hc(S,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||Ly,o=gw(t.getAttribute("formenctype"))||gw(l.getAttribute("enctype"))||Dy,h=new FormData(l,t),!p4()){let{name:A,type:O,value:U}=t;if(O==="image"){let H=A?`${A}.`:"";h.append(`${H}x`,"0"),h.append(`${H}y`,"0")}else A&&h.append(A,U)}}else{if(p0(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ly,r=null,o=Dy,f=t}return h&&o==="text/plain"&&(f=h,h=void 0),{action:r,method:n.toLowerCase(),encType:o,formData:h,body:f}}function wT(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function _4(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function y4(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function v4(t,e,n){let r=await Promise.all(t.map(async o=>{let h=e.routes[o.route.id];if(h){let f=await _4(h,n);return f.links?f.links():[]}return[]}));return T4(r.flat(1).filter(y4).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function KI(t,e,n,r,o,h){let f=(S,A)=>n[A]?S.route.id!==n[A].route.id:!0,l=(S,A)=>{var O;return n[A].pathname!==S.pathname||((O=n[A].route.path)==null?void 0:O.endsWith("*"))&&n[A].params["*"]!==S.params["*"]};return h==="assets"?e.filter((S,A)=>f(S,A)||l(S,A)):h==="data"?e.filter((S,A)=>{var U;let O=r.routes[S.route.id];if(!O||!O.hasLoader)return!1;if(f(S,A)||l(S,A))return!0;if(S.route.shouldRevalidate){let H=S.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:((U=n[0])==null?void 0:U.params)||{},nextUrl:new URL(t,window.origin),nextParams:S.params,defaultShouldRevalidate:!0});if(typeof H=="boolean")return H}return!0}):[]}function x4(t,e,{includeHydrateFallback:n}={}){return w4(t.map(r=>{let o=e.routes[r.route.id];if(!o)return[];let h=[o.module];return o.clientActionModule&&(h=h.concat(o.clientActionModule)),o.clientLoaderModule&&(h=h.concat(o.clientLoaderModule)),n&&o.hydrateFallbackModule&&(h=h.concat(o.hydrateFallbackModule)),o.imports&&(h=h.concat(o.imports)),h}).flat(1))}function w4(t){return[...new Set(t)]}function b4(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function T4(t,e){let n=new Set;return new Set(e),t.reduce((r,o)=>{let h=JSON.stringify(b4(o));return n.has(h)||(n.add(h),r.push({key:h,link:o})),r},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var S4=new Set([100,101,204,205]);function E4(t,e){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname="_root.data":e&&hc(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function HM(){let t=ut.useContext(Pp);return wT(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function I4(){let t=ut.useContext(f0);return wT(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var bT=ut.createContext(void 0);bT.displayName="FrameworkContext";function GM(){let t=ut.useContext(bT);return wT(t,"You must render this element inside a <HydratedRouter> element"),t}function P4(t,e){let n=ut.useContext(bT),[r,o]=ut.useState(!1),[h,f]=ut.useState(!1),{onFocus:l,onBlur:S,onMouseEnter:A,onMouseLeave:O,onTouchStart:U}=e,H=ut.useRef(null);ut.useEffect(()=>{if(t==="render"&&f(!0),t==="viewport"){let me=ce=>{ce.forEach(le=>{f(le.isIntersecting)})},Me=new IntersectionObserver(me,{threshold:.5});return H.current&&Me.observe(H.current),()=>{Me.disconnect()}}},[t]),ut.useEffect(()=>{if(r){let me=setTimeout(()=>{f(!0)},100);return()=>{clearTimeout(me)}}},[r]);let $=()=>{o(!0)},ie=()=>{o(!1),f(!1)};return n?t!=="intent"?[h,H,{}]:[h,H,{onFocus:Am(l,$),onBlur:Am(S,ie),onMouseEnter:Am(A,$),onMouseLeave:Am(O,ie),onTouchStart:Am(U,$)}]:[!1,H,{}]}function Am(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function C4({page:t,...e}){let{router:n}=HM(),r=ut.useMemo(()=>LM(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?ut.createElement(k4,{page:t,matches:r,...e}):null}function A4(t){let{manifest:e,routeModules:n}=GM(),[r,o]=ut.useState([]);return ut.useEffect(()=>{let h=!1;return v4(t,e,n).then(f=>{h||o(f)}),()=>{h=!0}},[t,e,n]),r}function k4({page:t,matches:e,...n}){let r=zd(),{manifest:o,routeModules:h}=GM(),{basename:f}=HM(),{loaderData:l,matches:S}=I4(),A=ut.useMemo(()=>KI(t,e,S,o,r,"data"),[t,e,S,o,r]),O=ut.useMemo(()=>KI(t,e,S,o,r,"assets"),[t,e,S,o,r]),U=ut.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let ie=new Set,me=!1;if(e.forEach(ce=>{var ge;let le=o.routes[ce.route.id];!le||!le.hasLoader||(!A.some(je=>je.route.id===ce.route.id)&&ce.route.id in l&&((ge=h[ce.route.id])!=null&&ge.shouldRevalidate)||le.hasClientLoader?me=!0:ie.add(ce.route.id))}),ie.size===0)return[];let Me=E4(t,f);return me&&ie.size>0&&Me.searchParams.set("_routes",e.filter(ce=>ie.has(ce.route.id)).map(ce=>ce.route.id).join(",")),[Me.pathname+Me.search]},[f,l,r,o,A,e,t,h]),H=ut.useMemo(()=>x4(O,o),[O,o]),$=A4(O);return ut.createElement(ut.Fragment,null,U.map(ie=>ut.createElement("link",{key:ie,rel:"prefetch",as:"fetch",href:ie,...n})),H.map(ie=>ut.createElement("link",{key:ie,rel:"modulepreload",href:ie,...n})),$.map(({key:ie,link:me})=>ut.createElement("link",{key:ie,...me})))}function M4(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var ZM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ZM&&(window.__reactRouterVersion="7.6.0")}catch{}function R4({basename:t,children:e,window:n}){let r=ut.useRef();r.current==null&&(r.current=vF({window:n,v5Compat:!0}));let o=r.current,[h,f]=ut.useState({action:o.action,location:o.location}),l=ut.useCallback(S=>{ut.startTransition(()=>f(S))},[f]);return ut.useLayoutEffect(()=>o.listen(l),[o,l]),ut.createElement(a4,{basename:t,children:e,location:h.location,navigationType:h.action,navigator:o})}var WM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,KM=ut.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:o,reloadDocument:h,replace:f,state:l,target:S,to:A,preventScrollReset:O,viewTransition:U,...H},$){let{basename:ie}=ut.useContext(Eu),me=typeof A=="string"&&WM.test(A),Me,ce=!1;if(typeof A=="string"&&me&&(Me=A,ZM))try{let ue=new URL(window.location.href),ve=A.startsWith("//")?new URL(ue.protocol+A):new URL(A),Pe=hc(ve.pathname,ie);ve.origin===ue.origin&&Pe!=null?A=Pe+ve.search+ve.hash:ce=!0}catch{bu(!1,`<Link to="${A}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let le=GF(A,{relative:o}),[ge,je,rt]=P4(r,H),qe=N4(A,{replace:f,state:l,target:S,preventScrollReset:O,relative:o,viewTransition:U});function fe(ue){e&&e(ue),ue.defaultPrevented||qe(ue)}let Q=ut.createElement("a",{...H,...rt,href:Me||le,onClick:ce||h?e:fe,ref:M4($,je),target:S,"data-discover":!me&&n==="render"?"true":void 0});return ge&&!me?ut.createElement(ut.Fragment,null,Q,ut.createElement(C4,{page:le})):Q});KM.displayName="Link";var L4=ut.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:o=!1,style:h,to:f,viewTransition:l,children:S,...A},O){let U=Yg(f,{relative:A.relative}),H=zd(),$=ut.useContext(f0),{navigator:ie,basename:me}=ut.useContext(Eu),Me=$!=null&&j4(U)&&l===!0,ce=ie.encodeLocation?ie.encodeLocation(U).pathname:U.pathname,le=H.pathname,ge=$&&$.navigation&&$.navigation.location?$.navigation.location.pathname:null;n||(le=le.toLowerCase(),ge=ge?ge.toLowerCase():null,ce=ce.toLowerCase()),ge&&me&&(ge=hc(ge,me)||ge);const je=ce!=="/"&&ce.endsWith("/")?ce.length-1:ce.length;let rt=le===ce||!o&&le.startsWith(ce)&&le.charAt(je)==="/",qe=ge!=null&&(ge===ce||!o&&ge.startsWith(ce)&&ge.charAt(ce.length)==="/"),fe={isActive:rt,isPending:qe,isTransitioning:Me},Q=rt?e:void 0,ue;typeof r=="function"?ue=r(fe):ue=[r,rt?"active":null,qe?"pending":null,Me?"transitioning":null].filter(Boolean).join(" ");let ve=typeof h=="function"?h(fe):h;return ut.createElement(KM,{...A,"aria-current":Q,className:ue,ref:O,style:ve,to:f,viewTransition:l},typeof S=="function"?S(fe):S)});L4.displayName="NavLink";var D4=ut.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:o,state:h,method:f=Ly,action:l,onSubmit:S,relative:A,preventScrollReset:O,viewTransition:U,...H},$)=>{let ie=B4(),me=V4(l,{relative:A}),Me=f.toLowerCase()==="get"?"get":"post",ce=typeof l=="string"&&WM.test(l),le=ge=>{if(S&&S(ge),ge.defaultPrevented)return;ge.preventDefault();let je=ge.nativeEvent.submitter,rt=(je==null?void 0:je.getAttribute("formmethod"))||f;ie(je||ge.currentTarget,{fetcherKey:e,method:rt,navigate:n,replace:o,state:h,relative:A,preventScrollReset:O,viewTransition:U})};return ut.createElement("form",{ref:$,method:Me,action:me,onSubmit:r?S:le,...H,"data-discover":!ce&&t==="render"?"true":void 0})});D4.displayName="Form";function z4(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function XM(t){let e=ut.useContext(Pp);return lr(e,z4(t)),e}function N4(t,{target:e,replace:n,state:r,preventScrollReset:o,relative:h,viewTransition:f}={}){let l=UM(),S=zd(),A=Yg(t,{relative:h});return ut.useCallback(O=>{if(f4(O,e)){O.preventDefault();let U=n!==void 0?n:Pg(S)===Pg(A);l(t,{replace:U,state:r,preventScrollReset:o,relative:h,viewTransition:f})}},[S,l,A,n,r,e,t,o,h,f])}var O4=0,F4=()=>`__${String(++O4)}__`;function B4(){let{router:t}=XM("useSubmit"),{basename:e}=ut.useContext(Eu),n=i4();return ut.useCallback(async(r,o={})=>{let{action:h,method:f,encType:l,formData:S,body:A}=g4(r,e);if(o.navigate===!1){let O=o.fetcherKey||F4();await t.fetch(O,n,o.action||h,{preventScrollReset:o.preventScrollReset,formData:S,body:A,formMethod:o.method||f,formEncType:o.encType||l,flushSync:o.flushSync})}else await t.navigate(o.action||h,{preventScrollReset:o.preventScrollReset,formData:S,body:A,formMethod:o.method||f,formEncType:o.encType||l,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[t,e,n])}function V4(t,{relative:e}={}){let{basename:n}=ut.useContext(Eu),r=ut.useContext(vc);lr(r,"useFormAction must be used inside a RouteContext");let[o]=r.matches.slice(-1),h={...Yg(t||".",{relative:e})},f=zd();if(t==null){h.search=f.search;let l=new URLSearchParams(h.search),S=l.getAll("index");if(S.some(O=>O==="")){l.delete("index"),S.filter(U=>U).forEach(U=>l.append("index",U));let O=l.toString();h.search=O?`?${O}`:""}}return(!t||t===".")&&o.route.index&&(h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(h.pathname=h.pathname==="/"?n:ic([n,h.pathname])),Pg(h)}function j4(t,e={}){let n=ut.useContext(BM);lr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=XM("useViewTransitionState"),o=Yg(t,{relative:e.relative});if(!n.isTransitioning)return!1;let h=hc(n.currentLocation.pathname,r)||n.currentLocation.pathname,f=hc(n.nextLocation.pathname,r)||n.nextLocation.pathname;return xv(o.pathname,f)!=null||xv(o.pathname,h)!=null}[...S4];const _w=[{name:"Alliance for Catholic Education",location:"Notre Dame",buildingType:"Academic Building"},{name:"Badin Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Baumer Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Basilica of the Sacred Heart",location:"Notre Dame",buildingType:"Academic Building"},{name:"Cafe commons",location:"Notre Dame",buildingType:"Student Building"},{name:"Carroll Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Chemistry Physics Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"Church of Our Lady of Loretto",location:"Saint Mary's",buildingType:"Academic Building"},{name:"Coleman-Morse Center",location:"Notre Dame",buildingType:"Student Building"},{name:"DeBartolo Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"Dillon Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Duncan Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Dunne Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Early Childhood Development Center",location:"Notre Dame",buildingType:"Academic Building"},{name:"Farley Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Fischer Graduate Housing",location:"Notre Dame",buildingType:"Hall"},{name:"Flaherty Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Flip Kitchen",location:"Notre Dame",buildingType:"Student Building"},{name:"Garbanzo Mediterranean Fresh @ Hesburgh Center",location:"Notre Dame",buildingType:"Student Building"},{name:"Grace Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Grotto of Our Lady of Lourdes",location:"Notre Dame",buildingType:"Academic Building"},{name:"Haggar College Center",location:"Saint Mary's",buildingType:"Student Building"},{name:"Hammes Notre Dame Bookstore",location:"Notre Dame",buildingType:"Student Building"},{name:"Hesburgh Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"Holy Cross College",location:"Holy Cross",buildingType:"Academic Building"},{name:"Holy Cross Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"Howard Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Huddle Mart Convenience Store",location:"Notre Dame",buildingType:"Student Building"},{name:"Johnson Family Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Keough Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Keough School of Global Affairs",location:"Notre Dame",buildingType:"Academic Building"},{name:"Keenan Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Legends",location:"Notre Dame",buildingType:"Student Building"},{name:"Le Man's College",location:"Saint Mary's",buildingType:"Academic Building"},{name:"Lewis Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Library Lawn",location:"Notre Dame",buildingType:"Academic Building"},{name:"Lyons Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Main Building",location:"Notre Dame",buildingType:"Academic Building"},{name:"McGrath Institute For Church Life",location:"Notre Dame",buildingType:"Academic Building"},{name:"Mendoza College of Business",location:"Notre Dame",buildingType:"Academic Building"},{name:"Moreau Seminary Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"Morrissey Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Music Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"North Dining Hall",location:"Notre Dame",buildingType:"Student Building"},{name:"North Dome",location:"Notre Dame",buildingType:"Academic Building"},{name:"Notre Dame College of Engineering",location:"Notre Dame",buildingType:"Academic Building"},{name:"Notre Dame Computer Store",location:"Notre Dame",buildingType:"Student Building"},{name:"Notre Dame Law School",location:"Notre Dame",buildingType:"Academic Building"},{name:"Notre Dame Stadium",location:"Notre Dame",buildingType:"Sports Facility"},{name:"O'Neill Family Hall",location:"Notre Dame",buildingType:"Hall"},{name:"O'Neill Hall of Music",location:"Notre Dame",buildingType:"Academic Building"},{name:"Pasquerilla West Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Pfeil Center",location:"Holy Cross",buildingType:"Sports Facility"},{name:"Purcell Pavilion",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Raclin Murphy Museum of Art",location:"Notre Dame",buildingType:"Academic Building"},{name:"Rolfs Aquatic Center",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Ryan Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Saint Mary's College Angela Athletic Center",location:"Saint Mary's",buildingType:"Sports Facility"},{name:"Saint Mary's Student Center",location:"Saint Mary's",buildingType:"Student Building"},{name:"Science Hall",location:"Saint Mary's",buildingType:"Academic Building"},{name:"Siegfried Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Smith Center for Recreational Sports",location:"Notre Dame",buildingType:"Sports Facility"},{name:"South Dining Hall",location:"Notre Dame",buildingType:"Student Building"},{name:"Spes Unica Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"St Edwards Hall",location:"Notre Dame",buildingType:"Hall"},{name:"St. Joseph Chapel",location:"Holy Cross",buildingType:"Academic Building"},{name:"Stanford Hall",location:"Notre Dame",buildingType:"Hall"},{name:"The Graduate School",location:"Notre Dame",buildingType:"Academic Building"},{name:"Traditions",location:"Notre Dame",buildingType:"Student Building"},{name:"Undergraduate Admissions",location:"Notre Dame",buildingType:"Student Building"},{name:"University Health Services",location:"Notre Dame",buildingType:"Student Building"},{name:"University of Notre Dame School of Architecture",location:"Notre Dame",buildingType:"Academic Building"},{name:"University Village",location:"Notre Dame",buildingType:"Hall"},{name:"Walsh Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Welsh Family Hall",location:"Notre Dame",buildingType:"Hall"}].sort((t,e)=>t.buildingType!==e.buildingType?t.buildingType.localeCompare(e.buildingType):t.name.localeCompare(e.name)),Bm=[{name:"Alliance for Catholic Education",latitude:41.7036684,longitude:-86.2398665,location:"Notre Dame",buildingType:"Academic Building"},{name:"Badin Hall",latitude:41.7006588,longitude:-86.2412167,location:"Notre Dame",buildingType:"Hall"},{name:"Baumer Hall",latitude:41.6970819,longitude:-86.2413698,location:"Notre Dame",buildingType:"Hall"},{name:"Basilica of the Sacred Heart",latitude:41.7026336,longitude:-86.2397856,location:"Notre Dame",buildingType:"Academic Building"},{name:"Cafe commons",latitude:41.7056815,longitude:-86.2353447,location:"Notre Dame",buildingType:"Student Building"},{name:"Carroll Hall",latitude:41.7019811,longitude:-86.2478028,location:"Notre Dame",buildingType:"Hall"},{name:"Chemistry Physics Library",latitude:41.7015402,longitude:-86.2366507,location:"Notre Dame",buildingType:"Academic Building"},{name:"Church of Our Lady of Loretto",latitude:41.7046872,longitude:-86.2605608,location:"Saint Mary's",buildingType:"Academic Building"},{name:"Coleman-Morse Center",latitude:41.7006394,longitude:-86.240573,location:"Notre Dame",buildingType:"Student Building"},{name:"DeBartolo Hall",latitude:41.6982522,longitude:-86.2362484,location:"Notre Dame",buildingType:"Academic Building"},{name:"Dillon Hall",latitude:41.6996037,longitude:-86.2403852,location:"Notre Dame",buildingType:"Hall"},{name:"Duncan Hall",latitude:41.697909,longitude:-86.2433368,location:"Notre Dame",buildingType:"Hall"},{name:"Dunne Hall",latitude:41.7045274,longitude:-86.2329434,location:"Notre Dame",buildingType:"Hall"},{name:"Early Childhood Development Center",latitude:41.7036642,longitude:-86.2297151,location:"Notre Dame",buildingType:"Academic Building"},{name:"Farley Hall",latitude:41.7036468,longitude:-86.2361456,location:"Notre Dame",buildingType:"Hall"},{name:"Fischer Graduate Housing",latitude:41.7051242,longitude:-86.229011,location:"Notre Dame",buildingType:"Hall"},{name:"Flaherty Hall",latitude:41.7034216,longitude:-86.2329018,location:"Notre Dame",buildingType:"Hall"},{name:"Flip Kitchen",latitude:41.7020089,longitude:-86.2376002,location:"Notre Dame",buildingType:"Student Building"},{name:"Garbanzo Mediterranean Fresh @ Hesburgh Center",latitude:41.696418,longitude:-86.2379586,location:"Notre Dame",buildingType:"Student Building"},{name:"Grace Hall",latitude:41.7048337,longitude:-86.2339312,location:"Notre Dame",buildingType:"Hall"},{name:"Grotto of Our Lady of Lourdes",latitude:41.7030868,longitude:-86.2403638,location:"Notre Dame",buildingType:"Academic Building"},{name:"Haggar College Center",latitude:41.7074603,longitude:-86.2556776,location:"Saint Mary's",buildingType:"Student Building"},{name:"Hammes Notre Dame Bookstore",latitude:41.696401,longitude:-86.2397479,location:"Notre Dame",buildingType:"Student Building"},{name:"Hesburgh Library",latitude:41.7023892,longitude:-86.2341526,location:"Notre Dame",buildingType:"Academic Building"},{name:"Holy Cross College",latitude:41.7000923,longitude:-86.2537078,location:"Holy Cross",buildingType:"Academic Building"},{name:"Holy Cross Hall",latitude:41.7056222,longitude:-86.2593738,location:"Saint Mary's",buildingType:"Hall"},{name:"Howard Hall",latitude:41.7007478,longitude:-86.2418234,location:"Notre Dame",buildingType:"Hall"},{name:"Huddle Mart Convenience Store",latitude:41.7018394,longitude:-86.2374841,location:"Notre Dame",buildingType:"Student Building"},{name:"Johnson Family Hall",latitude:41.7051344,longitude:-86.2322357,location:"Notre Dame",buildingType:"Hall"},{name:"Keough Hall",latitude:41.6980119,longitude:-86.2410978,location:"Notre Dame",buildingType:"Hall"},{name:"Keough School of Global Affairs",latitude:41.6958104,longitude:-86.2377301,location:"Notre Dame",buildingType:"Academic Building"},{name:"Keenan Hall",latitude:41.7042013,longitude:-86.2373552,location:"Notre Dame",buildingType:"Hall"},{name:"Legends",latitude:41.6961149,longitude:-86.2349385,location:"Notre Dame",buildingType:"Student Building"},{name:"Le Man's College",latitude:41.7073021,longitude:-86.2572448,location:"Saint Mary's",buildingType:"Academic Building"},{name:"Lewis Hall",latitude:41.7044552,longitude:-86.2396082,location:"Notre Dame",buildingType:"Hall"},{name:"Library Lawn",latitude:41.7014918,longitude:-86.2340728,location:"Notre Dame",buildingType:"Academic Building"},{name:"Lyons Hall",latitude:41.7007967,longitude:-86.2434023,location:"Notre Dame",buildingType:"Hall"},{name:"Main Building",latitude:41.7030267,longitude:-86.2390726,location:"Notre Dame",buildingType:"Academic Building"},{name:"McGrath Institute For Church Life",latitude:41.7028431,longitude:-86.2353977,location:"Notre Dame",buildingType:"Academic Building"},{name:"Mendoza College of Business",latitude:41.6971637,longitude:-86.2360776,location:"Notre Dame",buildingType:"Academic Building"},{name:"Moreau Seminary Library",latitude:41.7075309,longitude:-86.2413558,location:"Notre Dame",buildingType:"Academic Building"},{name:"Morrissey Hall",latitude:41.7009489,longitude:-86.24263,location:"Notre Dame",buildingType:"Hall"},{name:"Music Library",latitude:41.6972441,longitude:-86.2338908,location:"Notre Dame",buildingType:"Academic Building"},{name:"North Dining Hall",latitude:41.7043644,longitude:-86.2360824,location:"Notre Dame",buildingType:"Student Building"},{name:"North Dome",latitude:41.6989078,longitude:-86.2313753,location:"Notre Dame",buildingType:"Academic Building"},{name:"Notre Dame College of Engineering",latitude:41.6994719,longitude:-86.236722,location:"Notre Dame",buildingType:"Academic Building"},{name:"Notre Dame Computer Store",latitude:41.69635,longitude:-86.2399734,location:"Notre Dame",buildingType:"Student Building"},{name:"Notre Dame Law School",latitude:41.6986715,longitude:-86.2379551,location:"Notre Dame",buildingType:"Academic Building"},{name:"Notre Dame Stadium",latitude:41.6983981,longitude:-86.233916,location:"Notre Dame",buildingType:"Sports Facility"},{name:"O'Neill Family Hall",latitude:41.6980337,longitude:-86.2418805,location:"Notre Dame",buildingType:"Hall"},{name:"O'Neill Hall of Music",latitude:41.6972107,longitude:-86.2339136,location:"Notre Dame",buildingType:"Academic Building"},{name:"Pasquerilla West Hall",latitude:41.7038431,longitude:-86.2349545,location:"Notre Dame",buildingType:"Hall"},{name:"Pfeil Center",latitude:41.6979537,longitude:-86.2548825,location:"Holy Cross",buildingType:"Sports Facility"},{name:"Purcell Pavilion",latitude:41.6978278,longitude:-86.2313079,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Raclin Murphy Museum of Art",latitude:41.6938488,longitude:-86.2348584,location:"Notre Dame",buildingType:"Academic Building"},{name:"Rolfs Aquatic Center",latitude:41.6985583,longitude:-86.2302632,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Ryan Hall",latitude:41.697321,longitude:-86.2401144,location:"Notre Dame",buildingType:"Hall"},{name:"Saint Mary's College Angela Athletic Center",latitude:41.7099386,longitude:-86.2569961,location:"Saint Mary's",buildingType:"Sports Facility"},{name:"Saint Mary's Student Center",latitude:41.7081947,longitude:-86.258363,location:"Saint Mary's",buildingType:"Student Building"},{name:"Science Hall",latitude:41.7082933,longitude:-86.2554595,location:"Saint Mary's",buildingType:"Academic Building"},{name:"Siegfried Hall",latitude:41.703517,longitude:-86.2349108,location:"Notre Dame",buildingType:"Hall"},{name:"Smith Center for Recreational Sports",latitude:41.6984522,longitude:-86.2347681,location:"Notre Dame",buildingType:"Sports Facility"},{name:"South Dining Hall",latitude:41.699728,longitude:-86.2414702,location:"Notre Dame",buildingType:"Student Building"},{name:"Spes Unica Hall",latitude:41.7082812,longitude:-86.2542048,location:"Saint Mary's",buildingType:"Hall"},{name:"St Edwards Hall",latitude:41.703349,longitude:-86.2381985,location:"Notre Dame",buildingType:"Hall"},{name:"St. Joseph Chapel",latitude:41.6999412,longitude:-86.2532049,location:"Holy Cross",buildingType:"Academic Building"},{name:"Stanford Hall",latitude:41.704471,longitude:-86.2374673,location:"Notre Dame",buildingType:"Hall"},{name:"The Graduate School",latitude:41.7014004,longitude:-86.2419571,location:"Notre Dame",buildingType:"Academic Building"},{name:"Traditions",latitude:41.6924119,longitude:-86.2334396,location:"Notre Dame",buildingType:"Student Building"},{name:"Undergraduate Admissions",latitude:41.6981031,longitude:-86.2379327,location:"Notre Dame",buildingType:"Student Building"},{name:"University Health Services",latitude:41.7043474,longitude:-86.2381191,location:"Notre Dame",buildingType:"Student Building"},{name:"University of Notre Dame School of Architecture",latitude:41.6950452,longitude:-86.2351332,location:"Notre Dame",buildingType:"Academic Building"},{name:"University Village",latitude:41.7123537,longitude:-86.2481859,location:"Notre Dame",buildingType:"Hall"},{name:"Walsh Hall",latitude:41.7010014,longitude:-86.2400412,location:"Notre Dame",buildingType:"Hall"},{name:"Welsh Family Hall",latitude:41.698092,longitude:-86.2403468,location:"Notre Dame",buildingType:"Hall"}].sort((t,e)=>t.buildingType!==e.buildingType?t.buildingType.localeCompare(e.buildingType):t.name.localeCompare(e.name));var XI={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YM=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let o=t.charCodeAt(r);o<128?e[n++]=o:o<2048?(e[n++]=o>>6|192,e[n++]=o&63|128):(o&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(o=65536+((o&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=o>>18|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128,e[n++]=o&63|128):(e[n++]=o>>12|224,e[n++]=o>>6&63|128,e[n++]=o&63|128)}return e},U4=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const o=t[n++];if(o<128)e[r++]=String.fromCharCode(o);else if(o>191&&o<224){const h=t[n++];e[r++]=String.fromCharCode((o&31)<<6|h&63)}else if(o>239&&o<365){const h=t[n++],f=t[n++],l=t[n++],S=((o&7)<<18|(h&63)<<12|(f&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(S>>10)),e[r++]=String.fromCharCode(56320+(S&1023))}else{const h=t[n++],f=t[n++];e[r++]=String.fromCharCode((o&15)<<12|(h&63)<<6|f&63)}}return e.join("")},QM={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let o=0;o<t.length;o+=3){const h=t[o],f=o+1<t.length,l=f?t[o+1]:0,S=o+2<t.length,A=S?t[o+2]:0,O=h>>2,U=(h&3)<<4|l>>4;let H=(l&15)<<2|A>>6,$=A&63;S||($=64,f||(H=64)),r.push(n[O],n[U],n[H],n[$])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(YM(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):U4(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let o=0;o<t.length;){const h=n[t.charAt(o++)],l=o<t.length?n[t.charAt(o)]:0;++o;const A=o<t.length?n[t.charAt(o)]:64;++o;const U=o<t.length?n[t.charAt(o)]:64;if(++o,h==null||l==null||A==null||U==null)throw new $4;const H=h<<2|l>>4;if(r.push(H),A!==64){const $=l<<4&240|A>>2;if(r.push($),U!==64){const ie=A<<6&192|U;r.push(ie)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class $4 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const q4=function(t){const e=YM(t);return QM.encodeByteArray(e,!0)},wv=function(t){return q4(t).replace(/\./g,"")},JM=function(t){try{return QM.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H4(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G4=()=>H4().__FIREBASE_DEFAULTS__,Z4=()=>{if(typeof process>"u"||typeof XI>"u")return;const t=XI.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},W4=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&JM(t[1]);return e&&JSON.parse(e)},m0=()=>{try{return G4()||Z4()||W4()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},eR=t=>{var e,n;return(n=(e=m0())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},K4=t=>{const e=eR(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},tR=()=>{var t;return(t=m0())===null||t===void 0?void 0:t.config},nR=t=>{var e;return(e=m0())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y4(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",o=t.iat||0,h=t.sub||t.user_id;if(!h)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:o,exp:o+3600,auth_time:o,sub:h,user_id:h,firebase:{sign_in_provider:"custom",identities:{}}},t);return[wv(JSON.stringify(n)),wv(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Q4(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(eo())}function J4(){var t;const e=(t=m0())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function eB(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function iR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function tB(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function nB(){const t=eo();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function iB(){return!J4()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rR(){try{return typeof indexedDB=="object"}catch{return!1}}function sR(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},o.onupgradeneeded=()=>{n=!1},o.onerror=()=>{var h;e(((h=o.error)===null||h===void 0?void 0:h.message)||"")}}catch(n){e(n)}})}function rB(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sB="FirebaseError";class Vl extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=sB,Object.setPrototypeOf(this,Vl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nd.prototype.create)}}class Nd{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},o=`${this.service}/${e}`,h=this.errors[e],f=h?oB(h,r):"Error",l=`${this.serviceName}: ${f} (${o}).`;return new Vl(o,l,r)}}function oB(t,e){return t.replace(aB,(n,r)=>{const o=e[r];return o!=null?String(o):`<${r}?>`})}const aB=/\{\$([^}]+)}/g;function lB(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Cg(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const o of n){if(!r.includes(o))return!1;const h=t[o],f=e[o];if(YI(h)&&YI(f)){if(!Cg(h,f))return!1}else if(h!==f)return!1}for(const o of r)if(!n.includes(o))return!1;return!0}function YI(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qg(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(o=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(o))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function uB(t,e){const n=new cB(t,e);return n.subscribe.bind(n)}class cB{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let o;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");hB(e,["next","error","complete"])?o=e:o={next:e,error:n,complete:r},o.next===void 0&&(o.next=yw),o.error===void 0&&(o.error=yw),o.complete===void 0&&(o.complete=yw);const h=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?o.error(this.finalError):o.complete()}catch{}}),this.observers.push(o),h}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function hB(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function yw(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dB=1e3,fB=2,pB=4*60*60*1e3,mB=.5;function QI(t,e=dB,n=fB){const r=e*Math.pow(n,t),o=Math.round(mB*r*(Math.random()-.5)*2);return Math.min(pB,r+o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(t){return t&&t._delegate?t._delegate:t}class Fl{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new X4;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const o=this.getOrInitializeService({instanceIdentifier:n});o&&r.resolve(o)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),o=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(h){if(o)return null;throw h}else{if(o)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(yB(e))try{this.getOrInitializeService({instanceIdentifier:rd})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(n);try{const h=this.getOrInitializeService({instanceIdentifier:o});r.resolve(h)}catch{}}}}clearInstance(e=rd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=rd){return this.instances.has(e)}getOptions(e=rd){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const o=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[h,f]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(h);r===l&&f.resolve(o)}return o}onInit(e,n){var r;const o=this.normalizeInstanceIdentifier(n),h=(r=this.onInitCallbacks.get(o))!==null&&r!==void 0?r:new Set;h.add(e),this.onInitCallbacks.set(o,h);const f=this.instances.get(o);return f&&e(f,o),()=>{h.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const o of r)try{o(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:_B(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=rd){return this.component?this.component.multipleInstances?e:rd:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _B(t){return t===rd?void 0:t}function yB(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vB{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new gB(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Un;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Un||(Un={}));const xB={debug:Un.DEBUG,verbose:Un.VERBOSE,info:Un.INFO,warn:Un.WARN,error:Un.ERROR,silent:Un.SILENT},wB=Un.INFO,bB={[Un.DEBUG]:"log",[Un.VERBOSE]:"log",[Un.INFO]:"info",[Un.WARN]:"warn",[Un.ERROR]:"error"},TB=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),o=bB[e];if(o)console[o](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class g0{constructor(e){this.name=e,this._logLevel=wB,this._logHandler=TB,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Un))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?xB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Un.DEBUG,...e),this._logHandler(this,Un.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Un.VERBOSE,...e),this._logHandler(this,Un.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Un.INFO,...e),this._logHandler(this,Un.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Un.WARN,...e),this._logHandler(this,Un.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Un.ERROR,...e),this._logHandler(this,Un.ERROR,...e)}}const SB=(t,e)=>e.some(n=>t instanceof n);let JI,eP;function EB(){return JI||(JI=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function IB(){return eP||(eP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const oR=new WeakMap,Fb=new WeakMap,aR=new WeakMap,vw=new WeakMap,TT=new WeakMap;function PB(t){const e=new Promise((n,r)=>{const o=()=>{t.removeEventListener("success",h),t.removeEventListener("error",f)},h=()=>{n(hh(t.result)),o()},f=()=>{r(t.error),o()};t.addEventListener("success",h),t.addEventListener("error",f)});return e.then(n=>{n instanceof IDBCursor&&oR.set(n,t)}).catch(()=>{}),TT.set(e,t),e}function CB(t){if(Fb.has(t))return;const e=new Promise((n,r)=>{const o=()=>{t.removeEventListener("complete",h),t.removeEventListener("error",f),t.removeEventListener("abort",f)},h=()=>{n(),o()},f=()=>{r(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",h),t.addEventListener("error",f),t.addEventListener("abort",f)});Fb.set(t,e)}let Bb={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Fb.get(t);if(e==="objectStoreNames")return t.objectStoreNames||aR.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hh(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function AB(t){Bb=t(Bb)}function kB(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(xw(this),e,...n);return aR.set(r,e.sort?e.sort():[e]),hh(r)}:IB().includes(t)?function(...e){return t.apply(xw(this),e),hh(oR.get(this))}:function(...e){return hh(t.apply(xw(this),e))}}function MB(t){return typeof t=="function"?kB(t):(t instanceof IDBTransaction&&CB(t),SB(t,EB())?new Proxy(t,Bb):t)}function hh(t){if(t instanceof IDBRequest)return PB(t);if(vw.has(t))return vw.get(t);const e=MB(t);return e!==t&&(vw.set(t,e),TT.set(e,t)),e}const xw=t=>TT.get(t);function lR(t,e,{blocked:n,upgrade:r,blocking:o,terminated:h}={}){const f=indexedDB.open(t,e),l=hh(f);return r&&f.addEventListener("upgradeneeded",S=>{r(hh(f.result),S.oldVersion,S.newVersion,hh(f.transaction),S)}),n&&f.addEventListener("blocked",S=>n(S.oldVersion,S.newVersion,S)),l.then(S=>{h&&S.addEventListener("close",()=>h()),o&&S.addEventListener("versionchange",A=>o(A.oldVersion,A.newVersion,A))}).catch(()=>{}),l}const RB=["get","getKey","getAll","getAllKeys","count"],LB=["put","add","delete","clear"],ww=new Map;function tP(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ww.get(e))return ww.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=LB.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||RB.includes(n)))return;const h=async function(f,...l){const S=this.transaction(f,o?"readwrite":"readonly");let A=S.store;return r&&(A=A.index(l.shift())),(await Promise.all([A[n](...l),o&&S.done]))[0]};return ww.set(e,h),h}AB(t=>({...t,get:(e,n,r)=>tP(e,n)||t.get(e,n,r),has:(e,n)=>!!tP(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DB{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(zB(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function zB(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Vb="@firebase/app",nP="0.10.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dc=new g0("@firebase/app"),NB="@firebase/app-compat",OB="@firebase/analytics-compat",FB="@firebase/analytics",BB="@firebase/app-check-compat",VB="@firebase/app-check",jB="@firebase/auth",UB="@firebase/auth-compat",$B="@firebase/database",qB="@firebase/data-connect",HB="@firebase/database-compat",GB="@firebase/functions",ZB="@firebase/functions-compat",WB="@firebase/installations",KB="@firebase/installations-compat",XB="@firebase/messaging",YB="@firebase/messaging-compat",QB="@firebase/performance",JB="@firebase/performance-compat",e6="@firebase/remote-config",t6="@firebase/remote-config-compat",n6="@firebase/storage",i6="@firebase/storage-compat",r6="@firebase/firestore",s6="@firebase/vertexai",o6="@firebase/firestore-compat",a6="firebase",l6="11.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jb="[DEFAULT]",u6={[Vb]:"fire-core",[NB]:"fire-core-compat",[FB]:"fire-analytics",[OB]:"fire-analytics-compat",[VB]:"fire-app-check",[BB]:"fire-app-check-compat",[jB]:"fire-auth",[UB]:"fire-auth-compat",[$B]:"fire-rtdb",[qB]:"fire-data-connect",[HB]:"fire-rtdb-compat",[GB]:"fire-fn",[ZB]:"fire-fn-compat",[WB]:"fire-iid",[KB]:"fire-iid-compat",[XB]:"fire-fcm",[YB]:"fire-fcm-compat",[QB]:"fire-perf",[JB]:"fire-perf-compat",[e6]:"fire-rc",[t6]:"fire-rc-compat",[n6]:"fire-gcs",[i6]:"fire-gcs-compat",[r6]:"fire-fst",[o6]:"fire-fst-compat",[s6]:"fire-vertex","fire-js":"fire-js",[a6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bv=new Map,c6=new Map,Ub=new Map;function iP(t,e){try{t.container.addComponent(e)}catch(n){dc.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Tu(t){const e=t.name;if(Ub.has(e))return dc.debug(`There were multiple attempts to register component ${e}.`),!1;Ub.set(e,t);for(const n of bv.values())iP(n,t);for(const n of c6.values())iP(n,t);return!0}function Od(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function eh(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h6={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},dh=new Nd("app","Firebase",h6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d6{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Fl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw dh.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp=l6;function uR(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:jb,automaticDataCollectionEnabled:!1},e),o=r.name;if(typeof o!="string"||!o)throw dh.create("bad-app-name",{appName:String(o)});if(n||(n=tR()),!n)throw dh.create("no-options");const h=bv.get(o);if(h){if(Cg(n,h.options)&&Cg(r,h.config))return h;throw dh.create("duplicate-app",{appName:o})}const f=new vB(o);for(const S of Ub.values())f.addComponent(S);const l=new d6(n,r,f);return bv.set(o,l),l}function ST(t=jb){const e=bv.get(t);if(!e&&t===jb&&tR())return uR();if(!e)throw dh.create("no-app",{appName:t});return e}function Za(t,e,n){var r;let o=(r=u6[t])!==null&&r!==void 0?r:t;n&&(o+=`-${n}`);const h=o.match(/\s|\//),f=e.match(/\s|\//);if(h||f){const l=[`Unable to register library "${o}" with version "${e}":`];h&&l.push(`library name "${o}" contains illegal characters (whitespace or "/")`),h&&f&&l.push("and"),f&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),dc.warn(l.join(" "));return}Tu(new Fl(`${o}-version`,()=>({library:o,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f6="firebase-heartbeat-database",p6=1,Ag="firebase-heartbeat-store";let bw=null;function cR(){return bw||(bw=lR(f6,p6,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ag)}catch(n){console.warn(n)}}}}).catch(t=>{throw dh.create("idb-open",{originalErrorMessage:t.message})})),bw}async function m6(t){try{const n=(await cR()).transaction(Ag),r=await n.objectStore(Ag).get(hR(t));return await n.done,r}catch(e){if(e instanceof Vl)dc.warn(e.message);else{const n=dh.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});dc.warn(n.message)}}}async function rP(t,e){try{const r=(await cR()).transaction(Ag,"readwrite");await r.objectStore(Ag).put(e,hR(t)),await r.done}catch(n){if(n instanceof Vl)dc.warn(n.message);else{const r=dh.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});dc.warn(r.message)}}}function hR(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g6=1024,_6=30*24*60*60*1e3;class y6{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new x6(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),h=sP();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===h||this._heartbeatsCache.heartbeats.some(f=>f.date===h)?void 0:(this._heartbeatsCache.heartbeats.push({date:h,agent:o}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(f=>{const l=new Date(f.date).valueOf();return Date.now()-l<=_6}),this._storage.overwrite(this._heartbeatsCache))}catch(r){dc.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=sP(),{heartbeatsToSend:r,unsentEntries:o}=v6(this._heartbeatsCache.heartbeats),h=wv(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),h}catch(n){return dc.warn(n),""}}}function sP(){return new Date().toISOString().substring(0,10)}function v6(t,e=g6){const n=[];let r=t.slice();for(const o of t){const h=n.find(f=>f.agent===o.agent);if(h){if(h.dates.push(o.date),oP(n)>e){h.dates.pop();break}}else if(n.push({agent:o.agent,dates:[o.date]}),oP(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class x6{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rR()?sR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await m6(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const o=await this.read();return rP(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:o.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const o=await this.read();return rP(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:o.lastSentHeartbeatDate,heartbeats:[...o.heartbeats,...e.heartbeats]})}else return}}function oP(t){return wv(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w6(t){Tu(new Fl("platform-logger",e=>new DB(e),"PRIVATE")),Tu(new Fl("heartbeat",e=>new y6(e),"PRIVATE")),Za(Vb,nP,t),Za(Vb,nP,"esm2017"),Za("fire-js","")}w6("");var b6="firebase",T6="11.2.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Za(b6,T6,"app");var aP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fh,dR;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(fe,Q){function ue(){}ue.prototype=Q.prototype,fe.D=Q.prototype,fe.prototype=new ue,fe.prototype.constructor=fe,fe.C=function(ve,Pe,Ve){for(var Ee=Array(arguments.length-2),Xt=2;Xt<arguments.length;Xt++)Ee[Xt-2]=arguments[Xt];return Q.prototype[Pe].apply(ve,Ee)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function o(fe,Q,ue){ue||(ue=0);var ve=Array(16);if(typeof Q=="string")for(var Pe=0;16>Pe;++Pe)ve[Pe]=Q.charCodeAt(ue++)|Q.charCodeAt(ue++)<<8|Q.charCodeAt(ue++)<<16|Q.charCodeAt(ue++)<<24;else for(Pe=0;16>Pe;++Pe)ve[Pe]=Q[ue++]|Q[ue++]<<8|Q[ue++]<<16|Q[ue++]<<24;Q=fe.g[0],ue=fe.g[1],Pe=fe.g[2];var Ve=fe.g[3],Ee=Q+(Ve^ue&(Pe^Ve))+ve[0]+3614090360&4294967295;Q=ue+(Ee<<7&4294967295|Ee>>>25),Ee=Ve+(Pe^Q&(ue^Pe))+ve[1]+3905402710&4294967295,Ve=Q+(Ee<<12&4294967295|Ee>>>20),Ee=Pe+(ue^Ve&(Q^ue))+ve[2]+606105819&4294967295,Pe=Ve+(Ee<<17&4294967295|Ee>>>15),Ee=ue+(Q^Pe&(Ve^Q))+ve[3]+3250441966&4294967295,ue=Pe+(Ee<<22&4294967295|Ee>>>10),Ee=Q+(Ve^ue&(Pe^Ve))+ve[4]+4118548399&4294967295,Q=ue+(Ee<<7&4294967295|Ee>>>25),Ee=Ve+(Pe^Q&(ue^Pe))+ve[5]+1200080426&4294967295,Ve=Q+(Ee<<12&4294967295|Ee>>>20),Ee=Pe+(ue^Ve&(Q^ue))+ve[6]+2821735955&4294967295,Pe=Ve+(Ee<<17&4294967295|Ee>>>15),Ee=ue+(Q^Pe&(Ve^Q))+ve[7]+4249261313&4294967295,ue=Pe+(Ee<<22&4294967295|Ee>>>10),Ee=Q+(Ve^ue&(Pe^Ve))+ve[8]+1770035416&4294967295,Q=ue+(Ee<<7&4294967295|Ee>>>25),Ee=Ve+(Pe^Q&(ue^Pe))+ve[9]+2336552879&4294967295,Ve=Q+(Ee<<12&4294967295|Ee>>>20),Ee=Pe+(ue^Ve&(Q^ue))+ve[10]+4294925233&4294967295,Pe=Ve+(Ee<<17&4294967295|Ee>>>15),Ee=ue+(Q^Pe&(Ve^Q))+ve[11]+2304563134&4294967295,ue=Pe+(Ee<<22&4294967295|Ee>>>10),Ee=Q+(Ve^ue&(Pe^Ve))+ve[12]+1804603682&4294967295,Q=ue+(Ee<<7&4294967295|Ee>>>25),Ee=Ve+(Pe^Q&(ue^Pe))+ve[13]+4254626195&4294967295,Ve=Q+(Ee<<12&4294967295|Ee>>>20),Ee=Pe+(ue^Ve&(Q^ue))+ve[14]+2792965006&4294967295,Pe=Ve+(Ee<<17&4294967295|Ee>>>15),Ee=ue+(Q^Pe&(Ve^Q))+ve[15]+1236535329&4294967295,ue=Pe+(Ee<<22&4294967295|Ee>>>10),Ee=Q+(Pe^Ve&(ue^Pe))+ve[1]+4129170786&4294967295,Q=ue+(Ee<<5&4294967295|Ee>>>27),Ee=Ve+(ue^Pe&(Q^ue))+ve[6]+3225465664&4294967295,Ve=Q+(Ee<<9&4294967295|Ee>>>23),Ee=Pe+(Q^ue&(Ve^Q))+ve[11]+643717713&4294967295,Pe=Ve+(Ee<<14&4294967295|Ee>>>18),Ee=ue+(Ve^Q&(Pe^Ve))+ve[0]+3921069994&4294967295,ue=Pe+(Ee<<20&4294967295|Ee>>>12),Ee=Q+(Pe^Ve&(ue^Pe))+ve[5]+3593408605&4294967295,Q=ue+(Ee<<5&4294967295|Ee>>>27),Ee=Ve+(ue^Pe&(Q^ue))+ve[10]+38016083&4294967295,Ve=Q+(Ee<<9&4294967295|Ee>>>23),Ee=Pe+(Q^ue&(Ve^Q))+ve[15]+3634488961&4294967295,Pe=Ve+(Ee<<14&4294967295|Ee>>>18),Ee=ue+(Ve^Q&(Pe^Ve))+ve[4]+3889429448&4294967295,ue=Pe+(Ee<<20&4294967295|Ee>>>12),Ee=Q+(Pe^Ve&(ue^Pe))+ve[9]+568446438&4294967295,Q=ue+(Ee<<5&4294967295|Ee>>>27),Ee=Ve+(ue^Pe&(Q^ue))+ve[14]+3275163606&4294967295,Ve=Q+(Ee<<9&4294967295|Ee>>>23),Ee=Pe+(Q^ue&(Ve^Q))+ve[3]+4107603335&4294967295,Pe=Ve+(Ee<<14&4294967295|Ee>>>18),Ee=ue+(Ve^Q&(Pe^Ve))+ve[8]+1163531501&4294967295,ue=Pe+(Ee<<20&4294967295|Ee>>>12),Ee=Q+(Pe^Ve&(ue^Pe))+ve[13]+2850285829&4294967295,Q=ue+(Ee<<5&4294967295|Ee>>>27),Ee=Ve+(ue^Pe&(Q^ue))+ve[2]+4243563512&4294967295,Ve=Q+(Ee<<9&4294967295|Ee>>>23),Ee=Pe+(Q^ue&(Ve^Q))+ve[7]+1735328473&4294967295,Pe=Ve+(Ee<<14&4294967295|Ee>>>18),Ee=ue+(Ve^Q&(Pe^Ve))+ve[12]+2368359562&4294967295,ue=Pe+(Ee<<20&4294967295|Ee>>>12),Ee=Q+(ue^Pe^Ve)+ve[5]+4294588738&4294967295,Q=ue+(Ee<<4&4294967295|Ee>>>28),Ee=Ve+(Q^ue^Pe)+ve[8]+2272392833&4294967295,Ve=Q+(Ee<<11&4294967295|Ee>>>21),Ee=Pe+(Ve^Q^ue)+ve[11]+1839030562&4294967295,Pe=Ve+(Ee<<16&4294967295|Ee>>>16),Ee=ue+(Pe^Ve^Q)+ve[14]+4259657740&4294967295,ue=Pe+(Ee<<23&4294967295|Ee>>>9),Ee=Q+(ue^Pe^Ve)+ve[1]+2763975236&4294967295,Q=ue+(Ee<<4&4294967295|Ee>>>28),Ee=Ve+(Q^ue^Pe)+ve[4]+1272893353&4294967295,Ve=Q+(Ee<<11&4294967295|Ee>>>21),Ee=Pe+(Ve^Q^ue)+ve[7]+4139469664&4294967295,Pe=Ve+(Ee<<16&4294967295|Ee>>>16),Ee=ue+(Pe^Ve^Q)+ve[10]+3200236656&4294967295,ue=Pe+(Ee<<23&4294967295|Ee>>>9),Ee=Q+(ue^Pe^Ve)+ve[13]+681279174&4294967295,Q=ue+(Ee<<4&4294967295|Ee>>>28),Ee=Ve+(Q^ue^Pe)+ve[0]+3936430074&4294967295,Ve=Q+(Ee<<11&4294967295|Ee>>>21),Ee=Pe+(Ve^Q^ue)+ve[3]+3572445317&4294967295,Pe=Ve+(Ee<<16&4294967295|Ee>>>16),Ee=ue+(Pe^Ve^Q)+ve[6]+76029189&4294967295,ue=Pe+(Ee<<23&4294967295|Ee>>>9),Ee=Q+(ue^Pe^Ve)+ve[9]+3654602809&4294967295,Q=ue+(Ee<<4&4294967295|Ee>>>28),Ee=Ve+(Q^ue^Pe)+ve[12]+3873151461&4294967295,Ve=Q+(Ee<<11&4294967295|Ee>>>21),Ee=Pe+(Ve^Q^ue)+ve[15]+530742520&4294967295,Pe=Ve+(Ee<<16&4294967295|Ee>>>16),Ee=ue+(Pe^Ve^Q)+ve[2]+3299628645&4294967295,ue=Pe+(Ee<<23&4294967295|Ee>>>9),Ee=Q+(Pe^(ue|~Ve))+ve[0]+4096336452&4294967295,Q=ue+(Ee<<6&4294967295|Ee>>>26),Ee=Ve+(ue^(Q|~Pe))+ve[7]+1126891415&4294967295,Ve=Q+(Ee<<10&4294967295|Ee>>>22),Ee=Pe+(Q^(Ve|~ue))+ve[14]+2878612391&4294967295,Pe=Ve+(Ee<<15&4294967295|Ee>>>17),Ee=ue+(Ve^(Pe|~Q))+ve[5]+4237533241&4294967295,ue=Pe+(Ee<<21&4294967295|Ee>>>11),Ee=Q+(Pe^(ue|~Ve))+ve[12]+1700485571&4294967295,Q=ue+(Ee<<6&4294967295|Ee>>>26),Ee=Ve+(ue^(Q|~Pe))+ve[3]+2399980690&4294967295,Ve=Q+(Ee<<10&4294967295|Ee>>>22),Ee=Pe+(Q^(Ve|~ue))+ve[10]+4293915773&4294967295,Pe=Ve+(Ee<<15&4294967295|Ee>>>17),Ee=ue+(Ve^(Pe|~Q))+ve[1]+2240044497&4294967295,ue=Pe+(Ee<<21&4294967295|Ee>>>11),Ee=Q+(Pe^(ue|~Ve))+ve[8]+1873313359&4294967295,Q=ue+(Ee<<6&4294967295|Ee>>>26),Ee=Ve+(ue^(Q|~Pe))+ve[15]+4264355552&4294967295,Ve=Q+(Ee<<10&4294967295|Ee>>>22),Ee=Pe+(Q^(Ve|~ue))+ve[6]+2734768916&4294967295,Pe=Ve+(Ee<<15&4294967295|Ee>>>17),Ee=ue+(Ve^(Pe|~Q))+ve[13]+1309151649&4294967295,ue=Pe+(Ee<<21&4294967295|Ee>>>11),Ee=Q+(Pe^(ue|~Ve))+ve[4]+4149444226&4294967295,Q=ue+(Ee<<6&4294967295|Ee>>>26),Ee=Ve+(ue^(Q|~Pe))+ve[11]+3174756917&4294967295,Ve=Q+(Ee<<10&4294967295|Ee>>>22),Ee=Pe+(Q^(Ve|~ue))+ve[2]+718787259&4294967295,Pe=Ve+(Ee<<15&4294967295|Ee>>>17),Ee=ue+(Ve^(Pe|~Q))+ve[9]+3951481745&4294967295,fe.g[0]=fe.g[0]+Q&4294967295,fe.g[1]=fe.g[1]+(Pe+(Ee<<21&4294967295|Ee>>>11))&4294967295,fe.g[2]=fe.g[2]+Pe&4294967295,fe.g[3]=fe.g[3]+Ve&4294967295}r.prototype.u=function(fe,Q){Q===void 0&&(Q=fe.length);for(var ue=Q-this.blockSize,ve=this.B,Pe=this.h,Ve=0;Ve<Q;){if(Pe==0)for(;Ve<=ue;)o(this,fe,Ve),Ve+=this.blockSize;if(typeof fe=="string"){for(;Ve<Q;)if(ve[Pe++]=fe.charCodeAt(Ve++),Pe==this.blockSize){o(this,ve),Pe=0;break}}else for(;Ve<Q;)if(ve[Pe++]=fe[Ve++],Pe==this.blockSize){o(this,ve),Pe=0;break}}this.h=Pe,this.o+=Q},r.prototype.v=function(){var fe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);fe[0]=128;for(var Q=1;Q<fe.length-8;++Q)fe[Q]=0;var ue=8*this.o;for(Q=fe.length-8;Q<fe.length;++Q)fe[Q]=ue&255,ue/=256;for(this.u(fe),fe=Array(16),Q=ue=0;4>Q;++Q)for(var ve=0;32>ve;ve+=8)fe[ue++]=this.g[Q]>>>ve&255;return fe};function h(fe,Q){var ue=l;return Object.prototype.hasOwnProperty.call(ue,fe)?ue[fe]:ue[fe]=Q(fe)}function f(fe,Q){this.h=Q;for(var ue=[],ve=!0,Pe=fe.length-1;0<=Pe;Pe--){var Ve=fe[Pe]|0;ve&&Ve==Q||(ue[Pe]=Ve,ve=!1)}this.g=ue}var l={};function S(fe){return-128<=fe&&128>fe?h(fe,function(Q){return new f([Q|0],0>Q?-1:0)}):new f([fe|0],0>fe?-1:0)}function A(fe){if(isNaN(fe)||!isFinite(fe))return U;if(0>fe)return Me(A(-fe));for(var Q=[],ue=1,ve=0;fe>=ue;ve++)Q[ve]=fe/ue|0,ue*=4294967296;return new f(Q,0)}function O(fe,Q){if(fe.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(fe.charAt(0)=="-")return Me(O(fe.substring(1),Q));if(0<=fe.indexOf("-"))throw Error('number format error: interior "-" character');for(var ue=A(Math.pow(Q,8)),ve=U,Pe=0;Pe<fe.length;Pe+=8){var Ve=Math.min(8,fe.length-Pe),Ee=parseInt(fe.substring(Pe,Pe+Ve),Q);8>Ve?(Ve=A(Math.pow(Q,Ve)),ve=ve.j(Ve).add(A(Ee))):(ve=ve.j(ue),ve=ve.add(A(Ee)))}return ve}var U=S(0),H=S(1),$=S(16777216);t=f.prototype,t.m=function(){if(me(this))return-Me(this).m();for(var fe=0,Q=1,ue=0;ue<this.g.length;ue++){var ve=this.i(ue);fe+=(0<=ve?ve:4294967296+ve)*Q,Q*=4294967296}return fe},t.toString=function(fe){if(fe=fe||10,2>fe||36<fe)throw Error("radix out of range: "+fe);if(ie(this))return"0";if(me(this))return"-"+Me(this).toString(fe);for(var Q=A(Math.pow(fe,6)),ue=this,ve="";;){var Pe=je(ue,Q).g;ue=ce(ue,Pe.j(Q));var Ve=((0<ue.g.length?ue.g[0]:ue.h)>>>0).toString(fe);if(ue=Pe,ie(ue))return Ve+ve;for(;6>Ve.length;)Ve="0"+Ve;ve=Ve+ve}},t.i=function(fe){return 0>fe?0:fe<this.g.length?this.g[fe]:this.h};function ie(fe){if(fe.h!=0)return!1;for(var Q=0;Q<fe.g.length;Q++)if(fe.g[Q]!=0)return!1;return!0}function me(fe){return fe.h==-1}t.l=function(fe){return fe=ce(this,fe),me(fe)?-1:ie(fe)?0:1};function Me(fe){for(var Q=fe.g.length,ue=[],ve=0;ve<Q;ve++)ue[ve]=~fe.g[ve];return new f(ue,~fe.h).add(H)}t.abs=function(){return me(this)?Me(this):this},t.add=function(fe){for(var Q=Math.max(this.g.length,fe.g.length),ue=[],ve=0,Pe=0;Pe<=Q;Pe++){var Ve=ve+(this.i(Pe)&65535)+(fe.i(Pe)&65535),Ee=(Ve>>>16)+(this.i(Pe)>>>16)+(fe.i(Pe)>>>16);ve=Ee>>>16,Ve&=65535,Ee&=65535,ue[Pe]=Ee<<16|Ve}return new f(ue,ue[ue.length-1]&-2147483648?-1:0)};function ce(fe,Q){return fe.add(Me(Q))}t.j=function(fe){if(ie(this)||ie(fe))return U;if(me(this))return me(fe)?Me(this).j(Me(fe)):Me(Me(this).j(fe));if(me(fe))return Me(this.j(Me(fe)));if(0>this.l($)&&0>fe.l($))return A(this.m()*fe.m());for(var Q=this.g.length+fe.g.length,ue=[],ve=0;ve<2*Q;ve++)ue[ve]=0;for(ve=0;ve<this.g.length;ve++)for(var Pe=0;Pe<fe.g.length;Pe++){var Ve=this.i(ve)>>>16,Ee=this.i(ve)&65535,Xt=fe.i(Pe)>>>16,tr=fe.i(Pe)&65535;ue[2*ve+2*Pe]+=Ee*tr,le(ue,2*ve+2*Pe),ue[2*ve+2*Pe+1]+=Ve*tr,le(ue,2*ve+2*Pe+1),ue[2*ve+2*Pe+1]+=Ee*Xt,le(ue,2*ve+2*Pe+1),ue[2*ve+2*Pe+2]+=Ve*Xt,le(ue,2*ve+2*Pe+2)}for(ve=0;ve<Q;ve++)ue[ve]=ue[2*ve+1]<<16|ue[2*ve];for(ve=Q;ve<2*Q;ve++)ue[ve]=0;return new f(ue,0)};function le(fe,Q){for(;(fe[Q]&65535)!=fe[Q];)fe[Q+1]+=fe[Q]>>>16,fe[Q]&=65535,Q++}function ge(fe,Q){this.g=fe,this.h=Q}function je(fe,Q){if(ie(Q))throw Error("division by zero");if(ie(fe))return new ge(U,U);if(me(fe))return Q=je(Me(fe),Q),new ge(Me(Q.g),Me(Q.h));if(me(Q))return Q=je(fe,Me(Q)),new ge(Me(Q.g),Q.h);if(30<fe.g.length){if(me(fe)||me(Q))throw Error("slowDivide_ only works with positive integers.");for(var ue=H,ve=Q;0>=ve.l(fe);)ue=rt(ue),ve=rt(ve);var Pe=qe(ue,1),Ve=qe(ve,1);for(ve=qe(ve,2),ue=qe(ue,2);!ie(ve);){var Ee=Ve.add(ve);0>=Ee.l(fe)&&(Pe=Pe.add(ue),Ve=Ee),ve=qe(ve,1),ue=qe(ue,1)}return Q=ce(fe,Pe.j(Q)),new ge(Pe,Q)}for(Pe=U;0<=fe.l(Q);){for(ue=Math.max(1,Math.floor(fe.m()/Q.m())),ve=Math.ceil(Math.log(ue)/Math.LN2),ve=48>=ve?1:Math.pow(2,ve-48),Ve=A(ue),Ee=Ve.j(Q);me(Ee)||0<Ee.l(fe);)ue-=ve,Ve=A(ue),Ee=Ve.j(Q);ie(Ve)&&(Ve=H),Pe=Pe.add(Ve),fe=ce(fe,Ee)}return new ge(Pe,fe)}t.A=function(fe){return je(this,fe).h},t.and=function(fe){for(var Q=Math.max(this.g.length,fe.g.length),ue=[],ve=0;ve<Q;ve++)ue[ve]=this.i(ve)&fe.i(ve);return new f(ue,this.h&fe.h)},t.or=function(fe){for(var Q=Math.max(this.g.length,fe.g.length),ue=[],ve=0;ve<Q;ve++)ue[ve]=this.i(ve)|fe.i(ve);return new f(ue,this.h|fe.h)},t.xor=function(fe){for(var Q=Math.max(this.g.length,fe.g.length),ue=[],ve=0;ve<Q;ve++)ue[ve]=this.i(ve)^fe.i(ve);return new f(ue,this.h^fe.h)};function rt(fe){for(var Q=fe.g.length+1,ue=[],ve=0;ve<Q;ve++)ue[ve]=fe.i(ve)<<1|fe.i(ve-1)>>>31;return new f(ue,fe.h)}function qe(fe,Q){var ue=Q>>5;Q%=32;for(var ve=fe.g.length-ue,Pe=[],Ve=0;Ve<ve;Ve++)Pe[Ve]=0<Q?fe.i(Ve+ue)>>>Q|fe.i(Ve+ue+1)<<32-Q:fe.i(Ve+ue);return new f(Pe,fe.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,dR=r,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=A,f.fromString=O,fh=f}).apply(typeof aP<"u"?aP:typeof self<"u"?self:typeof window<"u"?window:{});var uy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fR,Vm,pR,zy,$b,mR,gR,_R;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(E,F,W){return E==Array.prototype||E==Object.prototype||(E[F]=W.value),E};function n(E){E=[typeof globalThis=="object"&&globalThis,E,typeof window=="object"&&window,typeof self=="object"&&self,typeof uy=="object"&&uy];for(var F=0;F<E.length;++F){var W=E[F];if(W&&W.Math==Math)return W}throw Error("Cannot find global object")}var r=n(this);function o(E,F){if(F)e:{var W=r;E=E.split(".");for(var de=0;de<E.length-1;de++){var $e=E[de];if(!($e in W))break e;W=W[$e]}E=E[E.length-1],de=W[E],F=F(de),F!=de&&F!=null&&e(W,E,{configurable:!0,writable:!0,value:F})}}function h(E,F){E instanceof String&&(E+="");var W=0,de=!1,$e={next:function(){if(!de&&W<E.length){var Je=W++;return{value:F(Je,E[Je]),done:!1}}return de=!0,{done:!0,value:void 0}}};return $e[Symbol.iterator]=function(){return $e},$e}o("Array.prototype.values",function(E){return E||function(){return h(this,function(F,W){return W})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},l=this||self;function S(E){var F=typeof E;return F=F!="object"?F:E?Array.isArray(E)?"array":F:"null",F=="array"||F=="object"&&typeof E.length=="number"}function A(E){var F=typeof E;return F=="object"&&E!=null||F=="function"}function O(E,F,W){return E.call.apply(E.bind,arguments)}function U(E,F,W){if(!E)throw Error();if(2<arguments.length){var de=Array.prototype.slice.call(arguments,2);return function(){var $e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply($e,de),E.apply(F,$e)}}return function(){return E.apply(F,arguments)}}function H(E,F,W){return H=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?O:U,H.apply(null,arguments)}function $(E,F){var W=Array.prototype.slice.call(arguments,1);return function(){var de=W.slice();return de.push.apply(de,arguments),E.apply(this,de)}}function ie(E,F){function W(){}W.prototype=F.prototype,E.aa=F.prototype,E.prototype=new W,E.prototype.constructor=E,E.Qb=function(de,$e,Je){for(var At=Array(arguments.length-2),Kn=2;Kn<arguments.length;Kn++)At[Kn-2]=arguments[Kn];return F.prototype[$e].apply(de,At)}}function me(E){const F=E.length;if(0<F){const W=Array(F);for(let de=0;de<F;de++)W[de]=E[de];return W}return[]}function Me(E,F){for(let W=1;W<arguments.length;W++){const de=arguments[W];if(S(de)){const $e=E.length||0,Je=de.length||0;E.length=$e+Je;for(let At=0;At<Je;At++)E[$e+At]=de[At]}else E.push(de)}}class ce{constructor(F,W){this.i=F,this.j=W,this.h=0,this.g=null}get(){let F;return 0<this.h?(this.h--,F=this.g,this.g=F.next,F.next=null):F=this.i(),F}}function le(E){return/^[\s\xa0]*$/.test(E)}function ge(){var E=l.navigator;return E&&(E=E.userAgent)?E:""}function je(E){return je[" "](E),E}je[" "]=function(){};var rt=ge().indexOf("Gecko")!=-1&&!(ge().toLowerCase().indexOf("webkit")!=-1&&ge().indexOf("Edge")==-1)&&!(ge().indexOf("Trident")!=-1||ge().indexOf("MSIE")!=-1)&&ge().indexOf("Edge")==-1;function qe(E,F,W){for(const de in E)F.call(W,E[de],de,E)}function fe(E,F){for(const W in E)F.call(void 0,E[W],W,E)}function Q(E){const F={};for(const W in E)F[W]=E[W];return F}const ue="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ve(E,F){let W,de;for(let $e=1;$e<arguments.length;$e++){de=arguments[$e];for(W in de)E[W]=de[W];for(let Je=0;Je<ue.length;Je++)W=ue[Je],Object.prototype.hasOwnProperty.call(de,W)&&(E[W]=de[W])}}function Pe(E){var F=1;E=E.split(":");const W=[];for(;0<F&&E.length;)W.push(E.shift()),F--;return E.length&&W.push(E.join(":")),W}function Ve(E){l.setTimeout(()=>{throw E},0)}function Ee(){var E=Qt;let F=null;return E.g&&(F=E.g,E.g=E.g.next,E.g||(E.h=null),F.next=null),F}class Xt{constructor(){this.h=this.g=null}add(F,W){const de=tr.get();de.set(F,W),this.h?this.h.next=de:this.g=de,this.h=de}}var tr=new ce(()=>new Yt,E=>E.reset());class Yt{constructor(){this.next=this.g=this.h=null}set(F,W){this.h=F,this.g=W,this.next=null}reset(){this.next=this.g=this.h=null}}let vi,lt=!1,Qt=new Xt,Tt=()=>{const E=l.Promise.resolve(void 0);vi=()=>{E.then(nn)}};var nn=()=>{for(var E;E=Ee();){try{E.h.call(E.g)}catch(W){Ve(W)}var F=tr;F.j(E),100>F.h&&(F.h++,E.next=F.g,F.g=E)}lt=!1};function rn(){this.s=this.s,this.C=this.C}rn.prototype.s=!1,rn.prototype.ma=function(){this.s||(this.s=!0,this.N())},rn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function cn(E,F){this.type=E,this.g=this.target=F,this.defaultPrevented=!1}cn.prototype.h=function(){this.defaultPrevented=!0};var vn=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var E=!1,F=Object.defineProperty({},"passive",{get:function(){E=!0}});try{const W=()=>{};l.addEventListener("test",W,F),l.removeEventListener("test",W,F)}catch{}return E}();function Jt(E,F){if(cn.call(this,E?E.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,E){var W=this.type=E.type,de=E.changedTouches&&E.changedTouches.length?E.changedTouches[0]:null;if(this.target=E.target||E.srcElement,this.g=F,F=E.relatedTarget){if(rt){e:{try{je(F.nodeName);var $e=!0;break e}catch{}$e=!1}$e||(F=null)}}else W=="mouseover"?F=E.fromElement:W=="mouseout"&&(F=E.toElement);this.relatedTarget=F,de?(this.clientX=de.clientX!==void 0?de.clientX:de.pageX,this.clientY=de.clientY!==void 0?de.clientY:de.pageY,this.screenX=de.screenX||0,this.screenY=de.screenY||0):(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0),this.button=E.button,this.key=E.key||"",this.ctrlKey=E.ctrlKey,this.altKey=E.altKey,this.shiftKey=E.shiftKey,this.metaKey=E.metaKey,this.pointerId=E.pointerId||0,this.pointerType=typeof E.pointerType=="string"?E.pointerType:on[E.pointerType]||"",this.state=E.state,this.i=E,E.defaultPrevented&&Jt.aa.h.call(this)}}ie(Jt,cn);var on={2:"touch",3:"pen",4:"mouse"};Jt.prototype.h=function(){Jt.aa.h.call(this);var E=this.i;E.preventDefault?E.preventDefault():E.returnValue=!1};var xi="closure_listenable_"+(1e6*Math.random()|0),Ir=0;function Pr(E,F,W,de,$e){this.listener=E,this.proxy=null,this.src=F,this.type=W,this.capture=!!de,this.ha=$e,this.key=++Ir,this.da=this.fa=!1}function Ls(E){E.da=!0,E.listener=null,E.proxy=null,E.src=null,E.ha=null}function ki(E){this.src=E,this.g={},this.h=0}ki.prototype.add=function(E,F,W,de,$e){var Je=E.toString();E=this.g[Je],E||(E=this.g[Je]=[],this.h++);var At=Fr(E,F,de,$e);return-1<At?(F=E[At],W||(F.fa=!1)):(F=new Pr(F,this.src,Je,!!de,$e),F.fa=W,E.push(F)),F};function ui(E,F){var W=F.type;if(W in E.g){var de=E.g[W],$e=Array.prototype.indexOf.call(de,F,void 0),Je;(Je=0<=$e)&&Array.prototype.splice.call(de,$e,1),Je&&(Ls(F),E.g[W].length==0&&(delete E.g[W],E.h--))}}function Fr(E,F,W,de){for(var $e=0;$e<E.length;++$e){var Je=E[$e];if(!Je.da&&Je.listener==F&&Je.capture==!!W&&Je.ha==de)return $e}return-1}var wi="closure_lm_"+(1e6*Math.random()|0),Ds={};function to(E,F,W,de,$e){if(Array.isArray(F)){for(var Je=0;Je<F.length;Je++)to(E,F[Je],W,de,$e);return null}return W=To(W),E&&E[xi]?E.K(F,W,A(de)?!!de.capture:!1,$e):Br(E,F,W,!1,de,$e)}function Br(E,F,W,de,$e,Je){if(!F)throw Error("Invalid event type");var At=A($e)?!!$e.capture:!!$e,Kn=ds(E);if(Kn||(E[wi]=Kn=new ki(E)),W=Kn.add(F,W,de,At,Je),W.proxy)return W;if(de=hs(),W.proxy=de,de.src=E,de.listener=W,E.addEventListener)vn||($e=At),$e===void 0&&($e=!1),E.addEventListener(F.toString(),de,$e);else if(E.attachEvent)E.attachEvent(zs(F.toString()),de);else if(E.addListener&&E.removeListener)E.addListener(de);else throw Error("addEventListener and attachEvent are unavailable.");return W}function hs(){function E(W){return F.call(E.src,E.listener,W)}const F=bo;return E}function no(E,F,W,de,$e){if(Array.isArray(F))for(var Je=0;Je<F.length;Je++)no(E,F[Je],W,de,$e);else de=A(de)?!!de.capture:!!de,W=To(W),E&&E[xi]?(E=E.i,F=String(F).toString(),F in E.g&&(Je=E.g[F],W=Fr(Je,W,de,$e),-1<W&&(Ls(Je[W]),Array.prototype.splice.call(Je,W,1),Je.length==0&&(delete E.g[F],E.h--)))):E&&(E=ds(E))&&(F=E.g[F.toString()],E=-1,F&&(E=Fr(F,W,de,$e)),(W=-1<E?F[E]:null)&&hr(W))}function hr(E){if(typeof E!="number"&&E&&!E.da){var F=E.src;if(F&&F[xi])ui(F.i,E);else{var W=E.type,de=E.proxy;F.removeEventListener?F.removeEventListener(W,de,E.capture):F.detachEvent?F.detachEvent(zs(W),de):F.addListener&&F.removeListener&&F.removeListener(de),(W=ds(F))?(ui(W,E),W.h==0&&(W.src=null,F[wi]=null)):Ls(E)}}}function zs(E){return E in Ds?Ds[E]:Ds[E]="on"+E}function bo(E,F){if(E.da)E=!0;else{F=new Jt(F,this);var W=E.listener,de=E.ha||E.src;E.fa&&hr(E),E=W.call(de,F)}return E}function ds(E){return E=E[wi],E instanceof ki?E:null}var Xo="__closure_events_fn_"+(1e9*Math.random()>>>0);function To(E){return typeof E=="function"?E:(E[Xo]||(E[Xo]=function(F){return E.handleEvent(F)}),E[Xo])}function ni(){rn.call(this),this.i=new ki(this),this.M=this,this.F=null}ie(ni,rn),ni.prototype[xi]=!0,ni.prototype.removeEventListener=function(E,F,W,de){no(this,E,F,W,de)};function Ti(E,F){var W,de=E.F;if(de)for(W=[];de;de=de.F)W.push(de);if(E=E.M,de=F.type||F,typeof F=="string")F=new cn(F,E);else if(F instanceof cn)F.target=F.target||E;else{var $e=F;F=new cn(de,E),ve(F,$e)}if($e=!0,W)for(var Je=W.length-1;0<=Je;Je--){var At=F.g=W[Je];$e=Vr(At,de,!0,F)&&$e}if(At=F.g=E,$e=Vr(At,de,!0,F)&&$e,$e=Vr(At,de,!1,F)&&$e,W)for(Je=0;Je<W.length;Je++)At=F.g=W[Je],$e=Vr(At,de,!1,F)&&$e}ni.prototype.N=function(){if(ni.aa.N.call(this),this.i){var E=this.i,F;for(F in E.g){for(var W=E.g[F],de=0;de<W.length;de++)Ls(W[de]);delete E.g[F],E.h--}}this.F=null},ni.prototype.K=function(E,F,W,de){return this.i.add(String(E),F,!1,W,de)},ni.prototype.L=function(E,F,W,de){return this.i.add(String(E),F,!0,W,de)};function Vr(E,F,W,de){if(F=E.i.g[String(F)],!F)return!0;F=F.concat();for(var $e=!0,Je=0;Je<F.length;++Je){var At=F[Je];if(At&&!At.da&&At.capture==W){var Kn=At.listener,Ei=At.ha||At.src;At.fa&&ui(E.i,At),$e=Kn.call(Ei,de)!==!1&&$e}}return $e&&!de.defaultPrevented}function So(E,F,W){if(typeof E=="function")W&&(E=H(E,W));else if(E&&typeof E.handleEvent=="function")E=H(E.handleEvent,E);else throw Error("Invalid listener argument");return 2147483647<Number(F)?-1:l.setTimeout(E,F||0)}function Ns(E){E.g=So(()=>{E.g=null,E.i&&(E.i=!1,Ns(E))},E.l);const F=E.h;E.h=null,E.m.apply(null,F)}class Yo extends rn{constructor(F,W){super(),this.m=F,this.l=W,this.h=null,this.i=!1,this.g=null}j(F){this.h=arguments,this.g?this.i=!0:Ns(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Os(E){rn.call(this),this.h=E,this.g={}}ie(Os,rn);var Qo=[];function fs(E){qe(E.g,function(F,W){this.g.hasOwnProperty(W)&&hr(F)},E),E.g={}}Os.prototype.N=function(){Os.aa.N.call(this),fs(this)},Os.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pe=l.JSON.stringify,ee=l.JSON.parse,re=class{stringify(E){return l.JSON.stringify(E,void 0)}parse(E){return l.JSON.parse(E,void 0)}};function oe(){}oe.prototype.h=null;function Te(E){return E.h||(E.h=E.i())}function Le(){}var Be={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function He(){cn.call(this,"d")}ie(He,cn);function Fe(){cn.call(this,"c")}ie(Fe,cn);var Qe={},Ye=null;function Ue(){return Ye=Ye||new ni}Qe.La="serverreachability";function Oe(E){cn.call(this,Qe.La,E)}ie(Oe,cn);function yt(E){const F=Ue();Ti(F,new Oe(F))}Qe.STAT_EVENT="statevent";function vt(E,F){cn.call(this,Qe.STAT_EVENT,E),this.stat=F}ie(vt,cn);function zt(E){const F=Ue();Ti(F,new vt(F,E))}Qe.Ma="timingevent";function tn(E,F){cn.call(this,Qe.Ma,E),this.size=F}ie(tn,cn);function nt(E,F){if(typeof E!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){E()},F)}function wt(){this.g=!0}wt.prototype.xa=function(){this.g=!1};function Ct(E,F,W,de,$e,Je){E.info(function(){if(E.g)if(Je)for(var At="",Kn=Je.split("&"),Ei=0;Ei<Kn.length;Ei++){var Dn=Kn[Ei].split("=");if(1<Dn.length){var qn=Dn[0];Dn=Dn[1];var Li=qn.split("_");At=2<=Li.length&&Li[1]=="type"?At+(qn+"="+Dn+"&"):At+(qn+"=redacted&")}}else At=null;else At=Je;return"XMLHTTP REQ ("+de+") [attempt "+$e+"]: "+F+`
`+W+`
`+At})}function xt(E,F,W,de,$e,Je,At){E.info(function(){return"XMLHTTP RESP ("+de+") [ attempt "+$e+"]: "+F+`
`+W+`
`+Je+" "+At})}function hn(E,F,W,de){E.info(function(){return"XMLHTTP TEXT ("+F+"): "+kt(E,W)+(de?" "+de:"")})}function qt(E,F){E.info(function(){return"TIMEOUT: "+F})}wt.prototype.info=function(){};function kt(E,F){if(!E.g)return F;if(!F)return null;try{var W=JSON.parse(F);if(W){for(E=0;E<W.length;E++)if(Array.isArray(W[E])){var de=W[E];if(!(2>de.length)){var $e=de[1];if(Array.isArray($e)&&!(1>$e.length)){var Je=$e[0];if(Je!="noop"&&Je!="stop"&&Je!="close")for(var At=1;At<$e.length;At++)$e[At]=""}}}}return pe(W)}catch{return F}}var Qn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ps={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Si;function Zn(){}ie(Zn,oe),Zn.prototype.g=function(){return new XMLHttpRequest},Zn.prototype.i=function(){return{}},Si=new Zn;function zn(E,F,W,de){this.j=E,this.i=F,this.l=W,this.R=de||1,this.U=new Os(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Cr}function Cr(){this.i=null,this.g="",this.h=!1}var ii={},Jo={};function Eo(E,F,W){E.L=1,E.v=Ar(Bt(F)),E.m=W,E.P=!0,Qa(E,null)}function Qa(E,F){E.F=Date.now(),Ja(E),E.A=Bt(E.v);var W=E.A,de=E.R;Array.isArray(de)||(de=[String(de)]),Vs(W.i,"t",de),E.C=0,W=E.j.J,E.h=new Cr,E.g=ll(E.j,W?F:null,!E.m),0<E.O&&(E.M=new Yo(H(E.Y,E,E.g),E.O)),F=E.U,W=E.g,de=E.ca;var $e="readystatechange";Array.isArray($e)||($e&&(Qo[0]=$e.toString()),$e=Qo);for(var Je=0;Je<$e.length;Je++){var At=to(W,$e[Je],de||F.handleEvent,!1,F.h||F);if(!At)break;F.g[At.key]=At}F=E.H?Q(E.H):{},E.m?(E.u||(E.u="POST"),F["Content-Type"]="application/x-www-form-urlencoded",E.g.ea(E.A,E.u,E.m,F)):(E.u="GET",E.g.ea(E.A,E.u,null,F)),yt(),Ct(E.i,E.u,E.A,E.l,E.R,E.m)}zn.prototype.ca=function(E){E=E.target;const F=this.M;F&&Qi(E)==3?F.j():this.Y(E)},zn.prototype.Y=function(E){try{if(E==this.g)e:{const Li=Qi(this.g);var F=this.g.Ba();const Ia=this.g.Z();if(!(3>Li)&&(Li!=3||this.g&&(this.h.h||this.g.oa()||Hr(this.g)))){this.J||Li!=4||F==7||(F==8||0>=Ia?yt(3):yt(2)),Ul(this);var W=this.g.Z();this.X=W;t:if(Io(this)){var de=Hr(this.g);E="";var $e=de.length,Je=Qi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Po(this),Bs(this);var At="";break t}this.h.i=new l.TextDecoder}for(F=0;F<$e;F++)this.h.h=!0,E+=this.h.i.decode(de[F],{stream:!(Je&&F==$e-1)});de.length=0,this.h.g+=E,this.C=0,At=this.h.g}else At=this.g.oa();if(this.o=W==200,xt(this.i,this.u,this.A,this.l,this.R,Li,W),this.o){if(this.T&&!this.K){t:{if(this.g){var Kn,Ei=this.g;if((Kn=Ei.g?Ei.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!le(Kn)){var Dn=Kn;break t}}Dn=null}if(W=Dn)hn(this.i,this.l,W,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,el(this,W);else{this.o=!1,this.s=3,zt(12),Po(this),Bs(this);break e}}if(this.P){W=!0;let Di;for(;!this.J&&this.C<At.length;)if(Di=Fs(this,At),Di==Jo){Li==4&&(this.s=4,zt(14),W=!1),hn(this.i,this.l,null,"[Incomplete Response]");break}else if(Di==ii){this.s=4,zt(15),hn(this.i,this.l,At,"[Invalid Chunk]"),W=!1;break}else hn(this.i,this.l,Di,null),el(this,Di);if(Io(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Li!=4||At.length!=0||this.h.h||(this.s=1,zt(16),W=!1),this.o=this.o&&W,!W)hn(this.i,this.l,At,"[Invalid Chunked Response]"),Po(this),Bs(this);else if(0<At.length&&!this.W){this.W=!0;var qn=this.j;qn.g==this&&qn.ba&&!qn.M&&(qn.j.info("Great, no buffering proxy detected. Bytes received: "+At.length),so(qn),qn.M=!0,zt(11))}}else hn(this.i,this.l,At,null),el(this,At);Li==4&&Po(this),this.o&&!this.J&&(Li==4?ku(this.j,this):(this.o=!1,Ja(this)))}else na(this.g),W==400&&0<At.indexOf("Unknown SID")?(this.s=3,zt(12)):(this.s=0,zt(13)),Po(this),Bs(this)}}}catch{}finally{}};function Io(E){return E.g?E.u=="GET"&&E.L!=2&&E.j.Ca:!1}function Fs(E,F){var W=E.C,de=F.indexOf(`
`,W);return de==-1?Jo:(W=Number(F.substring(W,de)),isNaN(W)?ii:(de+=1,de+W>F.length?Jo:(F=F.slice(de,de+W),E.C=de+W,F)))}zn.prototype.cancel=function(){this.J=!0,Po(this)};function Ja(E){E.S=Date.now()+E.I,jl(E,E.I)}function jl(E,F){if(E.B!=null)throw Error("WatchDog timer not null");E.B=nt(H(E.ba,E),F)}function Ul(E){E.B&&(l.clearTimeout(E.B),E.B=null)}zn.prototype.ba=function(){this.B=null;const E=Date.now();0<=E-this.S?(qt(this.i,this.A),this.L!=2&&(yt(),zt(17)),Po(this),this.s=2,Bs(this)):jl(this,this.S-E)};function Bs(E){E.j.G==0||E.J||ku(E.j,E)}function Po(E){Ul(E);var F=E.M;F&&typeof F.ma=="function"&&F.ma(),E.M=null,fs(E.U),E.g&&(F=E.g,E.g=null,F.abort(),F.ma())}function el(E,F){try{var W=E.j;if(W.G!=0&&(W.g==E||gn(W.h,E))){if(!E.K&&gn(W.h,E)&&W.G==3){try{var de=W.Da.g.parse(F)}catch{de=null}if(Array.isArray(de)&&de.length==3){var $e=de;if($e[0]==0){e:if(!W.u){if(W.g)if(W.g.F+3e3<E.F)vr(W),ol(W);else break e;No(W),zt(18)}}else W.za=$e[1],0<W.za-W.T&&37500>$e[2]&&W.F&&W.v==0&&!W.C&&(W.C=nt(H(W.Za,W),6e3));if(1>=Co(W.h)&&W.ca){try{W.ca()}catch{}W.ca=void 0}}else ys(W,11)}else if((E.K||W.g==E)&&vr(W),!le(F))for($e=W.Da.g.parse(F),F=0;F<$e.length;F++){let Dn=$e[F];if(W.T=Dn[0],Dn=Dn[1],W.G==2)if(Dn[0]=="c"){W.K=Dn[1],W.ia=Dn[2];const qn=Dn[3];qn!=null&&(W.la=qn,W.j.info("VER="+W.la));const Li=Dn[4];Li!=null&&(W.Aa=Li,W.j.info("SVER="+W.Aa));const Ia=Dn[5];Ia!=null&&typeof Ia=="number"&&0<Ia&&(de=1.5*Ia,W.L=de,W.j.info("backChannelRequestTimeoutMs_="+de)),de=W;const Di=E.g;if(Di){const Pa=Di.g?Di.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pa){var Je=de.h;Je.g||Pa.indexOf("spdy")==-1&&Pa.indexOf("quic")==-1&&Pa.indexOf("h2")==-1||(Je.j=Je.l,Je.g=new Set,Je.h&&(Jn(Je,Je.h),Je.h=null))}if(de.D){const oo=Di.g?Di.g.getResponseHeader("X-HTTP-Session-Id"):null;oo&&(de.ya=oo,un(de.I,de.D,oo))}}W.G=3,W.l&&W.l.ua(),W.ba&&(W.R=Date.now()-E.F,W.j.info("Handshake RTT: "+W.R+"ms")),de=W;var At=E;if(de.qa=ia(de,de.J?de.ia:null,de.W),At.K){ba(de.h,At);var Kn=At,Ei=de.L;Ei&&(Kn.I=Ei),Kn.B&&(Ul(Kn),Ja(Kn)),de.g=At}else Ri(de);0<W.i.length&&io(W)}else Dn[0]!="stop"&&Dn[0]!="close"||ys(W,7);else W.G==3&&(Dn[0]=="stop"||Dn[0]=="close"?Dn[0]=="stop"?ys(W,7):gs(W):Dn[0]!="noop"&&W.l&&W.l.ta(Dn),W.v=0)}}yt(4)}catch{}}var tl=class{constructor(E,F){this.g=E,this.map=F}};function Cu(E){this.l=E||10,l.PerformanceNavigationTiming?(E=l.performance.getEntriesByType("navigation"),E=0<E.length&&(E[0].nextHopProtocol=="hq"||E[0].nextHopProtocol=="h2")):E=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=E?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function $l(E){return E.h?!0:E.g?E.g.size>=E.j:!1}function Co(E){return E.h?1:E.g?E.g.size:0}function gn(E,F){return E.h?E.h==F:E.g?E.g.has(F):!1}function Jn(E,F){E.g?E.g.add(F):E.h=F}function ba(E,F){E.h&&E.h==F?E.h=null:E.g&&E.g.has(F)&&E.g.delete(F)}Cu.prototype.cancel=function(){if(this.i=jr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const E of this.g.values())E.cancel();this.g.clear()}};function jr(E){if(E.h!=null)return E.i.concat(E.h.D);if(E.g!=null&&E.g.size!==0){let F=E.i;for(const W of E.g.values())F=F.concat(W.D);return F}return me(E.i)}function Ao(E){if(E.V&&typeof E.V=="function")return E.V();if(typeof Map<"u"&&E instanceof Map||typeof Set<"u"&&E instanceof Set)return Array.from(E.values());if(typeof E=="string")return E.split("");if(S(E)){for(var F=[],W=E.length,de=0;de<W;de++)F.push(E[de]);return F}F=[],W=0;for(de in E)F[W++]=E[de];return F}function Ta(E){if(E.na&&typeof E.na=="function")return E.na();if(!E.V||typeof E.V!="function"){if(typeof Map<"u"&&E instanceof Map)return Array.from(E.keys());if(!(typeof Set<"u"&&E instanceof Set)){if(S(E)||typeof E=="string"){var F=[];E=E.length;for(var W=0;W<E;W++)F.push(W);return F}F=[],W=0;for(const de in E)F[W++]=de;return F}}}function dn(E,F){if(E.forEach&&typeof E.forEach=="function")E.forEach(F,void 0);else if(S(E)||typeof E=="string")Array.prototype.forEach.call(E,F,void 0);else for(var W=Ta(E),de=Ao(E),$e=de.length,Je=0;Je<$e;Je++)F.call(void 0,de[Je],W&&W[Je],E)}var Wn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function nl(E,F){if(E){E=E.split("&");for(var W=0;W<E.length;W++){var de=E[W].indexOf("="),$e=null;if(0<=de){var Je=E[W].substring(0,de);$e=E[W].substring(de+1)}else Je=E[W];F(Je,$e?decodeURIComponent($e.replace(/\+/g," ")):"")}}}function $i(E){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,E instanceof $i){this.h=E.h,Ur(this,E.j),this.o=E.o,this.g=E.g,ln(this,E.s),this.l=E.l;var F=E.i,W=new $r;W.i=F.i,F.g&&(W.g=new Map(F.g),W.h=F.h),ms(this,W),this.m=E.m}else E&&(F=String(E).match(Wn))?(this.h=!1,Ur(this,F[1]||"",!0),this.o=Vn(F[2]||""),this.g=Vn(F[3]||"",!0),ln(this,F[4]),this.l=Vn(F[5]||"",!0),ms(this,F[6]||"",!0),this.m=Vn(F[7]||"")):(this.h=!1,this.i=new $r(null,this.h))}$i.prototype.toString=function(){var E=[],F=this.j;F&&E.push(ei(F,ko,!0),":");var W=this.g;return(W||F=="file")&&(E.push("//"),(F=this.o)&&E.push(ei(F,ko,!0),"@"),E.push(encodeURIComponent(String(W)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),W=this.s,W!=null&&E.push(":",String(W))),(W=this.l)&&(this.g&&W.charAt(0)!="/"&&E.push("/"),E.push(ei(W,W.charAt(0)=="/"?Yi:Xi,!0))),(W=this.i.toString())&&E.push("?",W),(W=this.m)&&E.push("#",ei(W,il)),E.join("")};function Bt(E){return new $i(E)}function Ur(E,F,W){E.j=W?Vn(F,!0):F,E.j&&(E.j=E.j.replace(/:$/,""))}function ln(E,F){if(F){if(F=Number(F),isNaN(F)||0>F)throw Error("Bad port number "+F);E.s=F}else E.s=null}function ms(E,F,W){F instanceof $r?(E.i=F,is(E.i,E.h)):(W||(F=ei(F,qi)),E.i=new $r(F,E.h))}function un(E,F,W){E.i.set(F,W)}function Ar(E){return un(E,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),E}function Vn(E,F){return E?F?decodeURI(E.replace(/%25/g,"%2525")):decodeURIComponent(E):""}function ei(E,F,W){return typeof E=="string"?(E=encodeURI(E).replace(F,ri),W&&(E=E.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),E):null}function ri(E){return E=E.charCodeAt(0),"%"+(E>>4&15).toString(16)+(E&15).toString(16)}var ko=/[#\/\?@]/g,Xi=/[#\?:]/g,Yi=/[#\?]/g,qi=/[#\?@]/g,il=/#/g;function $r(E,F){this.h=this.g=null,this.i=E||null,this.j=!!F}function En(E){E.g||(E.g=new Map,E.h=0,E.i&&nl(E.i,function(F,W){E.add(decodeURIComponent(F.replace(/\+/g," ")),W)}))}t=$r.prototype,t.add=function(E,F){En(this),this.i=null,E=$t(this,E);var W=this.g.get(E);return W||this.g.set(E,W=[]),W.push(F),this.h+=1,this};function ea(E,F){En(E),F=$t(E,F),E.g.has(F)&&(E.i=null,E.h-=E.g.get(F).length,E.g.delete(F))}function qr(E,F){return En(E),F=$t(E,F),E.g.has(F)}t.forEach=function(E,F){En(this),this.g.forEach(function(W,de){W.forEach(function($e){E.call(F,$e,de,this)},this)},this)},t.na=function(){En(this);const E=Array.from(this.g.values()),F=Array.from(this.g.keys()),W=[];for(let de=0;de<F.length;de++){const $e=E[de];for(let Je=0;Je<$e.length;Je++)W.push(F[de])}return W},t.V=function(E){En(this);let F=[];if(typeof E=="string")qr(this,E)&&(F=F.concat(this.g.get($t(this,E))));else{E=Array.from(this.g.values());for(let W=0;W<E.length;W++)F=F.concat(E[W])}return F},t.set=function(E,F){return En(this),this.i=null,E=$t(this,E),qr(this,E)&&(this.h-=this.g.get(E).length),this.g.set(E,[F]),this.h+=1,this},t.get=function(E,F){return E?(E=this.V(E),0<E.length?String(E[0]):F):F};function Vs(E,F,W){ea(E,F),0<W.length&&(E.i=null,E.g.set($t(E,F),me(W)),E.h+=W.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const E=[],F=Array.from(this.g.keys());for(var W=0;W<F.length;W++){var de=F[W];const Je=encodeURIComponent(String(de)),At=this.V(de);for(de=0;de<At.length;de++){var $e=Je;At[de]!==""&&($e+="="+encodeURIComponent(String(At[de]))),E.push($e)}}return this.i=E.join("&")};function $t(E,F){return F=String(F),E.j&&(F=F.toLowerCase()),F}function is(E,F){F&&!E.j&&(En(E),E.i=null,E.g.forEach(function(W,de){var $e=de.toLowerCase();de!=$e&&(ea(this,de),Vs(this,$e,W))},E)),E.j=F}function Ln(E,F){const W=new wt;if(l.Image){const de=new Image;de.onload=$(Mn,W,"TestLoadImage: loaded",!0,F,de),de.onerror=$(Mn,W,"TestLoadImage: error",!1,F,de),de.onabort=$(Mn,W,"TestLoadImage: abort",!1,F,de),de.ontimeout=$(Mn,W,"TestLoadImage: timeout",!1,F,de),l.setTimeout(function(){de.ontimeout&&de.ontimeout()},1e4),de.src=E}else F(!1)}function rl(E,F){const W=new wt,de=new AbortController,$e=setTimeout(()=>{de.abort(),Mn(W,"TestPingServer: timeout",!1,F)},1e4);fetch(E,{signal:de.signal}).then(Je=>{clearTimeout($e),Je.ok?Mn(W,"TestPingServer: ok",!0,F):Mn(W,"TestPingServer: server error",!1,F)}).catch(()=>{clearTimeout($e),Mn(W,"TestPingServer: error",!1,F)})}function Mn(E,F,W,de,$e){try{$e&&($e.onload=null,$e.onerror=null,$e.onabort=null,$e.ontimeout=null),de(W)}catch{}}function Mo(){this.g=new re}function xn(E,F,W){const de=W||"";try{dn(E,function($e,Je){let At=$e;A($e)&&(At=pe($e)),F.push(de+Je+"="+encodeURIComponent(At))})}catch($e){throw F.push(de+"type="+encodeURIComponent("_badmap")),$e}}function Wt(E){this.l=E.Ub||null,this.j=E.eb||!1}ie(Wt,oe),Wt.prototype.g=function(){return new js(this.l,this.j)},Wt.prototype.i=function(E){return function(){return E}}({});function js(E,F){ni.call(this),this.D=E,this.o=F,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}ie(js,ni),t=js.prototype,t.open=function(E,F){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=E,this.A=F,this.readyState=1,Mi(this)},t.send=function(E){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const F={headers:this.u,method:this.B,credentials:this.m,cache:void 0};E&&(F.body=E),(this.D||l).fetch(new Request(this.A,F)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,si(this)),this.readyState=0},t.Sa=function(E){if(this.g&&(this.l=E,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=E.headers,this.readyState=2,Mi(this)),this.g&&(this.readyState=3,Mi(this),this.g)))if(this.responseType==="arraybuffer")E.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in E){if(this.j=E.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;fn(this)}else E.text().then(this.Ra.bind(this),this.ga.bind(this))};function fn(E){E.j.read().then(E.Pa.bind(E)).catch(E.ga.bind(E))}t.Pa=function(E){if(this.g){if(this.o&&E.value)this.response.push(E.value);else if(!this.o){var F=E.value?E.value:new Uint8Array(0);(F=this.v.decode(F,{stream:!E.done}))&&(this.response=this.responseText+=F)}E.done?si(this):Mi(this),this.readyState==3&&fn(this)}},t.Ra=function(E){this.g&&(this.response=this.responseText=E,si(this))},t.Qa=function(E){this.g&&(this.response=E,si(this))},t.ga=function(){this.g&&si(this)};function si(E){E.readyState=4,E.l=null,E.j=null,E.v=null,Mi(E)}t.setRequestHeader=function(E,F){this.u.append(E,F)},t.getResponseHeader=function(E){return this.h&&this.h.get(E.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const E=[],F=this.h.entries();for(var W=F.next();!W.done;)W=W.value,E.push(W[0]+": "+W[1]),W=F.next();return E.join(`\r
`)};function Mi(E){E.onreadystatechange&&E.onreadystatechange.call(E)}Object.defineProperty(js.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(E){this.m=E?"include":"same-origin"}});function ta(E){let F="";return qe(E,function(W,de){F+=de,F+=":",F+=W,F+=`\r
`}),F}function Ro(E,F,W){e:{for(de in W){var de=!1;break e}de=!0}de||(W=ta(W),typeof E=="string"?W!=null&&encodeURIComponent(String(W)):un(E,F,W))}function oi(E){ni.call(this),this.headers=new Map,this.o=E||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}ie(oi,ni);var Lo=/^https?$/i,ql=["POST","PUT"];t=oi.prototype,t.Ha=function(E){this.J=E},t.ea=function(E,F,W,de){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+E);F=F?F.toUpperCase():"GET",this.D=E,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Si.g(),this.v=this.o?Te(this.o):Te(Si),this.g.onreadystatechange=H(this.Ea,this);try{this.B=!0,this.g.open(F,String(E),!0),this.B=!1}catch(Je){Hl(this,Je);return}if(E=W||"",W=new Map(this.headers),de)if(Object.getPrototypeOf(de)===Object.prototype)for(var $e in de)W.set($e,de[$e]);else if(typeof de.keys=="function"&&typeof de.get=="function")for(const Je of de.keys())W.set(Je,de.get(Je));else throw Error("Unknown input type for opt_headers: "+String(de));de=Array.from(W.keys()).find(Je=>Je.toLowerCase()=="content-type"),$e=l.FormData&&E instanceof l.FormData,!(0<=Array.prototype.indexOf.call(ql,F,void 0))||de||$e||W.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Je,At]of W)this.g.setRequestHeader(Je,At);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{wn(this),this.u=!0,this.g.send(E),this.u=!1}catch(Je){Hl(this,Je)}};function Hl(E,F){E.h=!1,E.g&&(E.j=!0,E.g.abort(),E.j=!1),E.l=F,E.m=5,sl(E),Do(E)}function sl(E){E.A||(E.A=!0,Ti(E,"complete"),Ti(E,"error"))}t.abort=function(E){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=E||7,Ti(this,"complete"),Ti(this,"abort"),Do(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Do(this,!0)),oi.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?In(this):this.bb())},t.bb=function(){In(this)};function In(E){if(E.h&&typeof f<"u"&&(!E.v[1]||Qi(E)!=4||E.Z()!=2)){if(E.u&&Qi(E)==4)So(E.Ea,0,E);else if(Ti(E,"readystatechange"),Qi(E)==4){E.h=!1;try{const At=E.Z();e:switch(At){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var F=!0;break e;default:F=!1}var W;if(!(W=F)){var de;if(de=At===0){var $e=String(E.D).match(Wn)[1]||null;!$e&&l.self&&l.self.location&&($e=l.self.location.protocol.slice(0,-1)),de=!Lo.test($e?$e.toLowerCase():"")}W=de}if(W)Ti(E,"complete"),Ti(E,"success");else{E.m=6;try{var Je=2<Qi(E)?E.g.statusText:""}catch{Je=""}E.l=Je+" ["+E.Z()+"]",sl(E)}}finally{Do(E)}}}}function Do(E,F){if(E.g){wn(E);const W=E.g,de=E.v[0]?()=>{}:null;E.g=null,E.v=null,F||Ti(E,"ready");try{W.onreadystatechange=de}catch{}}}function wn(E){E.I&&(l.clearTimeout(E.I),E.I=null)}t.isActive=function(){return!!this.g};function Qi(E){return E.g?E.g.readyState:0}t.Z=function(){try{return 2<Qi(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(E){if(this.g){var F=this.g.responseText;return E&&F.indexOf(E)==0&&(F=F.substring(E.length)),ee(F)}};function Hr(E){try{if(!E.g)return null;if("response"in E.g)return E.g.response;switch(E.H){case"":case"text":return E.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in E.g)return E.g.mozResponseArrayBuffer}return null}catch{return null}}function na(E){const F={};E=(E.g&&2<=Qi(E)&&E.g.getAllResponseHeaders()||"").split(`\r
`);for(let de=0;de<E.length;de++){if(le(E[de]))continue;var W=Pe(E[de]);const $e=W[0];if(W=W[1],typeof W!="string")continue;W=W.trim();const Je=F[$e]||[];F[$e]=Je,Je.push(W)}fe(F,function(de){return de.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ci(E,F,W){return W&&W.internalChannelParams&&W.internalChannelParams[E]||F}function Gl(E){this.Aa=0,this.i=[],this.j=new wt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ci("failFast",!1,E),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ci("baseRetryDelayMs",5e3,E),this.cb=ci("retryDelaySeedMs",1e4,E),this.Wa=ci("forwardChannelMaxRetries",2,E),this.wa=ci("forwardChannelRequestTimeoutMs",2e4,E),this.pa=E&&E.xmlHttpFactory||void 0,this.Xa=E&&E.Tb||void 0,this.Ca=E&&E.useFetchStreams||!1,this.L=void 0,this.J=E&&E.supportsCrossDomainXhr||!1,this.K="",this.h=new Cu(E&&E.concurrentRequestLimit),this.Da=new Mo,this.P=E&&E.fastHandshake||!1,this.O=E&&E.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=E&&E.Rb||!1,E&&E.xa&&this.j.xa(),E&&E.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&E&&E.detectBufferingProxy||!1,this.ja=void 0,E&&E.longPollingTimeout&&0<E.longPollingTimeout&&(this.ja=E.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Gl.prototype,t.la=8,t.G=1,t.connect=function(E,F,W,de){zt(0),this.W=E,this.H=F||{},W&&de!==void 0&&(this.H.OSID=W,this.H.OAID=de),this.F=this.X,this.I=ia(this,null,this.W),io(this)};function gs(E){if(xc(E),E.G==3){var F=E.U++,W=Bt(E.I);if(un(W,"SID",E.K),un(W,"RID",F),un(W,"TYPE","terminate"),zo(E,W),F=new zn(E,E.j,F),F.L=2,F.v=Ar(Bt(W)),W=!1,l.navigator&&l.navigator.sendBeacon)try{W=l.navigator.sendBeacon(F.v.toString(),"")}catch{}!W&&l.Image&&(new Image().src=F.v,W=!0),W||(F.g=ll(F.j,null),F.g.ea(F.v)),F.F=Date.now(),Ja(F)}Ea(E)}function ol(E){E.g&&(so(E),E.g.cancel(),E.g=null)}function xc(E){ol(E),E.u&&(l.clearTimeout(E.u),E.u=null),vr(E),E.h.cancel(),E.s&&(typeof E.s=="number"&&l.clearTimeout(E.s),E.s=null)}function io(E){if(!$l(E.h)&&!E.s){E.s=!0;var F=E.Ga;vi||Tt(),lt||(vi(),lt=!0),Qt.add(F,E),E.B=0}}function Au(E,F){return Co(E.h)>=E.h.j-(E.s?1:0)?!1:E.s?(E.i=F.D.concat(E.i),!0):E.G==1||E.G==2||E.B>=(E.Va?0:E.Wa)?!1:(E.s=nt(H(E.Ga,E,F),al(E,E.B)),E.B++,!0)}t.Ga=function(E){if(this.s)if(this.s=null,this.G==1){if(!E){this.U=Math.floor(1e5*Math.random()),E=this.U++;const $e=new zn(this,this.j,E);let Je=this.o;if(this.S&&(Je?(Je=Q(Je),ve(Je,this.S)):Je=this.S),this.m!==null||this.O||($e.H=Je,Je=null),this.P)e:{for(var F=0,W=0;W<this.i.length;W++){t:{var de=this.i[W];if("__data__"in de.map&&(de=de.map.__data__,typeof de=="string")){de=de.length;break t}de=void 0}if(de===void 0)break;if(F+=de,4096<F){F=W;break e}if(F===4096||W===this.i.length-1){F=W+1;break e}}F=1e3}else F=1e3;F=ro(this,$e,F),W=Bt(this.I),un(W,"RID",E),un(W,"CVER",22),this.D&&un(W,"X-HTTP-Session-Id",this.D),zo(this,W),Je&&(this.O?F="headers="+encodeURIComponent(String(ta(Je)))+"&"+F:this.m&&Ro(W,this.m,Je)),Jn(this.h,$e),this.Ua&&un(W,"TYPE","init"),this.P?(un(W,"$req",F),un(W,"SID","null"),$e.T=!0,Eo($e,W,null)):Eo($e,W,F),this.G=2}}else this.G==3&&(E?_s(this,E):this.i.length==0||$l(this.h)||_s(this))};function _s(E,F){var W;F?W=F.l:W=E.U++;const de=Bt(E.I);un(de,"SID",E.K),un(de,"RID",W),un(de,"AID",E.T),zo(E,de),E.m&&E.o&&Ro(de,E.m,E.o),W=new zn(E,E.j,W,E.B+1),E.m===null&&(W.H=E.o),F&&(E.i=F.D.concat(E.i)),F=ro(E,W,1e3),W.I=Math.round(.5*E.wa)+Math.round(.5*E.wa*Math.random()),Jn(E.h,W),Eo(W,de,F)}function zo(E,F){E.H&&qe(E.H,function(W,de){un(F,de,W)}),E.l&&dn({},function(W,de){un(F,de,W)})}function ro(E,F,W){W=Math.min(E.i.length,W);var de=E.l?H(E.l.Na,E.l,E):null;e:{var $e=E.i;let Je=-1;for(;;){const At=["count="+W];Je==-1?0<W?(Je=$e[0].g,At.push("ofs="+Je)):Je=0:At.push("ofs="+Je);let Kn=!0;for(let Ei=0;Ei<W;Ei++){let Dn=$e[Ei].g;const qn=$e[Ei].map;if(Dn-=Je,0>Dn)Je=Math.max(0,$e[Ei].g-100),Kn=!1;else try{xn(qn,At,"req"+Dn+"_")}catch{de&&de(qn)}}if(Kn){de=At.join("&");break e}}}return E=E.i.splice(0,W),F.D=E,de}function Ri(E){if(!E.g&&!E.u){E.Y=1;var F=E.Fa;vi||Tt(),lt||(vi(),lt=!0),Qt.add(F,E),E.v=0}}function No(E){return E.g||E.u||3<=E.v?!1:(E.Y++,E.u=nt(H(E.Fa,E),al(E,E.v)),E.v++,!0)}t.Fa=function(){if(this.u=null,Sa(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var E=2*this.R;this.j.info("BP detection timer enabled: "+E),this.A=nt(H(this.ab,this),E)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,zt(10),ol(this),Sa(this))};function so(E){E.A!=null&&(l.clearTimeout(E.A),E.A=null)}function Sa(E){E.g=new zn(E,E.j,"rpc",E.Y),E.m===null&&(E.g.H=E.o),E.g.O=0;var F=Bt(E.qa);un(F,"RID","rpc"),un(F,"SID",E.K),un(F,"AID",E.T),un(F,"CI",E.F?"0":"1"),!E.F&&E.ja&&un(F,"TO",E.ja),un(F,"TYPE","xmlhttp"),zo(E,F),E.m&&E.o&&Ro(F,E.m,E.o),E.L&&(E.g.I=E.L);var W=E.g;E=E.ia,W.L=1,W.v=Ar(Bt(F)),W.m=null,W.P=!0,Qa(W,E)}t.Za=function(){this.C!=null&&(this.C=null,ol(this),No(this),zt(19))};function vr(E){E.C!=null&&(l.clearTimeout(E.C),E.C=null)}function ku(E,F){var W=null;if(E.g==F){vr(E),so(E),E.g=null;var de=2}else if(gn(E.h,F))W=F.D,ba(E.h,F),de=1;else return;if(E.G!=0){if(F.o)if(de==1){W=F.m?F.m.length:0,F=Date.now()-F.F;var $e=E.B;de=Ue(),Ti(de,new tn(de,W)),io(E)}else Ri(E);else if($e=F.s,$e==3||$e==0&&0<F.X||!(de==1&&Au(E,F)||de==2&&No(E)))switch(W&&0<W.length&&(F=E.h,F.i=F.i.concat(W)),$e){case 1:ys(E,5);break;case 4:ys(E,10);break;case 3:ys(E,6);break;default:ys(E,2)}}}function al(E,F){let W=E.Ta+Math.floor(Math.random()*E.cb);return E.isActive()||(W*=2),W*F}function ys(E,F){if(E.j.info("Error code "+F),F==2){var W=H(E.fb,E),de=E.Xa;const $e=!de;de=new $i(de||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Ur(de,"https"),Ar(de),$e?Ln(de.toString(),W):rl(de.toString(),W)}else zt(2);E.G=0,E.l&&E.l.sa(F),Ea(E),xc(E)}t.fb=function(E){E?(this.j.info("Successfully pinged google.com"),zt(2)):(this.j.info("Failed to ping google.com"),zt(1))};function Ea(E){if(E.G=0,E.ka=[],E.l){const F=jr(E.h);(F.length!=0||E.i.length!=0)&&(Me(E.ka,F),Me(E.ka,E.i),E.h.i.length=0,me(E.i),E.i.length=0),E.l.ra()}}function ia(E,F,W){var de=W instanceof $i?Bt(W):new $i(W);if(de.g!="")F&&(de.g=F+"."+de.g),ln(de,de.s);else{var $e=l.location;de=$e.protocol,F=F?F+"."+$e.hostname:$e.hostname,$e=+$e.port;var Je=new $i(null);de&&Ur(Je,de),F&&(Je.g=F),$e&&ln(Je,$e),W&&(Je.l=W),de=Je}return W=E.D,F=E.ya,W&&F&&un(de,W,F),un(de,"VER",E.la),zo(E,de),de}function ll(E,F,W){if(F&&!E.J)throw Error("Can't create secondary domain capable XhrIo object.");return F=E.Ca&&!E.pa?new oi(new Wt({eb:W})):new oi(E.pa),F.Ha(E.J),F}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Zl(){}t=Zl.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function vs(){}vs.prototype.g=function(E,F){return new dr(E,F)};function dr(E,F){ni.call(this),this.g=new Gl(F),this.l=E,this.h=F&&F.messageUrlParams||null,E=F&&F.messageHeaders||null,F&&F.clientProtocolHeaderRequired&&(E?E["X-Client-Protocol"]="webchannel":E={"X-Client-Protocol":"webchannel"}),this.g.o=E,E=F&&F.initMessageHeaders||null,F&&F.messageContentType&&(E?E["X-WebChannel-Content-Type"]=F.messageContentType:E={"X-WebChannel-Content-Type":F.messageContentType}),F&&F.va&&(E?E["X-WebChannel-Client-Profile"]=F.va:E={"X-WebChannel-Client-Profile":F.va}),this.g.S=E,(E=F&&F.Sb)&&!le(E)&&(this.g.m=E),this.v=F&&F.supportsCrossDomainXhr||!1,this.u=F&&F.sendRawJson||!1,(F=F&&F.httpSessionIdParam)&&!le(F)&&(this.g.D=F,E=this.h,E!==null&&F in E&&(E=this.h,F in E&&delete E[F])),this.j=new xs(this)}ie(dr,ni),dr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},dr.prototype.close=function(){gs(this.g)},dr.prototype.o=function(E){var F=this.g;if(typeof E=="string"){var W={};W.__data__=E,E=W}else this.u&&(W={},W.__data__=pe(E),E=W);F.i.push(new tl(F.Ya++,E)),F.G==3&&io(F)},dr.prototype.N=function(){this.g.l=null,delete this.j,gs(this.g),delete this.g,dr.aa.N.call(this)};function Us(E){He.call(this),E.__headers__&&(this.headers=E.__headers__,this.statusCode=E.__status__,delete E.__headers__,delete E.__status__);var F=E.__sm__;if(F){e:{for(const W in F){E=W;break e}E=void 0}(this.i=E)&&(E=this.i,F=F!==null&&E in F?F[E]:void 0),this.data=F}else this.data=E}ie(Us,He);function wc(){Fe.call(this),this.status=1}ie(wc,Fe);function xs(E){this.g=E}ie(xs,Zl),xs.prototype.ua=function(){Ti(this.g,"a")},xs.prototype.ta=function(E){Ti(this.g,new Us(E))},xs.prototype.sa=function(E){Ti(this.g,new wc)},xs.prototype.ra=function(){Ti(this.g,"b")},vs.prototype.createWebChannel=vs.prototype.g,dr.prototype.send=dr.prototype.o,dr.prototype.open=dr.prototype.m,dr.prototype.close=dr.prototype.close,_R=function(){return new vs},gR=function(){return Ue()},mR=Qe,$b={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Qn.NO_ERROR=0,Qn.TIMEOUT=8,Qn.HTTP_ERROR=6,zy=Qn,ps.COMPLETE="complete",pR=ps,Le.EventType=Be,Be.OPEN="a",Be.CLOSE="b",Be.ERROR="c",Be.MESSAGE="d",ni.prototype.listen=ni.prototype.K,Vm=Le,oi.prototype.listenOnce=oi.prototype.L,oi.prototype.getLastError=oi.prototype.Ka,oi.prototype.getLastErrorCode=oi.prototype.Ba,oi.prototype.getStatus=oi.prototype.Z,oi.prototype.getResponseJson=oi.prototype.Oa,oi.prototype.getResponseText=oi.prototype.oa,oi.prototype.send=oi.prototype.ea,oi.prototype.setWithCredentials=oi.prototype.Ha,fR=oi}).apply(typeof uy<"u"?uy:typeof self<"u"?self:typeof window<"u"?window:{});const lP="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xs.UNAUTHENTICATED=new Xs(null),Xs.GOOGLE_CREDENTIALS=new Xs("google-credentials-uid"),Xs.FIRST_PARTY=new Xs("first-party-uid"),Xs.MOCK_USER=new Xs("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ap="11.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd=new g0("@firebase/firestore");function Ef(){return Pd.logLevel}function Ft(t,...e){if(Pd.logLevel<=Un.DEBUG){const n=e.map(ET);Pd.debug(`Firestore (${Ap}): ${t}`,...n)}}function fc(t,...e){if(Pd.logLevel<=Un.ERROR){const n=e.map(ET);Pd.error(`Firestore (${Ap}): ${t}`,...n)}}function fp(t,...e){if(Pd.logLevel<=Un.WARN){const n=e.map(ET);Pd.warn(`Firestore (${Ap}): ${t}`,...n)}}function ET(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mn(t="Unexpected state"){const e=`FIRESTORE (${Ap}) INTERNAL ASSERTION FAILED: `+t;throw fc(e),new Error(e)}function yi(t,e){t||mn()}function Sn(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ut extends Vl{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class S6{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Xs.UNAUTHENTICATED))}shutdown(){}}class E6{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class I6{constructor(e){this.t=e,this.currentUser=Xs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){yi(this.o===void 0);let r=this.i;const o=S=>this.i!==r?(r=this.i,n(S)):Promise.resolve();let h=new ph;this.o=()=>{this.i++,this.currentUser=this.u(),h.resolve(),h=new ph,e.enqueueRetryable(()=>o(this.currentUser))};const f=()=>{const S=h;e.enqueueRetryable(async()=>{await S.promise,await o(this.currentUser)})},l=S=>{Ft("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=S,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(S=>l(S)),setTimeout(()=>{if(!this.auth){const S=this.t.getImmediate({optional:!0});S?l(S):(Ft("FirebaseAuthCredentialsProvider","Auth not yet detected"),h.resolve(),h=new ph)}},0),f()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(Ft("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(yi(typeof r.accessToken=="string"),new yR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return yi(e===null||typeof e=="string"),new Xs(e)}}class P6{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Xs.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class C6{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new P6(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Xs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class A6{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class k6{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){yi(this.o===void 0);const r=h=>{h.error!=null&&Ft("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${h.error.message}`);const f=h.token!==this.R;return this.R=h.token,Ft("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?n(h.token):Promise.resolve()};this.o=h=>{e.enqueueRetryable(()=>r(h))};const o=h=>{Ft("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=h,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(h=>o(h)),setTimeout(()=>{if(!this.appCheck){const h=this.A.getImmediate({optional:!0});h?o(h):Ft("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(yi(typeof n.token=="string"),this.R=n.token,new A6(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M6(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const o=M6(40);for(let h=0;h<o.length;++h)r.length<20&&o[h]<n&&(r+=e.charAt(o[h]%e.length))}return r}}function Gn(t,e){return t<e?-1:t>e?1:0}function pp(t,e,n){return t.length===e.length&&t.every((r,o)=>n(r,e[o]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{static now(){return ts.fromMillis(Date.now())}static fromDate(e){return ts.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new ts(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Ut(mt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Ut(mt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new Ut(mt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ut(mt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Gn(this.nanoseconds,e.nanoseconds):Gn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{static fromTimestamp(e){return new Tn(e)}static min(){return new Tn(new ts(0,0))}static max(){return new Tn(new ts(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(e,n,r){n===void 0?n=0:n>e.length&&mn(),r===void 0?r=e.length-n:r>e.length-n&&mn(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return cu.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof cu?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let o=0;o<r;o++){const h=cu.compareSegments(e.get(o),n.get(o));if(h!==0)return h}return Math.sign(e.length-n.length)}static compareSegments(e,n){const r=cu.isNumericId(e),o=cu.isNumericId(n);return r&&!o?-1:!r&&o?1:r&&o?cu.extractNumericId(e).compare(cu.extractNumericId(n)):e<n?-1:e>n?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fh.fromString(e.substring(4,e.length-2))}}class Wi extends cu{construct(e,n,r){return new Wi(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ut(mt.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(o=>o.length>0))}return new Wi(n)}static emptyPath(){return new Wi([])}}const R6=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class As extends cu{construct(e,n,r){return new As(e,n,r)}static isValidIdentifier(e){return R6.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),As.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new As(["__name__"])}static fromServerFormat(e){const n=[];let r="",o=0;const h=()=>{if(r.length===0)throw new Ut(mt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let f=!1;for(;o<e.length;){const l=e[o];if(l==="\\"){if(o+1===e.length)throw new Ut(mt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const S=e[o+1];if(S!=="\\"&&S!=="."&&S!=="`")throw new Ut(mt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=S,o+=2}else l==="`"?(f=!f,o++):l!=="."||f?(r+=l,o++):(h(),o++)}if(h(),f)throw new Ut(mt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new As(n)}static emptyPath(){return new As([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.path=e}static fromPath(e){return new an(Wi.fromString(e))}static fromName(e){return new an(Wi.fromString(e).popFirst(5))}static empty(){return new an(Wi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Wi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Wi.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new an(new Wi(e.slice()))}}function L6(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,o=Tn.fromTimestamp(r===1e9?new ts(n+1,0):new ts(n,r));return new yh(o,an.empty(),e)}function D6(t){return new yh(t.readTime,t.key,-1)}class yh{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new yh(Tn.min(),an.empty(),-1)}static max(){return new yh(Tn.max(),an.empty(),-1)}}function z6(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=an.comparator(t.documentKey,e.documentKey),n!==0?n:Gn(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N6="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class O6{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kp(t){if(t.code!==mt.FAILED_PRECONDITION||t.message!==N6)throw t;Ft("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&mn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ft((r,o)=>{this.nextCallback=h=>{this.wrapSuccess(e,h).next(r,o)},this.catchCallback=h=>{this.wrapFailure(n,h).next(r,o)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ft?n:ft.resolve(n)}catch(n){return ft.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ft.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ft.reject(n)}static resolve(e){return new ft((n,r)=>{n(e)})}static reject(e){return new ft((n,r)=>{r(e)})}static waitFor(e){return new ft((n,r)=>{let o=0,h=0,f=!1;e.forEach(l=>{++o,l.next(()=>{++h,f&&h===o&&n()},S=>r(S))}),f=!0,h===o&&n()})}static or(e){let n=ft.resolve(!1);for(const r of e)n=n.next(o=>o?ft.resolve(o):r());return n}static forEach(e,n){const r=[];return e.forEach((o,h)=>{r.push(n.call(this,o,h))}),this.waitFor(r)}static mapArray(e,n){return new ft((r,o)=>{const h=e.length,f=new Array(h);let l=0;for(let S=0;S<h;S++){const A=S;n(e[A]).next(O=>{f[A]=O,++l,l===h&&r(f)},O=>o(O))}})}static doWhile(e,n){return new ft((r,o)=>{const h=()=>{e()===!0?n().next(()=>{h()},o):r()};h()})}}function F6(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Mp(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}_0.oe=-1;function y0(t){return t==null}function Tv(t){return t===0&&1/t==-1/0}function B6(t){return typeof t=="number"&&Number.isInteger(t)&&!Tv(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V6(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=uP(e)),e=j6(t.get(n),e);return uP(e)}function j6(t,e){let n=e;const r=t.length;for(let o=0;o<r;o++){const h=t.charAt(o);switch(h){case"\0":n+="";break;case"":n+="";break;default:n+=h}}return n}function uP(t){return t+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Fd(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function xR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e,n){this.comparator=e,this.root=n||Cs.EMPTY}insert(e,n){return new cr(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Cs.BLACK,null,null))}remove(e){return new cr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Cs.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const o=this.comparator(e,r.key);if(o===0)return n+r.left.size;o<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cy(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cy(this.root,e,this.comparator,!1)}getReverseIterator(){return new cy(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cy(this.root,e,this.comparator,!0)}}class cy{constructor(e,n,r,o){this.isReverse=o,this.nodeStack=[];let h=1;for(;!e.isEmpty();)if(h=n?r(e.key,n):1,n&&o&&(h*=-1),h<0)e=this.isReverse?e.left:e.right;else{if(h===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Cs{constructor(e,n,r,o,h){this.key=e,this.value=n,this.color=r??Cs.RED,this.left=o??Cs.EMPTY,this.right=h??Cs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,o,h){return new Cs(e??this.key,n??this.value,r??this.color,o??this.left,h??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let o=this;const h=r(e,o.key);return o=h<0?o.copy(null,null,null,o.left.insert(e,n,r),null):h===0?o.copy(null,n,null,null,null):o.copy(null,null,null,null,o.right.insert(e,n,r)),o.fixUp()}removeMin(){if(this.left.isEmpty())return Cs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,o=this;if(n(e,o.key)<0)o.left.isEmpty()||o.left.isRed()||o.left.left.isRed()||(o=o.moveRedLeft()),o=o.copy(null,null,null,o.left.remove(e,n),null);else{if(o.left.isRed()&&(o=o.rotateRight()),o.right.isEmpty()||o.right.isRed()||o.right.left.isRed()||(o=o.moveRedRight()),n(e,o.key)===0){if(o.right.isEmpty())return Cs.EMPTY;r=o.right.min(),o=o.copy(r.key,r.value,null,null,o.right.removeMin())}o=o.copy(null,null,null,null,o.right.remove(e,n))}return o.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Cs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Cs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw mn();const e=this.left.check();if(e!==this.right.check())throw mn();return e+(this.isRed()?0:1)}}Cs.EMPTY=null,Cs.RED=!0,Cs.BLACK=!1;Cs.EMPTY=new class{constructor(){this.size=0}get key(){throw mn()}get value(){throw mn()}get color(){throw mn()}get left(){throw mn()}get right(){throw mn()}copy(e,n,r,o,h){return this}insert(e,n,r){return new Cs(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e){this.comparator=e,this.data=new cr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const o=r.getNext();if(this.comparator(o.key,e[1])>=0)return;n(o.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new hP(this.data.getIterator())}getIteratorFrom(e){return new hP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ns)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const o=n.getNext().key,h=r.getNext().key;if(this.comparator(o,h)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ns(this.comparator);return n.data=e,n}}class hP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e){this.fields=e,e.sort(As.comparator)}static empty(){return new Rl([])}unionWith(e){let n=new ns(As.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Rl(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return pp(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(o){try{return atob(o)}catch(h){throw typeof DOMException<"u"&&h instanceof DOMException?new wR("Invalid base64 string: "+h):h}}(e);return new Rs(n)}static fromUint8Array(e){const n=function(o){let h="";for(let f=0;f<o.length;++f)h+=String.fromCharCode(o[f]);return h}(e);return new Rs(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Gn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Rs.EMPTY_BYTE_STRING=new Rs("");const U6=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vh(t){if(yi(!!t),typeof t=="string"){let e=0;const n=U6.exec(t);if(yi(!!n),n[1]){let o=n[1];o=(o+"000000000").substr(0,9),e=Number(o)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Tr(t.seconds),nanos:Tr(t.nanos)}}function Tr(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function xh(t){return typeof t=="string"?Rs.fromBase64String(t):Rs.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IT(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function v0(t){const e=t.mapValue.fields.__previous_value__;return IT(e)?v0(e):e}function kg(t){const e=vh(t.mapValue.fields.__local_write_time__.timestampValue);return new ts(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(e,n,r,o,h,f,l,S,A){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=o,this.ssl=h,this.forceLongPolling=f,this.autoDetectLongPolling=l,this.longPollingOptions=S,this.useFetchStreams=A}}class Mg{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Mg("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Mg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hy={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function wh(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?IT(t)?4:H6(t)?9007199254740991:q6(t)?10:11:mn()}function Su(t,e){if(t===e)return!0;const n=wh(t);if(n!==wh(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return kg(t).isEqual(kg(e));case 3:return function(o,h){if(typeof o.timestampValue=="string"&&typeof h.timestampValue=="string"&&o.timestampValue.length===h.timestampValue.length)return o.timestampValue===h.timestampValue;const f=vh(o.timestampValue),l=vh(h.timestampValue);return f.seconds===l.seconds&&f.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(o,h){return xh(o.bytesValue).isEqual(xh(h.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(o,h){return Tr(o.geoPointValue.latitude)===Tr(h.geoPointValue.latitude)&&Tr(o.geoPointValue.longitude)===Tr(h.geoPointValue.longitude)}(t,e);case 2:return function(o,h){if("integerValue"in o&&"integerValue"in h)return Tr(o.integerValue)===Tr(h.integerValue);if("doubleValue"in o&&"doubleValue"in h){const f=Tr(o.doubleValue),l=Tr(h.doubleValue);return f===l?Tv(f)===Tv(l):isNaN(f)&&isNaN(l)}return!1}(t,e);case 9:return pp(t.arrayValue.values||[],e.arrayValue.values||[],Su);case 10:case 11:return function(o,h){const f=o.mapValue.fields||{},l=h.mapValue.fields||{};if(cP(f)!==cP(l))return!1;for(const S in f)if(f.hasOwnProperty(S)&&(l[S]===void 0||!Su(f[S],l[S])))return!1;return!0}(t,e);default:return mn()}}function Rg(t,e){return(t.values||[]).find(n=>Su(n,e))!==void 0}function mp(t,e){if(t===e)return 0;const n=wh(t),r=wh(e);if(n!==r)return Gn(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Gn(t.booleanValue,e.booleanValue);case 2:return function(h,f){const l=Tr(h.integerValue||h.doubleValue),S=Tr(f.integerValue||f.doubleValue);return l<S?-1:l>S?1:l===S?0:isNaN(l)?isNaN(S)?0:-1:1}(t,e);case 3:return dP(t.timestampValue,e.timestampValue);case 4:return dP(kg(t),kg(e));case 5:return Gn(t.stringValue,e.stringValue);case 6:return function(h,f){const l=xh(h),S=xh(f);return l.compareTo(S)}(t.bytesValue,e.bytesValue);case 7:return function(h,f){const l=h.split("/"),S=f.split("/");for(let A=0;A<l.length&&A<S.length;A++){const O=Gn(l[A],S[A]);if(O!==0)return O}return Gn(l.length,S.length)}(t.referenceValue,e.referenceValue);case 8:return function(h,f){const l=Gn(Tr(h.latitude),Tr(f.latitude));return l!==0?l:Gn(Tr(h.longitude),Tr(f.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return fP(t.arrayValue,e.arrayValue);case 10:return function(h,f){var l,S,A,O;const U=h.fields||{},H=f.fields||{},$=(l=U.value)===null||l===void 0?void 0:l.arrayValue,ie=(S=H.value)===null||S===void 0?void 0:S.arrayValue,me=Gn(((A=$==null?void 0:$.values)===null||A===void 0?void 0:A.length)||0,((O=ie==null?void 0:ie.values)===null||O===void 0?void 0:O.length)||0);return me!==0?me:fP($,ie)}(t.mapValue,e.mapValue);case 11:return function(h,f){if(h===hy.mapValue&&f===hy.mapValue)return 0;if(h===hy.mapValue)return 1;if(f===hy.mapValue)return-1;const l=h.fields||{},S=Object.keys(l),A=f.fields||{},O=Object.keys(A);S.sort(),O.sort();for(let U=0;U<S.length&&U<O.length;++U){const H=Gn(S[U],O[U]);if(H!==0)return H;const $=mp(l[S[U]],A[O[U]]);if($!==0)return $}return Gn(S.length,O.length)}(t.mapValue,e.mapValue);default:throw mn()}}function dP(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Gn(t,e);const n=vh(t),r=vh(e),o=Gn(n.seconds,r.seconds);return o!==0?o:Gn(n.nanos,r.nanos)}function fP(t,e){const n=t.values||[],r=e.values||[];for(let o=0;o<n.length&&o<r.length;++o){const h=mp(n[o],r[o]);if(h)return h}return Gn(n.length,r.length)}function gp(t){return qb(t)}function qb(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=vh(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return xh(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return an.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",o=!0;for(const h of n.values||[])o?o=!1:r+=",",r+=qb(h);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let o="{",h=!0;for(const f of r)h?h=!1:o+=",",o+=`${f}:${qb(n.fields[f])}`;return o+"}"}(t.mapValue):mn()}function Ny(t){switch(wh(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=v0(t);return e?16+Ny(e):16;case 5:return 2*t.stringValue.length;case 6:return xh(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((o,h)=>o+Ny(h),0)}(t.arrayValue);case 10:case 11:return function(r){let o=0;return Fd(r.fields,(h,f)=>{o+=h.length+Ny(f)}),o}(t.mapValue);default:throw mn()}}function pP(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Hb(t){return!!t&&"integerValue"in t}function PT(t){return!!t&&"arrayValue"in t}function mP(t){return!!t&&"nullValue"in t}function gP(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Oy(t){return!!t&&"mapValue"in t}function q6(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function eg(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Fd(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=eg(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=eg(t.arrayValue.values[n]);return e}return Object.assign({},t)}function H6(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.value=e}static empty(){return new Ua({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Oy(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=eg(n)}setAll(e){let n=As.emptyPath(),r={},o=[];e.forEach((f,l)=>{if(!n.isImmediateParentOf(l)){const S=this.getFieldsMap(n);this.applyChanges(S,r,o),r={},o=[],n=l.popLast()}f?r[l.lastSegment()]=eg(f):o.push(l.lastSegment())});const h=this.getFieldsMap(n);this.applyChanges(h,r,o)}delete(e){const n=this.field(e.popLast());Oy(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Su(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let o=n.mapValue.fields[e.get(r)];Oy(o)&&o.mapValue.fields||(o={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=o),n=o}return n.mapValue.fields}applyChanges(e,n,r){Fd(n,(o,h)=>e[o]=h);for(const o of r)delete e[o]}clone(){return new Ua(eg(this.value))}}function bR(t){const e=[];return Fd(t.fields,(n,r)=>{const o=new As([n]);if(Oy(r)){const h=bR(r.mapValue).fields;if(h.length===0)e.push(o);else for(const f of h)e.push(o.child(f))}else e.push(o)}),new Rl(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e,n,r,o,h,f,l){this.key=e,this.documentType=n,this.version=r,this.readTime=o,this.createTime=h,this.data=f,this.documentState=l}static newInvalidDocument(e){return new Qs(e,0,Tn.min(),Tn.min(),Tn.min(),Ua.empty(),0)}static newFoundDocument(e,n,r,o){return new Qs(e,1,n,Tn.min(),r,o,0)}static newNoDocument(e,n){return new Qs(e,2,n,Tn.min(),Tn.min(),Ua.empty(),0)}static newUnknownDocument(e,n){return new Qs(e,3,n,Tn.min(),Tn.min(),Ua.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Tn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ua.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ua.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Tn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Qs&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Qs(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,n){this.position=e,this.inclusive=n}}function _P(t,e,n){let r=0;for(let o=0;o<t.position.length;o++){const h=e[o],f=t.position[o];if(h.field.isKeyField()?r=an.comparator(an.fromName(f.referenceValue),n.key):r=mp(f,n.data.field(h.field)),h.dir==="desc"&&(r*=-1),r!==0)break}return r}function yP(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Su(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e,n="asc"){this.field=e,this.dir=n}}function G6(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{}class Or extends TR{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new W6(e,n,r):n==="array-contains"?new Y6(e,r):n==="in"?new Q6(e,r):n==="not-in"?new J6(e,r):n==="array-contains-any"?new eV(e,r):new Or(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new K6(e,r):new X6(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(mp(n,this.value)):n!==null&&wh(this.value)===wh(n)&&this.matchesComparison(mp(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return mn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Bl extends TR{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new Bl(e,n)}matches(e){return SR(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function SR(t){return t.op==="and"}function ER(t){return Z6(t)&&SR(t)}function Z6(t){for(const e of t.filters)if(e instanceof Bl)return!1;return!0}function Gb(t){if(t instanceof Or)return t.field.canonicalString()+t.op.toString()+gp(t.value);if(ER(t))return t.filters.map(e=>Gb(e)).join(",");{const e=t.filters.map(n=>Gb(n)).join(",");return`${t.op}(${e})`}}function IR(t,e){return t instanceof Or?function(r,o){return o instanceof Or&&r.op===o.op&&r.field.isEqual(o.field)&&Su(r.value,o.value)}(t,e):t instanceof Bl?function(r,o){return o instanceof Bl&&r.op===o.op&&r.filters.length===o.filters.length?r.filters.reduce((h,f,l)=>h&&IR(f,o.filters[l]),!0):!1}(t,e):void mn()}function PR(t){return t instanceof Or?function(n){return`${n.field.canonicalString()} ${n.op} ${gp(n.value)}`}(t):t instanceof Bl?function(n){return n.op.toString()+" {"+n.getFilters().map(PR).join(" ,")+"}"}(t):"Filter"}class W6 extends Or{constructor(e,n,r){super(e,n,r),this.key=an.fromName(r.referenceValue)}matches(e){const n=an.comparator(e.key,this.key);return this.matchesComparison(n)}}class K6 extends Or{constructor(e,n){super(e,"in",n),this.keys=CR("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class X6 extends Or{constructor(e,n){super(e,"not-in",n),this.keys=CR("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function CR(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>an.fromName(r.referenceValue))}class Y6 extends Or{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return PT(n)&&Rg(n.arrayValue,this.value)}}class Q6 extends Or{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Rg(this.value.arrayValue,n)}}class J6 extends Or{constructor(e,n){super(e,"not-in",n)}matches(e){if(Rg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Rg(this.value.arrayValue,n)}}class eV extends Or{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!PT(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Rg(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(e,n=null,r=[],o=[],h=null,f=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=o,this.limit=h,this.startAt=f,this.endAt=l,this.ue=null}}function vP(t,e=null,n=[],r=[],o=null,h=null,f=null){return new tV(t,e,n,r,o,h,f)}function CT(t){const e=Sn(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Gb(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(h){return h.field.canonicalString()+h.dir}(r)).join(","),y0(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>gp(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>gp(r)).join(",")),e.ue=n}return e.ue}function AT(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!G6(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!IR(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!yP(t.startAt,e.startAt)&&yP(t.endAt,e.endAt)}function Zb(t){return an.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,n=null,r=[],o=[],h=null,f="F",l=null,S=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=o,this.limit=h,this.limitType=f,this.startAt=l,this.endAt=S,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function nV(t,e,n,r,o,h,f,l){return new Rp(t,e,n,r,o,h,f,l)}function AR(t){return new Rp(t)}function xP(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function kR(t){return t.collectionGroup!==null}function tg(t){const e=Sn(t);if(e.ce===null){e.ce=[];const n=new Set;for(const h of e.explicitOrderBy)e.ce.push(h),n.add(h.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let l=new ns(As.comparator);return f.filters.forEach(S=>{S.getFlattenedFilters().forEach(A=>{A.isInequality()&&(l=l.add(A.field))})}),l})(e).forEach(h=>{n.has(h.canonicalString())||h.isKeyField()||e.ce.push(new Lg(h,r))}),n.has(As.keyField().canonicalString())||e.ce.push(new Lg(As.keyField(),r))}return e.ce}function mu(t){const e=Sn(t);return e.le||(e.le=iV(e,tg(t))),e.le}function iV(t,e){if(t.limitType==="F")return vP(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(o=>{const h=o.dir==="desc"?"asc":"desc";return new Lg(o.field,h)});const n=t.endAt?new Sv(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Sv(t.startAt.position,t.startAt.inclusive):null;return vP(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Wb(t,e){const n=t.filters.concat([e]);return new Rp(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ev(t,e,n){return new Rp(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function x0(t,e){return AT(mu(t),mu(e))&&t.limitType===e.limitType}function MR(t){return`${CT(mu(t))}|lt:${t.limitType}`}function If(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(o=>PR(o)).join(", ")}]`),y0(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(o=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(o)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(o=>gp(o)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(o=>gp(o)).join(",")),`Target(${r})`}(mu(t))}; limitType=${t.limitType})`}function w0(t,e){return e.isFoundDocument()&&function(r,o){const h=o.key.path;return r.collectionGroup!==null?o.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(h):an.isDocumentKey(r.path)?r.path.isEqual(h):r.path.isImmediateParentOf(h)}(t,e)&&function(r,o){for(const h of tg(r))if(!h.field.isKeyField()&&o.data.field(h.field)===null)return!1;return!0}(t,e)&&function(r,o){for(const h of r.filters)if(!h.matches(o))return!1;return!0}(t,e)&&function(r,o){return!(r.startAt&&!function(f,l,S){const A=_P(f,l,S);return f.inclusive?A<=0:A<0}(r.startAt,tg(r),o)||r.endAt&&!function(f,l,S){const A=_P(f,l,S);return f.inclusive?A>=0:A>0}(r.endAt,tg(r),o))}(t,e)}function rV(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function RR(t){return(e,n)=>{let r=!1;for(const o of tg(t)){const h=sV(o,e,n);if(h!==0)return h;r=r||o.field.isKeyField()}return 0}}function sV(t,e,n){const r=t.field.isKeyField()?an.comparator(e.key,n.key):function(h,f,l){const S=f.data.field(h),A=l.data.field(h);return S!==null&&A!==null?mp(S,A):mn()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return mn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[o,h]of r)if(this.equalsFn(o,e))return h}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),o=this.inner[r];if(o===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let h=0;h<o.length;h++)if(this.equalsFn(o[h][0],e))return void(o[h]=[e,n]);o.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return r.length===1?delete this.inner[n]:r.splice(o,1),this.innerSize--,!0;return!1}forEach(e){Fd(this.inner,(n,r)=>{for(const[o,h]of r)e(o,h)})}isEmpty(){return xR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oV=new cr(an.comparator);function pc(){return oV}const LR=new cr(an.comparator);function jm(...t){let e=LR;for(const n of t)e=e.insert(n.key,n);return e}function DR(t){let e=LR;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function cd(){return ng()}function zR(){return ng()}function ng(){return new Bd(t=>t.toString(),(t,e)=>t.isEqual(e))}const aV=new cr(an.comparator),lV=new ns(an.comparator);function $n(...t){let e=lV;for(const n of t)e=e.add(n);return e}const uV=new ns(Gn);function cV(){return uV}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kT(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Tv(e)?"-0":e}}function NR(t){return{integerValue:""+t}}function hV(t,e){return B6(e)?NR(e):kT(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(){this._=void 0}}function dV(t,e,n){return t instanceof Dg?function(o,h){const f={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return h&&IT(h)&&(h=v0(h)),h&&(f.fields.__previous_value__=h),{mapValue:f}}(n,e):t instanceof zg?FR(t,e):t instanceof Ng?BR(t,e):function(o,h){const f=OR(o,h),l=wP(f)+wP(o.Pe);return Hb(f)&&Hb(o.Pe)?NR(l):kT(o.serializer,l)}(t,e)}function fV(t,e,n){return t instanceof zg?FR(t,e):t instanceof Ng?BR(t,e):n}function OR(t,e){return t instanceof Iv?function(r){return Hb(r)||function(h){return!!h&&"doubleValue"in h}(r)}(e)?e:{integerValue:0}:null}class Dg extends b0{}class zg extends b0{constructor(e){super(),this.elements=e}}function FR(t,e){const n=VR(e);for(const r of t.elements)n.some(o=>Su(o,r))||n.push(r);return{arrayValue:{values:n}}}class Ng extends b0{constructor(e){super(),this.elements=e}}function BR(t,e){let n=VR(e);for(const r of t.elements)n=n.filter(o=>!Su(o,r));return{arrayValue:{values:n}}}class Iv extends b0{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function wP(t){return Tr(t.integerValue||t.doubleValue)}function VR(t){return PT(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pV{constructor(e,n){this.field=e,this.transform=n}}function mV(t,e){return t.field.isEqual(e.field)&&function(r,o){return r instanceof zg&&o instanceof zg||r instanceof Ng&&o instanceof Ng?pp(r.elements,o.elements,Su):r instanceof Iv&&o instanceof Iv?Su(r.Pe,o.Pe):r instanceof Dg&&o instanceof Dg}(t.transform,e.transform)}class gV{constructor(e,n){this.version=e,this.transformResults=n}}class rc{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new rc}static exists(e){return new rc(void 0,e)}static updateTime(e){return new rc(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Fy(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class T0{}function jR(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new $R(t.key,rc.none()):new Jg(t.key,t.data,rc.none());{const n=t.data,r=Ua.empty();let o=new ns(As.comparator);for(let h of e.fields)if(!o.has(h)){let f=n.field(h);f===null&&h.length>1&&(h=h.popLast(),f=n.field(h)),f===null?r.delete(h):r.set(h,f),o=o.add(h)}return new Vd(t.key,r,new Rl(o.toArray()),rc.none())}}function _V(t,e,n){t instanceof Jg?function(o,h,f){const l=o.value.clone(),S=TP(o.fieldTransforms,h,f.transformResults);l.setAll(S),h.convertToFoundDocument(f.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Vd?function(o,h,f){if(!Fy(o.precondition,h))return void h.convertToUnknownDocument(f.version);const l=TP(o.fieldTransforms,h,f.transformResults),S=h.data;S.setAll(UR(o)),S.setAll(l),h.convertToFoundDocument(f.version,S).setHasCommittedMutations()}(t,e,n):function(o,h,f){h.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,n)}function ig(t,e,n,r){return t instanceof Jg?function(h,f,l,S){if(!Fy(h.precondition,f))return l;const A=h.value.clone(),O=SP(h.fieldTransforms,S,f);return A.setAll(O),f.convertToFoundDocument(f.version,A).setHasLocalMutations(),null}(t,e,n,r):t instanceof Vd?function(h,f,l,S){if(!Fy(h.precondition,f))return l;const A=SP(h.fieldTransforms,S,f),O=f.data;return O.setAll(UR(h)),O.setAll(A),f.convertToFoundDocument(f.version,O).setHasLocalMutations(),l===null?null:l.unionWith(h.fieldMask.fields).unionWith(h.fieldTransforms.map(U=>U.field))}(t,e,n,r):function(h,f,l){return Fy(h.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):l}(t,e,n)}function yV(t,e){let n=null;for(const r of t.fieldTransforms){const o=e.data.field(r.field),h=OR(r.transform,o||null);h!=null&&(n===null&&(n=Ua.empty()),n.set(r.field,h))}return n||null}function bP(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,o){return r===void 0&&o===void 0||!(!r||!o)&&pp(r,o,(h,f)=>mV(h,f))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Jg extends T0{constructor(e,n,r,o=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=o,this.type=0}getFieldMask(){return null}}class Vd extends T0{constructor(e,n,r,o,h=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=o,this.fieldTransforms=h,this.type=1}getFieldMask(){return this.fieldMask}}function UR(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function TP(t,e,n){const r=new Map;yi(t.length===n.length);for(let o=0;o<n.length;o++){const h=t[o],f=h.transform,l=e.data.field(h.field);r.set(h.field,fV(f,l,n[o]))}return r}function SP(t,e,n){const r=new Map;for(const o of t){const h=o.transform,f=n.data.field(o.field);r.set(o.field,dV(h,f,e))}return r}class $R extends T0{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vV extends T0{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e,n,r,o){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=o}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let o=0;o<this.mutations.length;o++){const h=this.mutations[o];h.key.isEqual(e.key)&&_V(h,e,r[o])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=ig(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=ig(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=zR();return this.mutations.forEach(o=>{const h=e.get(o.key),f=h.overlayedDocument;let l=this.applyToLocalView(f,h.mutatedFields);l=n.has(o.key)?null:l;const S=jR(f,l);S!==null&&r.set(o.key,S),f.isValidDocument()||f.convertToNoDocument(Tn.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),$n())}isEqual(e){return this.batchId===e.batchId&&pp(this.mutations,e.mutations,(n,r)=>bP(n,r))&&pp(this.baseMutations,e.baseMutations,(n,r)=>bP(n,r))}}class MT{constructor(e,n,r,o){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=o}static from(e,n,r){yi(e.mutations.length===r.length);let o=function(){return aV}();const h=e.mutations;for(let f=0;f<h.length;f++)o=o.insert(h[f].key,r[f].version);return new MT(e,n,r,o)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zr,Xn;function TV(t){switch(t){default:return mn();case mt.CANCELLED:case mt.UNKNOWN:case mt.DEADLINE_EXCEEDED:case mt.RESOURCE_EXHAUSTED:case mt.INTERNAL:case mt.UNAVAILABLE:case mt.UNAUTHENTICATED:return!1;case mt.INVALID_ARGUMENT:case mt.NOT_FOUND:case mt.ALREADY_EXISTS:case mt.PERMISSION_DENIED:case mt.FAILED_PRECONDITION:case mt.ABORTED:case mt.OUT_OF_RANGE:case mt.UNIMPLEMENTED:case mt.DATA_LOSS:return!0}}function qR(t){if(t===void 0)return fc("GRPC error has no .code"),mt.UNKNOWN;switch(t){case zr.OK:return mt.OK;case zr.CANCELLED:return mt.CANCELLED;case zr.UNKNOWN:return mt.UNKNOWN;case zr.DEADLINE_EXCEEDED:return mt.DEADLINE_EXCEEDED;case zr.RESOURCE_EXHAUSTED:return mt.RESOURCE_EXHAUSTED;case zr.INTERNAL:return mt.INTERNAL;case zr.UNAVAILABLE:return mt.UNAVAILABLE;case zr.UNAUTHENTICATED:return mt.UNAUTHENTICATED;case zr.INVALID_ARGUMENT:return mt.INVALID_ARGUMENT;case zr.NOT_FOUND:return mt.NOT_FOUND;case zr.ALREADY_EXISTS:return mt.ALREADY_EXISTS;case zr.PERMISSION_DENIED:return mt.PERMISSION_DENIED;case zr.FAILED_PRECONDITION:return mt.FAILED_PRECONDITION;case zr.ABORTED:return mt.ABORTED;case zr.OUT_OF_RANGE:return mt.OUT_OF_RANGE;case zr.UNIMPLEMENTED:return mt.UNIMPLEMENTED;case zr.DATA_LOSS:return mt.DATA_LOSS;default:return mn()}}(Xn=zr||(zr={}))[Xn.OK=0]="OK",Xn[Xn.CANCELLED=1]="CANCELLED",Xn[Xn.UNKNOWN=2]="UNKNOWN",Xn[Xn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xn[Xn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xn[Xn.NOT_FOUND=5]="NOT_FOUND",Xn[Xn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xn[Xn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xn[Xn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xn[Xn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xn[Xn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xn[Xn.ABORTED=10]="ABORTED",Xn[Xn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xn[Xn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xn[Xn.INTERNAL=13]="INTERNAL",Xn[Xn.UNAVAILABLE=14]="UNAVAILABLE",Xn[Xn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SV(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV=new fh([4294967295,4294967295],0);function EP(t){const e=SV().encode(t),n=new dR;return n.update(e),new Uint8Array(n.digest())}function IP(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),o=e.getUint32(8,!0),h=e.getUint32(12,!0);return[new fh([n,r],0),new fh([o,h],0)]}class RT{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Um(`Invalid padding: ${n}`);if(r<0)throw new Um(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Um(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Um(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ie=fh.fromNumber(this.Te)}de(e,n,r){let o=e.add(n.multiply(fh.fromNumber(r)));return o.compare(EV)===1&&(o=new fh([o.getBits(0),o.getBits(1)],0)),o.modulo(this.Ie).toNumber()}Ee(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const n=EP(e),[r,o]=IP(n);for(let h=0;h<this.hashCount;h++){const f=this.de(r,o,h);if(!this.Ee(f))return!1}return!0}static create(e,n,r){const o=e%8==0?0:8-e%8,h=new Uint8Array(Math.ceil(e/8)),f=new RT(h,o,n);return r.forEach(l=>f.insert(l)),f}insert(e){if(this.Te===0)return;const n=EP(e),[r,o]=IP(n);for(let h=0;h<this.hashCount;h++){const f=this.de(r,o,h);this.Ae(f)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Um extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e,n,r,o,h){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=o,this.resolvedLimboDocuments=h}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const o=new Map;return o.set(e,e_.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new S0(Tn.min(),o,new cr(Gn),pc(),$n())}}class e_{constructor(e,n,r,o,h){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=o,this.removedDocuments=h}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new e_(r,n,$n(),$n(),$n())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e,n,r,o){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=o}}class HR{constructor(e,n){this.targetId=e,this.me=n}}class GR{constructor(e,n,r=Rs.EMPTY_BYTE_STRING,o=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=o}}class PP{constructor(){this.fe=0,this.ge=CP(),this.pe=Rs.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=$n(),n=$n(),r=$n();return this.ge.forEach((o,h)=>{switch(h){case 0:e=e.add(o);break;case 2:n=n.add(o);break;case 1:r=r.add(o);break;default:mn()}}),new e_(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=CP()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,yi(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class IV{constructor(e){this.Be=e,this.Le=new Map,this.ke=pc(),this.qe=dy(),this.Qe=dy(),this.Ke=new cr(Gn)}$e(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(n,e.Ve):this.We(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.We(n,e.key,e.Ve)}Ge(e){this.forEachTarget(e,n=>{const r=this.ze(n);switch(e.state){case 0:this.je(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.je(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.De(e.resumeToken));break;default:mn()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Le.forEach((r,o)=>{this.je(o)&&n(o)})}Je(e){const n=e.targetId,r=e.me.count,o=this.Ye(n);if(o){const h=o.target;if(Zb(h))if(r===0){const f=new an(h.path);this.We(n,f,Qs.newNoDocument(f,Tn.min()))}else yi(r===1);else{const f=this.Ze(n);if(f!==r){const l=this.Xe(e),S=l?this.et(l,e,f):1;if(S!==0){this.He(n);const A=S===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,A)}}}}}Xe(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:o=0},hashCount:h=0}=n;let f,l;try{f=xh(r).toUint8Array()}catch(S){if(S instanceof wR)return fp("Decoding the base64 bloom filter in existence filter failed ("+S.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw S}try{l=new RT(f,o,h)}catch(S){return fp(S instanceof Um?"BloomFilter error: ":"Applying bloom filter failed: ",S),null}return l.Te===0?null:l}et(e,n,r){return n.me.count===r-this.rt(e,n.targetId)?0:2}rt(e,n){const r=this.Be.getRemoteKeysForTarget(n);let o=0;return r.forEach(h=>{const f=this.Be.nt(),l=`projects/${f.projectId}/databases/${f.database}/documents/${h.path.canonicalString()}`;e.mightContain(l)||(this.We(n,h,null),o++)}),o}it(e){const n=new Map;this.Le.forEach((h,f)=>{const l=this.Ye(f);if(l){if(h.current&&Zb(l.target)){const S=new an(l.target.path);this.st(S).has(f)||this.ot(f,S)||this.We(f,S,Qs.newNoDocument(S,e))}h.be&&(n.set(f,h.ve()),h.Ce())}});let r=$n();this.Qe.forEach((h,f)=>{let l=!0;f.forEachWhile(S=>{const A=this.Ye(S);return!A||A.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(h))}),this.ke.forEach((h,f)=>f.setReadTime(e));const o=new S0(e,n,this.Ke,this.ke,r);return this.ke=pc(),this.qe=dy(),this.Qe=dy(),this.Ke=new cr(Gn),o}Ue(e,n){if(!this.je(e))return;const r=this.ot(e,n.key)?2:0;this.ze(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e)),this.Qe=this.Qe.insert(n.key,this._t(n.key).add(e))}We(e,n,r){if(!this.je(e))return;const o=this.ze(e);this.ot(e,n)?o.Fe(n,1):o.Me(n),this.Qe=this.Qe.insert(n,this._t(n).delete(e)),this.Qe=this.Qe.insert(n,this._t(n).add(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Le.delete(e)}Ze(e){const n=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let n=this.Le.get(e);return n||(n=new PP,this.Le.set(e,n)),n}_t(e){let n=this.Qe.get(e);return n||(n=new ns(Gn),this.Qe=this.Qe.insert(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new ns(Gn),this.qe=this.qe.insert(e,n)),n}je(e){const n=this.Ye(e)!==null;return n||Ft("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){const n=this.Le.get(e);return n&&n.Se?null:this.Be.ut(e)}He(e){this.Le.set(e,new PP),this.Be.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}ot(e,n){return this.Be.getRemoteKeysForTarget(e).has(n)}}function dy(){return new cr(an.comparator)}function CP(){return new cr(an.comparator)}const PV={asc:"ASCENDING",desc:"DESCENDING"},CV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},AV={and:"AND",or:"OR"};class kV{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Kb(t,e){return t.useProto3Json||y0(e)?e:{value:e}}function Pv(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ZR(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function MV(t,e){return Pv(t,e.toTimestamp())}function gu(t){return yi(!!t),Tn.fromTimestamp(function(n){const r=vh(n);return new ts(r.seconds,r.nanos)}(t))}function LT(t,e){return Xb(t,e).canonicalString()}function Xb(t,e){const n=function(o){return new Wi(["projects",o.projectId,"databases",o.database])}(t).child("documents");return e===void 0?n:n.child(e)}function WR(t){const e=Wi.fromString(t);return yi(JR(e)),e}function Yb(t,e){return LT(t.databaseId,e.path)}function Tw(t,e){const n=WR(e);if(n.get(1)!==t.databaseId.projectId)throw new Ut(mt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ut(mt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new an(XR(n))}function KR(t,e){return LT(t.databaseId,e)}function RV(t){const e=WR(t);return e.length===4?Wi.emptyPath():XR(e)}function Qb(t){return new Wi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function XR(t){return yi(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function AP(t,e,n){return{name:Yb(t,e),fields:n.value.mapValue.fields}}function LV(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(A){return A==="NO_CHANGE"?0:A==="ADD"?1:A==="REMOVE"?2:A==="CURRENT"?3:A==="RESET"?4:mn()}(e.targetChange.targetChangeType||"NO_CHANGE"),o=e.targetChange.targetIds||[],h=function(A,O){return A.useProto3Json?(yi(O===void 0||typeof O=="string"),Rs.fromBase64String(O||"")):(yi(O===void 0||O instanceof Buffer||O instanceof Uint8Array),Rs.fromUint8Array(O||new Uint8Array))}(t,e.targetChange.resumeToken),f=e.targetChange.cause,l=f&&function(A){const O=A.code===void 0?mt.UNKNOWN:qR(A.code);return new Ut(O,A.message||"")}(f);n=new GR(r,o,h,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const o=Tw(t,r.document.name),h=gu(r.document.updateTime),f=r.document.createTime?gu(r.document.createTime):Tn.min(),l=new Ua({mapValue:{fields:r.document.fields}}),S=Qs.newFoundDocument(o,h,f,l),A=r.targetIds||[],O=r.removedTargetIds||[];n=new By(A,O,S.key,S)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const o=Tw(t,r.document),h=r.readTime?gu(r.readTime):Tn.min(),f=Qs.newNoDocument(o,h),l=r.removedTargetIds||[];n=new By([],l,f.key,f)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const o=Tw(t,r.document),h=r.removedTargetIds||[];n=new By([],h,o,null)}else{if(!("filter"in e))return mn();{e.filter;const r=e.filter;r.targetId;const{count:o=0,unchangedNames:h}=r,f=new bV(o,h),l=r.targetId;n=new HR(l,f)}}return n}function DV(t,e){let n;if(e instanceof Jg)n={update:AP(t,e.key,e.value)};else if(e instanceof $R)n={delete:Yb(t,e.key)};else if(e instanceof Vd)n={update:AP(t,e.key,e.data),updateMask:$V(e.fieldMask)};else{if(!(e instanceof vV))return mn();n={verify:Yb(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(h,f){const l=f.transform;if(l instanceof Dg)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof zg)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ng)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Iv)return{fieldPath:f.field.canonicalString(),increment:l.Pe};throw mn()}(0,r))),e.precondition.isNone||(n.currentDocument=function(o,h){return h.updateTime!==void 0?{updateTime:MV(o,h.updateTime)}:h.exists!==void 0?{exists:h.exists}:mn()}(t,e.precondition)),n}function zV(t,e){return t&&t.length>0?(yi(e!==void 0),t.map(n=>function(o,h){let f=o.updateTime?gu(o.updateTime):gu(h);return f.isEqual(Tn.min())&&(f=gu(h)),new gV(f,o.transformResults||[])}(n,e))):[]}function NV(t,e){return{documents:[KR(t,e.path)]}}function OV(t,e){const n={structuredQuery:{}},r=e.path;let o;e.collectionGroup!==null?(o=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(o=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=KR(t,o);const h=function(A){if(A.length!==0)return QR(Bl.create(A,"and"))}(e.filters);h&&(n.structuredQuery.where=h);const f=function(A){if(A.length!==0)return A.map(O=>function(H){return{field:Pf(H.field),direction:VV(H.dir)}}(O))}(e.orderBy);f&&(n.structuredQuery.orderBy=f);const l=Kb(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(A){return{before:A.inclusive,values:A.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(A){return{before:!A.inclusive,values:A.position}}(e.endAt)),{ct:n,parent:o}}function FV(t){let e=RV(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let o=null;if(r>0){yi(r===1);const O=n.from[0];O.allDescendants?o=O.collectionId:e=e.child(O.collectionId)}let h=[];n.where&&(h=function(U){const H=YR(U);return H instanceof Bl&&ER(H)?H.getFilters():[H]}(n.where));let f=[];n.orderBy&&(f=function(U){return U.map(H=>function(ie){return new Lg(Cf(ie.field),function(Me){switch(Me){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(ie.direction))}(H))}(n.orderBy));let l=null;n.limit&&(l=function(U){let H;return H=typeof U=="object"?U.value:U,y0(H)?null:H}(n.limit));let S=null;n.startAt&&(S=function(U){const H=!!U.before,$=U.values||[];return new Sv($,H)}(n.startAt));let A=null;return n.endAt&&(A=function(U){const H=!U.before,$=U.values||[];return new Sv($,H)}(n.endAt)),nV(e,o,f,h,l,"F",S,A)}function BV(t,e){const n=function(o){switch(o){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return mn()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function YR(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Cf(n.unaryFilter.field);return Or.create(r,"==",{doubleValue:NaN});case"IS_NULL":const o=Cf(n.unaryFilter.field);return Or.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const h=Cf(n.unaryFilter.field);return Or.create(h,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=Cf(n.unaryFilter.field);return Or.create(f,"!=",{nullValue:"NULL_VALUE"});default:return mn()}}(t):t.fieldFilter!==void 0?function(n){return Or.create(Cf(n.fieldFilter.field),function(o){switch(o){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return mn()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Bl.create(n.compositeFilter.filters.map(r=>YR(r)),function(o){switch(o){case"AND":return"and";case"OR":return"or";default:return mn()}}(n.compositeFilter.op))}(t):mn()}function VV(t){return PV[t]}function jV(t){return CV[t]}function UV(t){return AV[t]}function Pf(t){return{fieldPath:t.canonicalString()}}function Cf(t){return As.fromServerFormat(t.fieldPath)}function QR(t){return t instanceof Or?function(n){if(n.op==="=="){if(gP(n.value))return{unaryFilter:{field:Pf(n.field),op:"IS_NAN"}};if(mP(n.value))return{unaryFilter:{field:Pf(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(gP(n.value))return{unaryFilter:{field:Pf(n.field),op:"IS_NOT_NAN"}};if(mP(n.value))return{unaryFilter:{field:Pf(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Pf(n.field),op:jV(n.op),value:n.value}}}(t):t instanceof Bl?function(n){const r=n.getFilters().map(o=>QR(o));return r.length===1?r[0]:{compositeFilter:{op:UV(n.op),filters:r}}}(t):mn()}function $V(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function JR(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e,n,r,o,h=Tn.min(),f=Tn.min(),l=Rs.EMPTY_BYTE_STRING,S=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=o,this.snapshotVersion=h,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=l,this.expectedCount=S}withSequenceNumber(e){return new th(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new th(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new th(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new th(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qV{constructor(e){this.ht=e}}function HV(t){const e=FV({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ev(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GV{constructor(){this.ln=new ZV}addToCollectionParentIndex(e,n){return this.ln.add(n),ft.resolve()}getCollectionParents(e,n){return ft.resolve(this.ln.getEntries(n))}addFieldIndex(e,n){return ft.resolve()}deleteFieldIndex(e,n){return ft.resolve()}deleteAllFieldIndexes(e){return ft.resolve()}createTargetIndexes(e,n){return ft.resolve()}getDocumentsMatchingTarget(e,n){return ft.resolve(null)}getIndexType(e,n){return ft.resolve(0)}getFieldIndexes(e,n){return ft.resolve([])}getNextCollectionGroupToUpdate(e){return ft.resolve(null)}getMinOffset(e,n){return ft.resolve(yh.min())}getMinOffsetFromCollectionGroup(e,n){return ft.resolve(yh.min())}updateCollectionGroup(e,n,r){return ft.resolve()}updateIndexEntries(e,n){return ft.resolve()}}class ZV{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),o=this.index[n]||new ns(Wi.comparator),h=!o.has(r);return this.index[n]=o.add(r),h}has(e){const n=e.lastSegment(),r=e.popLast(),o=this.index[n];return o&&o.has(r)}getEntries(e){return(this.index[e]||new ns(Wi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Uo{static withCacheSize(e){return new Uo(e,Uo.DEFAULT_COLLECTION_PERCENTILE,Uo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Uo.DEFAULT_COLLECTION_PERCENTILE=10,Uo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Uo.DEFAULT=new Uo(41943040,Uo.DEFAULT_COLLECTION_PERCENTILE,Uo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Uo.DISABLED=new Uo(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new _p(0)}static Qn(){return new _p(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MP([t,e],[n,r]){const o=Gn(t,n);return o===0?Gn(e,r):o}class WV{constructor(e){this.Gn=e,this.buffer=new ns(MP),this.zn=0}jn(){return++this.zn}Hn(e){const n=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();MP(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class KV{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){Ft("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Mp(n)?Ft("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await kp(n)}await this.Yn(3e5)})}}class XV{constructor(e,n){this.Zn=e,this.params=n}calculateTargetCount(e,n){return this.Zn.Xn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ft.resolve(_0.oe);const r=new WV(n);return this.Zn.forEachTarget(e,o=>r.Hn(o.sequenceNumber)).next(()=>this.Zn.er(e,o=>r.Hn(o))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Zn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Zn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ft("LruGarbageCollector","Garbage collection skipped; disabled"),ft.resolve(kP)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Ft("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kP):this.tr(e,n))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,n){let r,o,h,f,l,S,A;const O=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(U=>(U>this.params.maximumSequenceNumbersToCollect?(Ft("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${U}`),o=this.params.maximumSequenceNumbersToCollect):o=U,f=Date.now(),this.nthSequenceNumber(e,o))).next(U=>(r=U,l=Date.now(),this.removeTargets(e,r,n))).next(U=>(h=U,S=Date.now(),this.removeOrphanedDocuments(e,r))).next(U=>(A=Date.now(),Ef()<=Un.DEBUG&&Ft("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-O}ms
	Determined least recently used ${o} in `+(l-f)+`ms
	Removed ${h} targets in `+(S-l)+`ms
	Removed ${U} documents in `+(A-S)+`ms
Total Duration: ${A-O}ms`),ft.resolve({didRun:!0,sequenceNumbersCollected:o,targetsRemoved:h,documentsRemoved:U})))}}function YV(t,e){return new XV(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV{constructor(){this.changes=new Bd(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Qs.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ft.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e,n,r,o){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=o}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(o=>(r=o,this.remoteDocumentCache.getEntry(e,n))).next(o=>(r!==null&&ig(r.mutation,o,Rl.empty(),ts.now()),o))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,$n()).next(()=>r))}getLocalViewOfDocuments(e,n,r=$n()){const o=cd();return this.populateOverlays(e,o,n).next(()=>this.computeViews(e,n,o,r).next(h=>{let f=jm();return h.forEach((l,S)=>{f=f.insert(l,S.overlayedDocument)}),f}))}getOverlayedDocuments(e,n){const r=cd();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,$n()))}populateOverlays(e,n,r){const o=[];return r.forEach(h=>{n.has(h)||o.push(h)}),this.documentOverlayCache.getOverlays(e,o).next(h=>{h.forEach((f,l)=>{n.set(f,l)})})}computeViews(e,n,r,o){let h=pc();const f=ng(),l=function(){return ng()}();return n.forEach((S,A)=>{const O=r.get(A.key);o.has(A.key)&&(O===void 0||O.mutation instanceof Vd)?h=h.insert(A.key,A):O!==void 0?(f.set(A.key,O.mutation.getFieldMask()),ig(O.mutation,A,O.mutation.getFieldMask(),ts.now())):f.set(A.key,Rl.empty())}),this.recalculateAndSaveOverlays(e,h).next(S=>(S.forEach((A,O)=>f.set(A,O)),n.forEach((A,O)=>{var U;return l.set(A,new JV(O,(U=f.get(A))!==null&&U!==void 0?U:null))}),l))}recalculateAndSaveOverlays(e,n){const r=ng();let o=new cr((f,l)=>f-l),h=$n();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(f=>{for(const l of f)l.keys().forEach(S=>{const A=n.get(S);if(A===null)return;let O=r.get(S)||Rl.empty();O=l.applyToLocalView(A,O),r.set(S,O);const U=(o.get(l.batchId)||$n()).add(S);o=o.insert(l.batchId,U)})}).next(()=>{const f=[],l=o.getReverseIterator();for(;l.hasNext();){const S=l.getNext(),A=S.key,O=S.value,U=zR();O.forEach(H=>{if(!h.has(H)){const $=jR(n.get(H),r.get(H));$!==null&&U.set(H,$),h=h.add(H)}}),f.push(this.documentOverlayCache.saveOverlays(e,A,U))}return ft.waitFor(f)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,o){return function(f){return an.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):kR(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,o):this.getDocumentsMatchingCollectionQuery(e,n,r,o)}getNextDocuments(e,n,r,o){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,o).next(h=>{const f=o-h.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,o-h.size):ft.resolve(cd());let l=-1,S=h;return f.next(A=>ft.forEach(A,(O,U)=>(l<U.largestBatchId&&(l=U.largestBatchId),h.get(O)?ft.resolve():this.remoteDocumentCache.getEntry(e,O).next(H=>{S=S.insert(O,H)}))).next(()=>this.populateOverlays(e,A,h)).next(()=>this.computeViews(e,S,A,$n())).next(O=>({batchId:l,changes:DR(O)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new an(n)).next(r=>{let o=jm();return r.isFoundDocument()&&(o=o.insert(r.key,r)),o})}getDocumentsMatchingCollectionGroupQuery(e,n,r,o){const h=n.collectionGroup;let f=jm();return this.indexManager.getCollectionParents(e,h).next(l=>ft.forEach(l,S=>{const A=function(U,H){return new Rp(H,null,U.explicitOrderBy.slice(),U.filters.slice(),U.limit,U.limitType,U.startAt,U.endAt)}(n,S.child(h));return this.getDocumentsMatchingCollectionQuery(e,A,r,o).next(O=>{O.forEach((U,H)=>{f=f.insert(U,H)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,n,r,o){let h;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(f=>(h=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,h,o))).next(f=>{h.forEach((S,A)=>{const O=A.getKey();f.get(O)===null&&(f=f.insert(O,Qs.newInvalidDocument(O)))});let l=jm();return f.forEach((S,A)=>{const O=h.get(S);O!==void 0&&ig(O.mutation,A,Rl.empty(),ts.now()),w0(n,A)&&(l=l.insert(S,A))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,n){return ft.resolve(this.Tr.get(n))}saveBundleMetadata(e,n){return this.Tr.set(n.id,function(o){return{id:o.id,version:o.version,createTime:gu(o.createTime)}}(n)),ft.resolve()}getNamedQuery(e,n){return ft.resolve(this.Ir.get(n))}saveNamedQuery(e,n){return this.Ir.set(n.name,function(o){return{name:o.name,query:HV(o.bundledQuery),readTime:gu(o.readTime)}}(n)),ft.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(){this.overlays=new cr(an.comparator),this.dr=new Map}getOverlay(e,n){return ft.resolve(this.overlays.get(n))}getOverlays(e,n){const r=cd();return ft.forEach(n,o=>this.getOverlay(e,o).next(h=>{h!==null&&r.set(o,h)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((o,h)=>{this.Tt(e,n,h)}),ft.resolve()}removeOverlaysForBatchId(e,n,r){const o=this.dr.get(r);return o!==void 0&&(o.forEach(h=>this.overlays=this.overlays.remove(h)),this.dr.delete(r)),ft.resolve()}getOverlaysForCollection(e,n,r){const o=cd(),h=n.length+1,f=new an(n.child("")),l=this.overlays.getIteratorFrom(f);for(;l.hasNext();){const S=l.getNext().value,A=S.getKey();if(!n.isPrefixOf(A.path))break;A.path.length===h&&S.largestBatchId>r&&o.set(S.getKey(),S)}return ft.resolve(o)}getOverlaysForCollectionGroup(e,n,r,o){let h=new cr((A,O)=>A-O);const f=this.overlays.getIterator();for(;f.hasNext();){const A=f.getNext().value;if(A.getKey().getCollectionGroup()===n&&A.largestBatchId>r){let O=h.get(A.largestBatchId);O===null&&(O=cd(),h=h.insert(A.largestBatchId,O)),O.set(A.getKey(),A)}}const l=cd(),S=h.getIterator();for(;S.hasNext()&&(S.getNext().value.forEach((A,O)=>l.set(A,O)),!(l.size()>=o)););return ft.resolve(l)}Tt(e,n,r){const o=this.overlays.get(r.key);if(o!==null){const f=this.dr.get(o.largestBatchId).delete(r.key);this.dr.set(o.largestBatchId,f)}this.overlays=this.overlays.insert(r.key,new wV(n,r));let h=this.dr.get(n);h===void 0&&(h=$n(),this.dr.set(n,h)),this.dr.set(n,h.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{constructor(){this.sessionToken=Rs.EMPTY_BYTE_STRING}getSessionToken(e){return ft.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ft.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(){this.Er=new ns(as.Ar),this.Rr=new ns(as.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(e,n){const r=new as(e,n);this.Er=this.Er.add(r),this.Rr=this.Rr.add(r)}mr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.gr(new as(e,n))}pr(e,n){e.forEach(r=>this.removeReference(r,n))}yr(e){const n=new an(new Wi([])),r=new as(n,e),o=new as(n,e+1),h=[];return this.Rr.forEachInRange([r,o],f=>{this.gr(f),h.push(f.key)}),h}wr(){this.Er.forEach(e=>this.gr(e))}gr(e){this.Er=this.Er.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const n=new an(new Wi([])),r=new as(n,e),o=new as(n,e+1);let h=$n();return this.Rr.forEachInRange([r,o],f=>{h=h.add(f.key)}),h}containsKey(e){const n=new as(e,0),r=this.Er.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class as{constructor(e,n){this.key=e,this.br=n}static Ar(e,n){return an.comparator(e.key,n.key)||Gn(e.br,n.br)}static Vr(e,n){return Gn(e.br,n.br)||an.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Dr=1,this.vr=new ns(as.Ar)}checkEmpty(e){return ft.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,o){const h=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new xV(h,n,r,o);this.mutationQueue.push(f);for(const l of o)this.vr=this.vr.add(new as(l.key,h)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ft.resolve(f)}lookupMutationBatch(e,n){return ft.resolve(this.Cr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,o=this.Fr(r),h=o<0?0:o;return ft.resolve(this.mutationQueue.length>h?this.mutationQueue[h]:null)}getHighestUnacknowledgedBatchId(){return ft.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return ft.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new as(n,0),o=new as(n,Number.POSITIVE_INFINITY),h=[];return this.vr.forEachInRange([r,o],f=>{const l=this.Cr(f.br);h.push(l)}),ft.resolve(h)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ns(Gn);return n.forEach(o=>{const h=new as(o,0),f=new as(o,Number.POSITIVE_INFINITY);this.vr.forEachInRange([h,f],l=>{r=r.add(l.br)})}),ft.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,o=r.length+1;let h=r;an.isDocumentKey(h)||(h=h.child(""));const f=new as(new an(h),0);let l=new ns(Gn);return this.vr.forEachWhile(S=>{const A=S.key.path;return!!r.isPrefixOf(A)&&(A.length===o&&(l=l.add(S.br)),!0)},f),ft.resolve(this.Mr(l))}Mr(e){const n=[];return e.forEach(r=>{const o=this.Cr(r);o!==null&&n.push(o)}),n}removeMutationBatch(e,n){yi(this.Or(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return ft.forEach(n.mutations,o=>{const h=new as(o.key,n.batchId);return r=r.delete(h),this.referenceDelegate.markPotentiallyOrphaned(e,o.key)}).next(()=>{this.vr=r})}Bn(e){}containsKey(e,n){const r=new as(n,0),o=this.vr.firstAfterOrEqual(r);return ft.resolve(n.isEqual(o&&o.key))}performConsistencyCheck(e){return this.mutationQueue.length,ft.resolve()}Or(e,n){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){const n=this.Fr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e){this.Nr=e,this.docs=function(){return new cr(an.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,o=this.docs.get(r),h=o?o.size:0,f=this.Nr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:f}),this.size+=f-h,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ft.resolve(r?r.document.mutableCopy():Qs.newInvalidDocument(n))}getEntries(e,n){let r=pc();return n.forEach(o=>{const h=this.docs.get(o);r=r.insert(o,h?h.document.mutableCopy():Qs.newInvalidDocument(o))}),ft.resolve(r)}getDocumentsMatchingQuery(e,n,r,o){let h=pc();const f=n.path,l=new an(f.child("__id-9223372036854775808__")),S=this.docs.getIteratorFrom(l);for(;S.hasNext();){const{key:A,value:{document:O}}=S.getNext();if(!f.isPrefixOf(A.path))break;A.path.length>f.length+1||z6(D6(O),r)<=0||(o.has(O.key)||w0(n,O))&&(h=h.insert(O.key,O.mutableCopy()))}return ft.resolve(h)}getAllFromCollectionGroup(e,n,r,o){mn()}Br(e,n){return ft.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new oj(this)}getSize(e){return ft.resolve(this.size)}}class oj extends QV{constructor(e){super(),this.hr=e}applyChanges(e){const n=[];return this.changes.forEach((r,o)=>{o.isValidDocument()?n.push(this.hr.addEntry(e,o)):this.hr.removeEntry(r)}),ft.waitFor(n)}getFromCache(e,n){return this.hr.getEntry(e,n)}getAllFromCache(e,n){return this.hr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(e){this.persistence=e,this.Lr=new Bd(n=>CT(n),AT),this.lastRemoteSnapshotVersion=Tn.min(),this.highestTargetId=0,this.kr=0,this.qr=new DT,this.targetCount=0,this.Qr=_p.qn()}forEachTarget(e,n){return this.Lr.forEach((r,o)=>n(o)),ft.resolve()}getLastRemoteSnapshotVersion(e){return ft.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ft.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),ft.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.kr&&(this.kr=n),ft.resolve()}Un(e){this.Lr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Qr=new _p(n),this.highestTargetId=n),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,n){return this.Un(n),this.targetCount+=1,ft.resolve()}updateTargetData(e,n){return this.Un(n),ft.resolve()}removeTargetData(e,n){return this.Lr.delete(n.target),this.qr.yr(n.targetId),this.targetCount-=1,ft.resolve()}removeTargets(e,n,r){let o=0;const h=[];return this.Lr.forEach((f,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.Lr.delete(f),h.push(this.removeMatchingKeysForTargetId(e,l.targetId)),o++)}),ft.waitFor(h).next(()=>o)}getTargetCount(e){return ft.resolve(this.targetCount)}getTargetData(e,n){const r=this.Lr.get(n)||null;return ft.resolve(r)}addMatchingKeys(e,n,r){return this.qr.mr(n,r),ft.resolve()}removeMatchingKeys(e,n,r){this.qr.pr(n,r);const o=this.persistence.referenceDelegate,h=[];return o&&n.forEach(f=>{h.push(o.markPotentiallyOrphaned(e,f))}),ft.waitFor(h)}removeMatchingKeysForTargetId(e,n){return this.qr.yr(n),ft.resolve()}getMatchingKeysForTargetId(e,n){const r=this.qr.Sr(n);return ft.resolve(r)}containsKey(e,n){return ft.resolve(this.qr.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(e,n){this.Kr={},this.overlays={},this.$r=new _0(0),this.Ur=!1,this.Ur=!0,this.Wr=new ij,this.referenceDelegate=e(this),this.Gr=new aj(this),this.indexManager=new GV,this.remoteDocumentCache=function(o){return new sj(o)}(r=>this.referenceDelegate.zr(r)),this.serializer=new qV(n),this.jr=new tj(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new nj,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Kr[e.toKey()];return r||(r=new rj(n,this.referenceDelegate),this.Kr[e.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,n,r){Ft("MemoryPersistence","Starting transaction:",e);const o=new lj(this.$r.next());return this.referenceDelegate.Hr(),r(o).next(h=>this.referenceDelegate.Jr(o).next(()=>h)).toPromise().then(h=>(o.raiseOnCommittedEvent(),h))}Yr(e,n){return ft.or(Object.values(this.Kr).map(r=>()=>r.containsKey(e,n)))}}class lj extends O6{constructor(e){super(),this.currentSequenceNumber=e}}class zT{constructor(e){this.persistence=e,this.Zr=new DT,this.Xr=null}static ei(e){return new zT(e)}get ti(){if(this.Xr)return this.Xr;throw mn()}addReference(e,n,r){return this.Zr.addReference(r,n),this.ti.delete(r.toString()),ft.resolve()}removeReference(e,n,r){return this.Zr.removeReference(r,n),this.ti.add(r.toString()),ft.resolve()}markPotentiallyOrphaned(e,n){return this.ti.add(n.toString()),ft.resolve()}removeTarget(e,n){this.Zr.yr(n.targetId).forEach(o=>this.ti.add(o.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(o=>{o.forEach(h=>this.ti.add(h.toString()))}).next(()=>r.removeTargetData(e,n))}Hr(){this.Xr=new Set}Jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ft.forEach(this.ti,r=>{const o=an.fromPath(r);return this.ni(e,o).next(h=>{h||n.removeEntry(o,Tn.min())})}).next(()=>(this.Xr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ni(e,n).next(r=>{r?this.ti.delete(n.toString()):this.ti.add(n.toString())})}zr(e){return 0}ni(e,n){return ft.or([()=>ft.resolve(this.Zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Yr(e,n)])}}class Cv{constructor(e,n){this.persistence=e,this.ri=new Bd(r=>V6(r.path),(r,o)=>r.isEqual(o)),this.garbageCollector=YV(this,n)}static ei(e,n){return new Cv(e,n)}Hr(){}Jr(e){return ft.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}Xn(e){const n=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(o=>r+o))}nr(e){let n=0;return this.er(e,r=>{n++}).next(()=>n)}er(e,n){return ft.forEach(this.ri,(r,o)=>this.ir(e,r,o).next(h=>h?ft.resolve():n(o)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const o=this.persistence.getRemoteDocumentCache(),h=o.newChangeBuffer();return o.Br(e,f=>this.ir(e,f,n).next(l=>{l||(r++,h.removeEntry(f,Tn.min()))})).next(()=>h.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.ri.set(n,e.currentSequenceNumber),ft.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.ri.set(r,e.currentSequenceNumber),ft.resolve()}removeReference(e,n,r){return this.ri.set(r,e.currentSequenceNumber),ft.resolve()}updateLimboDocument(e,n){return this.ri.set(n,e.currentSequenceNumber),ft.resolve()}zr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Ny(e.data.value)),n}ir(e,n,r){return ft.or([()=>this.persistence.Yr(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const o=this.ri.get(n);return ft.resolve(o!==void 0&&o>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NT{constructor(e,n,r,o){this.targetId=e,this.fromCache=n,this.Wi=r,this.Gi=o}static zi(e,n){let r=$n(),o=$n();for(const h of n.docChanges)switch(h.type){case 0:r=r.add(h.doc.key);break;case 1:o=o.add(h.doc.key)}return new NT(e,n.fromCache,r,o)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return iB()?8:F6(eo())>0?6:4}()}initialize(e,n){this.Zi=e,this.indexManager=n,this.ji=!0}getDocumentsMatchingQuery(e,n,r,o){const h={result:null};return this.Xi(e,n).next(f=>{h.result=f}).next(()=>{if(!h.result)return this.es(e,n,o,r).next(f=>{h.result=f})}).next(()=>{if(h.result)return;const f=new uj;return this.ts(e,n,f).next(l=>{if(h.result=l,this.Hi)return this.ns(e,n,f,l.size)})}).next(()=>h.result)}ns(e,n,r,o){return r.documentReadCount<this.Ji?(Ef()<=Un.DEBUG&&Ft("QueryEngine","SDK will not create cache indexes for query:",If(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),ft.resolve()):(Ef()<=Un.DEBUG&&Ft("QueryEngine","Query:",If(n),"scans",r.documentReadCount,"local documents and returns",o,"documents as results."),r.documentReadCount>this.Yi*o?(Ef()<=Un.DEBUG&&Ft("QueryEngine","The SDK decides to create cache indexes for query:",If(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mu(n))):ft.resolve())}Xi(e,n){if(xP(n))return ft.resolve(null);let r=mu(n);return this.indexManager.getIndexType(e,r).next(o=>o===0?null:(n.limit!==null&&o===1&&(n=Ev(n,null,"F"),r=mu(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(h=>{const f=$n(...h);return this.Zi.getDocuments(e,f).next(l=>this.indexManager.getMinOffset(e,r).next(S=>{const A=this.rs(n,l);return this.ss(n,A,f,S.readTime)?this.Xi(e,Ev(n,null,"F")):this.os(e,A,n,S)}))})))}es(e,n,r,o){return xP(n)||o.isEqual(Tn.min())?ft.resolve(null):this.Zi.getDocuments(e,r).next(h=>{const f=this.rs(n,h);return this.ss(n,f,r,o)?ft.resolve(null):(Ef()<=Un.DEBUG&&Ft("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),If(n)),this.os(e,f,n,L6(o,-1)).next(l=>l))})}rs(e,n){let r=new ns(RR(e));return n.forEach((o,h)=>{w0(e,h)&&(r=r.add(h))}),r}ss(e,n,r,o){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const h=e.limitType==="F"?n.last():n.first();return!!h&&(h.hasPendingWrites||h.version.compareTo(o)>0)}ts(e,n,r){return Ef()<=Un.DEBUG&&Ft("QueryEngine","Using full collection scan to execute query:",If(n)),this.Zi.getDocumentsMatchingQuery(e,n,yh.min(),r)}os(e,n,r,o){return this.Zi.getDocumentsMatchingQuery(e,r,o).next(h=>(n.forEach(f=>{h=h.insert(f.key,f)}),h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hj{constructor(e,n,r,o){this.persistence=e,this._s=n,this.serializer=o,this.us=new cr(Gn),this.cs=new Bd(h=>CT(h),AT),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(r)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ej(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.us))}}function dj(t,e,n,r){return new hj(t,e,n,r)}async function tL(t,e){const n=Sn(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let o;return n.mutationQueue.getAllMutationBatches(r).next(h=>(o=h,n.Ps(e),n.mutationQueue.getAllMutationBatches(r))).next(h=>{const f=[],l=[];let S=$n();for(const A of o){f.push(A.batchId);for(const O of A.mutations)S=S.add(O.key)}for(const A of h){l.push(A.batchId);for(const O of A.mutations)S=S.add(O.key)}return n.localDocuments.getDocuments(r,S).next(A=>({Ts:A,removedBatchIds:f,addedBatchIds:l}))})})}function fj(t,e){const n=Sn(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const o=e.batch.keys(),h=n.hs.newChangeBuffer({trackRemovals:!0});return function(l,S,A,O){const U=A.batch,H=U.keys();let $=ft.resolve();return H.forEach(ie=>{$=$.next(()=>O.getEntry(S,ie)).next(me=>{const Me=A.docVersions.get(ie);yi(Me!==null),me.version.compareTo(Me)<0&&(U.applyToRemoteDocument(me,A),me.isValidDocument()&&(me.setReadTime(A.commitVersion),O.addEntry(me)))})}),$.next(()=>l.mutationQueue.removeMutationBatch(S,U))}(n,r,e,h).next(()=>h.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,o,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let S=$n();for(let A=0;A<l.mutationResults.length;++A)l.mutationResults[A].transformResults.length>0&&(S=S.add(l.batch.mutations[A].key));return S}(e))).next(()=>n.localDocuments.getDocuments(r,o))})}function nL(t){const e=Sn(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Gr.getLastRemoteSnapshotVersion(n))}function pj(t,e){const n=Sn(t),r=e.snapshotVersion;let o=n.us;return n.persistence.runTransaction("Apply remote event","readwrite-primary",h=>{const f=n.hs.newChangeBuffer({trackRemovals:!0});o=n.us;const l=[];e.targetChanges.forEach((O,U)=>{const H=o.get(U);if(!H)return;l.push(n.Gr.removeMatchingKeys(h,O.removedDocuments,U).next(()=>n.Gr.addMatchingKeys(h,O.addedDocuments,U)));let $=H.withSequenceNumber(h.currentSequenceNumber);e.targetMismatches.get(U)!==null?$=$.withResumeToken(Rs.EMPTY_BYTE_STRING,Tn.min()).withLastLimboFreeSnapshotVersion(Tn.min()):O.resumeToken.approximateByteSize()>0&&($=$.withResumeToken(O.resumeToken,r)),o=o.insert(U,$),function(me,Me,ce){return me.resumeToken.approximateByteSize()===0||Me.snapshotVersion.toMicroseconds()-me.snapshotVersion.toMicroseconds()>=3e8?!0:ce.addedDocuments.size+ce.modifiedDocuments.size+ce.removedDocuments.size>0}(H,$,O)&&l.push(n.Gr.updateTargetData(h,$))});let S=pc(),A=$n();if(e.documentUpdates.forEach(O=>{e.resolvedLimboDocuments.has(O)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(h,O))}),l.push(mj(h,f,e.documentUpdates).next(O=>{S=O.Is,A=O.ds})),!r.isEqual(Tn.min())){const O=n.Gr.getLastRemoteSnapshotVersion(h).next(U=>n.Gr.setTargetsMetadata(h,h.currentSequenceNumber,r));l.push(O)}return ft.waitFor(l).next(()=>f.apply(h)).next(()=>n.localDocuments.getLocalViewOfDocuments(h,S,A)).next(()=>S)}).then(h=>(n.us=o,h))}function mj(t,e,n){let r=$n(),o=$n();return n.forEach(h=>r=r.add(h)),e.getEntries(t,r).next(h=>{let f=pc();return n.forEach((l,S)=>{const A=h.get(l);S.isFoundDocument()!==A.isFoundDocument()&&(o=o.add(l)),S.isNoDocument()&&S.version.isEqual(Tn.min())?(e.removeEntry(l,S.readTime),f=f.insert(l,S)):!A.isValidDocument()||S.version.compareTo(A.version)>0||S.version.compareTo(A.version)===0&&A.hasPendingWrites?(e.addEntry(S),f=f.insert(l,S)):Ft("LocalStore","Ignoring outdated watch update for ",l,". Current version:",A.version," Watch version:",S.version)}),{Is:f,ds:o}})}function gj(t,e){const n=Sn(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function _j(t,e){const n=Sn(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let o;return n.Gr.getTargetData(r,e).next(h=>h?(o=h,ft.resolve(o)):n.Gr.allocateTargetId(r).next(f=>(o=new th(e,f,"TargetPurposeListen",r.currentSequenceNumber),n.Gr.addTargetData(r,o).next(()=>o))))}).then(r=>{const o=n.us.get(r.targetId);return(o===null||r.snapshotVersion.compareTo(o.snapshotVersion)>0)&&(n.us=n.us.insert(r.targetId,r),n.cs.set(e,r.targetId)),r})}async function Jb(t,e,n){const r=Sn(t),o=r.us.get(e),h=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",h,f=>r.persistence.referenceDelegate.removeTarget(f,o))}catch(f){if(!Mp(f))throw f;Ft("LocalStore",`Failed to update sequence numbers for target ${e}: ${f}`)}r.us=r.us.remove(e),r.cs.delete(o.target)}function RP(t,e,n){const r=Sn(t);let o=Tn.min(),h=$n();return r.persistence.runTransaction("Execute query","readwrite",f=>function(S,A,O){const U=Sn(S),H=U.cs.get(O);return H!==void 0?ft.resolve(U.us.get(H)):U.Gr.getTargetData(A,O)}(r,f,mu(e)).next(l=>{if(l)return o=l.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(f,l.targetId).next(S=>{h=S})}).next(()=>r._s.getDocumentsMatchingQuery(f,e,n?o:Tn.min(),n?h:$n())).next(l=>(yj(r,rV(e),l),{documents:l,Es:h})))}function yj(t,e,n){let r=t.ls.get(e)||Tn.min();n.forEach((o,h)=>{h.readTime.compareTo(r)>0&&(r=h.readTime)}),t.ls.set(e,r)}class LP{constructor(){this.activeTargetIds=cV()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vj{constructor(){this._o=new LP,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,n,r){this.ao[e]=n}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new LP,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{uo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){Ft("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){Ft("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fy=null;function Sw(){return fy===null?fy=function(){return 268435456+Math.round(2147483648*Math.random())}():fy++,"0x"+fy.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks="WebChannelConnection";class Tj extends class{get Co(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),h=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+n.host,this.Mo=`projects/${o}/databases/${h}`,this.xo=this.databaseId.database==="(default)"?`project_id=${o}`:`project_id=${o}&database_id=${h}`}Oo(n,r,o,h,f){const l=Sw(),S=this.No(n,r.toUriEncodedString());Ft("RestConnection",`Sending RPC '${n}' ${l}:`,S,o);const A={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(A,h,f),this.Lo(n,S,A,o).then(O=>(Ft("RestConnection",`Received RPC '${n}' ${l}: `,O),O),O=>{throw fp("RestConnection",`RPC '${n}' ${l} failed with error: `,O,"url: ",S,"request:",o),O})}ko(n,r,o,h,f,l){return this.Oo(n,r,o,h,f)}Bo(n,r,o){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ap}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((h,f)=>n[f]=h),o&&o.headers.forEach((h,f)=>n[f]=h)}No(n,r){const o=wj[n];return`${this.Fo}/v1/${r}:${o}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Lo(e,n,r,o){const h=Sw();return new Promise((f,l)=>{const S=new fR;S.setWithCredentials(!0),S.listenOnce(pR.COMPLETE,()=>{try{switch(S.getLastErrorCode()){case zy.NO_ERROR:const O=S.getResponseJson();Ft(Ks,`XHR for RPC '${e}' ${h} received:`,JSON.stringify(O)),f(O);break;case zy.TIMEOUT:Ft(Ks,`RPC '${e}' ${h} timed out`),l(new Ut(mt.DEADLINE_EXCEEDED,"Request time out"));break;case zy.HTTP_ERROR:const U=S.getStatus();if(Ft(Ks,`RPC '${e}' ${h} failed with status:`,U,"response text:",S.getResponseText()),U>0){let H=S.getResponseJson();Array.isArray(H)&&(H=H[0]);const $=H==null?void 0:H.error;if($&&$.status&&$.message){const ie=function(Me){const ce=Me.toLowerCase().replace(/_/g,"-");return Object.values(mt).indexOf(ce)>=0?ce:mt.UNKNOWN}($.status);l(new Ut(ie,$.message))}else l(new Ut(mt.UNKNOWN,"Server responded with status "+S.getStatus()))}else l(new Ut(mt.UNAVAILABLE,"Connection failed."));break;default:mn()}}finally{Ft(Ks,`RPC '${e}' ${h} completed.`)}});const A=JSON.stringify(o);Ft(Ks,`RPC '${e}' ${h} sending request:`,o),S.send(n,"POST",A,r,15)})}qo(e,n,r){const o=Sw(),h=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=_R(),l=gR(),S={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},A=this.longPollingOptions.timeoutSeconds;A!==void 0&&(S.longPollingTimeout=Math.round(1e3*A)),this.useFetchStreams&&(S.useFetchStreams=!0),this.Bo(S.initMessageHeaders,n,r),S.encodeInitMessageHeaders=!0;const O=h.join("");Ft(Ks,`Creating RPC '${e}' stream ${o}: ${O}`,S);const U=f.createWebChannel(O,S);let H=!1,$=!1;const ie=new bj({Eo:Me=>{$?Ft(Ks,`Not sending because RPC '${e}' stream ${o} is closed:`,Me):(H||(Ft(Ks,`Opening RPC '${e}' stream ${o} transport.`),U.open(),H=!0),Ft(Ks,`RPC '${e}' stream ${o} sending:`,Me),U.send(Me))},Ao:()=>U.close()}),me=(Me,ce,le)=>{Me.listen(ce,ge=>{try{le(ge)}catch(je){setTimeout(()=>{throw je},0)}})};return me(U,Vm.EventType.OPEN,()=>{$||(Ft(Ks,`RPC '${e}' stream ${o} transport opened.`),ie.So())}),me(U,Vm.EventType.CLOSE,()=>{$||($=!0,Ft(Ks,`RPC '${e}' stream ${o} transport closed`),ie.Do())}),me(U,Vm.EventType.ERROR,Me=>{$||($=!0,fp(Ks,`RPC '${e}' stream ${o} transport errored:`,Me),ie.Do(new Ut(mt.UNAVAILABLE,"The operation could not be completed")))}),me(U,Vm.EventType.MESSAGE,Me=>{var ce;if(!$){const le=Me.data[0];yi(!!le);const ge=le,je=(ge==null?void 0:ge.error)||((ce=ge[0])===null||ce===void 0?void 0:ce.error);if(je){Ft(Ks,`RPC '${e}' stream ${o} received error:`,je);const rt=je.status;let qe=function(ue){const ve=zr[ue];if(ve!==void 0)return qR(ve)}(rt),fe=je.message;qe===void 0&&(qe=mt.INTERNAL,fe="Unknown error status: "+rt+" with message "+je.message),$=!0,ie.Do(new Ut(qe,fe)),U.close()}else Ft(Ks,`RPC '${e}' stream ${o} received:`,le),ie.vo(le)}}),me(l,mR.STAT_EVENT,Me=>{Me.stat===$b.PROXY?Ft(Ks,`RPC '${e}' stream ${o} detected buffering proxy`):Me.stat===$b.NOPROXY&&Ft(Ks,`RPC '${e}' stream ${o} detected no buffering proxy`)}),setTimeout(()=>{ie.bo()},0),ie}}function Ew(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E0(t){return new kV(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iL{constructor(e,n,r=1e3,o=1.5,h=6e4){this.li=e,this.timerId=n,this.Qo=r,this.Ko=o,this.$o=h,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const n=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),o=Math.max(0,n-r);o>0&&Ft("ExponentialBackoff",`Backing off for ${o} ms (base delay: ${this.Uo} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,o,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rL{constructor(e,n,r,o,h,f,l,S){this.li=e,this.Yo=r,this.Zo=o,this.connection=h,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=l,this.listener=S,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new iL(e,n)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(e,n){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():n&&n.code===mt.RESOURCE_EXHAUSTED?(fc(n.toString()),fc("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):n&&n.code===mt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.po(n)}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),n=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,o])=>{this.Xo===n&&this.I_(r,o)},r=>{e(()=>{const o=new Ut(mt.UNKNOWN,"Fetching auth token failed: "+r.message);return this.d_(o)})})}I_(e,n){const r=this.T_(this.Xo);this.stream=this.E_(e,n),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(o=>{r(()=>this.d_(o))}),this.stream.onMessage(o=>{r(()=>++this.n_==1?this.A_(o):this.onNext(o))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}d_(e){return Ft("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return n=>{this.li.enqueueAndForget(()=>this.Xo===e?n():(Ft("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Sj extends rL{constructor(e,n,r,o,h,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,o,f),this.serializer=h}E_(e,n){return this.connection.qo("Listen",e,n)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const n=LV(this.serializer,e),r=function(h){if(!("targetChange"in h))return Tn.min();const f=h.targetChange;return f.targetIds&&f.targetIds.length?Tn.min():f.readTime?gu(f.readTime):Tn.min()}(e);return this.listener.R_(n,r)}V_(e){const n={};n.database=Qb(this.serializer),n.addTarget=function(h,f){let l;const S=f.target;if(l=Zb(S)?{documents:NV(h,S)}:{query:OV(h,S).ct},l.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){l.resumeToken=ZR(h,f.resumeToken);const A=Kb(h,f.expectedCount);A!==null&&(l.expectedCount=A)}else if(f.snapshotVersion.compareTo(Tn.min())>0){l.readTime=Pv(h,f.snapshotVersion.toTimestamp());const A=Kb(h,f.expectedCount);A!==null&&(l.expectedCount=A)}return l}(this.serializer,e);const r=BV(this.serializer,e);r&&(n.labels=r),this.c_(n)}m_(e){const n={};n.database=Qb(this.serializer),n.removeTarget=e,this.c_(n)}}class Ej extends rL{constructor(e,n,r,o,h,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,o,f),this.serializer=h}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(e,n){return this.connection.qo("Write",e,n)}A_(e){return yi(!!e.streamToken),this.lastStreamToken=e.streamToken,yi(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){yi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const n=zV(e.writeResults,e.commitTime),r=gu(e.commitTime);return this.listener.y_(r,n)}w_(){const e={};e.database=Qb(this.serializer),this.c_(e)}g_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>DV(this.serializer,r))};this.c_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ij extends class{}{constructor(e,n,r,o){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=o,this.S_=!1}b_(){if(this.S_)throw new Ut(mt.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,n,r,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([h,f])=>this.connection.Oo(e,Xb(n,r),o,h,f)).catch(h=>{throw h.name==="FirebaseError"?(h.code===mt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),h):new Ut(mt.UNKNOWN,h.toString())})}ko(e,n,r,o,h){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,l])=>this.connection.ko(e,Xb(n,r),o,f,l,h)).catch(f=>{throw f.name==="FirebaseError"?(f.code===mt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Ut(mt.UNKNOWN,f.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class Pj{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(fc(n),this.C_=!1):Ft("OnlineStateTracker",n)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(e,n,r,o,h){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=h,this.Q_.uo(f=>{r.enqueueAndForget(async()=>{jd(this)&&(Ft("RemoteStore","Restarting streams for network reachability change."),await async function(S){const A=Sn(S);A.k_.add(4),await t_(A),A.K_.set("Unknown"),A.k_.delete(4),await I0(A)}(this))})}),this.K_=new Pj(r,o)}}async function I0(t){if(jd(t))for(const e of t.q_)await e(!0)}async function t_(t){for(const e of t.q_)await e(!1)}function sL(t,e){const n=Sn(t);n.L_.has(e.targetId)||(n.L_.set(e.targetId,e),VT(n)?BT(n):Lp(n).s_()&&FT(n,e))}function OT(t,e){const n=Sn(t),r=Lp(n);n.L_.delete(e),r.s_()&&oL(n,e),n.L_.size===0&&(r.s_()?r.a_():jd(n)&&n.K_.set("Unknown"))}function FT(t,e){if(t.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Tn.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Lp(t).V_(e)}function oL(t,e){t.U_.xe(e),Lp(t).m_(e)}function BT(t){t.U_=new IV({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>t.L_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Lp(t).start(),t.K_.F_()}function VT(t){return jd(t)&&!Lp(t).i_()&&t.L_.size>0}function jd(t){return Sn(t).k_.size===0}function aL(t){t.U_=void 0}async function Aj(t){t.K_.set("Online")}async function kj(t){t.L_.forEach((e,n)=>{FT(t,e)})}async function Mj(t,e){aL(t),VT(t)?(t.K_.O_(e),BT(t)):t.K_.set("Unknown")}async function Rj(t,e,n){if(t.K_.set("Online"),e instanceof GR&&e.state===2&&e.cause)try{await async function(o,h){const f=h.cause;for(const l of h.targetIds)o.L_.has(l)&&(await o.remoteSyncer.rejectListen(l,f),o.L_.delete(l),o.U_.removeTarget(l))}(t,e)}catch(r){Ft("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Av(t,r)}else if(e instanceof By?t.U_.$e(e):e instanceof HR?t.U_.Je(e):t.U_.Ge(e),!n.isEqual(Tn.min()))try{const r=await nL(t.localStore);n.compareTo(r)>=0&&await function(h,f){const l=h.U_.it(f);return l.targetChanges.forEach((S,A)=>{if(S.resumeToken.approximateByteSize()>0){const O=h.L_.get(A);O&&h.L_.set(A,O.withResumeToken(S.resumeToken,f))}}),l.targetMismatches.forEach((S,A)=>{const O=h.L_.get(S);if(!O)return;h.L_.set(S,O.withResumeToken(Rs.EMPTY_BYTE_STRING,O.snapshotVersion)),oL(h,S);const U=new th(O.target,S,A,O.sequenceNumber);FT(h,U)}),h.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){Ft("RemoteStore","Failed to raise snapshot:",r),await Av(t,r)}}async function Av(t,e,n){if(!Mp(e))throw e;t.k_.add(1),await t_(t),t.K_.set("Offline"),n||(n=()=>nL(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Ft("RemoteStore","Retrying IndexedDB access"),await n(),t.k_.delete(1),await I0(t)})}function lL(t,e){return e().catch(n=>Av(t,n,e))}async function P0(t){const e=Sn(t),n=bh(e);let r=e.B_.length>0?e.B_[e.B_.length-1].batchId:-1;for(;Lj(e);)try{const o=await gj(e.localStore,r);if(o===null){e.B_.length===0&&n.a_();break}r=o.batchId,Dj(e,o)}catch(o){await Av(e,o)}uL(e)&&cL(e)}function Lj(t){return jd(t)&&t.B_.length<10}function Dj(t,e){t.B_.push(e);const n=bh(t);n.s_()&&n.f_&&n.g_(e.mutations)}function uL(t){return jd(t)&&!bh(t).i_()&&t.B_.length>0}function cL(t){bh(t).start()}async function zj(t){bh(t).w_()}async function Nj(t){const e=bh(t);for(const n of t.B_)e.g_(n.mutations)}async function Oj(t,e,n){const r=t.B_.shift(),o=MT.from(r,e,n);await lL(t,()=>t.remoteSyncer.applySuccessfulWrite(o)),await P0(t)}async function Fj(t,e){e&&bh(t).f_&&await async function(r,o){if(function(f){return TV(f)&&f!==mt.ABORTED}(o.code)){const h=r.B_.shift();bh(r).__(),await lL(r,()=>r.remoteSyncer.rejectFailedWrite(h.batchId,o)),await P0(r)}}(t,e),uL(t)&&cL(t)}async function zP(t,e){const n=Sn(t);n.asyncQueue.verifyOperationInProgress(),Ft("RemoteStore","RemoteStore received new credentials");const r=jd(n);n.k_.add(3),await t_(n),r&&n.K_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.k_.delete(3),await I0(n)}async function Bj(t,e){const n=Sn(t);e?(n.k_.delete(2),await I0(n)):e||(n.k_.add(2),await t_(n),n.K_.set("Unknown"))}function Lp(t){return t.W_||(t.W_=function(n,r,o){const h=Sn(n);return h.b_(),new Sj(r,h.connection,h.authCredentials,h.appCheckCredentials,h.serializer,o)}(t.datastore,t.asyncQueue,{Ro:Aj.bind(null,t),mo:kj.bind(null,t),po:Mj.bind(null,t),R_:Rj.bind(null,t)}),t.q_.push(async e=>{e?(t.W_.__(),VT(t)?BT(t):t.K_.set("Unknown")):(await t.W_.stop(),aL(t))})),t.W_}function bh(t){return t.G_||(t.G_=function(n,r,o){const h=Sn(n);return h.b_(),new Ej(r,h.connection,h.authCredentials,h.appCheckCredentials,h.serializer,o)}(t.datastore,t.asyncQueue,{Ro:()=>Promise.resolve(),mo:zj.bind(null,t),po:Fj.bind(null,t),p_:Nj.bind(null,t),y_:Oj.bind(null,t)}),t.q_.push(async e=>{e?(t.G_.__(),await P0(t)):(await t.G_.stop(),t.B_.length>0&&(Ft("RemoteStore",`Stopping write stream with ${t.B_.length} pending writes`),t.B_=[]))})),t.G_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jT{constructor(e,n,r,o,h){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=o,this.removalCallback=h,this.deferred=new ph,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,o,h){const f=Date.now()+r,l=new jT(e,n,f,o,h);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ut(mt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function UT(t,e){if(fc("AsyncQueue",`${e}: ${t}`),Mp(t))return new Ut(mt.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{static emptySet(e){return new Yf(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||an.comparator(n.key,r.key):(n,r)=>an.comparator(n.key,r.key),this.keyedMap=jm(),this.sortedSet=new cr(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Yf)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const o=n.getNext().key,h=r.getNext().key;if(!o.isEqual(h))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Yf;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(){this.z_=new cr(an.comparator)}track(e){const n=e.doc.key,r=this.z_.get(n);r?e.type!==0&&r.type===3?this.z_=this.z_.insert(n,e):e.type===3&&r.type!==1?this.z_=this.z_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.z_=this.z_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.z_=this.z_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.z_=this.z_.remove(n):e.type===1&&r.type===2?this.z_=this.z_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.z_=this.z_.insert(n,{type:2,doc:e.doc}):mn():this.z_=this.z_.insert(n,e)}j_(){const e=[];return this.z_.inorderTraversal((n,r)=>{e.push(r)}),e}}class yp{constructor(e,n,r,o,h,f,l,S,A){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=o,this.mutatedKeys=h,this.fromCache=f,this.syncStateChanged=l,this.excludesMetadataChanges=S,this.hasCachedResults=A}static fromInitialDocuments(e,n,r,o,h){const f=[];return n.forEach(l=>{f.push({type:0,doc:l})}),new yp(e,n,Yf.emptySet(n),f,r,o,!0,!1,h)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&x0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let o=0;o<n.length;o++)if(n[o].type!==r[o].type||!n[o].doc.isEqual(r[o].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vj{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class jj{constructor(){this.queries=OP(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(n,r){const o=Sn(n),h=o.queries;o.queries=OP(),h.forEach((f,l)=>{for(const S of l.J_)S.onError(r)})})(this,new Ut(mt.ABORTED,"Firestore shutting down"))}}function OP(){return new Bd(t=>MR(t),x0)}async function Uj(t,e){const n=Sn(t);let r=3;const o=e.query;let h=n.queries.get(o);h?!h.Y_()&&e.Z_()&&(r=2):(h=new Vj,r=e.Z_()?0:1);try{switch(r){case 0:h.H_=await n.onListen(o,!0);break;case 1:h.H_=await n.onListen(o,!1);break;case 2:await n.onFirstRemoteStoreListen(o)}}catch(f){const l=UT(f,`Initialization of query '${If(e.query)}' failed`);return void e.onError(l)}n.queries.set(o,h),h.J_.push(e),e.ea(n.onlineState),h.H_&&e.ta(h.H_)&&$T(n)}async function $j(t,e){const n=Sn(t),r=e.query;let o=3;const h=n.queries.get(r);if(h){const f=h.J_.indexOf(e);f>=0&&(h.J_.splice(f,1),h.J_.length===0?o=e.Z_()?0:1:!h.Y_()&&e.Z_()&&(o=2))}switch(o){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function qj(t,e){const n=Sn(t);let r=!1;for(const o of e){const h=o.query,f=n.queries.get(h);if(f){for(const l of f.J_)l.ta(o)&&(r=!0);f.H_=o}}r&&$T(n)}function Hj(t,e,n){const r=Sn(t),o=r.queries.get(e);if(o)for(const h of o.J_)h.onError(n);r.queries.delete(e)}function $T(t){t.X_.forEach(e=>{e.next()})}var e1,FP;(FP=e1||(e1={})).na="default",FP.Cache="cache";class Gj{constructor(e,n,r){this.query=e,this.ra=n,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(e){if(!this.options.includeMetadataChanges){const r=[];for(const o of e.docChanges)o.type!==3&&r.push(o);e=new yp(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.ia?this.oa(e)&&(this.ra.next(e),n=!0):this._a(e,this.onlineState)&&(this.aa(e),n=!0),this.sa=e,n}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let n=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),n=!0),n}_a(e,n){if(!e.fromCache||!this.Z_())return!0;const r=n!=="Offline";return(!this.options.ua||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}oa(e){if(e.docChanges.length>0)return!0;const n=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}aa(e){e=yp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==e1.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hL{constructor(e){this.key=e}}class dL{constructor(e){this.key=e}}class Zj{constructor(e,n){this.query=e,this.Ea=n,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=$n(),this.mutatedKeys=$n(),this.Va=RR(e),this.ma=new Yf(this.Va)}get fa(){return this.Ea}ga(e,n){const r=n?n.pa:new NP,o=n?n.ma:this.ma;let h=n?n.mutatedKeys:this.mutatedKeys,f=o,l=!1;const S=this.query.limitType==="F"&&o.size===this.query.limit?o.last():null,A=this.query.limitType==="L"&&o.size===this.query.limit?o.first():null;if(e.inorderTraversal((O,U)=>{const H=o.get(O),$=w0(this.query,U)?U:null,ie=!!H&&this.mutatedKeys.has(H.key),me=!!$&&($.hasLocalMutations||this.mutatedKeys.has($.key)&&$.hasCommittedMutations);let Me=!1;H&&$?H.data.isEqual($.data)?ie!==me&&(r.track({type:3,doc:$}),Me=!0):this.ya(H,$)||(r.track({type:2,doc:$}),Me=!0,(S&&this.Va($,S)>0||A&&this.Va($,A)<0)&&(l=!0)):!H&&$?(r.track({type:0,doc:$}),Me=!0):H&&!$&&(r.track({type:1,doc:H}),Me=!0,(S||A)&&(l=!0)),Me&&($?(f=f.add($),h=me?h.add(O):h.delete(O)):(f=f.delete(O),h=h.delete(O)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const O=this.query.limitType==="F"?f.last():f.first();f=f.delete(O.key),h=h.delete(O.key),r.track({type:1,doc:O})}return{ma:f,pa:r,ss:l,mutatedKeys:h}}ya(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,o){const h=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const f=e.pa.j_();f.sort((O,U)=>function($,ie){const me=Me=>{switch(Me){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return mn()}};return me($)-me(ie)}(O.type,U.type)||this.Va(O.doc,U.doc)),this.wa(r),o=o!=null&&o;const l=n&&!o?this.Sa():[],S=this.Ra.size===0&&this.current&&!o?1:0,A=S!==this.Aa;return this.Aa=S,f.length!==0||A?{snapshot:new yp(this.query,e.ma,h,f,e.mutatedKeys,S===0,A,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:l}:{ba:l}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new NP,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.Ea.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(n=>this.Ea=this.Ea.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ea=this.Ea.delete(n)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=$n(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});const n=[];return e.forEach(r=>{this.Ra.has(r)||n.push(new dL(r))}),this.Ra.forEach(r=>{e.has(r)||n.push(new hL(r))}),n}va(e){this.Ea=e.Es,this.Ra=$n();const n=this.ga(e.documents);return this.applyChanges(n,!0)}Ca(){return yp.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}}class Wj{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class Kj{constructor(e){this.key=e,this.Fa=!1}}class Xj{constructor(e,n,r,o,h,f){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=o,this.currentUser=h,this.maxConcurrentLimboResolutions=f,this.Ma={},this.xa=new Bd(l=>MR(l),x0),this.Oa=new Map,this.Na=new Set,this.Ba=new cr(an.comparator),this.La=new Map,this.ka=new DT,this.qa={},this.Qa=new Map,this.Ka=_p.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}}async function Yj(t,e,n=!0){const r=yL(t);let o;const h=r.xa.get(e);return h?(r.sharedClientState.addLocalQueryTarget(h.targetId),o=h.view.Ca()):o=await fL(r,e,n,!0),o}async function Qj(t,e){const n=yL(t);await fL(n,e,!0,!1)}async function fL(t,e,n,r){const o=await _j(t.localStore,mu(e)),h=o.targetId,f=t.sharedClientState.addLocalQueryTarget(h,n);let l;return r&&(l=await Jj(t,e,h,f==="current",o.resumeToken)),t.isPrimaryClient&&n&&sL(t.remoteStore,o),l}async function Jj(t,e,n,r,o){t.Ua=(U,H,$)=>async function(me,Me,ce,le){let ge=Me.view.ga(ce);ge.ss&&(ge=await RP(me.localStore,Me.query,!1).then(({documents:fe})=>Me.view.ga(fe,ge)));const je=le&&le.targetChanges.get(Me.targetId),rt=le&&le.targetMismatches.get(Me.targetId)!=null,qe=Me.view.applyChanges(ge,me.isPrimaryClient,je,rt);return VP(me,Me.targetId,qe.ba),qe.snapshot}(t,U,H,$);const h=await RP(t.localStore,e,!0),f=new Zj(e,h.Es),l=f.ga(h.documents),S=e_.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",o),A=f.applyChanges(l,t.isPrimaryClient,S);VP(t,n,A.ba);const O=new Wj(e,n,f);return t.xa.set(e,O),t.Oa.has(n)?t.Oa.get(n).push(e):t.Oa.set(n,[e]),A.snapshot}async function eU(t,e,n){const r=Sn(t),o=r.xa.get(e),h=r.Oa.get(o.targetId);if(h.length>1)return r.Oa.set(o.targetId,h.filter(f=>!x0(f,e))),void r.xa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(o.targetId),r.sharedClientState.isActiveQueryTarget(o.targetId)||await Jb(r.localStore,o.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(o.targetId),n&&OT(r.remoteStore,o.targetId),t1(r,o.targetId)}).catch(kp)):(t1(r,o.targetId),await Jb(r.localStore,o.targetId,!0))}async function tU(t,e){const n=Sn(t),r=n.xa.get(e),o=n.Oa.get(r.targetId);n.isPrimaryClient&&o.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),OT(n.remoteStore,r.targetId))}async function nU(t,e,n){const r=uU(t);try{const o=await function(f,l){const S=Sn(f),A=ts.now(),O=l.reduce(($,ie)=>$.add(ie.key),$n());let U,H;return S.persistence.runTransaction("Locally write mutations","readwrite",$=>{let ie=pc(),me=$n();return S.hs.getEntries($,O).next(Me=>{ie=Me,ie.forEach((ce,le)=>{le.isValidDocument()||(me=me.add(ce))})}).next(()=>S.localDocuments.getOverlayedDocuments($,ie)).next(Me=>{U=Me;const ce=[];for(const le of l){const ge=yV(le,U.get(le.key).overlayedDocument);ge!=null&&ce.push(new Vd(le.key,ge,bR(ge.value.mapValue),rc.exists(!0)))}return S.mutationQueue.addMutationBatch($,A,ce,l)}).next(Me=>{H=Me;const ce=Me.applyToLocalDocumentSet(U,me);return S.documentOverlayCache.saveOverlays($,Me.batchId,ce)})}).then(()=>({batchId:H.batchId,changes:DR(U)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(o.batchId),function(f,l,S){let A=f.qa[f.currentUser.toKey()];A||(A=new cr(Gn)),A=A.insert(l,S),f.qa[f.currentUser.toKey()]=A}(r,o.batchId,n),await n_(r,o.changes),await P0(r.remoteStore)}catch(o){const h=UT(o,"Failed to persist write");n.reject(h)}}async function pL(t,e){const n=Sn(t);try{const r=await pj(n.localStore,e);e.targetChanges.forEach((o,h)=>{const f=n.La.get(h);f&&(yi(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?f.Fa=!0:o.modifiedDocuments.size>0?yi(f.Fa):o.removedDocuments.size>0&&(yi(f.Fa),f.Fa=!1))}),await n_(n,r,e)}catch(r){await kp(r)}}function BP(t,e,n){const r=Sn(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const o=[];r.xa.forEach((h,f)=>{const l=f.view.ea(e);l.snapshot&&o.push(l.snapshot)}),function(f,l){const S=Sn(f);S.onlineState=l;let A=!1;S.queries.forEach((O,U)=>{for(const H of U.J_)H.ea(l)&&(A=!0)}),A&&$T(S)}(r.eventManager,e),o.length&&r.Ma.R_(o),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function iU(t,e,n){const r=Sn(t);r.sharedClientState.updateQueryState(e,"rejected",n);const o=r.La.get(e),h=o&&o.key;if(h){let f=new cr(an.comparator);f=f.insert(h,Qs.newNoDocument(h,Tn.min()));const l=$n().add(h),S=new S0(Tn.min(),new Map,new cr(Gn),f,l);await pL(r,S),r.Ba=r.Ba.remove(h),r.La.delete(e),qT(r)}else await Jb(r.localStore,e,!1).then(()=>t1(r,e,n)).catch(kp)}async function rU(t,e){const n=Sn(t),r=e.batch.batchId;try{const o=await fj(n.localStore,e);gL(n,r,null),mL(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await n_(n,o)}catch(o){await kp(o)}}async function sU(t,e,n){const r=Sn(t);try{const o=await function(f,l){const S=Sn(f);return S.persistence.runTransaction("Reject batch","readwrite-primary",A=>{let O;return S.mutationQueue.lookupMutationBatch(A,l).next(U=>(yi(U!==null),O=U.keys(),S.mutationQueue.removeMutationBatch(A,U))).next(()=>S.mutationQueue.performConsistencyCheck(A)).next(()=>S.documentOverlayCache.removeOverlaysForBatchId(A,O,l)).next(()=>S.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(A,O)).next(()=>S.localDocuments.getDocuments(A,O))})}(r.localStore,e);gL(r,e,n),mL(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await n_(r,o)}catch(o){await kp(o)}}function mL(t,e){(t.Qa.get(e)||[]).forEach(n=>{n.resolve()}),t.Qa.delete(e)}function gL(t,e,n){const r=Sn(t);let o=r.qa[r.currentUser.toKey()];if(o){const h=o.get(e);h&&(n?h.reject(n):h.resolve(),o=o.remove(e)),r.qa[r.currentUser.toKey()]=o}}function t1(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Oa.get(e))t.xa.delete(r),n&&t.Ma.Wa(r,n);t.Oa.delete(e),t.isPrimaryClient&&t.ka.yr(e).forEach(r=>{t.ka.containsKey(r)||_L(t,r)})}function _L(t,e){t.Na.delete(e.path.canonicalString());const n=t.Ba.get(e);n!==null&&(OT(t.remoteStore,n),t.Ba=t.Ba.remove(e),t.La.delete(n),qT(t))}function VP(t,e,n){for(const r of n)r instanceof hL?(t.ka.addReference(r.key,e),oU(t,r)):r instanceof dL?(Ft("SyncEngine","Document no longer in limbo: "+r.key),t.ka.removeReference(r.key,e),t.ka.containsKey(r.key)||_L(t,r.key)):mn()}function oU(t,e){const n=e.key,r=n.path.canonicalString();t.Ba.get(n)||t.Na.has(r)||(Ft("SyncEngine","New document in limbo: "+n),t.Na.add(r),qT(t))}function qT(t){for(;t.Na.size>0&&t.Ba.size<t.maxConcurrentLimboResolutions;){const e=t.Na.values().next().value;t.Na.delete(e);const n=new an(Wi.fromString(e)),r=t.Ka.next();t.La.set(r,new Kj(n)),t.Ba=t.Ba.insert(n,r),sL(t.remoteStore,new th(mu(AR(n.path)),r,"TargetPurposeLimboResolution",_0.oe))}}async function n_(t,e,n){const r=Sn(t),o=[],h=[],f=[];r.xa.isEmpty()||(r.xa.forEach((l,S)=>{f.push(r.Ua(S,e,n).then(A=>{var O;if((A||n)&&r.isPrimaryClient){const U=A?!A.fromCache:(O=n==null?void 0:n.targetChanges.get(S.targetId))===null||O===void 0?void 0:O.current;r.sharedClientState.updateQueryState(S.targetId,U?"current":"not-current")}if(A){o.push(A);const U=NT.zi(S.targetId,A);h.push(U)}}))}),await Promise.all(f),r.Ma.R_(o),await async function(S,A){const O=Sn(S);try{await O.persistence.runTransaction("notifyLocalViewChanges","readwrite",U=>ft.forEach(A,H=>ft.forEach(H.Wi,$=>O.persistence.referenceDelegate.addReference(U,H.targetId,$)).next(()=>ft.forEach(H.Gi,$=>O.persistence.referenceDelegate.removeReference(U,H.targetId,$)))))}catch(U){if(!Mp(U))throw U;Ft("LocalStore","Failed to update sequence numbers: "+U)}for(const U of A){const H=U.targetId;if(!U.fromCache){const $=O.us.get(H),ie=$.snapshotVersion,me=$.withLastLimboFreeSnapshotVersion(ie);O.us=O.us.insert(H,me)}}}(r.localStore,h))}async function aU(t,e){const n=Sn(t);if(!n.currentUser.isEqual(e)){Ft("SyncEngine","User change. New user:",e.toKey());const r=await tL(n.localStore,e);n.currentUser=e,function(h,f){h.Qa.forEach(l=>{l.forEach(S=>{S.reject(new Ut(mt.CANCELLED,f))})}),h.Qa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await n_(n,r.Ts)}}function lU(t,e){const n=Sn(t),r=n.La.get(e);if(r&&r.Fa)return $n().add(r.key);{let o=$n();const h=n.Oa.get(e);if(!h)return o;for(const f of h){const l=n.xa.get(f);o=o.unionWith(l.view.fa)}return o}}function yL(t){const e=Sn(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=pL.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=iU.bind(null,e),e.Ma.R_=qj.bind(null,e.eventManager),e.Ma.Wa=Hj.bind(null,e.eventManager),e}function uU(t){const e=Sn(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sU.bind(null,e),e}class kv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=E0(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,n){return null}Ya(e,n){return null}Ha(e){return dj(this.persistence,new cj,e.initialUser,this.serializer)}ja(e){return new eL(zT.ei,this.serializer)}za(e){return new vj}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}kv.provider={build:()=>new kv};class cU extends kv{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,n){yi(this.persistence.referenceDelegate instanceof Cv);const r=this.persistence.referenceDelegate.garbageCollector;return new KV(r,e.asyncQueue,n)}ja(e){const n=this.cacheSizeBytes!==void 0?Uo.withCacheSize(this.cacheSizeBytes):Uo.DEFAULT;return new eL(r=>Cv.ei(r,n),this.serializer)}}class n1{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>BP(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=aU.bind(null,this.syncEngine),await Bj(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new jj}()}createDatastore(e){const n=E0(e.databaseInfo.databaseId),r=function(h){return new Tj(h)}(e.databaseInfo);return function(h,f,l,S){return new Ij(h,f,l,S)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,o,h,f,l){return new Cj(r,o,h,f,l)}(this.localStore,this.datastore,e.asyncQueue,n=>BP(this.syncEngine,n,0),function(){return DP.p()?new DP:new xj}())}createSyncEngine(e,n){return function(o,h,f,l,S,A,O){const U=new Xj(o,h,f,l,S,A);return O&&(U.$a=!0),U}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(o){const h=Sn(o);Ft("RemoteStore","RemoteStore shutting down."),h.k_.add(5),await t_(h),h.Q_.shutdown(),h.K_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}n1.provider={build:()=>new n1};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hU{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):fc("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dU{constructor(e,n,r,o,h){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=o,this.user=Xs.UNAUTHENTICATED,this.clientId=vR.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=h,this.authCredentials.start(r,async f=>{Ft("FirestoreClient","Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(r,f=>(Ft("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ph;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=UT(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Iw(t,e){t.asyncQueue.verifyOperationInProgress(),Ft("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async o=>{r.isEqual(o)||(await tL(e.localStore,o),r=o)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function jP(t,e){t.asyncQueue.verifyOperationInProgress();const n=await fU(t);Ft("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>zP(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,o)=>zP(e.remoteStore,o)),t._onlineComponents=e}async function fU(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ft("FirestoreClient","Using user provided OfflineComponentProvider");try{await Iw(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(o){return o.name==="FirebaseError"?o.code===mt.FAILED_PRECONDITION||o.code===mt.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||o.code===22||o.code===20||o.code===11}(n))throw n;fp("Error using user provided cache. Falling back to memory cache: "+n),await Iw(t,new kv)}}else Ft("FirestoreClient","Using default OfflineComponentProvider"),await Iw(t,new cU(void 0));return t._offlineComponents}async function vL(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ft("FirestoreClient","Using user provided OnlineComponentProvider"),await jP(t,t._uninitializedComponentsProvider._online)):(Ft("FirestoreClient","Using default OnlineComponentProvider"),await jP(t,new n1))),t._onlineComponents}function pU(t){return vL(t).then(e=>e.syncEngine)}async function mU(t){const e=await vL(t),n=e.eventManager;return n.onListen=Yj.bind(null,e.syncEngine),n.onUnlisten=eU.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Qj.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=tU.bind(null,e.syncEngine),n}function gU(t,e,n={}){const r=new ph;return t.asyncQueue.enqueueAndForget(async()=>function(h,f,l,S,A){const O=new hU({next:H=>{O.eu(),f.enqueueAndForget(()=>$j(h,U)),H.fromCache&&S.source==="server"?A.reject(new Ut(mt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):A.resolve(H)},error:H=>A.reject(H)}),U=new Gj(l,O,{includeMetadataChanges:!0,ua:!0});return Uj(h,U)}(await mU(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xL(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wL(t,e,n){if(!n)throw new Ut(mt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function _U(t,e,n,r){if(e===!0&&r===!0)throw new Ut(mt.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function $P(t){if(!an.isDocumentKey(t))throw new Ut(mt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function qP(t){if(an.isDocumentKey(t))throw new Ut(mt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function C0(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":mn()}function Mv(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ut(mt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=C0(t);throw new Ut(mt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function yU(t,e){if(e<=0)throw new Ut(mt.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Ut(mt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ut(mt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}_U("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xL((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(h){if(h.timeoutSeconds!==void 0){if(isNaN(h.timeoutSeconds))throw new Ut(mt.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (must not be NaN)`);if(h.timeoutSeconds<5)throw new Ut(mt.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (minimum allowed value is 5)`);if(h.timeoutSeconds>30)throw new Ut(mt.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,o){return r.timeoutSeconds===o.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class A0{constructor(e,n,r,o){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=o,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new HP({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ut(mt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ut(mt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new HP(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new S6;switch(r.type){case"firstParty":return new C6(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ut(mt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=UP.get(n);r&&(Ft("ComponentProvider","Removing Datastore"),UP.delete(n),r.terminate())}(this),Promise.resolve()}}function vU(t,e,n,r={}){var o;const h=(t=Mv(t,A0))._getSettings(),f=`${e}:${n}`;if(h.host!=="firestore.googleapis.com"&&h.host!==f&&fp("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},h),{host:f,ssl:!1})),r.mockUserToken){let l,S;if(typeof r.mockUserToken=="string")l=r.mockUserToken,S=Xs.MOCK_USER;else{l=Y4(r.mockUserToken,(o=t._app)===null||o===void 0?void 0:o.options.projectId);const A=r.mockUserToken.sub||r.mockUserToken.user_id;if(!A)throw new Ut(mt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");S=new Xs(A)}t._authCredentials=new E6(new yR(l,S))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ih(this.firestore,e,this._query)}}class Wa{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wa(this.firestore,e,this._key)}}class mh extends Ih{constructor(e,n,r){super(e,n,AR(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wa(this.firestore,null,new an(e))}withConverter(e){return new mh(this.firestore,e,this._path)}}function wf(t,e,...n){if(t=Ko(t),wL("collection","path",e),t instanceof A0){const r=Wi.fromString(e,...n);return qP(r),new mh(t,null,r)}{if(!(t instanceof Wa||t instanceof mh))throw new Ut(mt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Wi.fromString(e,...n));return qP(r),new mh(t.firestore,null,r)}}function xU(t,e,...n){if(t=Ko(t),arguments.length===1&&(e=vR.newId()),wL("doc","path",e),t instanceof A0){const r=Wi.fromString(e,...n);return $P(r),new Wa(t,null,new an(r))}{if(!(t instanceof Wa||t instanceof mh))throw new Ut(mt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Wi.fromString(e,...n));return $P(r),new Wa(t.firestore,t instanceof mh?t.converter:null,new an(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{constructor(e=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new iL(this,"async_queue_retry"),this.fu=()=>{const r=Ew();r&&Ft("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=e;const n=Ew();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.du){this.du=!0,this.Vu=e||!1;const n=Ew();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.du)return new Promise(()=>{});const n=new ph;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!Mp(e))throw e;Ft("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){const n=this.gu.then(()=>(this.Ru=!0,e().catch(r=>{this.Au=r,this.Ru=!1;const o=function(f){let l=f.message||"";return f.stack&&(l=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),l}(r);throw fc("INTERNAL UNHANDLED ERROR: ",o),r}).then(r=>(this.Ru=!1,r))));return this.gu=n,n}enqueueAfterDelay(e,n,r){this.pu(),this.mu.indexOf(e)>-1&&(n=0);const o=jT.createAndSchedule(this,e,n,r,h=>this.Su(h));return this.Eu.push(o),o}pu(){this.Au&&mn()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(const n of this.Eu)if(n.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.Eu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Eu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const n=this.Eu.indexOf(e);this.Eu.splice(n,1)}}class HT extends A0{constructor(e,n,r,o){super(e,n,r,o),this.type="firestore",this._queue=new GP,this._persistenceKey=(o==null?void 0:o.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new GP(e),this._firestoreClient=void 0,await e}}}function wU(t,e){const n=typeof t=="object"?t:ST(),r=typeof t=="string"?t:"(default)",o=Od(n,"firestore").getImmediate({identifier:r});if(!o._initialized){const h=K4("firestore");h&&vU(o,...h)}return o}function bL(t){if(t._terminated)throw new Ut(mt.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||bU(t),t._firestoreClient}function bU(t){var e,n,r;const o=t._freezeSettings(),h=function(l,S,A,O){return new $6(l,S,A,O.host,O.ssl,O.experimentalForceLongPolling,O.experimentalAutoDetectLongPolling,xL(O.experimentalLongPollingOptions),O.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,o);t._componentsProvider||!((n=o.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=o.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),t._firestoreClient=new dU(t._authCredentials,t._appCheckCredentials,t._queue,h,t._componentsProvider&&function(l){const S=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(S),_online:S}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vp(Rs.fromBase64String(e))}catch(n){throw new Ut(mt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new vp(Rs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Ut(mt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new As(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Ut(mt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Ut(mt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Gn(this._lat,e._lat)||Gn(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,o){if(r.length!==o.length)return!1;for(let h=0;h<r.length;++h)if(r[h]!==o[h])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TU=/^__.*__$/;class SU{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Vd(e,this.data,this.fieldMask,n,this.fieldTransforms):new Jg(e,this.data,n,this.fieldTransforms)}}function TL(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw mn()}}class XT{constructor(e,n,r,o,h,f){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=o,h===void 0&&this.Fu(),this.fieldTransforms=h||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new XT(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),o=this.xu({path:r,Nu:!1});return o.Bu(e),o}Lu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),o=this.xu({path:r,Nu:!1});return o.Fu(),o}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return Rv(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Bu(this.path.get(e))}Bu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(TL(this.Mu)&&TU.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class EU{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||E0(e)}$u(e,n,r,o=!1){return new XT({Mu:e,methodName:n,Ku:r,path:As.emptyPath(),Nu:!1,Qu:o},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function SL(t){const e=t._freezeSettings(),n=E0(t._databaseId);return new EU(t._databaseId,!!e.ignoreUndefinedProperties,n)}function IU(t,e,n,r,o,h={}){const f=t.$u(h.merge||h.mergeFields?2:0,e,n,o);PL("Data must be an object, but it was:",f,r);const l=EL(r,f);let S,A;if(h.merge)S=new Rl(f.fieldMask),A=f.fieldTransforms;else if(h.mergeFields){const O=[];for(const U of h.mergeFields){const H=CU(e,U,n);if(!f.contains(H))throw new Ut(mt.INVALID_ARGUMENT,`Field '${H}' is specified in your field mask but missing from your input data.`);kU(O,H)||O.push(H)}S=new Rl(O),A=f.fieldTransforms.filter(U=>S.covers(U.field))}else S=null,A=f.fieldTransforms;return new SU(new Ua(l),S,A)}class YT extends ZT{_toFieldTransform(e){return new pV(e.path,new Dg)}isEqual(e){return e instanceof YT}}function PU(t,e,n,r=!1){return QT(n,t.$u(r?4:3,e))}function QT(t,e){if(IL(t=Ko(t)))return PL("Unsupported field value:",e,t),EL(t,e);if(t instanceof ZT)return function(r,o){if(!TL(o.Mu))throw o.qu(`${r._methodName}() can only be used with update() and set()`);if(!o.path)throw o.qu(`${r._methodName}() is not currently supported inside arrays`);const h=r._toFieldTransform(o);h&&o.fieldTransforms.push(h)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(r,o){const h=[];let f=0;for(const l of r){let S=QT(l,o.ku(f));S==null&&(S={nullValue:"NULL_VALUE"}),h.push(S),f++}return{arrayValue:{values:h}}}(t,e)}return function(r,o){if((r=Ko(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return hV(o.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const h=ts.fromDate(r);return{timestampValue:Pv(o.serializer,h)}}if(r instanceof ts){const h=new ts(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Pv(o.serializer,h)}}if(r instanceof WT)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof vp)return{bytesValue:ZR(o.serializer,r._byteString)};if(r instanceof Wa){const h=o.databaseId,f=r.firestore._databaseId;if(!f.isEqual(h))throw o.qu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${h.projectId}/${h.database}`);return{referenceValue:LT(r.firestore._databaseId||o.databaseId,r._key.path)}}if(r instanceof KT)return function(f,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:f.toArray().map(S=>{if(typeof S!="number")throw l.qu("VectorValues must only contain numeric values.");return kT(l.serializer,S)})}}}}}}(r,o);throw o.qu(`Unsupported field value: ${C0(r)}`)}(t,e)}function EL(t,e){const n={};return xR(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fd(t,(r,o)=>{const h=QT(o,e.Ou(r));h!=null&&(n[r]=h)}),{mapValue:{fields:n}}}function IL(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ts||t instanceof WT||t instanceof vp||t instanceof Wa||t instanceof ZT||t instanceof KT)}function PL(t,e,n){if(!IL(n)||!function(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}(n)){const r=C0(n);throw r==="an object"?e.qu(t+" a custom object"):e.qu(t+" "+r)}}function CU(t,e,n){if((e=Ko(e))instanceof GT)return e._internalPath;if(typeof e=="string")return CL(t,e);throw Rv("Field path arguments must be of type string or ",t,!1,void 0,n)}const AU=new RegExp("[~\\*/\\[\\]]");function CL(t,e,n){if(e.search(AU)>=0)throw Rv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new GT(...e.split("."))._internalPath}catch{throw Rv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Rv(t,e,n,r,o){const h=r&&!r.isEmpty(),f=o!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let S="";return(h||f)&&(S+=" (found",h&&(S+=` in field ${r}`),f&&(S+=` in document ${o}`),S+=")"),new Ut(mt.INVALID_ARGUMENT,l+t+S)}function kU(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e,n,r,o,h){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=o,this._converter=h}get id(){return this._key.path.lastSegment()}get ref(){return new Wa(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new MU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(JT("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class MU extends AL{data(){return super.data()}}function JT(t,e){return typeof e=="string"?CL(t,e):e instanceof GT?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RU(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Ut(mt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class e2{}class t2 extends e2{}function km(t,e,...n){let r=[];e instanceof e2&&r.push(e),r=r.concat(n),function(h){const f=h.filter(S=>S instanceof i2).length,l=h.filter(S=>S instanceof n2).length;if(f>1||f>0&&l>0)throw new Ut(mt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const o of r)t=o._apply(t);return t}class n2 extends t2{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new n2(e,n,r)}_apply(e){const n=this._parse(e);return kL(e._query,n),new Ih(e.firestore,e.converter,Wb(e._query,n))}_parse(e){const n=SL(e.firestore);return function(h,f,l,S,A,O,U){let H;if(A.isKeyField()){if(O==="array-contains"||O==="array-contains-any")throw new Ut(mt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${O}' queries on documentId().`);if(O==="in"||O==="not-in"){WP(U,O);const $=[];for(const ie of U)$.push(ZP(S,h,ie));H={arrayValue:{values:$}}}else H=ZP(S,h,U)}else O!=="in"&&O!=="not-in"&&O!=="array-contains-any"||WP(U,O),H=PU(l,f,U,O==="in"||O==="not-in");return Or.create(A,O,H)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}class i2 extends e2{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new i2(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Bl.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(o,h){let f=o;const l=h.getFlattenedFilters();for(const S of l)kL(f,S),f=Wb(f,S)}(e._query,n),new Ih(e.firestore,e.converter,Wb(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class r2 extends t2{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new r2(e,n)}_apply(e){const n=function(o,h,f){if(o.startAt!==null)throw new Ut(mt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(o.endAt!==null)throw new Ut(mt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lg(h,f)}(e._query,this._field,this._direction);return new Ih(e.firestore,e.converter,function(o,h){const f=o.explicitOrderBy.concat([h]);return new Rp(o.path,o.collectionGroup,f,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)}(e._query,n))}}function Mm(t,e="asc"){const n=e,r=JT("orderBy",t);return r2._create(r,n)}class s2 extends t2{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new s2(e,n,r)}_apply(e){return new Ih(e.firestore,e.converter,Ev(e._query,this._limit,this._limitType))}}function LU(t){return yU("limit",t),s2._create("limit",t,"F")}function ZP(t,e,n){if(typeof(n=Ko(n))=="string"){if(n==="")throw new Ut(mt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kR(e)&&n.indexOf("/")!==-1)throw new Ut(mt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Wi.fromString(n));if(!an.isDocumentKey(r))throw new Ut(mt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return pP(t,new an(r))}if(n instanceof Wa)return pP(t,n._key);throw new Ut(mt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${C0(n)}.`)}function WP(t,e){if(!Array.isArray(t)||t.length===0)throw new Ut(mt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function kL(t,e){const n=function(o,h){for(const f of o)for(const l of f.getFlattenedFilters())if(h.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(o){switch(o){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Ut(mt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ut(mt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class DU{convertValue(e,n="none"){switch(wh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Tr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(xh(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw mn()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Fd(e,(o,h)=>{r[o]=this.convertValue(h,n)}),r}convertVectorValue(e){var n,r,o;const h=(o=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||o===void 0?void 0:o.map(f=>Tr(f.doubleValue));return new KT(h)}convertGeoPoint(e){return new WT(Tr(e.latitude),Tr(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=v0(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(kg(e));default:return null}}convertTimestamp(e){const n=vh(e);return new ts(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Wi.fromString(e);yi(JR(r));const o=new Mg(r.get(1),r.get(3)),h=new an(r.popFirst(5));return o.isEqual(n)||fc(`Document ${h} contains a document reference within a different database (${o.projectId}/${o.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zU(t,e,n){let r;return r=t?t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class NU extends AL{constructor(e,n,r,o,h,f){super(e,n,r,o,f),this._firestore=e,this._firestoreImpl=e,this.metadata=h}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Vy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(JT("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Vy extends NU{data(e={}){return super.data(e)}}class OU{constructor(e,n,r,o){this._firestore=e,this._userDataWriter=n,this._snapshot=o,this.metadata=new py(o.hasPendingWrites,o.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Vy(this._firestore,this._userDataWriter,r.key,r,new py(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Ut(mt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(o,h){if(o._snapshot.oldDocs.isEmpty()){let f=0;return o._snapshot.docChanges.map(l=>{const S=new Vy(o._firestore,o._userDataWriter,l.doc.key,l.doc,new py(o._snapshot.mutatedKeys.has(l.doc.key),o._snapshot.fromCache),o.query.converter);return l.doc,{type:"added",doc:S,oldIndex:-1,newIndex:f++}})}{let f=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(l=>h||l.type!==3).map(l=>{const S=new Vy(o._firestore,o._userDataWriter,l.doc.key,l.doc,new py(o._snapshot.mutatedKeys.has(l.doc.key),o._snapshot.fromCache),o.query.converter);let A=-1,O=-1;return l.type!==0&&(A=f.indexOf(l.doc.key),f=f.delete(l.doc.key)),l.type!==1&&(f=f.add(l.doc),O=f.indexOf(l.doc.key)),{type:FU(l.type),doc:S,oldIndex:A,newIndex:O}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function FU(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return mn()}}class BU extends DU{constructor(e){super(),this.firestore=e}convertBytes(e){return new vp(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Wa(this.firestore,null,n)}}function Rm(t){t=Mv(t,Ih);const e=Mv(t.firestore,HT),n=bL(e),r=new BU(e);return RU(t._query),gU(n,t._query).then(o=>new OU(e,r,t,o))}function VU(t,e){const n=Mv(t.firestore,HT),r=xU(t),o=zU(t.converter,e);return jU(n,[IU(SL(t.firestore),"addDoc",r._key,o,t.converter!==null,{}).toMutation(r._key,rc.exists(!1))]).then(()=>r)}function jU(t,e){return function(r,o){const h=new ph;return r.asyncQueue.enqueueAndForget(async()=>nU(await pU(r),o,h)),h.promise}(bL(t),e)}function KP(){return new YT("serverTimestamp")}(function(e,n=!0){(function(o){Ap=o})(Cp),Tu(new Fl("firestore",(r,{instanceIdentifier:o,options:h})=>{const f=r.getProvider("app").getImmediate(),l=new HT(new I6(r.getProvider("auth-internal")),new k6(r.getProvider("app-check-internal")),function(A,O){if(!Object.prototype.hasOwnProperty.apply(A.options,["projectId"]))throw new Ut(mt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mg(A.options.projectId,O)}(f,o),f);return h=Object.assign({useFetchStreams:n},h),l._setSettings(h),l},"PUBLIC").setMultipleInstances(!0)),Za(lP,"4.7.6",e),Za(lP,"4.7.6","esm2017")})();function o2(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function ML(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const UU=ML,RL=new Nd("auth","Firebase",ML());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv=new g0("@firebase/auth");function $U(t,...e){Lv.logLevel<=Un.WARN&&Lv.warn(`Auth (${Cp}): ${t}`,...e)}function jy(t,...e){Lv.logLevel<=Un.ERROR&&Lv.error(`Auth (${Cp}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(t,...e){throw a2(t,...e)}function _u(t,...e){return a2(t,...e)}function LL(t,e,n){const r=Object.assign(Object.assign({},UU()),{[e]:n});return new Nd("auth","Firebase",r).create(e,{appName:t.name})}function md(t){return LL(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function a2(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return RL.create(t,...e)}function yn(t,e,...n){if(!t)throw a2(e,...n)}function Ju(t){const e="INTERNAL ASSERTION FAILED: "+t;throw jy(e),new Error(e)}function gc(t,e){t||Ju(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i1(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function qU(){return XP()==="http:"||XP()==="https:"}function XP(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qU()||iR()||"connection"in navigator)?navigator.onLine:!0}function GU(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(e,n){this.shortDelay=e,this.longDelay=n,gc(n>e,"Short delay should be less than long delay!"),this.isMobile=Q4()||tB()}get(){return HU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l2(t,e){gc(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DL{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ju("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ju("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ju("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WU=new i_(3e4,6e4);function u2(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Dp(t,e,n,r,o={}){return zL(t,o,async()=>{let h={},f={};r&&(e==="GET"?f=r:h={body:JSON.stringify(r)});const l=Qg(Object.assign({key:t.config.apiKey},f)).slice(1),S=await t._getAdditionalHeaders();S["Content-Type"]="application/json",t.languageCode&&(S["X-Firebase-Locale"]=t.languageCode);const A=Object.assign({method:e,headers:S},h);return eB()||(A.referrerPolicy="no-referrer"),DL.fetch()(NL(t,t.config.apiHost,n,l),A)})}async function zL(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},ZU),e);try{const o=new XU(t),h=await Promise.race([n(),o.promise]);o.clearNetworkTimeout();const f=await h.json();if("needConfirmation"in f)throw my(t,"account-exists-with-different-credential",f);if(h.ok&&!("errorMessage"in f))return f;{const l=h.ok?f.errorMessage:f.error.message,[S,A]=l.split(" : ");if(S==="FEDERATED_USER_ID_ALREADY_LINKED")throw my(t,"credential-already-in-use",f);if(S==="EMAIL_EXISTS")throw my(t,"email-already-in-use",f);if(S==="USER_DISABLED")throw my(t,"user-disabled",f);const O=r[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(A)throw LL(t,O,A);mc(t,O)}}catch(o){if(o instanceof Vl)throw o;mc(t,"network-request-failed",{message:String(o)})}}async function KU(t,e,n,r,o={}){const h=await Dp(t,e,n,r,o);return"mfaPendingCredential"in h&&mc(t,"multi-factor-auth-required",{_serverResponse:h}),h}function NL(t,e,n,r){const o=`${e}${n}?${r}`;return t.config.emulator?l2(t.config,o):`${t.config.apiScheme}://${o}`}class XU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(_u(this.auth,"network-request-failed")),WU.get())})}}function my(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const o=_u(t,e,r);return o.customData._tokenResponse=n,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YU(t,e){return Dp(t,"POST","/v1/accounts:delete",e)}async function OL(t,e){return Dp(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rg(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function QU(t,e=!1){const n=Ko(t),r=await n.getIdToken(e),o=c2(r);yn(o&&o.exp&&o.auth_time&&o.iat,n.auth,"internal-error");const h=typeof o.firebase=="object"?o.firebase:void 0,f=h==null?void 0:h.sign_in_provider;return{claims:o,token:r,authTime:rg(Pw(o.auth_time)),issuedAtTime:rg(Pw(o.iat)),expirationTime:rg(Pw(o.exp)),signInProvider:f||null,signInSecondFactor:(h==null?void 0:h.sign_in_second_factor)||null}}function Pw(t){return Number(t)*1e3}function c2(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return jy("JWT malformed, contained fewer than 3 sections"),null;try{const o=JM(n);return o?JSON.parse(o):(jy("Failed to decode base64 JWT payload"),null)}catch(o){return jy("Caught error parsing JWT payload as JSON",o==null?void 0:o.toString()),null}}function YP(t){const e=c2(t);return yn(e,"internal-error"),yn(typeof e.exp<"u","internal-error"),yn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Og(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Vl&&JU(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function JU({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e8{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const o=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,o)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=rg(this.lastLoginAt),this.creationTime=rg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dv(t){var e;const n=t.auth,r=await t.getIdToken(),o=await Og(t,OL(n,{idToken:r}));yn(o==null?void 0:o.users.length,n,"internal-error");const h=o.users[0];t._notifyReloadListener(h);const f=!((e=h.providerUserInfo)===null||e===void 0)&&e.length?FL(h.providerUserInfo):[],l=n8(t.providerData,f),S=t.isAnonymous,A=!(t.email&&h.passwordHash)&&!(l!=null&&l.length),O=S?A:!1,U={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:l,metadata:new r1(h.createdAt,h.lastLoginAt),isAnonymous:O};Object.assign(t,U)}async function t8(t){const e=Ko(t);await Dv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function n8(t,e){return[...t.filter(r=>!e.some(o=>o.providerId===r.providerId)),...e]}function FL(t){return t.map(e=>{var{providerId:n}=e,r=o2(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i8(t,e){const n=await zL(t,{},async()=>{const r=Qg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:o,apiKey:h}=t.config,f=NL(t,o,"/v1/token",`key=${h}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",DL.fetch()(f,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function r8(t,e){return Dp(t,"POST","/v2/accounts:revokeToken",u2(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){yn(e.idToken,"internal-error"),yn(typeof e.idToken<"u","internal-error"),yn(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):YP(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){yn(e.length!==0,"internal-error");const n=YP(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(yn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:o,expiresIn:h}=await i8(e,n);this.updateTokensAndExpiration(r,o,Number(h))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:o,expirationTime:h}=n,f=new Qf;return r&&(yn(typeof r=="string","internal-error",{appName:e}),f.refreshToken=r),o&&(yn(typeof o=="string","internal-error",{appName:e}),f.accessToken=o),h&&(yn(typeof h=="number","internal-error",{appName:e}),f.expirationTime=h),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qf,this.toJSON())}_performRefresh(){return Ju("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $c(t,e){yn(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ec{constructor(e){var{uid:n,auth:r,stsTokenManager:o}=e,h=o2(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new e8(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=o,this.accessToken=o.accessToken,this.displayName=h.displayName||null,this.email=h.email||null,this.emailVerified=h.emailVerified||!1,this.phoneNumber=h.phoneNumber||null,this.photoURL=h.photoURL||null,this.isAnonymous=h.isAnonymous||!1,this.tenantId=h.tenantId||null,this.providerData=h.providerData?[...h.providerData]:[],this.metadata=new r1(h.createdAt||void 0,h.lastLoginAt||void 0)}async getIdToken(e){const n=await Og(this,this.stsTokenManager.getToken(this.auth,e));return yn(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return QU(this,e)}reload(){return t8(this)}_assign(e){this!==e&&(yn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ec(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){yn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Dv(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eh(this.auth.app))return Promise.reject(md(this.auth));const e=await this.getIdToken();return await Og(this,YU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,o,h,f,l,S,A,O;const U=(r=n.displayName)!==null&&r!==void 0?r:void 0,H=(o=n.email)!==null&&o!==void 0?o:void 0,$=(h=n.phoneNumber)!==null&&h!==void 0?h:void 0,ie=(f=n.photoURL)!==null&&f!==void 0?f:void 0,me=(l=n.tenantId)!==null&&l!==void 0?l:void 0,Me=(S=n._redirectEventId)!==null&&S!==void 0?S:void 0,ce=(A=n.createdAt)!==null&&A!==void 0?A:void 0,le=(O=n.lastLoginAt)!==null&&O!==void 0?O:void 0,{uid:ge,emailVerified:je,isAnonymous:rt,providerData:qe,stsTokenManager:fe}=n;yn(ge&&fe,e,"internal-error");const Q=Qf.fromJSON(this.name,fe);yn(typeof ge=="string",e,"internal-error"),$c(U,e.name),$c(H,e.name),yn(typeof je=="boolean",e,"internal-error"),yn(typeof rt=="boolean",e,"internal-error"),$c($,e.name),$c(ie,e.name),$c(me,e.name),$c(Me,e.name),$c(ce,e.name),$c(le,e.name);const ue=new ec({uid:ge,auth:e,email:H,emailVerified:je,displayName:U,isAnonymous:rt,photoURL:ie,phoneNumber:$,tenantId:me,stsTokenManager:Q,createdAt:ce,lastLoginAt:le});return qe&&Array.isArray(qe)&&(ue.providerData=qe.map(ve=>Object.assign({},ve))),Me&&(ue._redirectEventId=Me),ue}static async _fromIdTokenResponse(e,n,r=!1){const o=new Qf;o.updateFromServerResponse(n);const h=new ec({uid:n.localId,auth:e,stsTokenManager:o,isAnonymous:r});return await Dv(h),h}static async _fromGetAccountInfoResponse(e,n,r){const o=n.users[0];yn(o.localId!==void 0,"internal-error");const h=o.providerUserInfo!==void 0?FL(o.providerUserInfo):[],f=!(o.email&&o.passwordHash)&&!(h!=null&&h.length),l=new Qf;l.updateFromIdToken(r);const S=new ec({uid:o.localId,auth:e,stsTokenManager:l,isAnonymous:f}),A={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:h,metadata:new r1(o.createdAt,o.lastLoginAt),isAnonymous:!(o.email&&o.passwordHash)&&!(h!=null&&h.length)};return Object.assign(S,A),S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP=new Map;function tc(t){gc(t instanceof Function,"Expected a class definition");let e=QP.get(t);return e?(gc(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,QP.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BL{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}BL.type="NONE";const JP=BL;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(t,e,n){return`firebase:${t}:${e}:${n}`}class Jf{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:o,name:h}=this.auth;this.fullUserKey=Uy(this.userKey,o.apiKey,h),this.fullPersistenceKey=Uy("persistence",o.apiKey,h),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ec._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Jf(tc(JP),e,r);const o=(await Promise.all(n.map(async A=>{if(await A._isAvailable())return A}))).filter(A=>A);let h=o[0]||tc(JP);const f=Uy(r,e.config.apiKey,e.name);let l=null;for(const A of n)try{const O=await A._get(f);if(O){const U=ec._fromJSON(e,O);A!==h&&(l=U),h=A;break}}catch{}const S=o.filter(A=>A._shouldAllowMigration);return!h._shouldAllowMigration||!S.length?new Jf(h,e,r):(h=S[0],l&&await h._set(f,l.toJSON()),await Promise.all(n.map(async A=>{if(A!==h)try{await A._remove(f)}catch{}})),new Jf(h,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($L(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(VL(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(HL(e))return"Blackberry";if(GL(e))return"Webos";if(jL(e))return"Safari";if((e.includes("chrome/")||UL(e))&&!e.includes("edge/"))return"Chrome";if(qL(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function VL(t=eo()){return/firefox\//i.test(t)}function jL(t=eo()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function UL(t=eo()){return/crios\//i.test(t)}function $L(t=eo()){return/iemobile/i.test(t)}function qL(t=eo()){return/android/i.test(t)}function HL(t=eo()){return/blackberry/i.test(t)}function GL(t=eo()){return/webos/i.test(t)}function h2(t=eo()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function s8(t=eo()){var e;return h2(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function o8(){return nB()&&document.documentMode===10}function ZL(t=eo()){return h2(t)||qL(t)||GL(t)||HL(t)||/windows phone/i.test(t)||$L(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WL(t,e=[]){let n;switch(t){case"Browser":n=eC(eo());break;case"Worker":n=`${eC(eo())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Cp}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a8{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=h=>new Promise((f,l)=>{try{const S=e(h);f(S)}catch(S){l(S)}});r.onAbort=n,this.queue.push(r);const o=this.queue.length-1;return()=>{this.queue[o]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const o of n)try{o()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l8(t,e={}){return Dp(t,"GET","/v2/passwordPolicy",u2(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u8=6;class c8{constructor(e){var n,r,o,h;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=f.minPasswordLength)!==null&&n!==void 0?n:u8,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(o=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&o!==void 0?o:"",this.forceUpgradeOnSignin=(h=e.forceUpgradeOnSignin)!==null&&h!==void 0?h:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,o,h,f,l;const S={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,S),this.validatePasswordCharacterOptions(e,S),S.isValid&&(S.isValid=(n=S.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),S.isValid&&(S.isValid=(r=S.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),S.isValid&&(S.isValid=(o=S.containsLowercaseLetter)!==null&&o!==void 0?o:!0),S.isValid&&(S.isValid=(h=S.containsUppercaseLetter)!==null&&h!==void 0?h:!0),S.isValid&&(S.isValid=(f=S.containsNumericCharacter)!==null&&f!==void 0?f:!0),S.isValid&&(S.isValid=(l=S.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),S}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,o=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),o&&(n.meetsMaxPasswordLength=e.length<=o)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let o=0;o<e.length;o++)r=e.charAt(o),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,o,h){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=o)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h8{constructor(e,n,r,o){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=o,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tC(this),this.idTokenSubscription=new tC(this),this.beforeStateQueue=new a8(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=RL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=o.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=tc(n)),this._initializationPromise=this.queue(async()=>{var r,o;if(!this._deleted&&(this.persistenceManager=await Jf.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await OL(this,{idToken:e}),r=await ec._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(eh(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let o=r,h=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=o==null?void 0:o._redirectEventId,S=await this.tryRedirectSignIn(e);(!f||f===l)&&(S!=null&&S.user)&&(o=S.user,h=!0)}if(!o)return this.directlySetCurrentUser(null);if(!o._redirectEventId){if(h)try{await this.beforeStateQueue.runMiddleware(o)}catch(f){o=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return o?this.reloadAndSetCurrentUserOrClear(o):this.directlySetCurrentUser(null)}return yn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===o._redirectEventId?this.directlySetCurrentUser(o):this.reloadAndSetCurrentUserOrClear(o)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Dv(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eh(this.app))return Promise.reject(md(this));const n=e?Ko(e):null;return n&&yn(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&yn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eh(this.app)?Promise.reject(md(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eh(this.app)?Promise.reject(md(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(tc(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await l8(this),n=new c8(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Nd("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await r8(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&tc(e)||this._popupRedirectResolver;yn(n,this,"argument-error"),this.redirectPersistenceManager=await Jf.create(this,[tc(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,o){if(this._deleted)return()=>{};const h=typeof n=="function"?n:n.next.bind(n);let f=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(yn(l,this,"internal-error"),l.then(()=>{f||h(this.currentUser)}),typeof n=="function"){const S=e.addObserver(n,r,o);return()=>{f=!0,S()}}else{const S=e.addObserver(n);return()=>{f=!0,S()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return yn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=WL(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const o=await this._getAppCheckToken();return o&&(n["X-Firebase-AppCheck"]=o),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&$U(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function d2(t){return Ko(t)}class tC{constructor(e){this.auth=e,this.observer=null,this.addObserver=uB(n=>this.observer=n)}get next(){return yn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f2={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function d8(t){f2=t}function f8(t){return f2.loadJS(t)}function p8(){return f2.gapiScript}function m8(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g8(t,e){const n=Od(t,"auth");if(n.isInitialized()){const o=n.getImmediate(),h=n.getOptions();if(Cg(h,e??{}))return o;mc(o,"already-initialized")}return n.initialize({options:e})}function _8(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(tc);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function y8(t,e,n){const r=d2(t);yn(r._canInitEmulator,r,"emulator-config-failed"),yn(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const o=!1,h=KL(e),{host:f,port:l}=v8(e),S=l===null?"":`:${l}`;r.config.emulator={url:`${h}//${f}${S}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:f,port:l,protocol:h.replace(":",""),options:Object.freeze({disableWarnings:o})}),x8()}function KL(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function v8(t){const e=KL(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(r);if(o){const h=o[1];return{host:h,port:nC(r.substr(h.length+1))}}else{const[h,f]=r.split(":");return{host:h,port:nC(f)}}}function nC(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function x8(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ju("not implemented")}_getIdTokenResponse(e){return Ju("not implemented")}_linkToIdToken(e,n){return Ju("not implemented")}_getReauthenticationResolver(e){return Ju("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ep(t,e){return KU(t,"POST","/v1/accounts:signInWithIdp",u2(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w8="http://localhost";class Cd extends XL{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Cd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):mc("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:o}=n,h=o2(n,["providerId","signInMethod"]);if(!r||!o)return null;const f=new Cd(r,o);return f.idToken=h.idToken||void 0,f.accessToken=h.accessToken||void 0,f.secret=h.secret,f.nonce=h.nonce,f.pendingToken=h.pendingToken||null,f}_getIdTokenResponse(e){const n=this.buildRequest();return ep(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ep(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ep(e,n)}buildRequest(){const e={requestUri:w8,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Qg(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r_ extends YL{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc extends r_{constructor(){super("facebook.com")}static credential(e){return Cd._fromParams({providerId:Wc.PROVIDER_ID,signInMethod:Wc.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wc.credentialFromTaggedObject(e)}static credentialFromError(e){return Wc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wc.credential(e.oauthAccessToken)}catch{return null}}}Wc.FACEBOOK_SIGN_IN_METHOD="facebook.com";Wc.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc extends r_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Cd._fromParams({providerId:Kc.PROVIDER_ID,signInMethod:Kc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Kc.credentialFromTaggedObject(e)}static credentialFromError(e){return Kc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Kc.credential(n,r)}catch{return null}}}Kc.GOOGLE_SIGN_IN_METHOD="google.com";Kc.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc extends r_{constructor(){super("github.com")}static credential(e){return Cd._fromParams({providerId:Xc.PROVIDER_ID,signInMethod:Xc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xc.credentialFromTaggedObject(e)}static credentialFromError(e){return Xc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xc.credential(e.oauthAccessToken)}catch{return null}}}Xc.GITHUB_SIGN_IN_METHOD="github.com";Xc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc extends r_{constructor(){super("twitter.com")}static credential(e,n){return Cd._fromParams({providerId:Yc.PROVIDER_ID,signInMethod:Yc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Yc.credentialFromTaggedObject(e)}static credentialFromError(e){return Yc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Yc.credential(n,r)}catch{return null}}}Yc.TWITTER_SIGN_IN_METHOD="twitter.com";Yc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,o=!1){const h=await ec._fromIdTokenResponse(e,r,o),f=iC(r);return new xp({user:h,providerId:f,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const o=iC(r);return new xp({user:e,providerId:o,_tokenResponse:r,operationType:n})}}function iC(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv extends Vl{constructor(e,n,r,o){var h;super(n.code,n.message),this.operationType=r,this.user=o,Object.setPrototypeOf(this,zv.prototype),this.customData={appName:e.name,tenantId:(h=e.tenantId)!==null&&h!==void 0?h:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,o){return new zv(e,n,r,o)}}function QL(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(h=>{throw h.code==="auth/multi-factor-auth-required"?zv._fromErrorAndOperation(t,h,e,r):h})}async function b8(t,e,n=!1){const r=await Og(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return xp._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T8(t,e,n=!1){const{auth:r}=t;if(eh(r.app))return Promise.reject(md(r));const o="reauthenticate";try{const h=await Og(t,QL(r,o,e,t),n);yn(h.idToken,r,"internal-error");const f=c2(h.idToken);yn(f,r,"internal-error");const{sub:l}=f;return yn(t.uid===l,r,"user-mismatch"),xp._forOperation(t,o,h)}catch(h){throw(h==null?void 0:h.code)==="auth/user-not-found"&&mc(r,"user-mismatch"),h}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S8(t,e,n=!1){if(eh(t.app))return Promise.reject(md(t));const r="signIn",o=await QL(t,r,e),h=await xp._fromIdTokenResponse(t,r,o);return n||await t._updateCurrentUser(h.user),h}function E8(t,e,n,r){return Ko(t).onIdTokenChanged(e,n,r)}function I8(t,e,n){return Ko(t).beforeAuthStateChanged(e,n)}const Nv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JL{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Nv,"1"),this.storage.removeItem(Nv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P8=1e3,C8=10;class eD extends JL{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ZL(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),o=this.localCache[n];r!==o&&e(n,o,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((f,l,S)=>{this.notifyListeners(f,S)});return}const r=e.key;n?this.detachListener():this.stopPolling();const o=()=>{const f=this.storage.getItem(r);!n&&this.localCache[r]===f||this.notifyListeners(r,f)},h=this.storage.getItem(r);o8()&&h!==e.newValue&&e.newValue!==e.oldValue?setTimeout(o,C8):o()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const o of Array.from(r))o(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},P8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}eD.type="LOCAL";const A8=eD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD extends JL{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}tD.type="SESSION";const nD=tD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k8(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(o=>o.isListeningto(e));if(n)return n;const r=new k0(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:o,data:h}=n.data,f=this.handlersMap[o];if(!(f!=null&&f.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:o});const l=Array.from(f).map(async A=>A(n.origin,h)),S=await k8(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:o,response:S})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}k0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p2(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M8{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const o=typeof MessageChannel<"u"?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let h,f;return new Promise((l,S)=>{const A=p2("",20);o.port1.start();const O=setTimeout(()=>{S(new Error("unsupported_event"))},r);f={messageChannel:o,onMessage(U){const H=U;if(H.data.eventId===A)switch(H.data.status){case"ack":clearTimeout(O),h=setTimeout(()=>{S(new Error("timeout"))},3e3);break;case"done":clearTimeout(h),l(H.data.response);break;default:clearTimeout(O),clearTimeout(h),S(new Error("invalid_response"));break}}},this.handlers.add(f),o.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:A,data:n},[o.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yu(){return window}function R8(t){yu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iD(){return typeof yu().WorkerGlobalScope<"u"&&typeof yu().importScripts=="function"}async function L8(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function D8(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function z8(){return iD()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD="firebaseLocalStorageDb",N8=1,Ov="firebaseLocalStorage",sD="fbase_key";class s_{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function M0(t,e){return t.transaction([Ov],e?"readwrite":"readonly").objectStore(Ov)}function O8(){const t=indexedDB.deleteDatabase(rD);return new s_(t).toPromise()}function s1(){const t=indexedDB.open(rD,N8);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Ov,{keyPath:sD})}catch(o){n(o)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Ov)?e(r):(r.close(),await O8(),e(await s1()))})})}async function rC(t,e,n){const r=M0(t,!0).put({[sD]:e,value:n});return new s_(r).toPromise()}async function F8(t,e){const n=M0(t,!1).get(e),r=await new s_(n).toPromise();return r===void 0?null:r.value}function sC(t,e){const n=M0(t,!0).delete(e);return new s_(n).toPromise()}const B8=800,V8=3;class oD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await s1(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>V8)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return iD()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=k0._getInstance(z8()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await L8(),!this.activeServiceWorker)return;this.sender=new M8(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||D8()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await s1();return await rC(e,Nv,"1"),await sC(e,Nv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>rC(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>F8(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>sC(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(o=>{const h=M0(o,!1).getAll();return new s_(h).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:o,value:h}of e)r.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(h)&&(this.notifyListeners(o,h),n.push(o));for(const o of Object.keys(this.localCache))this.localCache[o]&&!r.has(o)&&(this.notifyListeners(o,null),n.push(o));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const o of Array.from(r))o(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),B8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}oD.type="LOCAL";const j8=oD;new i_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U8(t,e){return e?tc(e):(yn(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2 extends XL{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ep(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ep(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ep(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function $8(t){return S8(t.auth,new m2(t),t.bypassAuthState)}function q8(t){const{auth:e,user:n}=t;return yn(n,e,"internal-error"),T8(n,new m2(t),t.bypassAuthState)}async function H8(t){const{auth:e,user:n}=t;return yn(n,e,"internal-error"),b8(n,new m2(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{constructor(e,n,r,o,h=!1){this.auth=e,this.resolver=r,this.user=o,this.bypassAuthState=h,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:o,tenantId:h,error:f,type:l}=e;if(f){this.reject(f);return}const S={auth:this.auth,requestUri:n,sessionId:r,tenantId:h||void 0,postBody:o||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(S))}catch(A){this.reject(A)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $8;case"linkViaPopup":case"linkViaRedirect":return H8;case"reauthViaPopup":case"reauthViaRedirect":return q8;default:mc(this.auth,"internal-error")}}resolve(e){gc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G8=new i_(2e3,1e4);class qf extends aD{constructor(e,n,r,o,h){super(e,n,o,h),this.provider=r,this.authWindow=null,this.pollId=null,qf.currentPopupAction&&qf.currentPopupAction.cancel(),qf.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return yn(e,this.auth,"internal-error"),e}async onExecution(){gc(this.filter.length===1,"Popup operations only handle one event");const e=p2();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(_u(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(_u(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qf.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_u(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,G8.get())};e()}}qf.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z8="pendingRedirect",$y=new Map;class W8 extends aD{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=$y.get(this.auth._key());if(!e){try{const r=await K8(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}$y.set(this.auth._key(),e)}return this.bypassAuthState||$y.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function K8(t,e){const n=Q8(e),r=Y8(t);if(!await r._isAvailable())return!1;const o=await r._get(n)==="true";return await r._remove(n),o}function X8(t,e){$y.set(t._key(),e)}function Y8(t){return tc(t._redirectPersistence)}function Q8(t){return Uy(Z8,t.config.apiKey,t.name)}async function J8(t,e,n=!1){if(eh(t.app))return Promise.reject(md(t));const r=d2(t),o=U8(r,e),f=await new W8(r,o,n).execute();return f&&!n&&(delete f.user._redirectEventId,await r._persistUserIfCurrent(f.user),await r._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e$=10*60*1e3;class t${constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!n$(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!lD(e)){const o=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(_u(this.auth,o))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=e$&&this.cachedEventUids.clear(),this.cachedEventUids.has(oC(e))}saveEventToCache(e){this.cachedEventUids.add(oC(e)),this.lastProcessedEventTime=Date.now()}}function oC(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function lD({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function n$(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lD(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i$(t,e={}){return Dp(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r$=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s$=/^https?/;async function o$(t){if(t.config.emulator)return;const{authorizedDomains:e}=await i$(t);for(const n of e)try{if(a$(n))return}catch{}mc(t,"unauthorized-domain")}function a$(t){const e=i1(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const f=new URL(t);return f.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&f.hostname===r}if(!s$.test(n))return!1;if(r$.test(t))return r===t;const o=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l$=new i_(3e4,6e4);function aC(){const t=yu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function u$(t){return new Promise((e,n)=>{var r,o,h;function f(){aC(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{aC(),n(_u(t,"network-request-failed"))},timeout:l$.get()})}if(!((o=(r=yu().gapi)===null||r===void 0?void 0:r.iframes)===null||o===void 0)&&o.Iframe)e(gapi.iframes.getContext());else if(!((h=yu().gapi)===null||h===void 0)&&h.load)f();else{const l=m8("iframefcb");return yu()[l]=()=>{gapi.load?f():n(_u(t,"network-request-failed"))},f8(`${p8()}?onload=${l}`).catch(S=>n(S))}}).catch(e=>{throw qy=null,e})}let qy=null;function c$(t){return qy=qy||u$(t),qy}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h$=new i_(5e3,15e3),d$="__/auth/iframe",f$="emulator/auth/iframe",p$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},m$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function g$(t){const e=t.config;yn(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?l2(e,f$):`https://${t.config.authDomain}/${d$}`,r={apiKey:e.apiKey,appName:t.name,v:Cp},o=m$.get(t.config.apiHost);o&&(r.eid=o);const h=t._getFrameworks();return h.length&&(r.fw=h.join(",")),`${n}?${Qg(r).slice(1)}`}async function _$(t){const e=await c$(t),n=yu().gapi;return yn(n,t,"internal-error"),e.open({where:document.body,url:g$(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:p$,dontclear:!0},r=>new Promise(async(o,h)=>{await r.restyle({setHideOnLeave:!1});const f=_u(t,"network-request-failed"),l=yu().setTimeout(()=>{h(f)},h$.get());function S(){yu().clearTimeout(l),o(r)}r.ping(S).then(S,()=>{h(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},v$=500,x$=600,w$="_blank",b$="http://localhost";class lC{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function T$(t,e,n,r=v$,o=x$){const h=Math.max((window.screen.availHeight-o)/2,0).toString(),f=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const S=Object.assign(Object.assign({},y$),{width:r.toString(),height:o.toString(),top:h,left:f}),A=eo().toLowerCase();n&&(l=UL(A)?w$:n),VL(A)&&(e=e||b$,S.scrollbars="yes");const O=Object.entries(S).reduce((H,[$,ie])=>`${H}${$}=${ie},`,"");if(s8(A)&&l!=="_self")return S$(e||"",l),new lC(null);const U=window.open(e||"",l,O);yn(U,t,"popup-blocked");try{U.focus()}catch{}return new lC(U)}function S$(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E$="__/auth/handler",I$="emulator/auth/handler",P$=encodeURIComponent("fac");async function uC(t,e,n,r,o,h){yn(t.config.authDomain,t,"auth-domain-config-required"),yn(t.config.apiKey,t,"invalid-api-key");const f={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Cp,eventId:o};if(e instanceof YL){e.setDefaultLanguage(t.languageCode),f.providerId=e.providerId||"",lB(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[O,U]of Object.entries({}))f[O]=U}if(e instanceof r_){const O=e.getScopes().filter(U=>U!=="");O.length>0&&(f.scopes=O.join(","))}t.tenantId&&(f.tid=t.tenantId);const l=f;for(const O of Object.keys(l))l[O]===void 0&&delete l[O];const S=await t._getAppCheckToken(),A=S?`#${P$}=${encodeURIComponent(S)}`:"";return`${C$(t)}?${Qg(l).slice(1)}${A}`}function C$({config:t}){return t.emulator?l2(t,I$):`https://${t.authDomain}/${E$}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cw="webStorageSupport";class A${constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nD,this._completeRedirectFn=J8,this._overrideRedirectResult=X8}async _openPopup(e,n,r,o){var h;gc((h=this.eventManagers[e._key()])===null||h===void 0?void 0:h.manager,"_initialize() not called before _openPopup()");const f=await uC(e,n,r,i1(),o);return T$(e,f,p2())}async _openRedirect(e,n,r,o){await this._originValidation(e);const h=await uC(e,n,r,i1(),o);return R8(h),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:o,promise:h}=this.eventManagers[n];return o?Promise.resolve(o):(gc(h,"If manager is not set, promise should be"),h)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await _$(e),r=new t$(e);return n.register("authEvent",o=>(yn(o==null?void 0:o.authEvent,e,"invalid-auth-event"),{status:r.onEvent(o.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Cw,{type:Cw},o=>{var h;const f=(h=o==null?void 0:o[0])===null||h===void 0?void 0:h[Cw];f!==void 0&&n(!!f),mc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=o$(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return ZL()||jL()||h2()}}const k$=A$;var cC="@firebase/auth",hC="1.8.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M${constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){yn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R$(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function L$(t){Tu(new Fl("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),o=e.getProvider("heartbeat"),h=e.getProvider("app-check-internal"),{apiKey:f,authDomain:l}=r.options;yn(f&&!f.includes(":"),"invalid-api-key",{appName:r.name});const S={apiKey:f,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:WL(t)},A=new h8(r,o,h,S);return _8(A,n),A},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Tu(new Fl("auth-internal",e=>{const n=d2(e.getProvider("auth").getImmediate());return(r=>new M$(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Za(cC,hC,R$(t)),Za(cC,hC,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D$=5*60,z$=nR("authIdTokenMaxAge")||D$;let dC=null;const N$=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>z$)return;const o=n==null?void 0:n.token;dC!==o&&(dC=o,await fetch(t,{method:o?"POST":"DELETE",headers:o?{Authorization:`Bearer ${o}`}:{}}))};function O$(t=ST()){const e=Od(t,"auth");if(e.isInitialized())return e.getImmediate();const n=g8(t,{popupRedirectResolver:k$,persistence:[j8,A8,nD]}),r=nR("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const h=new URL(r,location.origin);if(location.origin===h.origin){const f=N$(h.toString());I8(n,f,()=>f(n.currentUser)),E8(n,l=>f(l))}}const o=eR("auth");return o&&y8(n,`http://${o}`),n}function F$(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}d8({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=o=>{const h=_u("internal-error");h.customData=o,n(h)},r.type="text/javascript",r.charset="UTF-8",F$().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});L$("Browser");const uD="@firebase/installations",g2="0.6.12";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cD=1e4,hD=`w:${g2}`,dD="FIS_v2",B$="https://firebaseinstallations.googleapis.com/v1",V$=60*60*1e3,j$="installations",U$="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $$={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ad=new Nd(j$,U$,$$);function fD(t){return t instanceof Vl&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pD({projectId:t}){return`${B$}/projects/${t}/installations`}function mD(t){return{token:t.token,requestStatus:2,expiresIn:H$(t.expiresIn),creationTime:Date.now()}}async function gD(t,e){const r=(await e.json()).error;return Ad.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function _D({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function q$(t,{refreshToken:e}){const n=_D(t);return n.append("Authorization",G$(e)),n}async function yD(t){const e=await t();return e.status>=500&&e.status<600?t():e}function H$(t){return Number(t.replace("s","000"))}function G$(t){return`${dD} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z$({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=pD(t),o=_D(t),h=e.getImmediate({optional:!0});if(h){const A=await h.getHeartbeatsHeader();A&&o.append("x-firebase-client",A)}const f={fid:n,authVersion:dD,appId:t.appId,sdkVersion:hD},l={method:"POST",headers:o,body:JSON.stringify(f)},S=await yD(()=>fetch(r,l));if(S.ok){const A=await S.json();return{fid:A.fid||n,registrationStatus:2,refreshToken:A.refreshToken,authToken:mD(A.authToken)}}else throw await gD("Create Installation",S)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vD(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W$(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K$=/^[cdef][\w-]{21}$/,o1="";function X$(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=Y$(t);return K$.test(n)?n:o1}catch{return o1}}function Y$(t){return W$(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R0(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD=new Map;function wD(t,e){const n=R0(t);bD(n,e),Q$(n,e)}function bD(t,e){const n=xD.get(t);if(n)for(const r of n)r(e)}function Q$(t,e){const n=J$();n&&n.postMessage({key:t,fid:e}),e9()}let hd=null;function J$(){return!hd&&"BroadcastChannel"in self&&(hd=new BroadcastChannel("[Firebase] FID Change"),hd.onmessage=t=>{bD(t.data.key,t.data.fid)}),hd}function e9(){xD.size===0&&hd&&(hd.close(),hd=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t9="firebase-installations-database",n9=1,kd="firebase-installations-store";let Aw=null;function _2(){return Aw||(Aw=lR(t9,n9,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(kd)}}})),Aw}async function Fv(t,e){const n=R0(t),o=(await _2()).transaction(kd,"readwrite"),h=o.objectStore(kd),f=await h.get(n);return await h.put(e,n),await o.done,(!f||f.fid!==e.fid)&&wD(t,e.fid),e}async function TD(t){const e=R0(t),r=(await _2()).transaction(kd,"readwrite");await r.objectStore(kd).delete(e),await r.done}async function L0(t,e){const n=R0(t),o=(await _2()).transaction(kd,"readwrite"),h=o.objectStore(kd),f=await h.get(n),l=e(f);return l===void 0?await h.delete(n):await h.put(l,n),await o.done,l&&(!f||f.fid!==l.fid)&&wD(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y2(t){let e;const n=await L0(t.appConfig,r=>{const o=i9(r),h=r9(t,o);return e=h.registrationPromise,h.installationEntry});return n.fid===o1?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function i9(t){const e=t||{fid:X$(),registrationStatus:0};return SD(e)}function r9(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const o=Promise.reject(Ad.create("app-offline"));return{installationEntry:e,registrationPromise:o}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=s9(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:o9(t)}:{installationEntry:e}}async function s9(t,e){try{const n=await Z$(t,e);return Fv(t.appConfig,n)}catch(n){throw fD(n)&&n.customData.serverCode===409?await TD(t.appConfig):await Fv(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function o9(t){let e=await fC(t.appConfig);for(;e.registrationStatus===1;)await vD(100),e=await fC(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await y2(t);return r||n}return e}function fC(t){return L0(t,e=>{if(!e)throw Ad.create("installation-not-found");return SD(e)})}function SD(t){return a9(t)?{fid:t.fid,registrationStatus:0}:t}function a9(t){return t.registrationStatus===1&&t.registrationTime+cD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l9({appConfig:t,heartbeatServiceProvider:e},n){const r=u9(t,n),o=q$(t,n),h=e.getImmediate({optional:!0});if(h){const A=await h.getHeartbeatsHeader();A&&o.append("x-firebase-client",A)}const f={installation:{sdkVersion:hD,appId:t.appId}},l={method:"POST",headers:o,body:JSON.stringify(f)},S=await yD(()=>fetch(r,l));if(S.ok){const A=await S.json();return mD(A)}else throw await gD("Generate Auth Token",S)}function u9(t,{fid:e}){return`${pD(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v2(t,e=!1){let n;const r=await L0(t.appConfig,h=>{if(!ED(h))throw Ad.create("not-registered");const f=h.authToken;if(!e&&d9(f))return h;if(f.requestStatus===1)return n=c9(t,e),h;{if(!navigator.onLine)throw Ad.create("app-offline");const l=p9(h);return n=h9(t,l),l}});return n?await n:r.authToken}async function c9(t,e){let n=await pC(t.appConfig);for(;n.authToken.requestStatus===1;)await vD(100),n=await pC(t.appConfig);const r=n.authToken;return r.requestStatus===0?v2(t,e):r}function pC(t){return L0(t,e=>{if(!ED(e))throw Ad.create("not-registered");const n=e.authToken;return m9(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function h9(t,e){try{const n=await l9(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await Fv(t.appConfig,r),n}catch(n){if(fD(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await TD(t.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Fv(t.appConfig,r)}throw n}}function ED(t){return t!==void 0&&t.registrationStatus===2}function d9(t){return t.requestStatus===2&&!f9(t)}function f9(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+V$}function p9(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function m9(t){return t.requestStatus===1&&t.requestTime+cD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g9(t){const e=t,{installationEntry:n,registrationPromise:r}=await y2(e);return r?r.catch(console.error):v2(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _9(t,e=!1){const n=t;return await y9(n),(await v2(n,e)).token}async function y9(t){const{registrationPromise:e}=await y2(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v9(t){if(!t||!t.options)throw kw("App Configuration");if(!t.name)throw kw("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw kw(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function kw(t){return Ad.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID="installations",x9="installations-internal",w9=t=>{const e=t.getProvider("app").getImmediate(),n=v9(e),r=Od(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},b9=t=>{const e=t.getProvider("app").getImmediate(),n=Od(e,ID).getImmediate();return{getId:()=>g9(n),getToken:o=>_9(n,o)}};function T9(){Tu(new Fl(ID,w9,"PUBLIC")),Tu(new Fl(x9,b9,"PRIVATE"))}T9();Za(uD,g2);Za(uD,g2,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bv="analytics",S9="firebase_id",E9="origin",I9=60*1e3,P9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",x2="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wo=new g0("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},ya=new Nd("analytics","Analytics",C9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A9(t){if(!t.startsWith(x2)){const e=ya.create("invalid-gtag-resource",{gtagURL:t});return Wo.warn(e.message),""}return t}function PD(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function k9(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function M9(t,e){const n=k9("firebase-js-sdk-policy",{createScriptURL:A9}),r=document.createElement("script"),o=`${x2}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(o):o,r.async=!0,document.head.appendChild(r)}function R9(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function L9(t,e,n,r,o,h){const f=r[o];try{if(f)await e[f];else{const S=(await PD(n)).find(A=>A.measurementId===o);S&&await e[S.appId]}}catch(l){Wo.error(l)}t("config",o,h)}async function D9(t,e,n,r,o){try{let h=[];if(o&&o.send_to){let f=o.send_to;Array.isArray(f)||(f=[f]);const l=await PD(n);for(const S of f){const A=l.find(U=>U.measurementId===S),O=A&&e[A.appId];if(O)h.push(O);else{h=[];break}}}h.length===0&&(h=Object.values(e)),await Promise.all(h),t("event",r,o||{})}catch(h){Wo.error(h)}}function z9(t,e,n,r){async function o(h,...f){try{if(h==="event"){const[l,S]=f;await D9(t,e,n,l,S)}else if(h==="config"){const[l,S]=f;await L9(t,e,n,r,l,S)}else if(h==="consent"){const[l,S]=f;t("consent",l,S)}else if(h==="get"){const[l,S,A]=f;t("get",l,S,A)}else if(h==="set"){const[l]=f;t("set",l)}else t(h,...f)}catch(l){Wo.error(l)}}return o}function N9(t,e,n,r,o){let h=function(...f){window[r].push(arguments)};return window[o]&&typeof window[o]=="function"&&(h=window[o]),window[o]=z9(h,t,e,n),{gtagCore:h,wrappedGtag:window[o]}}function O9(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(x2)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F9=30,B9=1e3;class V9{constructor(e={},n=B9){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const CD=new V9;function j9(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function U9(t){var e;const{appId:n,apiKey:r}=t,o={method:"GET",headers:j9(r)},h=P9.replace("{app-id}",n),f=await fetch(h,o);if(f.status!==200&&f.status!==304){let l="";try{const S=await f.json();!((e=S.error)===null||e===void 0)&&e.message&&(l=S.error.message)}catch{}throw ya.create("config-fetch-failed",{httpStatus:f.status,responseMessage:l})}return f.json()}async function $9(t,e=CD,n){const{appId:r,apiKey:o,measurementId:h}=t.options;if(!r)throw ya.create("no-app-id");if(!o){if(h)return{measurementId:h,appId:r};throw ya.create("no-api-key")}const f=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new G9;return setTimeout(async()=>{l.abort()},I9),AD({appId:r,apiKey:o,measurementId:h},f,l,e)}async function AD(t,{throttleEndTimeMillis:e,backoffCount:n},r,o=CD){var h;const{appId:f,measurementId:l}=t;try{await q9(r,e)}catch(S){if(l)return Wo.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${l} provided in the "measurementId" field in the local Firebase config. [${S==null?void 0:S.message}]`),{appId:f,measurementId:l};throw S}try{const S=await U9(t);return o.deleteThrottleMetadata(f),S}catch(S){const A=S;if(!H9(A)){if(o.deleteThrottleMetadata(f),l)return Wo.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${l} provided in the "measurementId" field in the local Firebase config. [${A==null?void 0:A.message}]`),{appId:f,measurementId:l};throw S}const O=Number((h=A==null?void 0:A.customData)===null||h===void 0?void 0:h.httpStatus)===503?QI(n,o.intervalMillis,F9):QI(n,o.intervalMillis),U={throttleEndTimeMillis:Date.now()+O,backoffCount:n+1};return o.setThrottleMetadata(f,U),Wo.debug(`Calling attemptFetch again in ${O} millis`),AD(t,U,r,o)}}function q9(t,e){return new Promise((n,r)=>{const o=Math.max(e-Date.now(),0),h=setTimeout(n,o);t.addEventListener(()=>{clearTimeout(h),r(ya.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function H9(t){if(!(t instanceof Vl)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class G9{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Z9(t,e,n,r,o){if(o&&o.global){t("event",n,r);return}else{const h=await e,f=Object.assign(Object.assign({},r),{send_to:h});t("event",n,f)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W9(){if(rR())try{await sR()}catch(t){return Wo.warn(ya.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Wo.warn(ya.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function K9(t,e,n,r,o,h,f){var l;const S=$9(t);S.then($=>{n[$.measurementId]=$.appId,t.options.measurementId&&$.measurementId!==t.options.measurementId&&Wo.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${$.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch($=>Wo.error($)),e.push(S);const A=W9().then($=>{if($)return r.getId()}),[O,U]=await Promise.all([S,A]);O9(h)||M9(h,O.measurementId),o("js",new Date);const H=(l=f==null?void 0:f.config)!==null&&l!==void 0?l:{};return H[E9]="firebase",H.update=!0,U!=null&&(H[S9]=U),o("config",O.measurementId,H),O.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let X9=class{constructor(e){this.app=e}_delete(){return delete sg[this.app.options.appId],Promise.resolve()}},sg={},mC=[];const gC={};let Mw="dataLayer",Y9="gtag",_C,kD,yC=!1;function Q9(){const t=[];if(iR()&&t.push("This is a browser extension environment."),rB()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,o)=>`(${o+1}) ${r}`).join(" "),n=ya.create("invalid-analytics-context",{errorInfo:e});Wo.warn(n.message)}}function J9(t,e,n){Q9();const r=t.options.appId;if(!r)throw ya.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Wo.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw ya.create("no-api-key");if(sg[r]!=null)throw ya.create("already-exists",{id:r});if(!yC){R9(Mw);const{wrappedGtag:h,gtagCore:f}=N9(sg,mC,gC,Mw,Y9);kD=h,_C=f,yC=!0}return sg[r]=K9(t,mC,gC,e,_C,Mw,n),new X9(t)}function e7(t=ST()){t=Ko(t);const e=Od(t,Bv);return e.isInitialized()?e.getImmediate():t7(t)}function t7(t,e={}){const n=Od(t,Bv);if(n.isInitialized()){const o=n.getImmediate();if(Cg(e,n.getOptions()))return o;throw ya.create("already-initialized")}return n.initialize({options:e})}function au(t,e,n,r){t=Ko(t),Z9(kD,sg[t.app.options.appId],e,n,r).catch(o=>Wo.error(o))}const vC="@firebase/analytics",xC="0.10.11";function n7(){Tu(new Fl(Bv,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),o=e.getProvider("installations-internal").getImmediate();return J9(r,o,n)},"PUBLIC")),Tu(new Fl("analytics-internal",t,"PRIVATE")),Za(vC,xC),Za(vC,xC,"esm2017");function t(e){try{const n=e.getProvider(Bv).getImmediate();return{logEvent:(r,o,h)=>au(n,r,o,h)}}catch(n){throw ya.create("interop-component-reg-failed",{reason:n})}}}n7();const i7={BASE_URL:"/client",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyCgb8B9AqcsHLkcU9WX8cRbt8qMgSveT1k",VITE_FIREBASE_APP_ID:"1:1016256516850:web:5b902e0616dfc3c926766b",VITE_FIREBASE_AUTH_DOMAIN:"redreport-29023.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-S4C6LSBB9G",VITE_FIREBASE_MESSAGING_SENDER_ID:"1016256516850",VITE_FIREBASE_PROJECT_ID:"redreport-29023",VITE_FIREBASE_STORAGE_BUCKET:"redreport-29023.firebasestorage.app"},r7={apiKey:"AIzaSyCgb8B9AqcsHLkcU9WX8cRbt8qMgSveT1k",authDomain:"redreport-29023.firebaseapp.com",projectId:"redreport-29023",storageBucket:"redreport-29023.firebasestorage.app",messagingSenderId:"1016256516850",appId:"1:1016256516850:web:5b902e0616dfc3c926766b",measurementId:"G-S4C6LSBB9G"},s7=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID"];s7.forEach(t=>{if(!i7[t])throw new Error(`Missing required environment variable: ${t}`)});const w2=uR(r7),bf=wU(w2);O$(w2);let Yr=null;typeof window<"u"&&(Yr=e7(w2));class Tf{static async withRetry(e,n=3,r=1e3){let o;for(let h=1;h<=n;h++)try{return await e()}catch(f){if(o=f,h===n)throw o;await new Promise(l=>setTimeout(l,r*Math.pow(2,h-1)))}throw o}static handleFirebaseError(e){switch(e.code){case"permission-denied":return"Access denied. Please check your permissions.";case"unavailable":return"Service temporarily unavailable. Please try again.";case"deadline-exceeded":return"Request timed out. Please try again.";case"not-found":return"The requested resource was not found.";case"already-exists":return"The resource already exists.";case"resource-exhausted":return"Service quota exceeded. Please try again later.";case"failed-precondition":return"Operation failed due to a precondition.";case"aborted":return"Operation was aborted.";case"out-of-range":return"Operation is out of valid range.";case"unimplemented":return"Operation is not implemented.";case"internal":return"Internal error occurred. Please try again.";case"unavailable":return"Service is currently unavailable.";case"data-loss":return"Data loss occurred.";case"unauthenticated":return"Authentication required.";default:return"An unexpected error occurred. Please try again."}}static isFirebaseError(e){return e&&typeof e.code=="string"&&typeof e.message=="string"}static logError(e,n){console.error(`Firebase Error in ${n}:`,{code:e.code,message:e.message,details:e.details,stack:e.stack})}}const Q2=class Q2{static async submitReport(e){return Tf.withRetry(async()=>(await VU(wf(bf,this.COLLECTION_NAME),{...e,Time:KP(),createdAt:KP()})).id)}static async getReports(e=100){return Tf.withRetry(async()=>{const n=km(wf(bf,this.COLLECTION_NAME),Mm("Time","desc"),LU(e));return(await Rm(n)).docs.map(o=>{var f,l,S;const h=o.data();return{id:o.id,Dorm:h.Dorm,Type:h.Type,Time:((f=h.Time)==null?void 0:f.toDate())||new Date,hallData:h.hallData,userAgent:h.userAgent,timestamp:((l=h.timestamp)==null?void 0:l.toDate())||((S=h.Time)==null?void 0:S.toDate())||new Date,sessionId:h.sessionId,deviceInfo:h.deviceInfo,incidentDetails:h.incidentDetails}})})}static async getReportsByHall(e){return Tf.withRetry(async()=>{const n=km(wf(bf,this.COLLECTION_NAME),Mm("Time","desc"));return(await Rm(n)).docs.map(o=>{var f,l,S;const h=o.data();return{id:o.id,Dorm:h.Dorm,Type:h.Type,Time:((f=h.Time)==null?void 0:f.toDate())||new Date,hallData:h.hallData,userAgent:h.userAgent,timestamp:((l=h.timestamp)==null?void 0:l.toDate())||((S=h.Time)==null?void 0:S.toDate())||new Date,sessionId:h.sessionId,deviceInfo:h.deviceInfo,incidentDetails:h.incidentDetails}}).filter(o=>o.Dorm===e)})}static async getReportsByType(e){return Tf.withRetry(async()=>{const n=km(wf(bf,this.COLLECTION_NAME),Mm("Time","desc"));return(await Rm(n)).docs.map(o=>{var f,l,S;const h=o.data();return{id:o.id,Dorm:h.Dorm,Type:h.Type,Time:((f=h.Time)==null?void 0:f.toDate())||new Date,hallData:h.hallData,userAgent:h.userAgent,timestamp:((l=h.timestamp)==null?void 0:l.toDate())||((S=h.Time)==null?void 0:S.toDate())||new Date,sessionId:h.sessionId,deviceInfo:h.deviceInfo,incidentDetails:h.incidentDetails}}).filter(o=>o.Type===e)})}static async getReportsByBuildingType(e){return Tf.withRetry(async()=>{const n=km(wf(bf,this.COLLECTION_NAME),Mm("Time","desc"));return(await Rm(n)).docs.map(o=>{var f,l,S;const h=o.data();return{id:o.id,Dorm:h.Dorm,Type:h.Type,Time:((f=h.Time)==null?void 0:f.toDate())||new Date,hallData:h.hallData,userAgent:h.userAgent,timestamp:((l=h.timestamp)==null?void 0:l.toDate())||((S=h.Time)==null?void 0:S.toDate())||new Date,sessionId:h.sessionId,deviceInfo:h.deviceInfo,incidentDetails:h.incidentDetails}}).filter(o=>{var h;return((h=o.hallData)==null?void 0:h.buildingType)===e})})}static async getReportsBySeverity(e){return Tf.withRetry(async()=>{const n=km(wf(bf,this.COLLECTION_NAME),Mm("Time","desc"));return(await Rm(n)).docs.map(o=>{var f,l,S;const h=o.data();return{id:o.id,Dorm:h.Dorm,Type:h.Type,Time:((f=h.Time)==null?void 0:f.toDate())||new Date,hallData:h.hallData,userAgent:h.userAgent,timestamp:((l=h.timestamp)==null?void 0:l.toDate())||((S=h.Time)==null?void 0:S.toDate())||new Date,sessionId:h.sessionId,deviceInfo:h.deviceInfo,incidentDetails:h.incidentDetails}}).filter(o=>{var h;return(((h=o.incidentDetails)==null?void 0:h.severity)||1)>=e})})}};Q2.COLLECTION_NAME="Test";let Vv=Q2;class $m{static logReportSubmission(e,n,r,o){Yr&&au(Yr,"report_submitted",{hall_name:e,incident_type:n,building_type:(r==null?void 0:r.buildingType)||"Unknown",location:(r==null?void 0:r.location)||"Unknown",platform:(o==null?void 0:o.platform)||"Unknown",browser:(o==null?void 0:o.browser)||"Unknown",screen_resolution:(o==null?void 0:o.screenResolution)||"Unknown",timestamp:new Date().toISOString()})}static logMapView(){Yr&&au(Yr,"map_viewed",{timestamp:new Date().toISOString()})}static logError(e,n){Yr&&au(Yr,"error_occurred",{error_message:e,context:n||"general",timestamp:new Date().toISOString()})}static logHallSelection(e,n){Yr&&au(Yr,"hall_selected",{hall_name:e,building_type:n,timestamp:new Date().toISOString()})}static logTypeSelection(e,n){Yr&&au(Yr,"type_selected",{type_id:e,type_name:n,timestamp:new Date().toISOString()})}static logSessionStart(e,n){Yr&&au(Yr,"session_started",{session_id:e,platform:(n==null?void 0:n.platform)||"Unknown",browser:(n==null?void 0:n.browser)||"Unknown",language:(n==null?void 0:n.language)||"Unknown",timezone:(n==null?void 0:n.timezone)||"Unknown",timestamp:new Date().toISOString()})}static logIncidentSeverity(e,n){Yr&&au(Yr,"incident_severity",{severity_level:e,incident_type:n,timestamp:new Date().toISOString()})}static logBuildingTypeAnalysis(e,n){Yr&&au(Yr,"building_type_analysis",{building_type:e,incident_count:n,timestamp:new Date().toISOString()})}static logGeographicAnalysis(e,n,r){Yr&&au(Yr,"geographic_analysis",{location:e,latitude:n,longitude:r,timestamp:new Date().toISOString()})}}function o7(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function a7(){const t=navigator.userAgent;let e="Unknown";t.includes("Chrome")?e="Chrome":t.includes("Firefox")?e="Firefox":t.includes("Safari")?e="Safari":t.includes("Edge")&&(e="Edge");let n="Unknown";return t.includes("Windows")?n="Windows":t.includes("Mac")?n="Mac":t.includes("Linux")?n="Linux":t.includes("Android")?n="Android":t.includes("iOS")&&(n="iOS"),{platform:n,browser:e,screenResolution:`${screen.width}x${screen.height}`,userAgent:t,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,viewport:{width:window.innerWidth,height:window.innerHeight}}}function l7(){return{sessionId:o7(),timestamp:new Date,deviceInfo:a7()}}function u7(t){return["Uncomfortable Situation","Sexual Harassment","Physical","Verbal Aggression","Discrimination"][t]||"Unknown"}function wC({onHallSelect:t,onTypeSelect:e,onSubmit:n}){const r=UM(),[o,h]=ut.useState(""),[f,l]=ut.useState();ut.useState(!1);const[S,A]=ut.useState(!1);var O=[],U=!0,H=_w.map(qe=>qe.name);function $(qe,fe,Q){const ue=document.createElement("div");ue.id=qe;const ve=_w.find(Pe=>Pe.name===qe);ue.innerHTML=`${qe} (${(ve==null?void 0:ve.buildingType)||"Unknown"})`,ue.onclick=()=>{for(Q.value=qe,h(qe),ce(),t==null||t(qe),$m.logHallSelection(qe,(ve==null?void 0:ve.buildingType)||"Unknown");fe!=null&&fe.firstChild;)fe.firstChild.remove()},fe==null||fe.appendChild(ue)}function ie(){var qe=document.getElementById("list");if(O.length==H.length||S){for(console.log("Deleting");qe!=null&&qe.firstChild;)qe.firstChild.remove();O=[]}}function me(qe){var fe=document.getElementById("list");if(U==!0)for(U=!1;fe!=null&&fe.firstChild;)fe.firstChild.remove();for(var Q of H)qe.value.length==0&&!O.includes(Q)&&(O.push(Q),$(Q,fe,qe))}function Me(qe){var Ee;A(!1),qe.classList.remove("completehall");var fe=qe.value.replace(/[^a-zA-Z0-9]/g,""),Q=document.getElementById("list");for(O=[],console.log(O);(Q==null?void 0:Q.children.length)!=0;)(Ee=Q==null?void 0:Q.firstChild)==null||Ee.remove();for(var ue of H){var ve=!0,Pe=!0,Ve=ue.replace(/[^a-zA-Z0-9]/g,"");for(let Xt=0;Xt<fe.length;Xt++)fe.length>Ve.length||fe[Xt].toLocaleLowerCase()!=Ve[Xt].toLocaleLowerCase()?(ve=!1,Pe=!1):(fe.length<Ve.length||fe[Xt].toLocaleLowerCase()!=Ve[Xt].toLocaleLowerCase())&&(Pe=!1);fe.length==0&&(Pe=!1),ve==!0&&O.push(ue),Pe==!0&&ce()}for(var ue of O)(Q==null?void 0:Q.children.namedItem(ue))==null&&$(ue,Q,qe)}function ce(qe){var fe=document.getElementById("report");fe==null||fe.classList.add("completehall"),A(!0),console.log("Ran")}const le=async qe=>{if(!S){alert("No Hall Selected");return}if(f===void 0){alert("Please select an incident type");return}try{const fe=_w.find(Pe=>Pe.name===qe),Q=Bm.find(Pe=>Pe.name===qe),ue=l7(),ve={Dorm:qe,Type:f,hallData:fe?{name:fe.name,location:fe.location,buildingType:fe.buildingType,latitude:Q==null?void 0:Q.latitude,longitude:Q==null?void 0:Q.longitude}:void 0,userAgent:ue.deviceInfo.userAgent,timestamp:ue.timestamp,sessionId:ue.sessionId,deviceInfo:{platform:ue.deviceInfo.platform,browser:ue.deviceInfo.browser,screenResolution:ue.deviceInfo.screenResolution},incidentDetails:{typeName:u7(f)}};n==null||n(ve),await Vv.submitReport(ve),$m.logReportSubmission(qe,f,fe,ue.deviceInfo),$m.logGeographicAnalysis((fe==null?void 0:fe.location)||"Unknown",Q==null?void 0:Q.latitude,Q==null?void 0:Q.longitude),r("/map")}catch(fe){console.error("Error submitting report:",fe),alert("Error submitting report. Please try again.")}};function ge(qe){var fe=qe.ownerDocument.getElementsByClassName("overlay");for(const Q of fe)Q.classList.replace("animate__fadeIn","animate__fadeOut"),Q.classList.replace("animate__fadeInDown","animate__fadeOut")}function je(qe){var fe=qe.ownerDocument.getElementsByClassName("overlay");for(const Q of fe)Q.classList.replace("animate__fadeOut","animate__fadeIn"),Q.classList.add("animate__fadeInDown")}const rt=(qe,fe)=>{l(qe),e==null||e(qe),$m.logTypeSelection(qe,fe)};return Lt.jsxs(Lt.Fragment,{children:[Lt.jsx("div",{id:"underlay",className:"underlay"}),Lt.jsx("div",{id:"overlay",className:"animate__animated animate__fadeIn overlay cont",onClick:qe=>{ge(qe.currentTarget)},children:Lt.jsxs("div",{className:"animate__animated animate__fadeInDown animate__delay-1s col",children:[Lt.jsxs("h3",{className:"xxlarge",children:[Lt.jsx("b",{className:"red",children:"Redreport"})," ND Campus Safety Tool",Lt.jsx("b",{className:"red",children:" Instructions"})]}),Lt.jsx("p",{className:"small",children:Lt.jsx("i",{children:"You don't need to suffer alone"})}),Lt.jsx("h6",{className:"small",children:"Click anywhere to access the form"}),Lt.jsxs("div",{className:"jus-center m-2",children:[Lt.jsx("div",{className:"chatbubble bubble small flip animate__animated animate__fadeInDown animate__delay-2s",children:"Enter a HCC/ND/SMC campus location"}),Lt.jsx("input",{type:"text",className:"w-50"})]}),Lt.jsxs("div",{className:"just-cent",children:[Lt.jsx("div",{className:"chatbubble bubble small animate__animated animate__fadeInDown animate__delay-2s",children:"Pick the appropiate option"}),Lt.jsx("div",{className:"button yellowbg"}),Lt.jsx("div",{className:"button redbg"}),Lt.jsx("div",{className:"button bluebg"}),Lt.jsx("div",{className:"button purplebg"}),Lt.jsx("div",{className:"button blackbg"})]})]})}),Lt.jsxs("div",{className:"cont",children:[Lt.jsx("div",{className:"just-cent",children:Lt.jsx("div",{onClick:qe=>{je(qe.currentTarget)},className:"circle"})}),Lt.jsxs("div",{children:[Lt.jsx("label",{htmlFor:"report",id:"DormQ",children:Lt.jsx("b",{children:"Where did you feel unsafe?"})}),Lt.jsx("h6",{children:"Enter a campus location"}),Lt.jsx("input",{id:"report",type:"text",name:"report",placeholder:"Alumni",onClick:qe=>{me(qe.currentTarget)},onInputCapture:qe=>{Me(qe.currentTarget)}}),Lt.jsx("div",{className:"just-cent h-100",children:Lt.jsx("div",{id:"list",className:"autocomplete-items"})})]}),Lt.jsx("div",{className:"autocomplete",onMouseDown:()=>{ie()}}),Lt.jsxs("div",{className:"mt-2",children:[Lt.jsx("button",{className:"button yellowbg base",onClick:()=>rt(0,"Uncomfortable Situation"),children:"Uncomfortable Situation"}),Lt.jsx("button",{className:"button redbg base",onClick:()=>rt(1,"Sexual Harassment"),children:"Sexual Harassment"}),Lt.jsx("button",{className:"button purplebg base",onClick:()=>rt(2,"Physical"),children:"Physical"}),Lt.jsx("button",{className:"button bluebg base",onClick:()=>rt(3,"Verbal Aggression"),children:"Verbal Aggression"}),Lt.jsx("button",{className:"button blackbg base",onClick:()=>rt(4,"Discrimination"),children:"Discrimination"})]}),Lt.jsx("button",{className:"submit button base w-50 borderred whitebg black",onClick:()=>{le(o)},children:"Submit"})]})]})}var a1={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(n,r){r(e)})(xA,function(n){var r="1.9.4";function o(d){var y,P,D,j;for(P=1,D=arguments.length;P<D;P++){j=arguments[P];for(y in j)d[y]=j[y]}return d}var h=Object.create||function(){function d(){}return function(y){return d.prototype=y,new d}}();function f(d,y){var P=Array.prototype.slice;if(d.bind)return d.bind.apply(d,P.call(arguments,1));var D=P.call(arguments,2);return function(){return d.apply(y,D.length?D.concat(P.call(arguments)):arguments)}}var l=0;function S(d){return"_leaflet_id"in d||(d._leaflet_id=++l),d._leaflet_id}function A(d,y,P){var D,j,se,Ae;return Ae=function(){D=!1,j&&(se.apply(P,j),j=!1)},se=function(){D?j=arguments:(d.apply(P,arguments),setTimeout(Ae,y),D=!0)},se}function O(d,y,P){var D=y[1],j=y[0],se=D-j;return d===D&&P?d:((d-j)%se+se)%se+j}function U(){return!1}function H(d,y){if(y===!1)return d;var P=Math.pow(10,y===void 0?6:y);return Math.round(d*P)/P}function $(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function ie(d){return $(d).split(/\s+/)}function me(d,y){Object.prototype.hasOwnProperty.call(d,"options")||(d.options=d.options?h(d.options):{});for(var P in y)d.options[P]=y[P];return d.options}function Me(d,y,P){var D=[];for(var j in d)D.push(encodeURIComponent(P?j.toUpperCase():j)+"="+encodeURIComponent(d[j]));return(!y||y.indexOf("?")===-1?"?":"&")+D.join("&")}var ce=/\{ *([\w_ -]+) *\}/g;function le(d,y){return d.replace(ce,function(P,D){var j=y[D];if(j===void 0)throw new Error("No value provided for variable "+P);return typeof j=="function"&&(j=j(y)),j})}var ge=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"};function je(d,y){for(var P=0;P<d.length;P++)if(d[P]===y)return P;return-1}var rt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function qe(d){return window["webkit"+d]||window["moz"+d]||window["ms"+d]}var fe=0;function Q(d){var y=+new Date,P=Math.max(0,16-(y-fe));return fe=y+P,window.setTimeout(d,P)}var ue=window.requestAnimationFrame||qe("RequestAnimationFrame")||Q,ve=window.cancelAnimationFrame||qe("CancelAnimationFrame")||qe("CancelRequestAnimationFrame")||function(d){window.clearTimeout(d)};function Pe(d,y,P){if(P&&ue===Q)d.call(y);else return ue.call(window,f(d,y))}function Ve(d){d&&ve.call(window,d)}var Ee={__proto__:null,extend:o,create:h,bind:f,get lastId(){return l},stamp:S,throttle:A,wrapNum:O,falseFn:U,formatNum:H,trim:$,splitWords:ie,setOptions:me,getParamString:Me,template:le,isArray:ge,indexOf:je,emptyImageUrl:rt,requestFn:ue,cancelFn:ve,requestAnimFrame:Pe,cancelAnimFrame:Ve};function Xt(){}Xt.extend=function(d){var y=function(){me(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=y.__super__=this.prototype,D=h(P);D.constructor=y,y.prototype=D;for(var j in this)Object.prototype.hasOwnProperty.call(this,j)&&j!=="prototype"&&j!=="__super__"&&(y[j]=this[j]);return d.statics&&o(y,d.statics),d.includes&&(tr(d.includes),o.apply(null,[D].concat(d.includes))),o(D,d),delete D.statics,delete D.includes,D.options&&(D.options=P.options?h(P.options):{},o(D.options,d.options)),D._initHooks=[],D.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var se=0,Ae=D._initHooks.length;se<Ae;se++)D._initHooks[se].call(this)}},y},Xt.include=function(d){var y=this.prototype.options;return o(this.prototype,d),d.options&&(this.prototype.options=y,this.mergeOptions(d.options)),this},Xt.mergeOptions=function(d){return o(this.prototype.options,d),this},Xt.addInitHook=function(d){var y=Array.prototype.slice.call(arguments,1),P=typeof d=="function"?d:function(){this[d].apply(this,y)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function tr(d){if(!(typeof L>"u"||!L||!L.Mixin)){d=ge(d)?d:[d];for(var y=0;y<d.length;y++)d[y]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Yt={on:function(d,y,P){if(typeof d=="object")for(var D in d)this._on(D,d[D],y);else{d=ie(d);for(var j=0,se=d.length;j<se;j++)this._on(d[j],y,P)}return this},off:function(d,y,P){if(!arguments.length)delete this._events;else if(typeof d=="object")for(var D in d)this._off(D,d[D],y);else{d=ie(d);for(var j=arguments.length===1,se=0,Ae=d.length;se<Ae;se++)j?this._off(d[se]):this._off(d[se],y,P)}return this},_on:function(d,y,P,D){if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}if(this._listens(d,y,P)===!1){P===this&&(P=void 0);var j={fn:y,ctx:P};D&&(j.once=!0),this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push(j)}},_off:function(d,y,P){var D,j,se;if(this._events&&(D=this._events[d],!!D)){if(arguments.length===1){if(this._firingCount)for(j=0,se=D.length;j<se;j++)D[j].fn=U;delete this._events[d];return}if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}var Ae=this._listens(d,y,P);if(Ae!==!1){var Ge=D[Ae];this._firingCount&&(Ge.fn=U,this._events[d]=D=D.slice()),D.splice(Ae,1)}}},fire:function(d,y,P){if(!this.listens(d,P))return this;var D=o({},y,{type:d,target:this,sourceTarget:y&&y.sourceTarget||this});if(this._events){var j=this._events[d];if(j){this._firingCount=this._firingCount+1||1;for(var se=0,Ae=j.length;se<Ae;se++){var Ge=j[se],et=Ge.fn;Ge.once&&this.off(d,et,Ge.ctx),et.call(Ge.ctx||this,D)}this._firingCount--}}return P&&this._propagateEvent(D),this},listens:function(d,y,P,D){typeof d!="string"&&console.warn('"string" type argument expected');var j=y;typeof y!="function"&&(D=!!y,j=void 0,P=void 0);var se=this._events&&this._events[d];if(se&&se.length&&this._listens(d,j,P)!==!1)return!0;if(D){for(var Ae in this._eventParents)if(this._eventParents[Ae].listens(d,y,P,D))return!0}return!1},_listens:function(d,y,P){if(!this._events)return!1;var D=this._events[d]||[];if(!y)return!!D.length;P===this&&(P=void 0);for(var j=0,se=D.length;j<se;j++)if(D[j].fn===y&&D[j].ctx===P)return j;return!1},once:function(d,y,P){if(typeof d=="object")for(var D in d)this._on(D,d[D],y,!0);else{d=ie(d);for(var j=0,se=d.length;j<se;j++)this._on(d[j],y,P,!0)}return this},addEventParent:function(d){return this._eventParents=this._eventParents||{},this._eventParents[S(d)]=d,this},removeEventParent:function(d){return this._eventParents&&delete this._eventParents[S(d)],this},_propagateEvent:function(d){for(var y in this._eventParents)this._eventParents[y].fire(d.type,o({layer:d.target,propagatedFrom:d.target},d),!0)}};Yt.addEventListener=Yt.on,Yt.removeEventListener=Yt.clearAllEventListeners=Yt.off,Yt.addOneTimeEventListener=Yt.once,Yt.fireEvent=Yt.fire,Yt.hasEventListeners=Yt.listens;var vi=Xt.extend(Yt);function lt(d,y,P){this.x=P?Math.round(d):d,this.y=P?Math.round(y):y}var Qt=Math.trunc||function(d){return d>0?Math.floor(d):Math.ceil(d)};lt.prototype={clone:function(){return new lt(this.x,this.y)},add:function(d){return this.clone()._add(Tt(d))},_add:function(d){return this.x+=d.x,this.y+=d.y,this},subtract:function(d){return this.clone()._subtract(Tt(d))},_subtract:function(d){return this.x-=d.x,this.y-=d.y,this},divideBy:function(d){return this.clone()._divideBy(d)},_divideBy:function(d){return this.x/=d,this.y/=d,this},multiplyBy:function(d){return this.clone()._multiplyBy(d)},_multiplyBy:function(d){return this.x*=d,this.y*=d,this},scaleBy:function(d){return new lt(this.x*d.x,this.y*d.y)},unscaleBy:function(d){return new lt(this.x/d.x,this.y/d.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Qt(this.x),this.y=Qt(this.y),this},distanceTo:function(d){d=Tt(d);var y=d.x-this.x,P=d.y-this.y;return Math.sqrt(y*y+P*P)},equals:function(d){return d=Tt(d),d.x===this.x&&d.y===this.y},contains:function(d){return d=Tt(d),Math.abs(d.x)<=Math.abs(this.x)&&Math.abs(d.y)<=Math.abs(this.y)},toString:function(){return"Point("+H(this.x)+", "+H(this.y)+")"}};function Tt(d,y,P){return d instanceof lt?d:ge(d)?new lt(d[0],d[1]):d==null?d:typeof d=="object"&&"x"in d&&"y"in d?new lt(d.x,d.y):new lt(d,y,P)}function nn(d,y){if(d)for(var P=y?[d,y]:d,D=0,j=P.length;D<j;D++)this.extend(P[D])}nn.prototype={extend:function(d){var y,P;if(!d)return this;if(d instanceof lt||typeof d[0]=="number"||"x"in d)y=P=Tt(d);else if(d=rn(d),y=d.min,P=d.max,!y||!P)return this;return!this.min&&!this.max?(this.min=y.clone(),this.max=P.clone()):(this.min.x=Math.min(y.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(y.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(d){return Tt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,d)},getBottomLeft:function(){return Tt(this.min.x,this.max.y)},getTopRight:function(){return Tt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(d){var y,P;return typeof d[0]=="number"||d instanceof lt?d=Tt(d):d=rn(d),d instanceof nn?(y=d.min,P=d.max):y=P=d,y.x>=this.min.x&&P.x<=this.max.x&&y.y>=this.min.y&&P.y<=this.max.y},intersects:function(d){d=rn(d);var y=this.min,P=this.max,D=d.min,j=d.max,se=j.x>=y.x&&D.x<=P.x,Ae=j.y>=y.y&&D.y<=P.y;return se&&Ae},overlaps:function(d){d=rn(d);var y=this.min,P=this.max,D=d.min,j=d.max,se=j.x>y.x&&D.x<P.x,Ae=j.y>y.y&&D.y<P.y;return se&&Ae},isValid:function(){return!!(this.min&&this.max)},pad:function(d){var y=this.min,P=this.max,D=Math.abs(y.x-P.x)*d,j=Math.abs(y.y-P.y)*d;return rn(Tt(y.x-D,y.y-j),Tt(P.x+D,P.y+j))},equals:function(d){return d?(d=rn(d),this.min.equals(d.getTopLeft())&&this.max.equals(d.getBottomRight())):!1}};function rn(d,y){return!d||d instanceof nn?d:new nn(d,y)}function cn(d,y){if(d)for(var P=y?[d,y]:d,D=0,j=P.length;D<j;D++)this.extend(P[D])}cn.prototype={extend:function(d){var y=this._southWest,P=this._northEast,D,j;if(d instanceof Jt)D=d,j=d;else if(d instanceof cn){if(D=d._southWest,j=d._northEast,!D||!j)return this}else return d?this.extend(on(d)||vn(d)):this;return!y&&!P?(this._southWest=new Jt(D.lat,D.lng),this._northEast=new Jt(j.lat,j.lng)):(y.lat=Math.min(D.lat,y.lat),y.lng=Math.min(D.lng,y.lng),P.lat=Math.max(j.lat,P.lat),P.lng=Math.max(j.lng,P.lng)),this},pad:function(d){var y=this._southWest,P=this._northEast,D=Math.abs(y.lat-P.lat)*d,j=Math.abs(y.lng-P.lng)*d;return new cn(new Jt(y.lat-D,y.lng-j),new Jt(P.lat+D,P.lng+j))},getCenter:function(){return new Jt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Jt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Jt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(d){typeof d[0]=="number"||d instanceof Jt||"lat"in d?d=on(d):d=vn(d);var y=this._southWest,P=this._northEast,D,j;return d instanceof cn?(D=d.getSouthWest(),j=d.getNorthEast()):D=j=d,D.lat>=y.lat&&j.lat<=P.lat&&D.lng>=y.lng&&j.lng<=P.lng},intersects:function(d){d=vn(d);var y=this._southWest,P=this._northEast,D=d.getSouthWest(),j=d.getNorthEast(),se=j.lat>=y.lat&&D.lat<=P.lat,Ae=j.lng>=y.lng&&D.lng<=P.lng;return se&&Ae},overlaps:function(d){d=vn(d);var y=this._southWest,P=this._northEast,D=d.getSouthWest(),j=d.getNorthEast(),se=j.lat>y.lat&&D.lat<P.lat,Ae=j.lng>y.lng&&D.lng<P.lng;return se&&Ae},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(d,y){return d?(d=vn(d),this._southWest.equals(d.getSouthWest(),y)&&this._northEast.equals(d.getNorthEast(),y)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function vn(d,y){return d instanceof cn?d:new cn(d,y)}function Jt(d,y,P){if(isNaN(d)||isNaN(y))throw new Error("Invalid LatLng object: ("+d+", "+y+")");this.lat=+d,this.lng=+y,P!==void 0&&(this.alt=+P)}Jt.prototype={equals:function(d,y){if(!d)return!1;d=on(d);var P=Math.max(Math.abs(this.lat-d.lat),Math.abs(this.lng-d.lng));return P<=(y===void 0?1e-9:y)},toString:function(d){return"LatLng("+H(this.lat,d)+", "+H(this.lng,d)+")"},distanceTo:function(d){return Ir.distance(this,on(d))},wrap:function(){return Ir.wrapLatLng(this)},toBounds:function(d){var y=180*d/40075017,P=y/Math.cos(Math.PI/180*this.lat);return vn([this.lat-y,this.lng-P],[this.lat+y,this.lng+P])},clone:function(){return new Jt(this.lat,this.lng,this.alt)}};function on(d,y,P){return d instanceof Jt?d:ge(d)&&typeof d[0]!="object"?d.length===3?new Jt(d[0],d[1],d[2]):d.length===2?new Jt(d[0],d[1]):null:d==null?d:typeof d=="object"&&"lat"in d?new Jt(d.lat,"lng"in d?d.lng:d.lon,d.alt):y===void 0?null:new Jt(d,y,P)}var xi={latLngToPoint:function(d,y){var P=this.projection.project(d),D=this.scale(y);return this.transformation._transform(P,D)},pointToLatLng:function(d,y){var P=this.scale(y),D=this.transformation.untransform(d,P);return this.projection.unproject(D)},project:function(d){return this.projection.project(d)},unproject:function(d){return this.projection.unproject(d)},scale:function(d){return 256*Math.pow(2,d)},zoom:function(d){return Math.log(d/256)/Math.LN2},getProjectedBounds:function(d){if(this.infinite)return null;var y=this.projection.bounds,P=this.scale(d),D=this.transformation.transform(y.min,P),j=this.transformation.transform(y.max,P);return new nn(D,j)},infinite:!1,wrapLatLng:function(d){var y=this.wrapLng?O(d.lng,this.wrapLng,!0):d.lng,P=this.wrapLat?O(d.lat,this.wrapLat,!0):d.lat,D=d.alt;return new Jt(P,y,D)},wrapLatLngBounds:function(d){var y=d.getCenter(),P=this.wrapLatLng(y),D=y.lat-P.lat,j=y.lng-P.lng;if(D===0&&j===0)return d;var se=d.getSouthWest(),Ae=d.getNorthEast(),Ge=new Jt(se.lat-D,se.lng-j),et=new Jt(Ae.lat-D,Ae.lng-j);return new cn(Ge,et)}},Ir=o({},xi,{wrapLng:[-180,180],R:6371e3,distance:function(d,y){var P=Math.PI/180,D=d.lat*P,j=y.lat*P,se=Math.sin((y.lat-d.lat)*P/2),Ae=Math.sin((y.lng-d.lng)*P/2),Ge=se*se+Math.cos(D)*Math.cos(j)*Ae*Ae,et=2*Math.atan2(Math.sqrt(Ge),Math.sqrt(1-Ge));return this.R*et}}),Pr=6378137,Ls={R:Pr,MAX_LATITUDE:85.0511287798,project:function(d){var y=Math.PI/180,P=this.MAX_LATITUDE,D=Math.max(Math.min(P,d.lat),-P),j=Math.sin(D*y);return new lt(this.R*d.lng*y,this.R*Math.log((1+j)/(1-j))/2)},unproject:function(d){var y=180/Math.PI;return new Jt((2*Math.atan(Math.exp(d.y/this.R))-Math.PI/2)*y,d.x*y/this.R)},bounds:function(){var d=Pr*Math.PI;return new nn([-d,-d],[d,d])}()};function ki(d,y,P,D){if(ge(d)){this._a=d[0],this._b=d[1],this._c=d[2],this._d=d[3];return}this._a=d,this._b=y,this._c=P,this._d=D}ki.prototype={transform:function(d,y){return this._transform(d.clone(),y)},_transform:function(d,y){return y=y||1,d.x=y*(this._a*d.x+this._b),d.y=y*(this._c*d.y+this._d),d},untransform:function(d,y){return y=y||1,new lt((d.x/y-this._b)/this._a,(d.y/y-this._d)/this._c)}};function ui(d,y,P,D){return new ki(d,y,P,D)}var Fr=o({},Ir,{code:"EPSG:3857",projection:Ls,transformation:function(){var d=.5/(Math.PI*Ls.R);return ui(d,.5,-d,.5)}()}),wi=o({},Fr,{code:"EPSG:900913"});function Ds(d){return document.createElementNS("http://www.w3.org/2000/svg",d)}function to(d,y){var P="",D,j,se,Ae,Ge,et;for(D=0,se=d.length;D<se;D++){for(Ge=d[D],j=0,Ae=Ge.length;j<Ae;j++)et=Ge[j],P+=(j?"L":"M")+et.x+" "+et.y;P+=y?xt.svg?"z":"x":""}return P||"M0 0"}var Br=document.documentElement.style,hs="ActiveXObject"in window,no=hs&&!document.addEventListener,hr="msLaunchUri"in navigator&&!("documentMode"in document),zs=Ct("webkit"),bo=Ct("android"),ds=Ct("android 2")||Ct("android 3"),Xo=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),To=bo&&Ct("Google")&&Xo<537&&!("AudioNode"in window),ni=!!window.opera,Ti=!hr&&Ct("chrome"),Vr=Ct("gecko")&&!zs&&!ni&&!hs,So=!Ti&&Ct("safari"),Ns=Ct("phantom"),Yo="OTransition"in Br,Os=navigator.platform.indexOf("Win")===0,Qo=hs&&"transition"in Br,fs="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ds,pe="MozPerspective"in Br,ee=!window.L_DISABLE_3D&&(Qo||fs||pe)&&!Yo&&!Ns,re=typeof orientation<"u"||Ct("mobile"),oe=re&&zs,Te=re&&fs,Le=!window.PointerEvent&&window.MSPointerEvent,Be=!!(window.PointerEvent||Le),He="ontouchstart"in window||!!window.TouchEvent,Fe=!window.L_NO_TOUCH&&(He||Be),Qe=re&&ni,Ye=re&&Vr,Ue=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Oe=function(){var d=!1;try{var y=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("testPassiveEventSupport",U,y),window.removeEventListener("testPassiveEventSupport",U,y)}catch{}return d}(),yt=function(){return!!document.createElement("canvas").getContext}(),vt=!!(document.createElementNS&&Ds("svg").createSVGRect),zt=!!vt&&function(){var d=document.createElement("div");return d.innerHTML="<svg/>",(d.firstChild&&d.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),tn=!vt&&function(){try{var d=document.createElement("div");d.innerHTML='<v:shape adj="1"/>';var y=d.firstChild;return y.style.behavior="url(#default#VML)",y&&typeof y.adj=="object"}catch{return!1}}(),nt=navigator.platform.indexOf("Mac")===0,wt=navigator.platform.indexOf("Linux")===0;function Ct(d){return navigator.userAgent.toLowerCase().indexOf(d)>=0}var xt={ie:hs,ielt9:no,edge:hr,webkit:zs,android:bo,android23:ds,androidStock:To,opera:ni,chrome:Ti,gecko:Vr,safari:So,phantom:Ns,opera12:Yo,win:Os,ie3d:Qo,webkit3d:fs,gecko3d:pe,any3d:ee,mobile:re,mobileWebkit:oe,mobileWebkit3d:Te,msPointer:Le,pointer:Be,touch:Fe,touchNative:He,mobileOpera:Qe,mobileGecko:Ye,retina:Ue,passiveEvents:Oe,canvas:yt,svg:vt,vml:tn,inlineSvg:zt,mac:nt,linux:wt},hn=xt.msPointer?"MSPointerDown":"pointerdown",qt=xt.msPointer?"MSPointerMove":"pointermove",kt=xt.msPointer?"MSPointerUp":"pointerup",Qn=xt.msPointer?"MSPointerCancel":"pointercancel",ps={touchstart:hn,touchmove:qt,touchend:kt,touchcancel:Qn},Si={touchstart:Ja,touchmove:Fs,touchend:Fs,touchcancel:Fs},Zn={},zn=!1;function Cr(d,y,P){return y==="touchstart"&&Io(),Si[y]?(P=Si[y].bind(this,P),d.addEventListener(ps[y],P,!1),P):(console.warn("wrong event specified:",y),U)}function ii(d,y,P){if(!ps[y]){console.warn("wrong event specified:",y);return}d.removeEventListener(ps[y],P,!1)}function Jo(d){Zn[d.pointerId]=d}function Eo(d){Zn[d.pointerId]&&(Zn[d.pointerId]=d)}function Qa(d){delete Zn[d.pointerId]}function Io(){zn||(document.addEventListener(hn,Jo,!0),document.addEventListener(qt,Eo,!0),document.addEventListener(kt,Qa,!0),document.addEventListener(Qn,Qa,!0),zn=!0)}function Fs(d,y){if(y.pointerType!==(y.MSPOINTER_TYPE_MOUSE||"mouse")){y.touches=[];for(var P in Zn)y.touches.push(Zn[P]);y.changedTouches=[y],d(y)}}function Ja(d,y){y.MSPOINTER_TYPE_TOUCH&&y.pointerType===y.MSPOINTER_TYPE_TOUCH&&si(y),Fs(d,y)}function jl(d){var y={},P,D;for(D in d)P=d[D],y[D]=P&&P.bind?P.bind(d):P;return d=y,y.type="dblclick",y.detail=2,y.isTrusted=!1,y._simulated=!0,y}var Ul=200;function Bs(d,y){d.addEventListener("dblclick",y);var P=0,D;function j(se){if(se.detail!==1){D=se.detail;return}if(!(se.pointerType==="mouse"||se.sourceCapabilities&&!se.sourceCapabilities.firesTouchEvents)){var Ae=ta(se);if(!(Ae.some(function(et){return et instanceof HTMLLabelElement&&et.attributes.for})&&!Ae.some(function(et){return et instanceof HTMLInputElement||et instanceof HTMLSelectElement}))){var Ge=Date.now();Ge-P<=Ul?(D++,D===2&&y(jl(se))):D=1,P=Ge}}}return d.addEventListener("click",j),{dblclick:y,simDblclick:j}}function Po(d,y){d.removeEventListener("dblclick",y.dblclick),d.removeEventListener("click",y.simDblclick)}var el=ln(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),tl=ln(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Cu=tl==="webkitTransition"||tl==="OTransition"?tl+"End":"transitionend";function $l(d){return typeof d=="string"?document.getElementById(d):d}function Co(d,y){var P=d.style[y]||d.currentStyle&&d.currentStyle[y];if((!P||P==="auto")&&document.defaultView){var D=document.defaultView.getComputedStyle(d,null);P=D?D[y]:null}return P==="auto"?null:P}function gn(d,y,P){var D=document.createElement(d);return D.className=y||"",P&&P.appendChild(D),D}function Jn(d){var y=d.parentNode;y&&y.removeChild(d)}function ba(d){for(;d.firstChild;)d.removeChild(d.firstChild)}function jr(d){var y=d.parentNode;y&&y.lastChild!==d&&y.appendChild(d)}function Ao(d){var y=d.parentNode;y&&y.firstChild!==d&&y.insertBefore(d,y.firstChild)}function Ta(d,y){if(d.classList!==void 0)return d.classList.contains(y);var P=$i(d);return P.length>0&&new RegExp("(^|\\s)"+y+"(\\s|$)").test(P)}function dn(d,y){if(d.classList!==void 0)for(var P=ie(y),D=0,j=P.length;D<j;D++)d.classList.add(P[D]);else if(!Ta(d,y)){var se=$i(d);nl(d,(se?se+" ":"")+y)}}function Wn(d,y){d.classList!==void 0?d.classList.remove(y):nl(d,$((" "+$i(d)+" ").replace(" "+y+" "," ")))}function nl(d,y){d.className.baseVal===void 0?d.className=y:d.className.baseVal=y}function $i(d){return d.correspondingElement&&(d=d.correspondingElement),d.className.baseVal===void 0?d.className:d.className.baseVal}function Bt(d,y){"opacity"in d.style?d.style.opacity=y:"filter"in d.style&&Ur(d,y)}function Ur(d,y){var P=!1,D="DXImageTransform.Microsoft.Alpha";try{P=d.filters.item(D)}catch{if(y===1)return}y=Math.round(y*100),P?(P.Enabled=y!==100,P.Opacity=y):d.style.filter+=" progid:"+D+"(opacity="+y+")"}function ln(d){for(var y=document.documentElement.style,P=0;P<d.length;P++)if(d[P]in y)return d[P];return!1}function ms(d,y,P){var D=y||new lt(0,0);d.style[el]=(xt.ie3d?"translate("+D.x+"px,"+D.y+"px)":"translate3d("+D.x+"px,"+D.y+"px,0)")+(P?" scale("+P+")":"")}function un(d,y){d._leaflet_pos=y,xt.any3d?ms(d,y):(d.style.left=y.x+"px",d.style.top=y.y+"px")}function Ar(d){return d._leaflet_pos||new lt(0,0)}var Vn,ei,ri;if("onselectstart"in document)Vn=function(){$t(window,"selectstart",si)},ei=function(){Ln(window,"selectstart",si)};else{var ko=ln(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Vn=function(){if(ko){var d=document.documentElement.style;ri=d[ko],d[ko]="none"}},ei=function(){ko&&(document.documentElement.style[ko]=ri,ri=void 0)}}function Xi(){$t(window,"dragstart",si)}function Yi(){Ln(window,"dragstart",si)}var qi,il;function $r(d){for(;d.tabIndex===-1;)d=d.parentNode;d.style&&(En(),qi=d,il=d.style.outlineStyle,d.style.outlineStyle="none",$t(window,"keydown",En))}function En(){qi&&(qi.style.outlineStyle=il,qi=void 0,il=void 0,Ln(window,"keydown",En))}function ea(d){do d=d.parentNode;while((!d.offsetWidth||!d.offsetHeight)&&d!==document.body);return d}function qr(d){var y=d.getBoundingClientRect();return{x:y.width/d.offsetWidth||1,y:y.height/d.offsetHeight||1,boundingClientRect:y}}var Vs={__proto__:null,TRANSFORM:el,TRANSITION:tl,TRANSITION_END:Cu,get:$l,getStyle:Co,create:gn,remove:Jn,empty:ba,toFront:jr,toBack:Ao,hasClass:Ta,addClass:dn,removeClass:Wn,setClass:nl,getClass:$i,setOpacity:Bt,testProp:ln,setTransform:ms,setPosition:un,getPosition:Ar,get disableTextSelection(){return Vn},get enableTextSelection(){return ei},disableImageDrag:Xi,enableImageDrag:Yi,preventOutline:$r,restoreOutline:En,getSizedParentNode:ea,getScale:qr};function $t(d,y,P,D){if(y&&typeof y=="object")for(var j in y)Mo(d,j,y[j],P);else{y=ie(y);for(var se=0,Ae=y.length;se<Ae;se++)Mo(d,y[se],P,D)}return this}var is="_leaflet_events";function Ln(d,y,P,D){if(arguments.length===1)rl(d),delete d[is];else if(y&&typeof y=="object")for(var j in y)xn(d,j,y[j],P);else if(y=ie(y),arguments.length===2)rl(d,function(Ge){return je(y,Ge)!==-1});else for(var se=0,Ae=y.length;se<Ae;se++)xn(d,y[se],P,D);return this}function rl(d,y){for(var P in d[is]){var D=P.split(/\d/)[0];(!y||y(D))&&xn(d,D,null,null,P)}}var Mn={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Mo(d,y,P,D){var j=y+S(P)+(D?"_"+S(D):"");if(d[is]&&d[is][j])return this;var se=function(Ge){return P.call(D||d,Ge||window.event)},Ae=se;!xt.touchNative&&xt.pointer&&y.indexOf("touch")===0?se=Cr(d,y,se):xt.touch&&y==="dblclick"?se=Bs(d,se):"addEventListener"in d?y==="touchstart"||y==="touchmove"||y==="wheel"||y==="mousewheel"?d.addEventListener(Mn[y]||y,se,xt.passiveEvents?{passive:!1}:!1):y==="mouseenter"||y==="mouseleave"?(se=function(Ge){Ge=Ge||window.event,ql(d,Ge)&&Ae(Ge)},d.addEventListener(Mn[y],se,!1)):d.addEventListener(y,Ae,!1):d.attachEvent("on"+y,se),d[is]=d[is]||{},d[is][j]=se}function xn(d,y,P,D,j){j=j||y+S(P)+(D?"_"+S(D):"");var se=d[is]&&d[is][j];if(!se)return this;!xt.touchNative&&xt.pointer&&y.indexOf("touch")===0?ii(d,y,se):xt.touch&&y==="dblclick"?Po(d,se):"removeEventListener"in d?d.removeEventListener(Mn[y]||y,se,!1):d.detachEvent("on"+y,se),d[is][j]=null}function Wt(d){return d.stopPropagation?d.stopPropagation():d.originalEvent?d.originalEvent._stopped=!0:d.cancelBubble=!0,this}function js(d){return Mo(d,"wheel",Wt),this}function fn(d){return $t(d,"mousedown touchstart dblclick contextmenu",Wt),d._leaflet_disable_click=!0,this}function si(d){return d.preventDefault?d.preventDefault():d.returnValue=!1,this}function Mi(d){return si(d),Wt(d),this}function ta(d){if(d.composedPath)return d.composedPath();for(var y=[],P=d.target;P;)y.push(P),P=P.parentNode;return y}function Ro(d,y){if(!y)return new lt(d.clientX,d.clientY);var P=qr(y),D=P.boundingClientRect;return new lt((d.clientX-D.left)/P.x-y.clientLeft,(d.clientY-D.top)/P.y-y.clientTop)}var oi=xt.linux&&xt.chrome?window.devicePixelRatio:xt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Lo(d){return xt.edge?d.wheelDeltaY/2:d.deltaY&&d.deltaMode===0?-d.deltaY/oi:d.deltaY&&d.deltaMode===1?-d.deltaY*20:d.deltaY&&d.deltaMode===2?-d.deltaY*60:d.deltaX||d.deltaZ?0:d.wheelDelta?(d.wheelDeltaY||d.wheelDelta)/2:d.detail&&Math.abs(d.detail)<32765?-d.detail*20:d.detail?d.detail/-32765*60:0}function ql(d,y){var P=y.relatedTarget;if(!P)return!0;try{for(;P&&P!==d;)P=P.parentNode}catch{return!1}return P!==d}var Hl={__proto__:null,on:$t,off:Ln,stopPropagation:Wt,disableScrollPropagation:js,disableClickPropagation:fn,preventDefault:si,stop:Mi,getPropagationPath:ta,getMousePosition:Ro,getWheelDelta:Lo,isExternalTarget:ql,addListener:$t,removeListener:Ln},sl=vi.extend({run:function(d,y,P,D){this.stop(),this._el=d,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(D||.5,.2),this._startPos=Ar(d),this._offset=y.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Pe(this._animate,this),this._step()},_step:function(d){var y=+new Date-this._startTime,P=this._duration*1e3;y<P?this._runFrame(this._easeOut(y/P),d):(this._runFrame(1),this._complete())},_runFrame:function(d,y){var P=this._startPos.add(this._offset.multiplyBy(d));y&&P._round(),un(this._el,P),this.fire("step")},_complete:function(){Ve(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(d){return 1-Math.pow(1-d,this._easeOutPower)}}),In=vi.extend({options:{crs:Fr,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(d,y){y=me(this,y),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(d),this._initLayout(),this._onResize=f(this._onResize,this),this._initEvents(),y.maxBounds&&this.setMaxBounds(y.maxBounds),y.zoom!==void 0&&(this._zoom=this._limitZoom(y.zoom)),y.center&&y.zoom!==void 0&&this.setView(on(y.center),y.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=tl&&xt.any3d&&!xt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),$t(this._proxy,Cu,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(d,y,P){if(y=y===void 0?this._zoom:this._limitZoom(y),d=this._limitCenter(on(d),y,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=o({animate:P.animate},P.zoom),P.pan=o({animate:P.animate,duration:P.duration},P.pan));var D=this._zoom!==y?this._tryAnimatedZoom&&this._tryAnimatedZoom(d,y,P.zoom):this._tryAnimatedPan(d,P.pan);if(D)return clearTimeout(this._sizeTimer),this}return this._resetView(d,y,P.pan&&P.pan.noMoveStart),this},setZoom:function(d,y){return this._loaded?this.setView(this.getCenter(),d,{zoom:y}):(this._zoom=d,this)},zoomIn:function(d,y){return d=d||(xt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+d,y)},zoomOut:function(d,y){return d=d||(xt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-d,y)},setZoomAround:function(d,y,P){var D=this.getZoomScale(y),j=this.getSize().divideBy(2),se=d instanceof lt?d:this.latLngToContainerPoint(d),Ae=se.subtract(j).multiplyBy(1-1/D),Ge=this.containerPointToLatLng(j.add(Ae));return this.setView(Ge,y,{zoom:P})},_getBoundsCenterZoom:function(d,y){y=y||{},d=d.getBounds?d.getBounds():vn(d);var P=Tt(y.paddingTopLeft||y.padding||[0,0]),D=Tt(y.paddingBottomRight||y.padding||[0,0]),j=this.getBoundsZoom(d,!1,P.add(D));if(j=typeof y.maxZoom=="number"?Math.min(y.maxZoom,j):j,j===1/0)return{center:d.getCenter(),zoom:j};var se=D.subtract(P).divideBy(2),Ae=this.project(d.getSouthWest(),j),Ge=this.project(d.getNorthEast(),j),et=this.unproject(Ae.add(Ge).divideBy(2).add(se),j);return{center:et,zoom:j}},fitBounds:function(d,y){if(d=vn(d),!d.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(d,y);return this.setView(P.center,P.zoom,y)},fitWorld:function(d){return this.fitBounds([[-90,-180],[90,180]],d)},panTo:function(d,y){return this.setView(d,this._zoom,{pan:y})},panBy:function(d,y){if(d=Tt(d).round(),y=y||{},!d.x&&!d.y)return this.fire("moveend");if(y.animate!==!0&&!this.getSize().contains(d))return this._resetView(this.unproject(this.project(this.getCenter()).add(d)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new sl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),y.noMoveStart||this.fire("movestart"),y.animate!==!1){dn(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(d).round();this._panAnim.run(this._mapPane,P,y.duration||.25,y.easeLinearity)}else this._rawPanBy(d),this.fire("move").fire("moveend");return this},flyTo:function(d,y,P){if(P=P||{},P.animate===!1||!xt.any3d)return this.setView(d,y,P);this._stop();var D=this.project(this.getCenter()),j=this.project(d),se=this.getSize(),Ae=this._zoom;d=on(d),y=y===void 0?Ae:y;var Ge=Math.max(se.x,se.y),et=Ge*this.getZoomScale(Ae,y),pt=j.distanceTo(D)||1,Dt=1.42,en=Dt*Dt;function bn(Hi){var ju=Hi?-1:1,Uu=Hi?et:Ge,eu=et*et-Ge*Ge+ju*en*en*pt*pt,Gr=2*Uu*en*pt,Ii=eu/Gr,gl=Math.sqrt(Ii*Ii+1)-Ii,lo=gl<1e-9?-18:Math.log(gl);return lo}function nr(Hi){return(Math.exp(Hi)-Math.exp(-Hi))/2}function ir(Hi){return(Math.exp(Hi)+Math.exp(-Hi))/2}function rs(Hi){return nr(Hi)/ir(Hi)}var kr=bn(0);function ml(Hi){return Ge*(ir(kr)/ir(kr+Dt*Hi))}function Da(Hi){return Ge*(ir(kr)*rs(kr+Dt*Hi)-nr(kr))/en}function zh(Hi){return 1-Math.pow(1-Hi,1.5)}var Jl=Date.now(),Nh=(bn(1)-kr)/Dt,Wd=P.duration?1e3*P.duration:1e3*Nh*.8;function Oh(){var Hi=(Date.now()-Jl)/Wd,ju=zh(Hi)*Nh;Hi<=1?(this._flyToFrame=Pe(Oh,this),this._move(this.unproject(D.add(j.subtract(D).multiplyBy(Da(ju)/pt)),Ae),this.getScaleZoom(Ge/ml(ju),Ae),{flyTo:!0})):this._move(d,y)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),Oh.call(this),this},flyToBounds:function(d,y){var P=this._getBoundsCenterZoom(d,y);return this.flyTo(P.center,P.zoom,y)},setMaxBounds:function(d){return d=vn(d),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),d.isValid()?(this.options.maxBounds=d,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(d){var y=this.options.minZoom;return this.options.minZoom=d,this._loaded&&y!==d&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(d):this},setMaxZoom:function(d){var y=this.options.maxZoom;return this.options.maxZoom=d,this._loaded&&y!==d&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(d):this},panInsideBounds:function(d,y){this._enforcingBounds=!0;var P=this.getCenter(),D=this._limitCenter(P,this._zoom,vn(d));return P.equals(D)||this.panTo(D,y),this._enforcingBounds=!1,this},panInside:function(d,y){y=y||{};var P=Tt(y.paddingTopLeft||y.padding||[0,0]),D=Tt(y.paddingBottomRight||y.padding||[0,0]),j=this.project(this.getCenter()),se=this.project(d),Ae=this.getPixelBounds(),Ge=rn([Ae.min.add(P),Ae.max.subtract(D)]),et=Ge.getSize();if(!Ge.contains(se)){this._enforcingBounds=!0;var pt=se.subtract(Ge.getCenter()),Dt=Ge.extend(se).getSize().subtract(et);j.x+=pt.x<0?-Dt.x:Dt.x,j.y+=pt.y<0?-Dt.y:Dt.y,this.panTo(this.unproject(j),y),this._enforcingBounds=!1}return this},invalidateSize:function(d){if(!this._loaded)return this;d=o({animate:!1,pan:!0},d===!0?{animate:!0}:d);var y=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),D=y.divideBy(2).round(),j=P.divideBy(2).round(),se=D.subtract(j);return!se.x&&!se.y?this:(d.animate&&d.pan?this.panBy(se):(d.pan&&this._rawPanBy(se),this.fire("move"),d.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(f(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:y,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(d){if(d=this._locateOptions=o({timeout:1e4,watch:!1},d),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var y=f(this._handleGeolocationResponse,this),P=f(this._handleGeolocationError,this);return d.watch?this._locationWatchId=navigator.geolocation.watchPosition(y,P,d):navigator.geolocation.getCurrentPosition(y,P,d),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(d){if(this._container._leaflet_id){var y=d.code,P=d.message||(y===1?"permission denied":y===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:y,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(d){if(this._container._leaflet_id){var y=d.coords.latitude,P=d.coords.longitude,D=new Jt(y,P),j=D.toBounds(d.coords.accuracy*2),se=this._locateOptions;if(se.setView){var Ae=this.getBoundsZoom(j);this.setView(D,se.maxZoom?Math.min(Ae,se.maxZoom):Ae)}var Ge={latlng:D,bounds:j,timestamp:d.timestamp};for(var et in d.coords)typeof d.coords[et]=="number"&&(Ge[et]=d.coords[et]);this.fire("locationfound",Ge)}},addHandler:function(d,y){if(!y)return this;var P=this[d]=new y(this);return this._handlers.push(P),this.options[d]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Jn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Ve(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var d;for(d in this._layers)this._layers[d].remove();for(d in this._panes)Jn(this._panes[d]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(d,y){var P="leaflet-pane"+(d?" leaflet-"+d.replace("Pane","")+"-pane":""),D=gn("div",P,y||this._mapPane);return d&&(this._panes[d]=D),D},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var d=this.getPixelBounds(),y=this.unproject(d.getBottomLeft()),P=this.unproject(d.getTopRight());return new cn(y,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(d,y,P){d=vn(d),P=Tt(P||[0,0]);var D=this.getZoom()||0,j=this.getMinZoom(),se=this.getMaxZoom(),Ae=d.getNorthWest(),Ge=d.getSouthEast(),et=this.getSize().subtract(P),pt=rn(this.project(Ge,D),this.project(Ae,D)).getSize(),Dt=xt.any3d?this.options.zoomSnap:1,en=et.x/pt.x,bn=et.y/pt.y,nr=y?Math.max(en,bn):Math.min(en,bn);return D=this.getScaleZoom(nr,D),Dt&&(D=Math.round(D/(Dt/100))*(Dt/100),D=y?Math.ceil(D/Dt)*Dt:Math.floor(D/Dt)*Dt),Math.max(j,Math.min(se,D))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new lt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(d,y){var P=this._getTopLeftPoint(d,y);return new nn(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(d){return this.options.crs.getProjectedBounds(d===void 0?this.getZoom():d)},getPane:function(d){return typeof d=="string"?this._panes[d]:d},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(d,y){var P=this.options.crs;return y=y===void 0?this._zoom:y,P.scale(d)/P.scale(y)},getScaleZoom:function(d,y){var P=this.options.crs;y=y===void 0?this._zoom:y;var D=P.zoom(d*P.scale(y));return isNaN(D)?1/0:D},project:function(d,y){return y=y===void 0?this._zoom:y,this.options.crs.latLngToPoint(on(d),y)},unproject:function(d,y){return y=y===void 0?this._zoom:y,this.options.crs.pointToLatLng(Tt(d),y)},layerPointToLatLng:function(d){var y=Tt(d).add(this.getPixelOrigin());return this.unproject(y)},latLngToLayerPoint:function(d){var y=this.project(on(d))._round();return y._subtract(this.getPixelOrigin())},wrapLatLng:function(d){return this.options.crs.wrapLatLng(on(d))},wrapLatLngBounds:function(d){return this.options.crs.wrapLatLngBounds(vn(d))},distance:function(d,y){return this.options.crs.distance(on(d),on(y))},containerPointToLayerPoint:function(d){return Tt(d).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(d){return Tt(d).add(this._getMapPanePos())},containerPointToLatLng:function(d){var y=this.containerPointToLayerPoint(Tt(d));return this.layerPointToLatLng(y)},latLngToContainerPoint:function(d){return this.layerPointToContainerPoint(this.latLngToLayerPoint(on(d)))},mouseEventToContainerPoint:function(d){return Ro(d,this._container)},mouseEventToLayerPoint:function(d){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(d))},mouseEventToLatLng:function(d){return this.layerPointToLatLng(this.mouseEventToLayerPoint(d))},_initContainer:function(d){var y=this._container=$l(d);if(y){if(y._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");$t(y,"scroll",this._onScroll,this),this._containerId=S(y)},_initLayout:function(){var d=this._container;this._fadeAnimated=this.options.fadeAnimation&&xt.any3d,dn(d,"leaflet-container"+(xt.touch?" leaflet-touch":"")+(xt.retina?" leaflet-retina":"")+(xt.ielt9?" leaflet-oldie":"")+(xt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var y=Co(d,"position");y!=="absolute"&&y!=="relative"&&y!=="fixed"&&y!=="sticky"&&(d.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var d=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),un(this._mapPane,new lt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(dn(d.markerPane,"leaflet-zoom-hide"),dn(d.shadowPane,"leaflet-zoom-hide"))},_resetView:function(d,y,P){un(this._mapPane,new lt(0,0));var D=!this._loaded;this._loaded=!0,y=this._limitZoom(y),this.fire("viewprereset");var j=this._zoom!==y;this._moveStart(j,P)._move(d,y)._moveEnd(j),this.fire("viewreset"),D&&this.fire("load")},_moveStart:function(d,y){return d&&this.fire("zoomstart"),y||this.fire("movestart"),this},_move:function(d,y,P,D){y===void 0&&(y=this._zoom);var j=this._zoom!==y;return this._zoom=y,this._lastCenter=d,this._pixelOrigin=this._getNewPixelOrigin(d),D?P&&P.pinch&&this.fire("zoom",P):((j||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(d){return d&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Ve(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(d){un(this._mapPane,this._getMapPanePos().subtract(d))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(d){this._targets={},this._targets[S(this._container)]=this;var y=d?Ln:$t;y(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&y(window,"resize",this._onResize,this),xt.any3d&&this.options.transform3DLimit&&(d?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Ve(this._resizeRequest),this._resizeRequest=Pe(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var d=this._getMapPanePos();Math.max(Math.abs(d.x),Math.abs(d.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(d,y){for(var P=[],D,j=y==="mouseout"||y==="mouseover",se=d.target||d.srcElement,Ae=!1;se;){if(D=this._targets[S(se)],D&&(y==="click"||y==="preclick")&&this._draggableMoved(D)){Ae=!0;break}if(D&&D.listens(y,!0)&&(j&&!ql(se,d)||(P.push(D),j))||se===this._container)break;se=se.parentNode}return!P.length&&!Ae&&!j&&this.listens(y,!0)&&(P=[this]),P},_isClickDisabled:function(d){for(;d&&d!==this._container;){if(d._leaflet_disable_click)return!0;d=d.parentNode}},_handleDOMEvent:function(d){var y=d.target||d.srcElement;if(!(!this._loaded||y._leaflet_disable_events||d.type==="click"&&this._isClickDisabled(y))){var P=d.type;P==="mousedown"&&$r(y),this._fireDOMEvent(d,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(d,y,P){if(d.type==="click"){var D=o({},d);D.type="preclick",this._fireDOMEvent(D,D.type,P)}var j=this._findEventTargets(d,y);if(P){for(var se=[],Ae=0;Ae<P.length;Ae++)P[Ae].listens(y,!0)&&se.push(P[Ae]);j=se.concat(j)}if(j.length){y==="contextmenu"&&si(d);var Ge=j[0],et={originalEvent:d};if(d.type!=="keypress"&&d.type!=="keydown"&&d.type!=="keyup"){var pt=Ge.getLatLng&&(!Ge._radius||Ge._radius<=10);et.containerPoint=pt?this.latLngToContainerPoint(Ge.getLatLng()):this.mouseEventToContainerPoint(d),et.layerPoint=this.containerPointToLayerPoint(et.containerPoint),et.latlng=pt?Ge.getLatLng():this.layerPointToLatLng(et.layerPoint)}for(Ae=0;Ae<j.length;Ae++)if(j[Ae].fire(y,et,!0),et.originalEvent._stopped||j[Ae].options.bubblingMouseEvents===!1&&je(this._mouseEvents,y)!==-1)return}},_draggableMoved:function(d){return d=d.dragging&&d.dragging.enabled()?d:this,d.dragging&&d.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var d=0,y=this._handlers.length;d<y;d++)this._handlers[d].disable()},whenReady:function(d,y){return this._loaded?d.call(y||this,{target:this}):this.on("load",d,y),this},_getMapPanePos:function(){return Ar(this._mapPane)||new lt(0,0)},_moved:function(){var d=this._getMapPanePos();return d&&!d.equals([0,0])},_getTopLeftPoint:function(d,y){var P=d&&y!==void 0?this._getNewPixelOrigin(d,y):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(d,y){var P=this.getSize()._divideBy(2);return this.project(d,y)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(d,y,P){var D=this._getNewPixelOrigin(P,y);return this.project(d,y)._subtract(D)},_latLngBoundsToNewLayerBounds:function(d,y,P){var D=this._getNewPixelOrigin(P,y);return rn([this.project(d.getSouthWest(),y)._subtract(D),this.project(d.getNorthWest(),y)._subtract(D),this.project(d.getSouthEast(),y)._subtract(D),this.project(d.getNorthEast(),y)._subtract(D)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(d){return this.latLngToLayerPoint(d).subtract(this._getCenterLayerPoint())},_limitCenter:function(d,y,P){if(!P)return d;var D=this.project(d,y),j=this.getSize().divideBy(2),se=new nn(D.subtract(j),D.add(j)),Ae=this._getBoundsOffset(se,P,y);return Math.abs(Ae.x)<=1&&Math.abs(Ae.y)<=1?d:this.unproject(D.add(Ae),y)},_limitOffset:function(d,y){if(!y)return d;var P=this.getPixelBounds(),D=new nn(P.min.add(d),P.max.add(d));return d.add(this._getBoundsOffset(D,y))},_getBoundsOffset:function(d,y,P){var D=rn(this.project(y.getNorthEast(),P),this.project(y.getSouthWest(),P)),j=D.min.subtract(d.min),se=D.max.subtract(d.max),Ae=this._rebound(j.x,-se.x),Ge=this._rebound(j.y,-se.y);return new lt(Ae,Ge)},_rebound:function(d,y){return d+y>0?Math.round(d-y)/2:Math.max(0,Math.ceil(d))-Math.max(0,Math.floor(y))},_limitZoom:function(d){var y=this.getMinZoom(),P=this.getMaxZoom(),D=xt.any3d?this.options.zoomSnap:1;return D&&(d=Math.round(d/D)*D),Math.max(y,Math.min(P,d))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Wn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(d,y){var P=this._getCenterOffset(d)._trunc();return(y&&y.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,y),!0)},_createAnimProxy:function(){var d=this._proxy=gn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(d),this.on("zoomanim",function(y){var P=el,D=this._proxy.style[P];ms(this._proxy,this.project(y.center,y.zoom),this.getZoomScale(y.zoom,1)),D===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Jn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var d=this.getCenter(),y=this.getZoom();ms(this._proxy,this.project(d,y),this.getZoomScale(y,1))},_catchTransitionEnd:function(d){this._animatingZoom&&d.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(d,y,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(y-this._zoom)>this.options.zoomAnimationThreshold)return!1;var D=this.getZoomScale(y),j=this._getCenterOffset(d)._divideBy(1-1/D);return P.animate!==!0&&!this.getSize().contains(j)?!1:(Pe(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(d,y,!0)},this),!0)},_animateZoom:function(d,y,P,D){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=d,this._animateToZoom=y,dn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:d,zoom:y,noUpdate:D}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(f(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Wn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Do(d,y){return new In(d,y)}var wn=Xt.extend({options:{position:"topright"},initialize:function(d){me(this,d)},getPosition:function(){return this.options.position},setPosition:function(d){var y=this._map;return y&&y.removeControl(this),this.options.position=d,y&&y.addControl(this),this},getContainer:function(){return this._container},addTo:function(d){this.remove(),this._map=d;var y=this._container=this.onAdd(d),P=this.getPosition(),D=d._controlCorners[P];return dn(y,"leaflet-control"),P.indexOf("bottom")!==-1?D.insertBefore(y,D.firstChild):D.appendChild(y),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Jn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(d){this._map&&d&&d.screenX>0&&d.screenY>0&&this._map.getContainer().focus()}}),Qi=function(d){return new wn(d)};In.include({addControl:function(d){return d.addTo(this),this},removeControl:function(d){return d.remove(),this},_initControlPos:function(){var d=this._controlCorners={},y="leaflet-",P=this._controlContainer=gn("div",y+"control-container",this._container);function D(j,se){var Ae=y+j+" "+y+se;d[j+se]=gn("div",Ae,P)}D("top","left"),D("top","right"),D("bottom","left"),D("bottom","right")},_clearControlPos:function(){for(var d in this._controlCorners)Jn(this._controlCorners[d]);Jn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Hr=wn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(d,y,P,D){return P<D?-1:D<P?1:0}},initialize:function(d,y,P){me(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var D in d)this._addLayer(d[D],D);for(D in y)this._addLayer(y[D],D,!0)},onAdd:function(d){this._initLayout(),this._update(),this._map=d,d.on("zoomend",this._checkDisabledLayers,this);for(var y=0;y<this._layers.length;y++)this._layers[y].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(d){return wn.prototype.addTo.call(this,d),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(d,y){return this._addLayer(d,y),this._map?this._update():this},addOverlay:function(d,y){return this._addLayer(d,y,!0),this._map?this._update():this},removeLayer:function(d){d.off("add remove",this._onLayerChange,this);var y=this._getLayer(S(d));return y&&this._layers.splice(this._layers.indexOf(y),1),this._map?this._update():this},expand:function(){dn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var d=this._map.getSize().y-(this._container.offsetTop+50);return d<this._section.clientHeight?(dn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=d+"px"):Wn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Wn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var d="leaflet-control-layers",y=this._container=gn("div",d),P=this.options.collapsed;y.setAttribute("aria-haspopup",!0),fn(y),js(y);var D=this._section=gn("section",d+"-list");P&&(this._map.on("click",this.collapse,this),$t(y,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var j=this._layersLink=gn("a",d+"-toggle",y);j.href="#",j.title="Layers",j.setAttribute("role","button"),$t(j,{keydown:function(se){se.keyCode===13&&this._expandSafely()},click:function(se){si(se),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=gn("div",d+"-base",D),this._separator=gn("div",d+"-separator",D),this._overlaysList=gn("div",d+"-overlays",D),y.appendChild(D)},_getLayer:function(d){for(var y=0;y<this._layers.length;y++)if(this._layers[y]&&S(this._layers[y].layer)===d)return this._layers[y]},_addLayer:function(d,y,P){this._map&&d.on("add remove",this._onLayerChange,this),this._layers.push({layer:d,name:y,overlay:P}),this.options.sortLayers&&this._layers.sort(f(function(D,j){return this.options.sortFunction(D.layer,j.layer,D.name,j.name)},this)),this.options.autoZIndex&&d.setZIndex&&(this._lastZIndex++,d.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ba(this._baseLayersList),ba(this._overlaysList),this._layerControlInputs=[];var d,y,P,D,j=0;for(P=0;P<this._layers.length;P++)D=this._layers[P],this._addItem(D),y=y||D.overlay,d=d||!D.overlay,j+=D.overlay?0:1;return this.options.hideSingleBase&&(d=d&&j>1,this._baseLayersList.style.display=d?"":"none"),this._separator.style.display=y&&d?"":"none",this},_onLayerChange:function(d){this._handlingClick||this._update();var y=this._getLayer(S(d.target)),P=y.overlay?d.type==="add"?"overlayadd":"overlayremove":d.type==="add"?"baselayerchange":null;P&&this._map.fire(P,y)},_createRadioElement:function(d,y){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+d+'"'+(y?' checked="checked"':"")+"/>",D=document.createElement("div");return D.innerHTML=P,D.firstChild},_addItem:function(d){var y=document.createElement("label"),P=this._map.hasLayer(d.layer),D;d.overlay?(D=document.createElement("input"),D.type="checkbox",D.className="leaflet-control-layers-selector",D.defaultChecked=P):D=this._createRadioElement("leaflet-base-layers_"+S(this),P),this._layerControlInputs.push(D),D.layerId=S(d.layer),$t(D,"click",this._onInputClick,this);var j=document.createElement("span");j.innerHTML=" "+d.name;var se=document.createElement("span");y.appendChild(se),se.appendChild(D),se.appendChild(j);var Ae=d.overlay?this._overlaysList:this._baseLayersList;return Ae.appendChild(y),this._checkDisabledLayers(),y},_onInputClick:function(){if(!this._preventClick){var d=this._layerControlInputs,y,P,D=[],j=[];this._handlingClick=!0;for(var se=d.length-1;se>=0;se--)y=d[se],P=this._getLayer(y.layerId).layer,y.checked?D.push(P):y.checked||j.push(P);for(se=0;se<j.length;se++)this._map.hasLayer(j[se])&&this._map.removeLayer(j[se]);for(se=0;se<D.length;se++)this._map.hasLayer(D[se])||this._map.addLayer(D[se]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var d=this._layerControlInputs,y,P,D=this._map.getZoom(),j=d.length-1;j>=0;j--)y=d[j],P=this._getLayer(y.layerId).layer,y.disabled=P.options.minZoom!==void 0&&D<P.options.minZoom||P.options.maxZoom!==void 0&&D>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var d=this._section;this._preventClick=!0,$t(d,"click",si),this.expand();var y=this;setTimeout(function(){Ln(d,"click",si),y._preventClick=!1})}}),na=function(d,y,P){return new Hr(d,y,P)},ci=wn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(d){var y="leaflet-control-zoom",P=gn("div",y+" leaflet-bar"),D=this.options;return this._zoomInButton=this._createButton(D.zoomInText,D.zoomInTitle,y+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(D.zoomOutText,D.zoomOutTitle,y+"-out",P,this._zoomOut),this._updateDisabled(),d.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(d){d.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(d){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(d.shiftKey?3:1))},_zoomOut:function(d){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(d.shiftKey?3:1))},_createButton:function(d,y,P,D,j){var se=gn("a",P,D);return se.innerHTML=d,se.href="#",se.title=y,se.setAttribute("role","button"),se.setAttribute("aria-label",y),fn(se),$t(se,"click",Mi),$t(se,"click",j,this),$t(se,"click",this._refocusOnMap,this),se},_updateDisabled:function(){var d=this._map,y="leaflet-disabled";Wn(this._zoomInButton,y),Wn(this._zoomOutButton,y),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||d._zoom===d.getMinZoom())&&(dn(this._zoomOutButton,y),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||d._zoom===d.getMaxZoom())&&(dn(this._zoomInButton,y),this._zoomInButton.setAttribute("aria-disabled","true"))}});In.mergeOptions({zoomControl:!0}),In.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ci,this.addControl(this.zoomControl))});var Gl=function(d){return new ci(d)},gs=wn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(d){var y="leaflet-control-scale",P=gn("div",y),D=this.options;return this._addScales(D,y+"-line",P),d.on(D.updateWhenIdle?"moveend":"move",this._update,this),d.whenReady(this._update,this),P},onRemove:function(d){d.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(d,y,P){d.metric&&(this._mScale=gn("div",y,P)),d.imperial&&(this._iScale=gn("div",y,P))},_update:function(){var d=this._map,y=d.getSize().y/2,P=d.distance(d.containerPointToLatLng([0,y]),d.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(P)},_updateScales:function(d){this.options.metric&&d&&this._updateMetric(d),this.options.imperial&&d&&this._updateImperial(d)},_updateMetric:function(d){var y=this._getRoundNum(d),P=y<1e3?y+" m":y/1e3+" km";this._updateScale(this._mScale,P,y/d)},_updateImperial:function(d){var y=d*3.2808399,P,D,j;y>5280?(P=y/5280,D=this._getRoundNum(P),this._updateScale(this._iScale,D+" mi",D/P)):(j=this._getRoundNum(y),this._updateScale(this._iScale,j+" ft",j/y))},_updateScale:function(d,y,P){d.style.width=Math.round(this.options.maxWidth*P)+"px",d.innerHTML=y},_getRoundNum:function(d){var y=Math.pow(10,(Math.floor(d)+"").length-1),P=d/y;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,y*P}}),ol=function(d){return new gs(d)},xc='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',io=wn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(xt.inlineSvg?xc+" ":"")+"Leaflet</a>"},initialize:function(d){me(this,d),this._attributions={}},onAdd:function(d){d.attributionControl=this,this._container=gn("div","leaflet-control-attribution"),fn(this._container);for(var y in d._layers)d._layers[y].getAttribution&&this.addAttribution(d._layers[y].getAttribution());return this._update(),d.on("layeradd",this._addAttribution,this),this._container},onRemove:function(d){d.off("layeradd",this._addAttribution,this)},_addAttribution:function(d){d.layer.getAttribution&&(this.addAttribution(d.layer.getAttribution()),d.layer.once("remove",function(){this.removeAttribution(d.layer.getAttribution())},this))},setPrefix:function(d){return this.options.prefix=d,this._update(),this},addAttribution:function(d){return d?(this._attributions[d]||(this._attributions[d]=0),this._attributions[d]++,this._update(),this):this},removeAttribution:function(d){return d?(this._attributions[d]&&(this._attributions[d]--,this._update()),this):this},_update:function(){if(this._map){var d=[];for(var y in this._attributions)this._attributions[y]&&d.push(y);var P=[];this.options.prefix&&P.push(this.options.prefix),d.length&&P.push(d.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});In.mergeOptions({attributionControl:!0}),In.addInitHook(function(){this.options.attributionControl&&new io().addTo(this)});var Au=function(d){return new io(d)};wn.Layers=Hr,wn.Zoom=ci,wn.Scale=gs,wn.Attribution=io,Qi.layers=na,Qi.zoom=Gl,Qi.scale=ol,Qi.attribution=Au;var _s=Xt.extend({initialize:function(d){this._map=d},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});_s.addTo=function(d,y){return d.addHandler(y,this),this};var zo={Events:Yt},ro=xt.touch?"touchstart mousedown":"mousedown",Ri=vi.extend({options:{clickTolerance:3},initialize:function(d,y,P,D){me(this,D),this._element=d,this._dragStartTarget=y||d,this._preventOutline=P},enable:function(){this._enabled||($t(this._dragStartTarget,ro,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ri._dragging===this&&this.finishDrag(!0),Ln(this._dragStartTarget,ro,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(d){if(this._enabled&&(this._moved=!1,!Ta(this._element,"leaflet-zoom-anim"))){if(d.touches&&d.touches.length!==1){Ri._dragging===this&&this.finishDrag();return}if(!(Ri._dragging||d.shiftKey||d.which!==1&&d.button!==1&&!d.touches)&&(Ri._dragging=this,this._preventOutline&&$r(this._element),Xi(),Vn(),!this._moving)){this.fire("down");var y=d.touches?d.touches[0]:d,P=ea(this._element);this._startPoint=new lt(y.clientX,y.clientY),this._startPos=Ar(this._element),this._parentScale=qr(P);var D=d.type==="mousedown";$t(document,D?"mousemove":"touchmove",this._onMove,this),$t(document,D?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(d){if(this._enabled){if(d.touches&&d.touches.length>1){this._moved=!0;return}var y=d.touches&&d.touches.length===1?d.touches[0]:d,P=new lt(y.clientX,y.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,si(d),this._moved||(this.fire("dragstart"),this._moved=!0,dn(document.body,"leaflet-dragging"),this._lastTarget=d.target||d.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),dn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=d,this._updatePosition())}},_updatePosition:function(){var d={originalEvent:this._lastEvent};this.fire("predrag",d),un(this._element,this._newPos),this.fire("drag",d)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(d){Wn(document.body,"leaflet-dragging"),this._lastTarget&&(Wn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ln(document,"mousemove touchmove",this._onMove,this),Ln(document,"mouseup touchend touchcancel",this._onUp,this),Yi(),ei();var y=this._moved&&this._moving;this._moving=!1,Ri._dragging=!1,y&&this.fire("dragend",{noInertia:d,distance:this._newPos.distanceTo(this._startPos)})}});function No(d,y,P){var D,j=[1,4,2,8],se,Ae,Ge,et,pt,Dt,en,bn;for(se=0,Dt=d.length;se<Dt;se++)d[se]._code=Us(d[se],y);for(Ge=0;Ge<4;Ge++){for(en=j[Ge],D=[],se=0,Dt=d.length,Ae=Dt-1;se<Dt;Ae=se++)et=d[se],pt=d[Ae],et._code&en?pt._code&en||(bn=dr(pt,et,en,y,P),bn._code=Us(bn,y),D.push(bn)):(pt._code&en&&(bn=dr(pt,et,en,y,P),bn._code=Us(bn,y),D.push(bn)),D.push(et));d=D}return d}function so(d,y){var P,D,j,se,Ae,Ge,et,pt,Dt;if(!d||d.length===0)throw new Error("latlngs not passed");E(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var en=on([0,0]),bn=vn(d),nr=bn.getNorthWest().distanceTo(bn.getSouthWest())*bn.getNorthEast().distanceTo(bn.getNorthWest());nr<1700&&(en=Sa(d));var ir=d.length,rs=[];for(P=0;P<ir;P++){var kr=on(d[P]);rs.push(y.project(on([kr.lat-en.lat,kr.lng-en.lng])))}for(Ge=et=pt=0,P=0,D=ir-1;P<ir;D=P++)j=rs[P],se=rs[D],Ae=j.y*se.x-se.y*j.x,et+=(j.x+se.x)*Ae,pt+=(j.y+se.y)*Ae,Ge+=Ae*3;Ge===0?Dt=rs[0]:Dt=[et/Ge,pt/Ge];var ml=y.unproject(Tt(Dt));return on([ml.lat+en.lat,ml.lng+en.lng])}function Sa(d){for(var y=0,P=0,D=0,j=0;j<d.length;j++){var se=on(d[j]);y+=se.lat,P+=se.lng,D++}return on([y/D,P/D])}var vr={__proto__:null,clipPolygon:No,polygonCenter:so,centroid:Sa};function ku(d,y){if(!y||!d.length)return d.slice();var P=y*y;return d=ll(d,P),d=Ea(d,P),d}function al(d,y,P){return Math.sqrt(xs(d,y,P,!0))}function ys(d,y,P){return xs(d,y,P)}function Ea(d,y){var P=d.length,D=typeof Uint8Array<"u"?Uint8Array:Array,j=new D(P);j[0]=j[P-1]=1,ia(d,j,y,0,P-1);var se,Ae=[];for(se=0;se<P;se++)j[se]&&Ae.push(d[se]);return Ae}function ia(d,y,P,D,j){var se=0,Ae,Ge,et;for(Ge=D+1;Ge<=j-1;Ge++)et=xs(d[Ge],d[D],d[j],!0),et>se&&(Ae=Ge,se=et);se>P&&(y[Ae]=1,ia(d,y,P,D,Ae),ia(d,y,P,Ae,j))}function ll(d,y){for(var P=[d[0]],D=1,j=0,se=d.length;D<se;D++)wc(d[D],d[j])>y&&(P.push(d[D]),j=D);return j<se-1&&P.push(d[se-1]),P}var Zl;function vs(d,y,P,D,j){var se=D?Zl:Us(d,P),Ae=Us(y,P),Ge,et,pt;for(Zl=Ae;;){if(!(se|Ae))return[d,y];if(se&Ae)return!1;Ge=se||Ae,et=dr(d,y,Ge,P,j),pt=Us(et,P),Ge===se?(d=et,se=pt):(y=et,Ae=pt)}}function dr(d,y,P,D,j){var se=y.x-d.x,Ae=y.y-d.y,Ge=D.min,et=D.max,pt,Dt;return P&8?(pt=d.x+se*(et.y-d.y)/Ae,Dt=et.y):P&4?(pt=d.x+se*(Ge.y-d.y)/Ae,Dt=Ge.y):P&2?(pt=et.x,Dt=d.y+Ae*(et.x-d.x)/se):P&1&&(pt=Ge.x,Dt=d.y+Ae*(Ge.x-d.x)/se),new lt(pt,Dt,j)}function Us(d,y){var P=0;return d.x<y.min.x?P|=1:d.x>y.max.x&&(P|=2),d.y<y.min.y?P|=4:d.y>y.max.y&&(P|=8),P}function wc(d,y){var P=y.x-d.x,D=y.y-d.y;return P*P+D*D}function xs(d,y,P,D){var j=y.x,se=y.y,Ae=P.x-j,Ge=P.y-se,et=Ae*Ae+Ge*Ge,pt;return et>0&&(pt=((d.x-j)*Ae+(d.y-se)*Ge)/et,pt>1?(j=P.x,se=P.y):pt>0&&(j+=Ae*pt,se+=Ge*pt)),Ae=d.x-j,Ge=d.y-se,D?Ae*Ae+Ge*Ge:new lt(j,se)}function E(d){return!ge(d[0])||typeof d[0][0]!="object"&&typeof d[0][0]<"u"}function F(d){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),E(d)}function W(d,y){var P,D,j,se,Ae,Ge,et,pt;if(!d||d.length===0)throw new Error("latlngs not passed");E(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var Dt=on([0,0]),en=vn(d),bn=en.getNorthWest().distanceTo(en.getSouthWest())*en.getNorthEast().distanceTo(en.getNorthWest());bn<1700&&(Dt=Sa(d));var nr=d.length,ir=[];for(P=0;P<nr;P++){var rs=on(d[P]);ir.push(y.project(on([rs.lat-Dt.lat,rs.lng-Dt.lng])))}for(P=0,D=0;P<nr-1;P++)D+=ir[P].distanceTo(ir[P+1])/2;if(D===0)pt=ir[0];else for(P=0,se=0;P<nr-1;P++)if(Ae=ir[P],Ge=ir[P+1],j=Ae.distanceTo(Ge),se+=j,se>D){et=(se-D)/j,pt=[Ge.x-et*(Ge.x-Ae.x),Ge.y-et*(Ge.y-Ae.y)];break}var kr=y.unproject(Tt(pt));return on([kr.lat+Dt.lat,kr.lng+Dt.lng])}var de={__proto__:null,simplify:ku,pointToSegmentDistance:al,closestPointOnSegment:ys,clipSegment:vs,_getEdgeIntersection:dr,_getBitCode:Us,_sqClosestPointOnSegment:xs,isFlat:E,_flat:F,polylineCenter:W},$e={project:function(d){return new lt(d.lng,d.lat)},unproject:function(d){return new Jt(d.y,d.x)},bounds:new nn([-180,-90],[180,90])},Je={R:6378137,R_MINOR:6356752314245179e-9,bounds:new nn([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(d){var y=Math.PI/180,P=this.R,D=d.lat*y,j=this.R_MINOR/P,se=Math.sqrt(1-j*j),Ae=se*Math.sin(D),Ge=Math.tan(Math.PI/4-D/2)/Math.pow((1-Ae)/(1+Ae),se/2);return D=-P*Math.log(Math.max(Ge,1e-10)),new lt(d.lng*y*P,D)},unproject:function(d){for(var y=180/Math.PI,P=this.R,D=this.R_MINOR/P,j=Math.sqrt(1-D*D),se=Math.exp(-d.y/P),Ae=Math.PI/2-2*Math.atan(se),Ge=0,et=.1,pt;Ge<15&&Math.abs(et)>1e-7;Ge++)pt=j*Math.sin(Ae),pt=Math.pow((1-pt)/(1+pt),j/2),et=Math.PI/2-2*Math.atan(se*pt)-Ae,Ae+=et;return new Jt(Ae*y,d.x*y/P)}},At={__proto__:null,LonLat:$e,Mercator:Je,SphericalMercator:Ls},Kn=o({},Ir,{code:"EPSG:3395",projection:Je,transformation:function(){var d=.5/(Math.PI*Je.R);return ui(d,.5,-d,.5)}()}),Ei=o({},Ir,{code:"EPSG:4326",projection:$e,transformation:ui(1/180,1,-1/180,.5)}),Dn=o({},xi,{projection:$e,transformation:ui(1,0,-1,0),scale:function(d){return Math.pow(2,d)},zoom:function(d){return Math.log(d)/Math.LN2},distance:function(d,y){var P=y.lng-d.lng,D=y.lat-d.lat;return Math.sqrt(P*P+D*D)},infinite:!0});xi.Earth=Ir,xi.EPSG3395=Kn,xi.EPSG3857=Fr,xi.EPSG900913=wi,xi.EPSG4326=Ei,xi.Simple=Dn;var qn=vi.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(d){return d.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(d){return d&&d.removeLayer(this),this},getPane:function(d){return this._map.getPane(d?this.options[d]||d:this.options.pane)},addInteractiveTarget:function(d){return this._map._targets[S(d)]=this,this},removeInteractiveTarget:function(d){return delete this._map._targets[S(d)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(d){var y=d.target;if(y.hasLayer(this)){if(this._map=y,this._zoomAnimated=y._zoomAnimated,this.getEvents){var P=this.getEvents();y.on(P,this),this.once("remove",function(){y.off(P,this)},this)}this.onAdd(y),this.fire("add"),y.fire("layeradd",{layer:this})}}});In.include({addLayer:function(d){if(!d._layerAdd)throw new Error("The provided object is not a Layer.");var y=S(d);return this._layers[y]?this:(this._layers[y]=d,d._mapToAdd=this,d.beforeAdd&&d.beforeAdd(this),this.whenReady(d._layerAdd,d),this)},removeLayer:function(d){var y=S(d);return this._layers[y]?(this._loaded&&d.onRemove(this),delete this._layers[y],this._loaded&&(this.fire("layerremove",{layer:d}),d.fire("remove")),d._map=d._mapToAdd=null,this):this},hasLayer:function(d){return S(d)in this._layers},eachLayer:function(d,y){for(var P in this._layers)d.call(y,this._layers[P]);return this},_addLayers:function(d){d=d?ge(d)?d:[d]:[];for(var y=0,P=d.length;y<P;y++)this.addLayer(d[y])},_addZoomLimit:function(d){(!isNaN(d.options.maxZoom)||!isNaN(d.options.minZoom))&&(this._zoomBoundLayers[S(d)]=d,this._updateZoomLevels())},_removeZoomLimit:function(d){var y=S(d);this._zoomBoundLayers[y]&&(delete this._zoomBoundLayers[y],this._updateZoomLevels())},_updateZoomLevels:function(){var d=1/0,y=-1/0,P=this._getZoomSpan();for(var D in this._zoomBoundLayers){var j=this._zoomBoundLayers[D].options;d=j.minZoom===void 0?d:Math.min(d,j.minZoom),y=j.maxZoom===void 0?y:Math.max(y,j.maxZoom)}this._layersMaxZoom=y===-1/0?void 0:y,this._layersMinZoom=d===1/0?void 0:d,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Li=qn.extend({initialize:function(d,y){me(this,y),this._layers={};var P,D;if(d)for(P=0,D=d.length;P<D;P++)this.addLayer(d[P])},addLayer:function(d){var y=this.getLayerId(d);return this._layers[y]=d,this._map&&this._map.addLayer(d),this},removeLayer:function(d){var y=d in this._layers?d:this.getLayerId(d);return this._map&&this._layers[y]&&this._map.removeLayer(this._layers[y]),delete this._layers[y],this},hasLayer:function(d){var y=typeof d=="number"?d:this.getLayerId(d);return y in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(d){var y=Array.prototype.slice.call(arguments,1),P,D;for(P in this._layers)D=this._layers[P],D[d]&&D[d].apply(D,y);return this},onAdd:function(d){this.eachLayer(d.addLayer,d)},onRemove:function(d){this.eachLayer(d.removeLayer,d)},eachLayer:function(d,y){for(var P in this._layers)d.call(y,this._layers[P]);return this},getLayer:function(d){return this._layers[d]},getLayers:function(){var d=[];return this.eachLayer(d.push,d),d},setZIndex:function(d){return this.invoke("setZIndex",d)},getLayerId:function(d){return S(d)}}),Ia=function(d,y){return new Li(d,y)},Di=Li.extend({addLayer:function(d){return this.hasLayer(d)?this:(d.addEventParent(this),Li.prototype.addLayer.call(this,d),this.fire("layeradd",{layer:d}))},removeLayer:function(d){return this.hasLayer(d)?(d in this._layers&&(d=this._layers[d]),d.removeEventParent(this),Li.prototype.removeLayer.call(this,d),this.fire("layerremove",{layer:d})):this},setStyle:function(d){return this.invoke("setStyle",d)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var d=new cn;for(var y in this._layers){var P=this._layers[y];d.extend(P.getBounds?P.getBounds():P.getLatLng())}return d}}),Pa=function(d,y){return new Di(d,y)},oo=Xt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(d){me(this,d)},createIcon:function(d){return this._createIcon("icon",d)},createShadow:function(d){return this._createIcon("shadow",d)},_createIcon:function(d,y){var P=this._getIconUrl(d);if(!P){if(d==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var D=this._createImg(P,y&&y.tagName==="IMG"?y:null);return this._setIconStyles(D,d),(this.options.crossOrigin||this.options.crossOrigin==="")&&(D.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),D},_setIconStyles:function(d,y){var P=this.options,D=P[y+"Size"];typeof D=="number"&&(D=[D,D]);var j=Tt(D),se=Tt(y==="shadow"&&P.shadowAnchor||P.iconAnchor||j&&j.divideBy(2,!0));d.className="leaflet-marker-"+y+" "+(P.className||""),se&&(d.style.marginLeft=-se.x+"px",d.style.marginTop=-se.y+"px"),j&&(d.style.width=j.x+"px",d.style.height=j.y+"px")},_createImg:function(d,y){return y=y||document.createElement("img"),y.src=d,y},_getIconUrl:function(d){return xt.retina&&this.options[d+"RetinaUrl"]||this.options[d+"Url"]}});function Ch(d){return new oo(d)}var ul=oo.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(d){return typeof ul.imagePath!="string"&&(ul.imagePath=this._detectIconPath()),(this.options.imagePath||ul.imagePath)+oo.prototype._getIconUrl.call(this,d)},_stripUrl:function(d){var y=function(P,D,j){var se=D.exec(P);return se&&se[j]};return d=y(d,/^url\((['"])?(.+)\1\)$/,2),d&&y(d,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var d=gn("div","leaflet-default-icon-path",document.body),y=Co(d,"background-image")||Co(d,"backgroundImage");if(document.body.removeChild(d),y=this._stripUrl(y),y)return y;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Wl=_s.extend({initialize:function(d){this._marker=d},addHooks:function(){var d=this._marker._icon;this._draggable||(this._draggable=new Ri(d,d,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),dn(d,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Wn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(d){var y=this._marker,P=y._map,D=this._marker.options.autoPanSpeed,j=this._marker.options.autoPanPadding,se=Ar(y._icon),Ae=P.getPixelBounds(),Ge=P.getPixelOrigin(),et=rn(Ae.min._subtract(Ge).add(j),Ae.max._subtract(Ge).subtract(j));if(!et.contains(se)){var pt=Tt((Math.max(et.max.x,se.x)-et.max.x)/(Ae.max.x-et.max.x)-(Math.min(et.min.x,se.x)-et.min.x)/(Ae.min.x-et.min.x),(Math.max(et.max.y,se.y)-et.max.y)/(Ae.max.y-et.max.y)-(Math.min(et.min.y,se.y)-et.min.y)/(Ae.min.y-et.min.y)).multiplyBy(D);P.panBy(pt,{animate:!1}),this._draggable._newPos._add(pt),this._draggable._startPos._add(pt),un(y._icon,this._draggable._newPos),this._onDrag(d),this._panRequest=Pe(this._adjustPan.bind(this,d))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(d){this._marker.options.autoPan&&(Ve(this._panRequest),this._panRequest=Pe(this._adjustPan.bind(this,d)))},_onDrag:function(d){var y=this._marker,P=y._shadow,D=Ar(y._icon),j=y._map.layerPointToLatLng(D);P&&un(P,D),y._latlng=j,d.latlng=j,d.oldLatLng=this._oldLatLng,y.fire("move",d).fire("drag",d)},_onDragEnd:function(d){Ve(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",d)}}),$s=qn.extend({options:{icon:new ul,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(d,y){me(this,y),this._latlng=on(d)},onAdd:function(d){this._zoomAnimated=this._zoomAnimated&&d.options.markerZoomAnimation,this._zoomAnimated&&d.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(d){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&d.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(d){var y=this._latlng;return this._latlng=on(d),this.update(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},setZIndexOffset:function(d){return this.options.zIndexOffset=d,this.update()},getIcon:function(){return this.options.icon},setIcon:function(d){return this.options.icon=d,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var d=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(d)}return this},_initIcon:function(){var d=this.options,y="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=d.icon.createIcon(this._icon),D=!1;P!==this._icon&&(this._icon&&this._removeIcon(),D=!0,d.title&&(P.title=d.title),P.tagName==="IMG"&&(P.alt=d.alt||"")),dn(P,y),d.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,d.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$t(P,"focus",this._panOnFocus,this);var j=d.icon.createShadow(this._shadow),se=!1;j!==this._shadow&&(this._removeShadow(),se=!0),j&&(dn(j,y),j.alt=""),this._shadow=j,d.opacity<1&&this._updateOpacity(),D&&this.getPane().appendChild(this._icon),this._initInteraction(),j&&se&&this.getPane(d.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ln(this._icon,"focus",this._panOnFocus,this),Jn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Jn(this._shadow),this._shadow=null},_setPos:function(d){this._icon&&un(this._icon,d),this._shadow&&un(this._shadow,d),this._zIndex=d.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(d){this._icon&&(this._icon.style.zIndex=this._zIndex+d)},_animateZoom:function(d){var y=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center).round();this._setPos(y)},_initInteraction:function(){if(this.options.interactive&&(dn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Wl)){var d=this.options.draggable;this.dragging&&(d=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Wl(this),d&&this.dragging.enable()}},setOpacity:function(d){return this.options.opacity=d,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var d=this.options.opacity;this._icon&&Bt(this._icon,d),this._shadow&&Bt(this._shadow,d)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var d=this._map;if(d){var y=this.options.icon.options,P=y.iconSize?Tt(y.iconSize):Tt(0,0),D=y.iconAnchor?Tt(y.iconAnchor):Tt(0,0);d.panInside(this._latlng,{paddingTopLeft:D,paddingBottomRight:P.subtract(D)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ah(d,y){return new $s(d,y)}var Oo=qn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(d){this._renderer=d.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(d){return me(this,d),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&d&&Object.prototype.hasOwnProperty.call(d,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),cl=Oo.extend({options:{fill:!0,radius:10},initialize:function(d,y){me(this,y),this._latlng=on(d),this._radius=this.options.radius},setLatLng:function(d){var y=this._latlng;return this._latlng=on(d),this.redraw(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(d){return this.options.radius=this._radius=d,this.redraw()},getRadius:function(){return this._radius},setStyle:function(d){var y=d&&d.radius||this._radius;return Oo.prototype.setStyle.call(this,d),this.setRadius(y),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var d=this._radius,y=this._radiusY||d,P=this._clickTolerance(),D=[d+P,y+P];this._pxBounds=new nn(this._point.subtract(D),this._point.add(D))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(d){return d.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ud(d,y){return new cl(d,y)}var Mu=cl.extend({initialize:function(d,y,P){if(typeof y=="number"&&(y=o({},P,{radius:y})),me(this,y),this._latlng=on(d),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(d){return this._mRadius=d,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var d=[this._radius,this._radiusY||this._radius];return new cn(this._map.layerPointToLatLng(this._point.subtract(d)),this._map.layerPointToLatLng(this._point.add(d)))},setStyle:Oo.prototype.setStyle,_project:function(){var d=this._latlng.lng,y=this._latlng.lat,P=this._map,D=P.options.crs;if(D.distance===Ir.distance){var j=Math.PI/180,se=this._mRadius/Ir.R/j,Ae=P.project([y+se,d]),Ge=P.project([y-se,d]),et=Ae.add(Ge).divideBy(2),pt=P.unproject(et).lat,Dt=Math.acos((Math.cos(se*j)-Math.sin(y*j)*Math.sin(pt*j))/(Math.cos(y*j)*Math.cos(pt*j)))/j;(isNaN(Dt)||Dt===0)&&(Dt=se/Math.cos(Math.PI/180*y)),this._point=et.subtract(P.getPixelOrigin()),this._radius=isNaN(Dt)?0:et.x-P.project([pt,d-Dt]).x,this._radiusY=et.y-Ae.y}else{var en=D.unproject(D.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(en).x}this._updateBounds()}});function hl(d,y,P){return new Mu(d,y,P)}var ao=Oo.extend({options:{smoothFactor:1,noClip:!1},initialize:function(d,y){me(this,y),this._setLatLngs(d)},getLatLngs:function(){return this._latlngs},setLatLngs:function(d){return this._setLatLngs(d),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(d){for(var y=1/0,P=null,D=xs,j,se,Ae=0,Ge=this._parts.length;Ae<Ge;Ae++)for(var et=this._parts[Ae],pt=1,Dt=et.length;pt<Dt;pt++){j=et[pt-1],se=et[pt];var en=D(d,j,se,!0);en<y&&(y=en,P=D(d,j,se))}return P&&(P.distance=Math.sqrt(y)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return W(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(d,y){return y=y||this._defaultShape(),d=on(d),y.push(d),this._bounds.extend(d),this.redraw()},_setLatLngs:function(d){this._bounds=new cn,this._latlngs=this._convertLatLngs(d)},_defaultShape:function(){return E(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(d){for(var y=[],P=E(d),D=0,j=d.length;D<j;D++)P?(y[D]=on(d[D]),this._bounds.extend(y[D])):y[D]=this._convertLatLngs(d[D]);return y},_project:function(){var d=new nn;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,d),this._bounds.isValid()&&d.isValid()&&(this._rawPxBounds=d,this._updateBounds())},_updateBounds:function(){var d=this._clickTolerance(),y=new lt(d,d);this._rawPxBounds&&(this._pxBounds=new nn([this._rawPxBounds.min.subtract(y),this._rawPxBounds.max.add(y)]))},_projectLatlngs:function(d,y,P){var D=d[0]instanceof Jt,j=d.length,se,Ae;if(D){for(Ae=[],se=0;se<j;se++)Ae[se]=this._map.latLngToLayerPoint(d[se]),P.extend(Ae[se]);y.push(Ae)}else for(se=0;se<j;se++)this._projectLatlngs(d[se],y,P)},_clipPoints:function(){var d=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}var y=this._parts,P,D,j,se,Ae,Ge,et;for(P=0,j=0,se=this._rings.length;P<se;P++)for(et=this._rings[P],D=0,Ae=et.length;D<Ae-1;D++)Ge=vs(et[D],et[D+1],d,D,!0),Ge&&(y[j]=y[j]||[],y[j].push(Ge[0]),(Ge[1]!==et[D+1]||D===Ae-2)&&(y[j].push(Ge[1]),j++))}},_simplifyPoints:function(){for(var d=this._parts,y=this.options.smoothFactor,P=0,D=d.length;P<D;P++)d[P]=ku(d[P],y)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(d,y){var P,D,j,se,Ae,Ge,et=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(P=0,se=this._parts.length;P<se;P++)for(Ge=this._parts[P],D=0,Ae=Ge.length,j=Ae-1;D<Ae;j=D++)if(!(!y&&D===0)&&al(d,Ge[j],Ge[D])<=et)return!0;return!1}});function jn(d,y){return new ao(d,y)}ao._flat=F;var Kl=ao.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return so(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(d){var y=ao.prototype._convertLatLngs.call(this,d),P=y.length;return P>=2&&y[0]instanceof Jt&&y[0].equals(y[P-1])&&y.pop(),y},_setLatLngs:function(d){ao.prototype._setLatLngs.call(this,d),E(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return E(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var d=this._renderer._bounds,y=this.options.weight,P=new lt(y,y);if(d=new nn(d.min.subtract(P),d.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}for(var D=0,j=this._rings.length,se;D<j;D++)se=No(this._rings[D],d,!0),se.length&&this._parts.push(se)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(d){var y=!1,P,D,j,se,Ae,Ge,et,pt;if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(se=0,et=this._parts.length;se<et;se++)for(P=this._parts[se],Ae=0,pt=P.length,Ge=pt-1;Ae<pt;Ge=Ae++)D=P[Ae],j=P[Ge],D.y>d.y!=j.y>d.y&&d.x<(j.x-D.x)*(d.y-D.y)/(j.y-D.y)+D.x&&(y=!y);return y||ao.prototype._containsPoint.call(this,d,!0)}});function Fp(d,y){return new Kl(d,y)}var ra=Di.extend({initialize:function(d,y){me(this,y),this._layers={},d&&this.addData(d)},addData:function(d){var y=ge(d)?d:d.features,P,D,j;if(y){for(P=0,D=y.length;P<D;P++)j=y[P],(j.geometries||j.geometry||j.features||j.coordinates)&&this.addData(j);return this}var se=this.options;if(se.filter&&!se.filter(d))return this;var Ae=Ru(d,se);return Ae?(Ae.feature=Fo(d),Ae.defaultOptions=Ae.options,this.resetStyle(Ae),se.onEachFeature&&se.onEachFeature(d,Ae),this.addLayer(Ae)):this},resetStyle:function(d){return d===void 0?this.eachLayer(this.resetStyle,this):(d.options=o({},d.defaultOptions),this._setLayerStyle(d,this.options.style),this)},setStyle:function(d){return this.eachLayer(function(y){this._setLayerStyle(y,d)},this)},_setLayerStyle:function(d,y){d.setStyle&&(typeof y=="function"&&(y=y(d.feature)),d.setStyle(y))}});function Ru(d,y){var P=d.type==="Feature"?d.geometry:d,D=P?P.coordinates:null,j=[],se=y&&y.pointToLayer,Ae=y&&y.coordsToLatLng||bc,Ge,et,pt,Dt;if(!D&&!P)return null;switch(P.type){case"Point":return Ge=Ae(D),$d(se,d,Ge,y);case"MultiPoint":for(pt=0,Dt=D.length;pt<Dt;pt++)Ge=Ae(D[pt]),j.push($d(se,d,Ge,y));return new Di(j);case"LineString":case"MultiLineString":return et=dl(D,P.type==="LineString"?0:1,Ae),new ao(et,y);case"Polygon":case"MultiPolygon":return et=dl(D,P.type==="Polygon"?1:2,Ae),new Kl(et,y);case"GeometryCollection":for(pt=0,Dt=P.geometries.length;pt<Dt;pt++){var en=Ru({geometry:P.geometries[pt],type:"Feature",properties:d.properties},y);en&&j.push(en)}return new Di(j);case"FeatureCollection":for(pt=0,Dt=P.features.length;pt<Dt;pt++){var bn=Ru(P.features[pt],y);bn&&j.push(bn)}return new Di(j);default:throw new Error("Invalid GeoJSON object.")}}function $d(d,y,P,D){return d?d(y,P):new $s(P,D&&D.markersInheritOptions&&D)}function bc(d){return new Jt(d[1],d[0],d[2])}function dl(d,y,P){for(var D=[],j=0,se=d.length,Ae;j<se;j++)Ae=y?dl(d[j],y-1,P):(P||bc)(d[j]),D.push(Ae);return D}function Xl(d,y){return d=on(d),d.alt!==void 0?[H(d.lng,y),H(d.lat,y),H(d.alt,y)]:[H(d.lng,y),H(d.lat,y)]}function fl(d,y,P,D){for(var j=[],se=0,Ae=d.length;se<Ae;se++)j.push(y?fl(d[se],E(d[se])?0:y-1,P,D):Xl(d[se],D));return!y&&P&&j.length>0&&j.push(j[0].slice()),j}function Ca(d,y){return d.feature?o({},d.feature,{geometry:y}):Fo(y)}function Fo(d){return d.type==="Feature"||d.type==="FeatureCollection"?d:{type:"Feature",properties:{},geometry:d}}var Aa={toGeoJSON:function(d){return Ca(this,{type:"Point",coordinates:Xl(this.getLatLng(),d)})}};$s.include(Aa),Mu.include(Aa),cl.include(Aa),ao.include({toGeoJSON:function(d){var y=!E(this._latlngs),P=fl(this._latlngs,y?1:0,!1,d);return Ca(this,{type:(y?"Multi":"")+"LineString",coordinates:P})}}),Kl.include({toGeoJSON:function(d){var y=!E(this._latlngs),P=y&&!E(this._latlngs[0]),D=fl(this._latlngs,P?2:y?1:0,!0,d);return y||(D=[D]),Ca(this,{type:(P?"Multi":"")+"Polygon",coordinates:D})}}),Li.include({toMultiPoint:function(d){var y=[];return this.eachLayer(function(P){y.push(P.toGeoJSON(d).geometry.coordinates)}),Ca(this,{type:"MultiPoint",coordinates:y})},toGeoJSON:function(d){var y=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(y==="MultiPoint")return this.toMultiPoint(d);var P=y==="GeometryCollection",D=[];return this.eachLayer(function(j){if(j.toGeoJSON){var se=j.toGeoJSON(d);if(P)D.push(se.geometry);else{var Ae=Fo(se);Ae.type==="FeatureCollection"?D.push.apply(D,Ae.features):D.push(Ae)}}}),P?Ca(this,{geometries:D,type:"GeometryCollection"}):{type:"FeatureCollection",features:D}}});function ws(d,y){return new ra(d,y)}var qd=ws,Lu=qn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(d,y,P){this._url=d,this._bounds=vn(y),me(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(dn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Jn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(d){return this.options.opacity=d,this._image&&this._updateOpacity(),this},setStyle:function(d){return d.opacity&&this.setOpacity(d.opacity),this},bringToFront:function(){return this._map&&jr(this._image),this},bringToBack:function(){return this._map&&Ao(this._image),this},setUrl:function(d){return this._url=d,this._image&&(this._image.src=d),this},setBounds:function(d){return this._bounds=vn(d),this._map&&this._reset(),this},getEvents:function(){var d={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var d=this._url.tagName==="IMG",y=this._image=d?this._url:gn("img");if(dn(y,"leaflet-image-layer"),this._zoomAnimated&&dn(y,"leaflet-zoom-animated"),this.options.className&&dn(y,this.options.className),y.onselectstart=U,y.onmousemove=U,y.onload=f(this.fire,this,"load"),y.onerror=f(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),d){this._url=y.src;return}y.src=this._url,y.alt=this.options.alt},_animateZoom:function(d){var y=this._map.getZoomScale(d.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,d.zoom,d.center).min;ms(this._image,P,y)},_reset:function(){var d=this._image,y=new nn(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=y.getSize();un(d,y.min),d.style.width=P.x+"px",d.style.height=P.y+"px"},_updateOpacity:function(){Bt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var d=this.options.errorOverlayUrl;d&&this._url!==d&&(this._url=d,this._image.src=d)},getCenter:function(){return this._bounds.getCenter()}}),kh=function(d,y,P){return new Lu(d,y,P)},ka=Lu.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var d=this._url.tagName==="VIDEO",y=this._image=d?this._url:gn("video");if(dn(y,"leaflet-image-layer"),this._zoomAnimated&&dn(y,"leaflet-zoom-animated"),this.options.className&&dn(y,this.options.className),y.onselectstart=U,y.onmousemove=U,y.onloadeddata=f(this.fire,this,"load"),d){for(var P=y.getElementsByTagName("source"),D=[],j=0;j<P.length;j++)D.push(P[j].src);this._url=P.length>0?D:[y.src];return}ge(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(y.style,"objectFit")&&(y.style.objectFit="fill"),y.autoplay=!!this.options.autoplay,y.loop=!!this.options.loop,y.muted=!!this.options.muted,y.playsInline=!!this.options.playsInline;for(var se=0;se<this._url.length;se++){var Ae=gn("source");Ae.src=this._url[se],y.appendChild(Ae)}}});function Tc(d,y,P){return new ka(d,y,P)}var Du=Lu.extend({_initImage:function(){var d=this._image=this._url;dn(d,"leaflet-image-layer"),this._zoomAnimated&&dn(d,"leaflet-zoom-animated"),this.options.className&&dn(d,this.options.className),d.onselectstart=U,d.onmousemove=U}});function zu(d,y,P){return new Du(d,y,P)}var bs=qn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(d,y){d&&(d instanceof Jt||ge(d))?(this._latlng=on(d),me(this,y)):(me(this,d),this._source=y),this.options.content&&(this._content=this.options.content)},openOn:function(d){return d=arguments.length?d:this._source._map,d.hasLayer(this)||d.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(d){return this._map?this.close():(arguments.length?this._source=d:d=this._source,this._prepareOpen(),this.openOn(d._map)),this},onAdd:function(d){this._zoomAnimated=d._zoomAnimated,this._container||this._initLayout(),d._fadeAnimated&&Bt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),d._fadeAnimated&&Bt(this._container,1),this.bringToFront(),this.options.interactive&&(dn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(d){d._fadeAnimated?(Bt(this._container,0),this._removeTimeout=setTimeout(f(Jn,void 0,this._container),200)):Jn(this._container),this.options.interactive&&(Wn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(d){return this._latlng=on(d),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(d){return this._content=d,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var d={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&jr(this._container),this},bringToBack:function(){return this._map&&Ao(this._container),this},_prepareOpen:function(d){var y=this._source;if(!y._map)return!1;if(y instanceof Di){y=null;var P=this._source._layers;for(var D in P)if(P[D]._map){y=P[D];break}if(!y)return!1;this._source=y}if(!d)if(y.getCenter)d=y.getCenter();else if(y.getLatLng)d=y.getLatLng();else if(y.getBounds)d=y.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(d),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var d=this._contentNode,y=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof y=="string")d.innerHTML=y;else{for(;d.hasChildNodes();)d.removeChild(d.firstChild);d.appendChild(y)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var d=this._map.latLngToLayerPoint(this._latlng),y=Tt(this.options.offset),P=this._getAnchor();this._zoomAnimated?un(this._container,d.add(P)):y=y.add(d).add(P);var D=this._containerBottom=-y.y,j=this._containerLeft=-Math.round(this._containerWidth/2)+y.x;this._container.style.bottom=D+"px",this._container.style.left=j+"px"}},_getAnchor:function(){return[0,0]}});In.include({_initOverlay:function(d,y,P,D){var j=y;return j instanceof d||(j=new d(D).setContent(y)),P&&j.setLatLng(P),j}}),qn.include({_initOverlay:function(d,y,P,D){var j=P;return j instanceof d?(me(j,D),j._source=this):(j=y&&!D?y:new d(D,this),j.setContent(P)),j}});var Nu=bs.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(d){return d=arguments.length?d:this._source._map,!d.hasLayer(this)&&d._popup&&d._popup.options.autoClose&&d.removeLayer(d._popup),d._popup=this,bs.prototype.openOn.call(this,d)},onAdd:function(d){bs.prototype.onAdd.call(this,d),d.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Oo||this._source.on("preclick",Wt))},onRemove:function(d){bs.prototype.onRemove.call(this,d),d.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Oo||this._source.off("preclick",Wt))},getEvents:function(){var d=bs.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(d.preclick=this.close),this.options.keepInView&&(d.moveend=this._adjustPan),d},_initLayout:function(){var d="leaflet-popup",y=this._container=gn("div",d+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=gn("div",d+"-content-wrapper",y);if(this._contentNode=gn("div",d+"-content",P),fn(y),js(this._contentNode),$t(y,"contextmenu",Wt),this._tipContainer=gn("div",d+"-tip-container",y),this._tip=gn("div",d+"-tip",this._tipContainer),this.options.closeButton){var D=this._closeButton=gn("a",d+"-close-button",y);D.setAttribute("role","button"),D.setAttribute("aria-label","Close popup"),D.href="#close",D.innerHTML='<span aria-hidden="true">&#215;</span>',$t(D,"click",function(j){si(j),this.close()},this)}},_updateLayout:function(){var d=this._contentNode,y=d.style;y.width="",y.whiteSpace="nowrap";var P=d.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),y.width=P+1+"px",y.whiteSpace="",y.height="";var D=d.offsetHeight,j=this.options.maxHeight,se="leaflet-popup-scrolled";j&&D>j?(y.height=j+"px",dn(d,se)):Wn(d,se),this._containerWidth=this._container.offsetWidth},_animateZoom:function(d){var y=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center),P=this._getAnchor();un(this._container,y.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var d=this._map,y=parseInt(Co(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+y,D=this._containerWidth,j=new lt(this._containerLeft,-P-this._containerBottom);j._add(Ar(this._container));var se=d.layerPointToContainerPoint(j),Ae=Tt(this.options.autoPanPadding),Ge=Tt(this.options.autoPanPaddingTopLeft||Ae),et=Tt(this.options.autoPanPaddingBottomRight||Ae),pt=d.getSize(),Dt=0,en=0;se.x+D+et.x>pt.x&&(Dt=se.x+D-pt.x+et.x),se.x-Dt-Ge.x<0&&(Dt=se.x-Ge.x),se.y+P+et.y>pt.y&&(en=se.y+P-pt.y+et.y),se.y-en-Ge.y<0&&(en=se.y-Ge.y),(Dt||en)&&(this.options.keepInView&&(this._autopanning=!0),d.fire("autopanstart").panBy([Dt,en]))}},_getAnchor:function(){return Tt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Yl=function(d,y){return new Nu(d,y)};In.mergeOptions({closePopupOnClick:!0}),In.include({openPopup:function(d,y,P){return this._initOverlay(Nu,d,y,P).openOn(this),this},closePopup:function(d){return d=arguments.length?d:this._popup,d&&d.close(),this}}),qn.include({bindPopup:function(d,y){return this._popup=this._initOverlay(Nu,this._popup,d,y),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(d){return this._popup&&(this instanceof Di||(this._popup._source=this),this._popup._prepareOpen(d||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(d){return this._popup&&this._popup.setContent(d),this},getPopup:function(){return this._popup},_openPopup:function(d){if(!(!this._popup||!this._map)){Mi(d);var y=d.layer||d.target;if(this._popup._source===y&&!(y instanceof Oo)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(d.latlng);return}this._popup._source=y,this.openPopup(d.latlng)}},_movePopup:function(d){this._popup.setLatLng(d.latlng)},_onKeyPress:function(d){d.originalEvent.keyCode===13&&this._openPopup(d)}});var sa=bs.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(d){bs.prototype.onAdd.call(this,d),this.setOpacity(this.options.opacity),d.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(d){bs.prototype.onRemove.call(this,d),d.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var d=bs.prototype.getEvents.call(this);return this.options.permanent||(d.preclick=this.close),d},_initLayout:function(){var d="leaflet-tooltip",y=d+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=gn("div",y),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+S(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(d){var y,P,D=this._map,j=this._container,se=D.latLngToContainerPoint(D.getCenter()),Ae=D.layerPointToContainerPoint(d),Ge=this.options.direction,et=j.offsetWidth,pt=j.offsetHeight,Dt=Tt(this.options.offset),en=this._getAnchor();Ge==="top"?(y=et/2,P=pt):Ge==="bottom"?(y=et/2,P=0):Ge==="center"?(y=et/2,P=pt/2):Ge==="right"?(y=0,P=pt/2):Ge==="left"?(y=et,P=pt/2):Ae.x<se.x?(Ge="right",y=0,P=pt/2):(Ge="left",y=et+(Dt.x+en.x)*2,P=pt/2),d=d.subtract(Tt(y,P,!0)).add(Dt).add(en),Wn(j,"leaflet-tooltip-right"),Wn(j,"leaflet-tooltip-left"),Wn(j,"leaflet-tooltip-top"),Wn(j,"leaflet-tooltip-bottom"),dn(j,"leaflet-tooltip-"+Ge),un(j,d)},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},setOpacity:function(d){this.options.opacity=d,this._container&&Bt(this._container,d)},_animateZoom:function(d){var y=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(y)},_getAnchor:function(){return Tt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Hd=function(d,y){return new sa(d,y)};In.include({openTooltip:function(d,y,P){return this._initOverlay(sa,d,y,P).openOn(this),this},closeTooltip:function(d){return d.close(),this}}),qn.include({bindTooltip:function(d,y){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(sa,this._tooltip,d,y),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(d){if(!(!d&&this._tooltipHandlersAdded)){var y=d?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[y](P),this._tooltipHandlersAdded=!d}},openTooltip:function(d){return this._tooltip&&(this instanceof Di||(this._tooltip._source=this),this._tooltip._prepareOpen(d)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(d){return this._tooltip&&this._tooltip.setContent(d),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(d){var y=typeof d.getElement=="function"&&d.getElement();y&&($t(y,"focus",function(){this._tooltip._source=d,this.openTooltip()},this),$t(y,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(d){var y=typeof d.getElement=="function"&&d.getElement();y&&y.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(d){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var y=this;this._map.once("moveend",function(){y._openOnceFlag=!1,y._openTooltip(d)});return}this._tooltip._source=d.layer||d.target,this.openTooltip(this._tooltip.options.sticky?d.latlng:void 0)}},_moveTooltip:function(d){var y=d.latlng,P,D;this._tooltip.options.sticky&&d.originalEvent&&(P=this._map.mouseEventToContainerPoint(d.originalEvent),D=this._map.containerPointToLayerPoint(P),y=this._map.layerPointToLatLng(D)),this._tooltip.setLatLng(y)}});var Sc=oo.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(d){var y=d&&d.tagName==="DIV"?d:document.createElement("div"),P=this.options;if(P.html instanceof Element?(ba(y),y.appendChild(P.html)):y.innerHTML=P.html!==!1?P.html:"",P.bgPos){var D=Tt(P.bgPos);y.style.backgroundPosition=-D.x+"px "+-D.y+"px"}return this._setIconStyles(y,"icon"),y},createShadow:function(){return null}});function Nn(d){return new Sc(d)}oo.Default=ul;var Ma=qn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:xt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(d){me(this,d)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(d){d._addZoomLimit(this)},onRemove:function(d){this._removeAllTiles(),Jn(this._container),d._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(jr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ao(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(d){return this.options.opacity=d,this._updateOpacity(),this},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var d=this._clampZoom(this._map.getZoom());d!==this._tileZoom&&(this._tileZoom=d,this._updateLevels()),this._update()}return this},getEvents:function(){var d={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=A(this._onMoveEnd,this.options.updateInterval,this)),d.move=this._onMove),this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},createTile:function(){return document.createElement("div")},getTileSize:function(){var d=this.options.tileSize;return d instanceof lt?d:new lt(d,d)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(d){for(var y=this.getPane().children,P=-d(-1/0,1/0),D=0,j=y.length,se;D<j;D++)se=y[D].style.zIndex,y[D]!==this._container&&se&&(P=d(P,+se));isFinite(P)&&(this.options.zIndex=P+d(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!xt.ielt9){Bt(this._container,this.options.opacity);var d=+new Date,y=!1,P=!1;for(var D in this._tiles){var j=this._tiles[D];if(!(!j.current||!j.loaded)){var se=Math.min(1,(d-j.loaded)/200);Bt(j.el,se),se<1?y=!0:(j.active?P=!0:this._onOpaqueTile(j),j.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),y&&(Ve(this._fadeFrame),this._fadeFrame=Pe(this._updateOpacity,this))}},_onOpaqueTile:U,_initContainer:function(){this._container||(this._container=gn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var d=this._tileZoom,y=this.options.maxZoom;if(d!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===d?(this._levels[P].el.style.zIndex=y-Math.abs(d-P),this._onUpdateLevel(P)):(Jn(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var D=this._levels[d],j=this._map;return D||(D=this._levels[d]={},D.el=gn("div","leaflet-tile-container leaflet-zoom-animated",this._container),D.el.style.zIndex=y,D.origin=j.project(j.unproject(j.getPixelOrigin()),d).round(),D.zoom=d,this._setZoomTransform(D,j.getCenter(),j.getZoom()),U(D.el.offsetWidth),this._onCreateLevel(D)),this._level=D,D}},_onUpdateLevel:U,_onRemoveLevel:U,_onCreateLevel:U,_pruneTiles:function(){if(this._map){var d,y,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(d in this._tiles)y=this._tiles[d],y.retain=y.current;for(d in this._tiles)if(y=this._tiles[d],y.current&&!y.active){var D=y.coords;this._retainParent(D.x,D.y,D.z,D.z-5)||this._retainChildren(D.x,D.y,D.z,D.z+2)}for(d in this._tiles)this._tiles[d].retain||this._removeTile(d)}},_removeTilesAtZoom:function(d){for(var y in this._tiles)this._tiles[y].coords.z===d&&this._removeTile(y)},_removeAllTiles:function(){for(var d in this._tiles)this._removeTile(d)},_invalidateAll:function(){for(var d in this._levels)Jn(this._levels[d].el),this._onRemoveLevel(Number(d)),delete this._levels[d];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(d,y,P,D){var j=Math.floor(d/2),se=Math.floor(y/2),Ae=P-1,Ge=new lt(+j,+se);Ge.z=+Ae;var et=this._tileCoordsToKey(Ge),pt=this._tiles[et];return pt&&pt.active?(pt.retain=!0,!0):(pt&&pt.loaded&&(pt.retain=!0),Ae>D?this._retainParent(j,se,Ae,D):!1)},_retainChildren:function(d,y,P,D){for(var j=2*d;j<2*d+2;j++)for(var se=2*y;se<2*y+2;se++){var Ae=new lt(j,se);Ae.z=P+1;var Ge=this._tileCoordsToKey(Ae),et=this._tiles[Ge];if(et&&et.active){et.retain=!0;continue}else et&&et.loaded&&(et.retain=!0);P+1<D&&this._retainChildren(j,se,P+1,D)}},_resetView:function(d){var y=d&&(d.pinch||d.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),y,y)},_animateZoom:function(d){this._setView(d.center,d.zoom,!0,d.noUpdate)},_clampZoom:function(d){var y=this.options;return y.minNativeZoom!==void 0&&d<y.minNativeZoom?y.minNativeZoom:y.maxNativeZoom!==void 0&&y.maxNativeZoom<d?y.maxNativeZoom:d},_setView:function(d,y,P,D){var j=Math.round(y);this.options.maxZoom!==void 0&&j>this.options.maxZoom||this.options.minZoom!==void 0&&j<this.options.minZoom?j=void 0:j=this._clampZoom(j);var se=this.options.updateWhenZooming&&j!==this._tileZoom;(!D||se)&&(this._tileZoom=j,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),j!==void 0&&this._update(d),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(d,y)},_setZoomTransforms:function(d,y){for(var P in this._levels)this._setZoomTransform(this._levels[P],d,y)},_setZoomTransform:function(d,y,P){var D=this._map.getZoomScale(P,d.zoom),j=d.origin.multiplyBy(D).subtract(this._map._getNewPixelOrigin(y,P)).round();xt.any3d?ms(d.el,j,D):un(d.el,j)},_resetGrid:function(){var d=this._map,y=d.options.crs,P=this._tileSize=this.getTileSize(),D=this._tileZoom,j=this._map.getPixelWorldBounds(this._tileZoom);j&&(this._globalTileRange=this._pxBoundsToTileRange(j)),this._wrapX=y.wrapLng&&!this.options.noWrap&&[Math.floor(d.project([0,y.wrapLng[0]],D).x/P.x),Math.ceil(d.project([0,y.wrapLng[1]],D).x/P.y)],this._wrapY=y.wrapLat&&!this.options.noWrap&&[Math.floor(d.project([y.wrapLat[0],0],D).y/P.x),Math.ceil(d.project([y.wrapLat[1],0],D).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(d){var y=this._map,P=y._animatingZoom?Math.max(y._animateToZoom,y.getZoom()):y.getZoom(),D=y.getZoomScale(P,this._tileZoom),j=y.project(d,this._tileZoom).floor(),se=y.getSize().divideBy(D*2);return new nn(j.subtract(se),j.add(se))},_update:function(d){var y=this._map;if(y){var P=this._clampZoom(y.getZoom());if(d===void 0&&(d=y.getCenter()),this._tileZoom!==void 0){var D=this._getTiledPixelBounds(d),j=this._pxBoundsToTileRange(D),se=j.getCenter(),Ae=[],Ge=this.options.keepBuffer,et=new nn(j.getBottomLeft().subtract([Ge,-Ge]),j.getTopRight().add([Ge,-Ge]));if(!(isFinite(j.min.x)&&isFinite(j.min.y)&&isFinite(j.max.x)&&isFinite(j.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var pt in this._tiles){var Dt=this._tiles[pt].coords;(Dt.z!==this._tileZoom||!et.contains(new lt(Dt.x,Dt.y)))&&(this._tiles[pt].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(d,P);return}for(var en=j.min.y;en<=j.max.y;en++)for(var bn=j.min.x;bn<=j.max.x;bn++){var nr=new lt(bn,en);if(nr.z=this._tileZoom,!!this._isValidTile(nr)){var ir=this._tiles[this._tileCoordsToKey(nr)];ir?ir.current=!0:Ae.push(nr)}}if(Ae.sort(function(kr,ml){return kr.distanceTo(se)-ml.distanceTo(se)}),Ae.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var rs=document.createDocumentFragment();for(bn=0;bn<Ae.length;bn++)this._addTile(Ae[bn],rs);this._level.el.appendChild(rs)}}}},_isValidTile:function(d){var y=this._map.options.crs;if(!y.infinite){var P=this._globalTileRange;if(!y.wrapLng&&(d.x<P.min.x||d.x>P.max.x)||!y.wrapLat&&(d.y<P.min.y||d.y>P.max.y))return!1}if(!this.options.bounds)return!0;var D=this._tileCoordsToBounds(d);return vn(this.options.bounds).overlaps(D)},_keyToBounds:function(d){return this._tileCoordsToBounds(this._keyToTileCoords(d))},_tileCoordsToNwSe:function(d){var y=this._map,P=this.getTileSize(),D=d.scaleBy(P),j=D.add(P),se=y.unproject(D,d.z),Ae=y.unproject(j,d.z);return[se,Ae]},_tileCoordsToBounds:function(d){var y=this._tileCoordsToNwSe(d),P=new cn(y[0],y[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(d){return d.x+":"+d.y+":"+d.z},_keyToTileCoords:function(d){var y=d.split(":"),P=new lt(+y[0],+y[1]);return P.z=+y[2],P},_removeTile:function(d){var y=this._tiles[d];y&&(Jn(y.el),delete this._tiles[d],this.fire("tileunload",{tile:y.el,coords:this._keyToTileCoords(d)}))},_initTile:function(d){dn(d,"leaflet-tile");var y=this.getTileSize();d.style.width=y.x+"px",d.style.height=y.y+"px",d.onselectstart=U,d.onmousemove=U,xt.ielt9&&this.options.opacity<1&&Bt(d,this.options.opacity)},_addTile:function(d,y){var P=this._getTilePos(d),D=this._tileCoordsToKey(d),j=this.createTile(this._wrapCoords(d),f(this._tileReady,this,d));this._initTile(j),this.createTile.length<2&&Pe(f(this._tileReady,this,d,null,j)),un(j,P),this._tiles[D]={el:j,coords:d,current:!0},y.appendChild(j),this.fire("tileloadstart",{tile:j,coords:d})},_tileReady:function(d,y,P){y&&this.fire("tileerror",{error:y,tile:P,coords:d});var D=this._tileCoordsToKey(d);P=this._tiles[D],P&&(P.loaded=+new Date,this._map._fadeAnimated?(Bt(P.el,0),Ve(this._fadeFrame),this._fadeFrame=Pe(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),y||(dn(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:d})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),xt.ielt9||!this._map._fadeAnimated?Pe(this._pruneTiles,this):setTimeout(f(this._pruneTiles,this),250)))},_getTilePos:function(d){return d.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(d){var y=new lt(this._wrapX?O(d.x,this._wrapX):d.x,this._wrapY?O(d.y,this._wrapY):d.y);return y.z=d.z,y},_pxBoundsToTileRange:function(d){var y=this.getTileSize();return new nn(d.min.unscaleBy(y).floor(),d.max.unscaleBy(y).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var d in this._tiles)if(!this._tiles[d].loaded)return!1;return!0}});function Bp(d){return new Ma(d)}var pl=Ma.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(d,y){this._url=d,y=me(this,y),y.detectRetina&&xt.retina&&y.maxZoom>0?(y.tileSize=Math.floor(y.tileSize/2),y.zoomReverse?(y.zoomOffset--,y.minZoom=Math.min(y.maxZoom,y.minZoom+1)):(y.zoomOffset++,y.maxZoom=Math.max(y.minZoom,y.maxZoom-1)),y.minZoom=Math.max(0,y.minZoom)):y.zoomReverse?y.minZoom=Math.min(y.maxZoom,y.minZoom):y.maxZoom=Math.max(y.minZoom,y.maxZoom),typeof y.subdomains=="string"&&(y.subdomains=y.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(d,y){return this._url===d&&y===void 0&&(y=!0),this._url=d,y||this.redraw(),this},createTile:function(d,y){var P=document.createElement("img");return $t(P,"load",f(this._tileOnLoad,this,y,P)),$t(P,"error",f(this._tileOnError,this,y,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(d),P},getTileUrl:function(d){var y={r:xt.retina?"@2x":"",s:this._getSubdomain(d),x:d.x,y:d.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-d.y;this.options.tms&&(y.y=P),y["-y"]=P}return le(this._url,o(y,this.options))},_tileOnLoad:function(d,y){xt.ielt9?setTimeout(f(d,this,null,y),0):d(null,y)},_tileOnError:function(d,y,P){var D=this.options.errorTileUrl;D&&y.getAttribute("src")!==D&&(y.src=D),d(P,y)},_onTileRemove:function(d){d.tile.onload=null},_getZoomForUrl:function(){var d=this._tileZoom,y=this.options.maxZoom,P=this.options.zoomReverse,D=this.options.zoomOffset;return P&&(d=y-d),d+D},_getSubdomain:function(d){var y=Math.abs(d.x+d.y)%this.options.subdomains.length;return this.options.subdomains[y]},_abortLoading:function(){var d,y;for(d in this._tiles)if(this._tiles[d].coords.z!==this._tileZoom&&(y=this._tiles[d].el,y.onload=U,y.onerror=U,!y.complete)){y.src=rt;var P=this._tiles[d].coords;Jn(y),delete this._tiles[d],this.fire("tileabort",{tile:y,coords:P})}},_removeTile:function(d){var y=this._tiles[d];if(y)return y.el.setAttribute("src",rt),Ma.prototype._removeTile.call(this,d)},_tileReady:function(d,y,P){if(!(!this._map||P&&P.getAttribute("src")===rt))return Ma.prototype._tileReady.call(this,d,y,P)}});function Ql(d,y){return new pl(d,y)}var Ec=pl.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(d,y){this._url=d;var P=o({},this.defaultWmsParams);for(var D in y)D in this.options||(P[D]=y[D]);y=me(this,y);var j=y.detectRetina&&xt.retina?2:1,se=this.getTileSize();P.width=se.x*j,P.height=se.y*j,this.wmsParams=P},onAdd:function(d){this._crs=this.options.crs||d.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var y=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[y]=this._crs.code,pl.prototype.onAdd.call(this,d)},getTileUrl:function(d){var y=this._tileCoordsToNwSe(d),P=this._crs,D=rn(P.project(y[0]),P.project(y[1])),j=D.min,se=D.max,Ae=(this._wmsVersion>=1.3&&this._crs===Ei?[j.y,j.x,se.y,se.x]:[j.x,j.y,se.x,se.y]).join(","),Ge=pl.prototype.getTileUrl.call(this,d);return Ge+Me(this.wmsParams,Ge,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ae},setParams:function(d,y){return o(this.wmsParams,d),y||this.redraw(),this}});function Vp(d,y){return new Ec(d,y)}pl.WMS=Ec,Ql.wms=Vp;var Bo=qn.extend({options:{padding:.1},initialize:function(d){me(this,d),S(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),dn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var d={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(d.zoomanim=this._onAnimZoom),d},_onAnimZoom:function(d){this._updateTransform(d.center,d.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(d,y){var P=this._map.getZoomScale(y,this._zoom),D=this._map.getSize().multiplyBy(.5+this.options.padding),j=this._map.project(this._center,y),se=D.multiplyBy(-P).add(j).subtract(this._map._getNewPixelOrigin(d,y));xt.any3d?ms(this._container,se,P):un(this._container,se)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var d in this._layers)this._layers[d]._reset()},_onZoomEnd:function(){for(var d in this._layers)this._layers[d]._project()},_updatePaths:function(){for(var d in this._layers)this._layers[d]._update()},_update:function(){var d=this.options.padding,y=this._map.getSize(),P=this._map.containerPointToLayerPoint(y.multiplyBy(-d)).round();this._bounds=new nn(P,P.add(y.multiplyBy(1+d*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Gd=Bo.extend({options:{tolerance:0},getEvents:function(){var d=Bo.prototype.getEvents.call(this);return d.viewprereset=this._onViewPreReset,d},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Bo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var d=this._container=document.createElement("canvas");$t(d,"mousemove",this._onMouseMove,this),$t(d,"click dblclick mousedown mouseup contextmenu",this._onClick,this),$t(d,"mouseout",this._handleMouseOut,this),d._leaflet_disable_events=!0,this._ctx=d.getContext("2d")},_destroyContainer:function(){Ve(this._redrawRequest),delete this._ctx,Jn(this._container),Ln(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var d;this._redrawBounds=null;for(var y in this._layers)d=this._layers[y],d._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Bo.prototype._update.call(this);var d=this._bounds,y=this._container,P=d.getSize(),D=xt.retina?2:1;un(y,d.min),y.width=D*P.x,y.height=D*P.y,y.style.width=P.x+"px",y.style.height=P.y+"px",xt.retina&&this._ctx.scale(2,2),this._ctx.translate(-d.min.x,-d.min.y),this.fire("update")}},_reset:function(){Bo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(d){this._updateDashArray(d),this._layers[S(d)]=d;var y=d._order={layer:d,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=y),this._drawLast=y,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(d){this._requestRedraw(d)},_removePath:function(d){var y=d._order,P=y.next,D=y.prev;P?P.prev=D:this._drawLast=D,D?D.next=P:this._drawFirst=P,delete d._order,delete this._layers[S(d)],this._requestRedraw(d)},_updatePath:function(d){this._extendRedrawBounds(d),d._project(),d._update(),this._requestRedraw(d)},_updateStyle:function(d){this._updateDashArray(d),this._requestRedraw(d)},_updateDashArray:function(d){if(typeof d.options.dashArray=="string"){var y=d.options.dashArray.split(/[, ]+/),P=[],D,j;for(j=0;j<y.length;j++){if(D=Number(y[j]),isNaN(D))return;P.push(D)}d.options._dashArray=P}else d.options._dashArray=d.options.dashArray},_requestRedraw:function(d){this._map&&(this._extendRedrawBounds(d),this._redrawRequest=this._redrawRequest||Pe(this._redraw,this))},_extendRedrawBounds:function(d){if(d._pxBounds){var y=(d.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new nn,this._redrawBounds.extend(d._pxBounds.min.subtract([y,y])),this._redrawBounds.extend(d._pxBounds.max.add([y,y]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var d=this._redrawBounds;if(d){var y=d.getSize();this._ctx.clearRect(d.min.x,d.min.y,y.x,y.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var d,y=this._redrawBounds;if(this._ctx.save(),y){var P=y.getSize();this._ctx.beginPath(),this._ctx.rect(y.min.x,y.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var D=this._drawFirst;D;D=D.next)d=D.layer,(!y||d._pxBounds&&d._pxBounds.intersects(y))&&d._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(d,y){if(this._drawing){var P,D,j,se,Ae=d._parts,Ge=Ae.length,et=this._ctx;if(Ge){for(et.beginPath(),P=0;P<Ge;P++){for(D=0,j=Ae[P].length;D<j;D++)se=Ae[P][D],et[D?"lineTo":"moveTo"](se.x,se.y);y&&et.closePath()}this._fillStroke(et,d)}}},_updateCircle:function(d){if(!(!this._drawing||d._empty())){var y=d._point,P=this._ctx,D=Math.max(Math.round(d._radius),1),j=(Math.max(Math.round(d._radiusY),1)||D)/D;j!==1&&(P.save(),P.scale(1,j)),P.beginPath(),P.arc(y.x,y.y/j,D,0,Math.PI*2,!1),j!==1&&P.restore(),this._fillStroke(P,d)}},_fillStroke:function(d,y){var P=y.options;P.fill&&(d.globalAlpha=P.fillOpacity,d.fillStyle=P.fillColor||P.color,d.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(d.setLineDash&&d.setLineDash(y.options&&y.options._dashArray||[]),d.globalAlpha=P.opacity,d.lineWidth=P.weight,d.strokeStyle=P.color,d.lineCap=P.lineCap,d.lineJoin=P.lineJoin,d.stroke())},_onClick:function(d){for(var y=this._map.mouseEventToLayerPoint(d),P,D,j=this._drawFirst;j;j=j.next)P=j.layer,P.options.interactive&&P._containsPoint(y)&&(!(d.type==="click"||d.type==="preclick")||!this._map._draggableMoved(P))&&(D=P);this._fireEvent(D?[D]:!1,d)},_onMouseMove:function(d){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var y=this._map.mouseEventToLayerPoint(d);this._handleMouseHover(d,y)}},_handleMouseOut:function(d){var y=this._hoveredLayer;y&&(Wn(this._container,"leaflet-interactive"),this._fireEvent([y],d,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(d,y){if(!this._mouseHoverThrottled){for(var P,D,j=this._drawFirst;j;j=j.next)P=j.layer,P.options.interactive&&P._containsPoint(y)&&(D=P);D!==this._hoveredLayer&&(this._handleMouseOut(d),D&&(dn(this._container,"leaflet-interactive"),this._fireEvent([D],d,"mouseover"),this._hoveredLayer=D)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,d),this._mouseHoverThrottled=!0,setTimeout(f(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(d,y,P){this._map._fireDOMEvent(y,P||y.type,d)},_bringToFront:function(d){var y=d._order;if(y){var P=y.next,D=y.prev;if(P)P.prev=D;else return;D?D.next=P:P&&(this._drawFirst=P),y.prev=this._drawLast,this._drawLast.next=y,y.next=null,this._drawLast=y,this._requestRedraw(d)}},_bringToBack:function(d){var y=d._order;if(y){var P=y.next,D=y.prev;if(D)D.next=P;else return;P?P.prev=D:D&&(this._drawLast=D),y.prev=null,y.next=this._drawFirst,this._drawFirst.prev=y,this._drawFirst=y,this._requestRedraw(d)}}});function Ou(d){return xt.canvas?new Gd(d):null}var Ra=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(d){return document.createElement("<lvml:"+d+' class="lvml">')}}catch{}return function(d){return document.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Ic={_initContainer:function(){this._container=gn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Bo.prototype._update.call(this),this.fire("update"))},_initPath:function(d){var y=d._container=Ra("shape");dn(y,"leaflet-vml-shape "+(this.options.className||"")),y.coordsize="1 1",d._path=Ra("path"),y.appendChild(d._path),this._updateStyle(d),this._layers[S(d)]=d},_addPath:function(d){var y=d._container;this._container.appendChild(y),d.options.interactive&&d.addInteractiveTarget(y)},_removePath:function(d){var y=d._container;Jn(y),d.removeInteractiveTarget(y),delete this._layers[S(d)]},_updateStyle:function(d){var y=d._stroke,P=d._fill,D=d.options,j=d._container;j.stroked=!!D.stroke,j.filled=!!D.fill,D.stroke?(y||(y=d._stroke=Ra("stroke")),j.appendChild(y),y.weight=D.weight+"px",y.color=D.color,y.opacity=D.opacity,D.dashArray?y.dashStyle=ge(D.dashArray)?D.dashArray.join(" "):D.dashArray.replace(/( *, *)/g," "):y.dashStyle="",y.endcap=D.lineCap.replace("butt","flat"),y.joinstyle=D.lineJoin):y&&(j.removeChild(y),d._stroke=null),D.fill?(P||(P=d._fill=Ra("fill")),j.appendChild(P),P.color=D.fillColor||D.color,P.opacity=D.fillOpacity):P&&(j.removeChild(P),d._fill=null)},_updateCircle:function(d){var y=d._point.round(),P=Math.round(d._radius),D=Math.round(d._radiusY||P);this._setPath(d,d._empty()?"M0 0":"AL "+y.x+","+y.y+" "+P+","+D+" 0,"+65535*360)},_setPath:function(d,y){d._path.v=y},_bringToFront:function(d){jr(d._container)},_bringToBack:function(d){Ao(d._container)}},oa=xt.vml?Ra:Ds,La=Bo.extend({_initContainer:function(){this._container=oa("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=oa("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Jn(this._container),Ln(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Bo.prototype._update.call(this);var d=this._bounds,y=d.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(y))&&(this._svgSize=y,P.setAttribute("width",y.x),P.setAttribute("height",y.y)),un(P,d.min),P.setAttribute("viewBox",[d.min.x,d.min.y,y.x,y.y].join(" ")),this.fire("update")}},_initPath:function(d){var y=d._path=oa("path");d.options.className&&dn(y,d.options.className),d.options.interactive&&dn(y,"leaflet-interactive"),this._updateStyle(d),this._layers[S(d)]=d},_addPath:function(d){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(d._path),d.addInteractiveTarget(d._path)},_removePath:function(d){Jn(d._path),d.removeInteractiveTarget(d._path),delete this._layers[S(d)]},_updatePath:function(d){d._project(),d._update()},_updateStyle:function(d){var y=d._path,P=d.options;y&&(P.stroke?(y.setAttribute("stroke",P.color),y.setAttribute("stroke-opacity",P.opacity),y.setAttribute("stroke-width",P.weight),y.setAttribute("stroke-linecap",P.lineCap),y.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?y.setAttribute("stroke-dasharray",P.dashArray):y.removeAttribute("stroke-dasharray"),P.dashOffset?y.setAttribute("stroke-dashoffset",P.dashOffset):y.removeAttribute("stroke-dashoffset")):y.setAttribute("stroke","none"),P.fill?(y.setAttribute("fill",P.fillColor||P.color),y.setAttribute("fill-opacity",P.fillOpacity),y.setAttribute("fill-rule",P.fillRule||"evenodd")):y.setAttribute("fill","none"))},_updatePoly:function(d,y){this._setPath(d,to(d._parts,y))},_updateCircle:function(d){var y=d._point,P=Math.max(Math.round(d._radius),1),D=Math.max(Math.round(d._radiusY),1)||P,j="a"+P+","+D+" 0 1,0 ",se=d._empty()?"M0 0":"M"+(y.x-P)+","+y.y+j+P*2+",0 "+j+-P*2+",0 ";this._setPath(d,se)},_setPath:function(d,y){d._path.setAttribute("d",y)},_bringToFront:function(d){jr(d._path)},_bringToBack:function(d){Ao(d._path)}});xt.vml&&La.include(Ic);function Mh(d){return xt.svg||xt.vml?new La(d):null}In.include({getRenderer:function(d){var y=d.options.renderer||this._getPaneRenderer(d.options.pane)||this.options.renderer||this._renderer;return y||(y=this._renderer=this._createRenderer()),this.hasLayer(y)||this.addLayer(y),y},_getPaneRenderer:function(d){if(d==="overlayPane"||d===void 0)return!1;var y=this._paneRenderers[d];return y===void 0&&(y=this._createRenderer({pane:d}),this._paneRenderers[d]=y),y},_createRenderer:function(d){return this.options.preferCanvas&&Ou(d)||Mh(d)}});var Fu=Kl.extend({initialize:function(d,y){Kl.prototype.initialize.call(this,this._boundsToLatLngs(d),y)},setBounds:function(d){return this.setLatLngs(this._boundsToLatLngs(d))},_boundsToLatLngs:function(d){return d=vn(d),[d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()]}});function Pc(d,y){return new Fu(d,y)}La.create=oa,La.pointsToPath=to,ra.geometryToLayer=Ru,ra.coordsToLatLng=bc,ra.coordsToLatLngs=dl,ra.latLngToCoords=Xl,ra.latLngsToCoords=fl,ra.getFeature=Ca,ra.asFeature=Fo,In.mergeOptions({boxZoom:!0});var Cc=_s.extend({initialize:function(d){this._map=d,this._container=d._container,this._pane=d._panes.overlayPane,this._resetStateTimeout=0,d.on("unload",this._destroy,this)},addHooks:function(){$t(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ln(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Jn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(d){if(!d.shiftKey||d.which!==1&&d.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Vn(),Xi(),this._startPoint=this._map.mouseEventToContainerPoint(d),$t(document,{contextmenu:Mi,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(d){this._moved||(this._moved=!0,this._box=gn("div","leaflet-zoom-box",this._container),dn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(d);var y=new nn(this._point,this._startPoint),P=y.getSize();un(this._box,y.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(Jn(this._box),Wn(this._container,"leaflet-crosshair")),ei(),Yi(),Ln(document,{contextmenu:Mi,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(d){if(!(d.which!==1&&d.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(f(this._resetState,this),0);var y=new cn(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(y).fire("boxzoomend",{boxZoomBounds:y})}},_onKeyDown:function(d){d.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});In.addInitHook("addHandler","boxZoom",Cc),In.mergeOptions({doubleClickZoom:!0});var Zd=_s.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(d){var y=this._map,P=y.getZoom(),D=y.options.zoomDelta,j=d.originalEvent.shiftKey?P-D:P+D;y.options.doubleClickZoom==="center"?y.setZoom(j):y.setZoomAround(d.containerPoint,j)}});In.addInitHook("addHandler","doubleClickZoom",Zd),In.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Bu=_s.extend({addHooks:function(){if(!this._draggable){var d=this._map;this._draggable=new Ri(d._mapPane,d._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),d.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),d.on("zoomend",this._onZoomEnd,this),d.whenReady(this._onZoomEnd,this))}dn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Wn(this._map._container,"leaflet-grab"),Wn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var d=this._map;if(d._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var y=vn(this._map.options.maxBounds);this._offsetLimit=rn(this._map.latLngToContainerPoint(y.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(y.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;d.fire("movestart").fire("dragstart"),d.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(d){if(this._map.options.inertia){var y=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(y),this._prunePositions(y)}this._map.fire("move",d).fire("drag",d)},_prunePositions:function(d){for(;this._positions.length>1&&d-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var d=this._map.getSize().divideBy(2),y=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=y.subtract(d).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(d,y){return d-(d-y)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var d=this._draggable._newPos.subtract(this._draggable._startPos),y=this._offsetLimit;d.x<y.min.x&&(d.x=this._viscousLimit(d.x,y.min.x)),d.y<y.min.y&&(d.y=this._viscousLimit(d.y,y.min.y)),d.x>y.max.x&&(d.x=this._viscousLimit(d.x,y.max.x)),d.y>y.max.y&&(d.y=this._viscousLimit(d.y,y.max.y)),this._draggable._newPos=this._draggable._startPos.add(d)}},_onPreDragWrap:function(){var d=this._worldWidth,y=Math.round(d/2),P=this._initialWorldOffset,D=this._draggable._newPos.x,j=(D-y+P)%d+y-P,se=(D+y+P)%d-y-P,Ae=Math.abs(j+P)<Math.abs(se+P)?j:se;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ae},_onDragEnd:function(d){var y=this._map,P=y.options,D=!P.inertia||d.noInertia||this._times.length<2;if(y.fire("dragend",d),D)y.fire("moveend");else{this._prunePositions(+new Date);var j=this._lastPos.subtract(this._positions[0]),se=(this._lastTime-this._times[0])/1e3,Ae=P.easeLinearity,Ge=j.multiplyBy(Ae/se),et=Ge.distanceTo([0,0]),pt=Math.min(P.inertiaMaxSpeed,et),Dt=Ge.multiplyBy(pt/et),en=pt/(P.inertiaDeceleration*Ae),bn=Dt.multiplyBy(-en/2).round();!bn.x&&!bn.y?y.fire("moveend"):(bn=y._limitOffset(bn,y.options.maxBounds),Pe(function(){y.panBy(bn,{duration:en,easeLinearity:Ae,noMoveStart:!0,animate:!0})}))}}});In.addInitHook("addHandler","dragging",Bu),In.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Rh=_s.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(d){this._map=d,this._setPanDelta(d.options.keyboardPanDelta),this._setZoomDelta(d.options.zoomDelta)},addHooks:function(){var d=this._map._container;d.tabIndex<=0&&(d.tabIndex="0"),$t(d,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ln(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var d=document.body,y=document.documentElement,P=d.scrollTop||y.scrollTop,D=d.scrollLeft||y.scrollLeft;this._map._container.focus(),window.scrollTo(D,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(d){var y=this._panKeys={},P=this.keyCodes,D,j;for(D=0,j=P.left.length;D<j;D++)y[P.left[D]]=[-1*d,0];for(D=0,j=P.right.length;D<j;D++)y[P.right[D]]=[d,0];for(D=0,j=P.down.length;D<j;D++)y[P.down[D]]=[0,d];for(D=0,j=P.up.length;D<j;D++)y[P.up[D]]=[0,-1*d]},_setZoomDelta:function(d){var y=this._zoomKeys={},P=this.keyCodes,D,j;for(D=0,j=P.zoomIn.length;D<j;D++)y[P.zoomIn[D]]=d;for(D=0,j=P.zoomOut.length;D<j;D++)y[P.zoomOut[D]]=-d},_addHooks:function(){$t(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ln(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(d){if(!(d.altKey||d.ctrlKey||d.metaKey)){var y=d.keyCode,P=this._map,D;if(y in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(D=this._panKeys[y],d.shiftKey&&(D=Tt(D).multiplyBy(3)),P.options.maxBounds&&(D=P._limitOffset(Tt(D),P.options.maxBounds)),P.options.worldCopyJump){var j=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(D)));P.panTo(j)}else P.panBy(D)}else if(y in this._zoomKeys)P.setZoom(P.getZoom()+(d.shiftKey?3:1)*this._zoomKeys[y]);else if(y===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Mi(d)}}});In.addInitHook("addHandler","keyboard",Rh),In.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Lh=_s.extend({addHooks:function(){$t(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ln(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(d){var y=Lo(d),P=this._map.options.wheelDebounceTime;this._delta+=y,this._lastMousePos=this._map.mouseEventToContainerPoint(d),this._startTime||(this._startTime=+new Date);var D=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(f(this._performZoom,this),D),Mi(d)},_performZoom:function(){var d=this._map,y=d.getZoom(),P=this._map.options.zoomSnap||0;d._stop();var D=this._delta/(this._map.options.wheelPxPerZoomLevel*4),j=4*Math.log(2/(1+Math.exp(-Math.abs(D))))/Math.LN2,se=P?Math.ceil(j/P)*P:j,Ae=d._limitZoom(y+(this._delta>0?se:-se))-y;this._delta=0,this._startTime=null,Ae&&(d.options.scrollWheelZoom==="center"?d.setZoom(y+Ae):d.setZoomAround(this._lastMousePos,y+Ae))}});In.addInitHook("addHandler","scrollWheelZoom",Lh);var Ac=600;In.mergeOptions({tapHold:xt.touchNative&&xt.safari&&xt.mobile,tapTolerance:15});var Vu=_s.extend({addHooks:function(){$t(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ln(this._map._container,"touchstart",this._onDown,this)},_onDown:function(d){if(clearTimeout(this._holdTimeout),d.touches.length===1){var y=d.touches[0];this._startPos=this._newPos=new lt(y.clientX,y.clientY),this._holdTimeout=setTimeout(f(function(){this._cancel(),this._isTapValid()&&($t(document,"touchend",si),$t(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",y))},this),Ac),$t(document,"touchend touchcancel contextmenu",this._cancel,this),$t(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function d(){Ln(document,"touchend",si),Ln(document,"touchend touchcancel",d)},_cancel:function(){clearTimeout(this._holdTimeout),Ln(document,"touchend touchcancel contextmenu",this._cancel,this),Ln(document,"touchmove",this._onMove,this)},_onMove:function(d){var y=d.touches[0];this._newPos=new lt(y.clientX,y.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(d,y){var P=new MouseEvent(d,{bubbles:!0,cancelable:!0,view:window,screenX:y.screenX,screenY:y.screenY,clientX:y.clientX,clientY:y.clientY});P._simulated=!0,y.target.dispatchEvent(P)}});In.addInitHook("addHandler","tapHold",Vu),In.mergeOptions({touchZoom:xt.touch,bounceAtZoomLimits:!0});var kc=_s.extend({addHooks:function(){dn(this._map._container,"leaflet-touch-zoom"),$t(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Wn(this._map._container,"leaflet-touch-zoom"),Ln(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var y=this._map;if(!(!d.touches||d.touches.length!==2||y._animatingZoom||this._zooming)){var P=y.mouseEventToContainerPoint(d.touches[0]),D=y.mouseEventToContainerPoint(d.touches[1]);this._centerPoint=y.getSize()._divideBy(2),this._startLatLng=y.containerPointToLatLng(this._centerPoint),y.options.touchZoom!=="center"&&(this._pinchStartLatLng=y.containerPointToLatLng(P.add(D)._divideBy(2))),this._startDist=P.distanceTo(D),this._startZoom=y.getZoom(),this._moved=!1,this._zooming=!0,y._stop(),$t(document,"touchmove",this._onTouchMove,this),$t(document,"touchend touchcancel",this._onTouchEnd,this),si(d)}},_onTouchMove:function(d){if(!(!d.touches||d.touches.length!==2||!this._zooming)){var y=this._map,P=y.mouseEventToContainerPoint(d.touches[0]),D=y.mouseEventToContainerPoint(d.touches[1]),j=P.distanceTo(D)/this._startDist;if(this._zoom=y.getScaleZoom(j,this._startZoom),!y.options.bounceAtZoomLimits&&(this._zoom<y.getMinZoom()&&j<1||this._zoom>y.getMaxZoom()&&j>1)&&(this._zoom=y._limitZoom(this._zoom)),y.options.touchZoom==="center"){if(this._center=this._startLatLng,j===1)return}else{var se=P._add(D)._divideBy(2)._subtract(this._centerPoint);if(j===1&&se.x===0&&se.y===0)return;this._center=y.unproject(y.project(this._pinchStartLatLng,this._zoom).subtract(se),this._zoom)}this._moved||(y._moveStart(!0,!1),this._moved=!0),Ve(this._animRequest);var Ae=f(y._move,y,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Pe(Ae,this,!0),si(d)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Ve(this._animRequest),Ln(document,"touchmove",this._onTouchMove,this),Ln(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});In.addInitHook("addHandler","touchZoom",kc),In.BoxZoom=Cc,In.DoubleClickZoom=Zd,In.Drag=Bu,In.Keyboard=Rh,In.ScrollWheelZoom=Lh,In.TapHold=Vu,In.TouchZoom=kc,n.Bounds=nn,n.Browser=xt,n.CRS=xi,n.Canvas=Gd,n.Circle=Mu,n.CircleMarker=cl,n.Class=Xt,n.Control=wn,n.DivIcon=Sc,n.DivOverlay=bs,n.DomEvent=Hl,n.DomUtil=Vs,n.Draggable=Ri,n.Evented=vi,n.FeatureGroup=Di,n.GeoJSON=ra,n.GridLayer=Ma,n.Handler=_s,n.Icon=oo,n.ImageOverlay=Lu,n.LatLng=Jt,n.LatLngBounds=cn,n.Layer=qn,n.LayerGroup=Li,n.LineUtil=de,n.Map=In,n.Marker=$s,n.Mixin=zo,n.Path=Oo,n.Point=lt,n.PolyUtil=vr,n.Polygon=Kl,n.Polyline=ao,n.Popup=Nu,n.PosAnimation=sl,n.Projection=At,n.Rectangle=Fu,n.Renderer=Bo,n.SVG=La,n.SVGOverlay=Du,n.TileLayer=pl,n.Tooltip=sa,n.Transformation=ki,n.Util=Ee,n.VideoOverlay=ka,n.bind=f,n.bounds=rn,n.canvas=Ou,n.circle=hl,n.circleMarker=Ud,n.control=Qi,n.divIcon=Nn,n.extend=o,n.featureGroup=Pa,n.geoJSON=ws,n.geoJson=qd,n.gridLayer=Bp,n.icon=Ch,n.imageOverlay=kh,n.latLng=on,n.latLngBounds=vn,n.layerGroup=Ia,n.map=Do,n.marker=Ah,n.point=Tt,n.polygon=Fp,n.polyline=jn,n.popup=Yl,n.rectangle=Pc,n.setOptions=me,n.stamp=S,n.svg=Mh,n.svgOverlay=zu,n.tileLayer=Ql,n.tooltip=Hd,n.transformation=ui,n.version=r,n.videoOverlay=Tc;var Dh=window.L;n.noConflict=function(){return window.L=Dh,this},window.L=n})})(a1,a1.exports);var c7=a1.exports;const ji=Xv(c7);var MD={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.0/LICENSE.txt
 */(function(t,e){(function(n,r){t.exports=r()})(xA,function(){var n={},r={};function o(f,l,S){if(r[f]=S,f==="index"){var A="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",O={};return r.shared(O),r.index(n,O),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),n}}o("shared",["exports"],function(f){function l(c,s,u,p){return new(u||(u=Promise))(function(_,w){function b(R){try{k(p.next(R))}catch(N){w(N)}}function I(R){try{k(p.throw(R))}catch(N){w(N)}}function k(R){var N;R.done?_(R.value):(N=R.value,N instanceof u?N:new u(function(B){B(N)})).then(b,I)}k((p=p.apply(c,s||[])).next())})}function S(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var A,O;function U(){if(O)return A;function c(s,u){this.x=s,this.y=u}return O=1,A=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,u){return this.clone()._rotateAround(s,u)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var u=s.x-this.x,p=s.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,u){return Math.atan2(this.x*u-this.y*s,this.x*s+this.y*u)},_matMult:function(s){var u=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=u,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var u=Math.cos(s),p=Math.sin(s),_=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=_,this},_rotateAround:function(s,u){var p=Math.cos(s),_=Math.sin(s),w=u.y+_*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-_*(this.y-u.y),this.y=w,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(s){return s instanceof c?s:Array.isArray(s)?new c(s[0],s[1]):s},A}typeof SuppressedError=="function"&&SuppressedError;var H,$,ie=S(U()),me=function(){if($)return H;function c(s,u,p,_){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(_-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=u,this.p2x=p,this.p2y=_}return $=1,H=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,u){if(u===void 0&&(u=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,_=0;_<8;_++){var w=this.sampleCurveX(p)-s;if(Math.abs(w)<u)return p;var b=this.sampleCurveDerivativeX(p);if(Math.abs(b)<1e-6)break;p-=w/b}var I=0,k=1;for(p=s,_=0;_<20&&(w=this.sampleCurveX(p),!(Math.abs(w-s)<u));_++)s>w?I=p:k=p,p=.5*(k-I)+I;return p},solve:function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))}},H}(),Me=S(me);let ce,le;function ge(){return ce==null&&(ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ce}function je(){if(le==null&&(le=!1,ge())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let p=0;p<5*5;p++){const _=4*p;s.fillStyle=`rgb(${_},${_+1},${_+2})`,s.fillRect(p%5,Math.floor(p/5),1,1)}const u=s.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&u[p]!==p){le=!0;break}}}return le||!1}var rt,qe=1e-6,fe=typeof Float32Array<"u"?Float32Array:Array;function Q(){var c=new fe(9);return fe!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function ue(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ve(){var c=new fe(3);return fe!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Pe(c,s,u){var p=new fe(3);return p[0]=c,p[1]=s,p[2]=u,p}function Ve(c,s,u){var p=s[0],_=s[1],w=s[2],b=s[3];return c[0]=u[0]*p+u[4]*_+u[8]*w+u[12]*b,c[1]=u[1]*p+u[5]*_+u[9]*w+u[13]*b,c[2]=u[2]*p+u[6]*_+u[10]*w+u[14]*b,c[3]=u[3]*p+u[7]*_+u[11]*w+u[15]*b,c}function Ee(){var c=new fe(4);return fe!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Xt(){var c=new fe(2);return fe!=Float32Array&&(c[0]=0,c[1]=0),c}function tr(c,s){var u=new fe(2);return u[0]=c,u[1]=s,u}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)}),ve(),rt=new fe(4),fe!=Float32Array&&(rt[0]=0,rt[1]=0,rt[2]=0,rt[3]=0),ve(),Pe(1,0,0),Pe(0,1,0),Ee(),Ee(),Q(),Xt();const Yt=8192;function vi(c,s,u){return s*(Yt/(c.tileSize*Math.pow(2,u-c.tileID.overscaledZ)))}function lt(c,s){return(c%s+s)%s}function Qt(c,s,u){return c*(1-u)+s*u}function Tt(c){if(c<=0)return 0;if(c>=1)return 1;const s=c*c,u=s*c;return 4*(c<.5?u:3*(c-s)+u-.75)}function nn(c,s,u,p){const _=new Me(c,s,u,p);return w=>_.solve(w)}const rn=nn(.25,.1,.25,1);function cn(c,s,u){return Math.min(u,Math.max(s,c))}function vn(c,s,u){const p=u-s,_=((c-s)%p+p)%p+s;return _===s?u:_}function Jt(c,...s){for(const u of s)for(const p in u)c[p]=u[p];return c}let on=1;function xi(c,s,u){const p={};for(const _ in c)p[_]=s.call(this,c[_],_,c);return p}function Ir(c,s,u){const p={};for(const _ in c)s.call(this,c[_],_,c)&&(p[_]=c[_]);return p}function Pr(c){return Array.isArray(c)?c.map(Pr):typeof c=="object"&&c?xi(c,Pr):c}const Ls={};function ki(c){Ls[c]||(typeof console<"u"&&console.warn(c),Ls[c]=!0)}function ui(c,s,u){return(u.y-c.y)*(s.x-c.x)>(s.y-c.y)*(u.x-c.x)}function Fr(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let wi=null;function Ds(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const to="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Br(c,s,u,p,_){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(c,{timestamp:0});try{const b=w==null?void 0:w.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const I=b.startsWith("BGR"),k=new Uint8ClampedArray(p*_*4);if(yield w.copyTo(k,function(R,N,B,G,X){const Y=4*Math.max(1,0),te=(Math.max(0,B)-B)*G*4+Y,he=4*G,we=Math.max(0,N),Ne=Math.max(0,B);return{rect:{x:we,y:Ne,width:Math.min(R.width,N+G)-we,height:Math.min(R.height,B+X)-Ne},layout:[{offset:te,stride:he}]}}(c,s,u,p,_)),I)for(let R=0;R<k.length;R+=4){const N=k[R];k[R]=k[R+2],k[R+2]=N}return k}finally{w.close()}})}let hs,no;function hr(c){return c/Math.PI*180}const zs="AbortError";function bo(){return new Error(zs)}const ds={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Xo(c){return ds.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const To="global-dispatcher";class ni extends Error{constructor(s,u,p,_){super(`AJAXError: ${u} (${s}): ${p}`),this.status=s,this.statusText=u,this.url=p,this.body=_}}const Ti=()=>Fr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Vr=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const p=Xo(c.url);if(p)return p(c,s);if(Fr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:To},s)}if(!(/^file:/.test(u=c.url)||/^file:/.test(Ti())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,_){return l(this,void 0,void 0,function*(){const w=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ti(),signal:_.signal});let b,I;p.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");try{b=yield fetch(w)}catch(R){throw new ni(0,R.message,p.url,new Blob)}if(!b.ok){const R=yield b.blob();throw new ni(b.status,b.statusText,p.url,R)}I=p.type==="arrayBuffer"||p.type==="image"?b.arrayBuffer():p.type==="json"?b.json():b.text();const k=yield I;if(_.signal.aborted)throw bo();return{data:k,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(c,s);if(Fr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:To},s)}var u;return function(p,_){return new Promise((w,b)=>{var I;const k=new XMLHttpRequest;k.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(k.responseType="arraybuffer");for(const R in p.headers)k.setRequestHeader(R,p.headers[R]);p.type==="json"&&(k.responseType="text",!((I=p.headers)===null||I===void 0)&&I.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=p.credentials==="include",k.onerror=()=>{b(new Error(k.statusText))},k.onload=()=>{if(!_.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let R=k.response;if(p.type==="json")try{R=JSON.parse(k.response)}catch(N){return void b(N)}w({data:R,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const R=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});b(new ni(k.status,k.statusText,p.url,R))}},_.signal.addEventListener("abort",()=>{k.abort(),b(bo())}),k.send(p.body)})}(c,s)};function So(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const s=new URL(c),u=window.location;return s.protocol===u.protocol&&s.host===u.host}function Ns(c,s,u){u[c]&&u[c].indexOf(s)!==-1||(u[c]=u[c]||[],u[c].push(s))}function Yo(c,s,u){if(u&&u[c]){const p=u[c].indexOf(s);p!==-1&&u[c].splice(p,1)}}class Os{constructor(s,u={}){Jt(this,u),this.type=s}}class Qo extends Os{constructor(s,u={}){super("error",Jt({error:s},u))}}class fs{on(s,u){return this._listeners=this._listeners||{},Ns(s,u,this._listeners),{unsubscribe:()=>{this.off(s,u)}}}off(s,u){return Yo(s,u,this._listeners),Yo(s,u,this._oneTimeListeners),this}once(s,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ns(s,u,this._oneTimeListeners),this):new Promise(p=>this.once(s,p))}fire(s,u){typeof s=="string"&&(s=new Os(s,u||{}));const p=s.type;if(this.listens(p)){s.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of _)I.call(this,s);const w=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of w)Yo(p,I,this._oneTimeListeners),I.call(this,s);const b=this._eventedParent;b&&(Jt(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(s))}else s instanceof Qo&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ee=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function re(c,s){const u={};for(const p in c)p!=="ref"&&(u[p]=c[p]);return ee.forEach(p=>{p in s&&(u[p]=s[p])}),u}function oe(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let u=0;u<c.length;u++)if(!oe(c[u],s[u]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const u in c)if(!oe(c[u],s[u]))return!1;return!0}return c===s}function Te(c,s){c.push(s)}function Le(c,s,u){Te(u,{command:"addSource",args:[c,s[c]]})}function Be(c,s,u){Te(s,{command:"removeSource",args:[c]}),u[c]=!0}function He(c,s,u,p){Be(c,u,p),Le(c,s,u)}function Fe(c,s,u){let p;for(p in c[u])if(Object.prototype.hasOwnProperty.call(c[u],p)&&p!=="data"&&!oe(c[u][p],s[u][p]))return!1;for(p in s[u])if(Object.prototype.hasOwnProperty.call(s[u],p)&&p!=="data"&&!oe(c[u][p],s[u][p]))return!1;return!0}function Qe(c,s,u,p,_,w){c=c||{},s=s||{};for(const b in c)Object.prototype.hasOwnProperty.call(c,b)&&(oe(c[b],s[b])||u.push({command:w,args:[p,b,s[b],_]}));for(const b in s)Object.prototype.hasOwnProperty.call(s,b)&&!Object.prototype.hasOwnProperty.call(c,b)&&(oe(c[b],s[b])||u.push({command:w,args:[p,b,s[b],_]}))}function Ye(c){return c.id}function Ue(c,s){return c[s.id]=s,c}class Oe{constructor(s,u,p,_){this.message=(s?`${s}: `:"")+p,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)}}function yt(c,...s){for(const u of s)for(const p in u)c[p]=u[p];return c}class vt extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class zt{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[p,_]of u)this.bindings[p]=_}concat(s){return new zt(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const tn={kind:"null"},nt={kind:"number"},wt={kind:"string"},Ct={kind:"boolean"},xt={kind:"color"},hn={kind:"projectionDefinition"},qt={kind:"object"},kt={kind:"value"},Qn={kind:"collator"},ps={kind:"formatted"},Si={kind:"padding"},Zn={kind:"resolvedImage"},zn={kind:"variableAnchorOffsetCollection"};function Cr(c,s){return{kind:"array",itemType:c,N:s}}function ii(c){if(c.kind==="array"){const s=ii(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const Jo=[tn,nt,wt,Ct,xt,hn,ps,qt,Cr(kt),Si,Zn,zn];function Eo(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Eo(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const u of Jo)if(!Eo(u,s))return null}}return`Expected ${ii(c)} but found ${ii(s)} instead.`}function Qa(c,s){return s.some(u=>u.kind===c.kind)}function Io(c,s){return s.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}function Fs(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}const Ja=.96422,jl=.82521,Ul=4/29,Bs=6/29,Po=3*Bs*Bs,el=Bs*Bs*Bs,tl=Math.PI/180,Cu=180/Math.PI;function $l(c){return(c%=360)<0&&(c+=360),c}function Co([c,s,u,p]){let _,w;const b=Jn((.2225045*(c=gn(c))+.7168786*(s=gn(s))+.0606169*(u=gn(u)))/1);c===s&&s===u?_=w=b:(_=Jn((.4360747*c+.3850649*s+.1430804*u)/Ja),w=Jn((.0139322*c+.0971045*s+.7141733*u)/jl));const I=116*b-16;return[I<0?0:I,500*(_-b),200*(b-w),p]}function gn(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Jn(c){return c>el?Math.pow(c,1/3):c/Po+Ul}function ba([c,s,u,p]){let _=(c+16)/116,w=isNaN(s)?_:_+s/500,b=isNaN(u)?_:_-u/200;return _=1*Ao(_),w=Ja*Ao(w),b=jl*Ao(b),[jr(3.1338561*w-1.6168667*_-.4906146*b),jr(-.9787684*w+1.9161415*_+.033454*b),jr(.0719453*w-.2289914*_+1.4052427*b),p]}function jr(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ao(c){return c>Bs?c*c*c:Po*(c-Ul)}function Ta(c){return parseInt(c.padEnd(2,c),16)/255}function dn(c,s){return Wn(s?c/100:c,0,1)}function Wn(c,s,u){return Math.min(Math.max(s,c),u)}function nl(c){return!c.some(Number.isNaN)}const $i={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Bt(c,s,u){return c+u*(s-c)}function Ur(c,s,u){return c.map((p,_)=>Bt(p,s[_],u))}class ln{constructor(s,u,p,_=1,w=!0){this.r=s,this.g=u,this.b=p,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[s,u,p,_]))}static parse(s){if(s instanceof ln)return s;if(typeof s!="string")return;const u=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=$i[p];if(_){const[b,I,k]=_;return[b/255,I/255,k/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const b=p.length<6?1:2;let I=1;return[Ta(p.slice(I,I+=b)),Ta(p.slice(I,I+=b)),Ta(p.slice(I,I+=b)),Ta(p.slice(I,I+b)||"ff")]}if(p.startsWith("rgb")){const b=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[I,k,R,N,B,G,X,Y,te,he,we,Ne]=b,Se=[N||" ",X||" ",he].join("");if(Se==="  "||Se==="  /"||Se===",,"||Se===",,,"){const K=[R,G,te].join(""),ae=K==="%%%"?100:K===""?255:0;if(ae){const Ie=[Wn(+k/ae,0,1),Wn(+B/ae,0,1),Wn(+Y/ae,0,1),we?dn(+we,Ne):1];if(nl(Ie))return Ie}}return}}const w=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[b,I,k,R,N,B,G,X,Y]=w,te=[k||" ",N||" ",G].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const he=[+I,Wn(+R,0,100),Wn(+B,0,100),X?dn(+X,Y):1];if(nl(he))return function([we,Ne,Se,K]){function ae(Ie){const We=(Ie+we/30)%12,ct=Ne*Math.min(Se,1-Se);return Se-ct*Math.max(-1,Math.min(We-3,9-We,1))}return we=$l(we),Ne/=100,Se/=100,[ae(0),ae(8),ae(4),K]}(he)}}}(s);return u?new ln(...u,!1):void 0}get rgb(){const{r:s,g:u,b:p,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[s/w,u/w,p/w,_])}get hcl(){return this.overwriteGetter("hcl",function(s){const[u,p,_,w]=Co(s),b=Math.sqrt(p*p+_*_);return[Math.round(1e4*b)?$l(Math.atan2(_,p)*Cu):NaN,b,u,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Co(this.rgb))}overwriteGetter(s,u){return Object.defineProperty(this,s,{value:u}),u}toString(){const[s,u,p,_]=this.rgb;return`rgba(${[s,u,p].map(w=>Math.round(255*w)).join(",")},${_})`}static interpolate(s,u,p,_="rgb"){switch(_){case"rgb":{const[w,b,I,k]=Ur(s.rgb,u.rgb,p);return new ln(w,b,I,k,!1)}case"hcl":{const[w,b,I,k]=s.hcl,[R,N,B,G]=u.hcl;let X,Y;if(isNaN(w)||isNaN(R))isNaN(w)?isNaN(R)?X=NaN:(X=R,I!==1&&I!==0||(Y=N)):(X=w,B!==1&&B!==0||(Y=b));else{let Se=R-w;R>w&&Se>180?Se-=360:R<w&&w-R>180&&(Se+=360),X=w+p*Se}const[te,he,we,Ne]=function([Se,K,ae,Ie]){return Se=isNaN(Se)?0:Se*tl,ba([ae,Math.cos(Se)*K,Math.sin(Se)*K,Ie])}([X,Y??Bt(b,N,p),Bt(I,B,p),Bt(k,G,p)]);return new ln(te,he,we,Ne,!1)}case"lab":{const[w,b,I,k]=ba(Ur(s.lab,u.lab,p));return new ln(w,b,I,k,!1)}}}}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1);class ms{constructor(s,u,p){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const un=["bottom","center","top"];class Ar{constructor(s,u,p,_,w,b){this.text=s,this.image=u,this.scale=p,this.fontStack=_,this.textColor=w,this.verticalAlign=b}}class Vn{constructor(s){this.sections=s}static fromString(s){return new Vn([new Ar(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Vn?s:Vn.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class ei{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ei)return s;if(typeof s=="number")return new ei([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const u of s)if(typeof u!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new ei(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,u,p){return new ei(Ur(s.values,u.values,p))}}class ri{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const ko=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Xi)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let u=0;u<s.length;u+=2){const p=s[u],_=s[u+1];if(typeof p!="string"||!ko.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Xi(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,u,p){const _=s.values,w=u.values;if(_.length!==w.length)throw new ri(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${u.toString()}`);const b=[];for(let I=0;I<_.length;I+=2){if(_[I]!==w[I])throw new ri(`Cannot interpolate values containing mismatched anchors. from[${I}]: ${_[I]}, to[${I}]: ${w[I]}`);b.push(_[I]);const[k,R]=_[I+1],[N,B]=w[I+1];b.push([Bt(k,N,p),Bt(R,B,p)])}return new Xi(b)}}class Yi{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new Yi({name:s,available:!1}):null}}class qi{constructor(s,u,p){this.from=s,this.to=u,this.transition=p}static interpolate(s,u,p){return new qi(s,u,p)}static parse(s){return s instanceof qi?s:Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"?new qi(s[0],s[1],s[2]):typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number"?new qi(s.from,s.to,s.transition):typeof s=="string"?new qi(s,s,1):void 0}}function il(c,s,u,p){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[c,s,u,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[c,s,u,p]:[c,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $r(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof qi||c instanceof ln||c instanceof ms||c instanceof Vn||c instanceof ei||c instanceof Xi||c instanceof Yi)return!0;if(Array.isArray(c)){for(const s of c)if(!$r(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!$r(c[s]))return!1;return!0}return!1}function En(c){if(c===null)return tn;if(typeof c=="string")return wt;if(typeof c=="boolean")return Ct;if(typeof c=="number")return nt;if(c instanceof ln)return xt;if(c instanceof qi)return hn;if(c instanceof ms)return Qn;if(c instanceof Vn)return ps;if(c instanceof ei)return Si;if(c instanceof Xi)return zn;if(c instanceof Yi)return Zn;if(Array.isArray(c)){const s=c.length;let u;for(const p of c){const _=En(p);if(u){if(u===_)continue;u=kt;break}u=_}return Cr(u||kt,s)}return qt}function ea(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof ln||c instanceof qi||c instanceof Vn||c instanceof ei||c instanceof Xi||c instanceof Yi?c.toString():JSON.stringify(c)}class qr{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!$r(s[1]))return u.error("invalid value");const p=s[1];let _=En(p);const w=u.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new qr(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Vs={string:wt,number:nt,boolean:Ct,object:qt};class $t{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let p,_=1;const w=s[0];if(w==="array"){let I,k;if(s.length>2){const R=s[1];if(typeof R!="string"||!(R in Vs)||R==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=Vs[R],_++}else I=kt;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);k=s[2],_++}p=Cr(I,k)}else{if(!Vs[w])throw new Error(`Types doesn't contain name = ${w}`);p=Vs[w]}const b=[];for(;_<s.length;_++){const I=u.parse(s[_],_,kt);if(!I)return null;b.push(I)}return new $t(p,b)}evaluate(s){for(let u=0;u<this.args.length;u++){const p=this.args[u].evaluate(s);if(!Eo(this.type,En(p)))return p;if(u===this.args.length-1)throw new ri(`Expected value to be of type ${ii(this.type)}, but found ${ii(En(p))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const is={"to-boolean":Ct,"to-color":xt,"to-number":nt,"to-string":wt};class Ln{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const p=s[0];if(!is[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&s.length!==2)return u.error("Expected one argument.");const _=is[p],w=[];for(let b=1;b<s.length;b++){const I=u.parse(s[b],b,kt);if(!I)return null;w.push(I)}return new Ln(_,w)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let u,p;for(const _ of this.args){if(u=_.evaluate(s),p=null,u instanceof ln)return u;if(typeof u=="string"){const w=s.parseColor(u);if(w)return w}else if(Array.isArray(u)&&(p=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:il(u[0],u[1],u[2],u[3]),!p))return new ln(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ri(p||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const p of this.args){u=p.evaluate(s);const _=ei.parse(u);if(_)return _}throw new ri(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const p of this.args){u=p.evaluate(s);const _=Xi.parse(u);if(_)return _}throw new ri(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const p of this.args){if(u=p.evaluate(s),u===null)return 0;const _=Number(u);if(!isNaN(_))return _}throw new ri(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Vn.fromString(ea(this.args[0].evaluate(s)));case"resolvedImage":return Yi.fromString(ea(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return ea(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const rl=["Unknown","Point","LineString","Polygon"];class Mn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=ln.parse(s)),u}}class Mo{constructor(s,u,p=[],_,w=new zt,b=[]){this.registry=s,this.path=p,this.key=p.map(I=>`[${I}]`).join(""),this.scope=w,this.errors=b,this.expectedType=_,this._isConstant=u}parse(s,u,p,_,w={}){return u?this.concat(u,p,_)._parse(s,w):this._parse(s,w)}_parse(s,u){function p(_,w,b){return b==="assert"?new $t(w,[_]):b==="coerce"?new Ln(w,[_]):_}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=s[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let b=w.parse(s,this);if(!b)return null;if(this.expectedType){const I=this.expectedType,k=b.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||k.kind!=="value")if(I.kind!=="projectionDefinition"||k.kind!=="string"&&k.kind!=="array")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(I.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(I,k))return null}else b=p(b,I,u.typeAnnotation||"coerce");else b=p(b,I,u.typeAnnotation||"coerce");else b=p(b,I,u.typeAnnotation||"coerce");else b=p(b,I,u.typeAnnotation||"coerce");else b=p(b,I,u.typeAnnotation||"assert")}if(!(b instanceof qr)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const I=new Mn;try{b=new qr(b.type,b.evaluate(I))}catch(k){return this.error(k.message),null}}return b}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,p){const _=typeof s=="number"?this.path.concat(s):this.path,w=p?this.scope.concat(p):this.scope;return new Mo(this.registry,this._isConstant,_,u||null,w,this.errors)}error(s,...u){const p=`${this.key}${u.map(_=>`[${_}]`).join("")}`;this.errors.push(new vt(p,s))}checkSubtype(s,u){const p=Eo(s,u);return p&&this.error(p),p}}class xn{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const p=[];for(let w=1;w<s.length-1;w+=2){const b=s[w];if(typeof b!="string")return u.error(`Expected string, but found ${typeof b} instead.`,w);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",w);const I=u.parse(s[w+1],w+1);if(!I)return null;p.push([b,I])}const _=u.parse(s[s.length-1],s.length-1,u.expectedType,p);return _?new xn(p,_):null}outputDefined(){return this.result.outputDefined()}}class Wt{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const p=s[1];return u.scope.has(p)?new Wt(p,u.scope.get(p)):u.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class js{constructor(s,u,p){this.type=s,this.index=u,this.input=p}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=u.parse(s[1],1,nt),_=u.parse(s[2],2,Cr(u.expectedType||kt));return p&&_?new js(_.type.itemType,p,_):null}evaluate(s){const u=this.index.evaluate(s),p=this.input.evaluate(s);if(u<0)throw new ri(`Array index out of bounds: ${u} < 0.`);if(u>=p.length)throw new ri(`Array index out of bounds: ${u} > ${p.length-1}.`);if(u!==Math.floor(u))throw new ri(`Array index must be an integer, but found ${u} instead.`);return p[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class fn{constructor(s,u){this.type=Ct,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=u.parse(s[1],1,kt),_=u.parse(s[2],2,kt);return p&&_?Qa(p.type,[Ct,wt,nt,tn,kt])?new fn(p,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(p.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!p)return!1;if(!Io(u,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${ii(En(u))} instead.`);if(!Io(p,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${ii(En(p))} instead.`);return p.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class si{constructor(s,u,p){this.type=nt,this.needle=s,this.haystack=u,this.fromIndex=p}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const p=u.parse(s[1],1,kt),_=u.parse(s[2],2,kt);if(!p||!_)return null;if(!Qa(p.type,[Ct,wt,nt,tn,kt]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(p.type)} instead`);if(s.length===4){const w=u.parse(s[3],3,nt);return w?new si(p,_,w):null}return new si(p,_)}evaluate(s){const u=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!Io(u,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${ii(En(u))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(s)),Io(p,["string"])){const w=p.indexOf(u,_);return w===-1?-1:[...p.slice(0,w)].length}if(Io(p,["array"]))return p.indexOf(u,_);throw new ri(`Expected second argument to be of type array or string, but found ${ii(En(p))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Mi{constructor(s,u,p,_,w,b){this.inputType=s,this.type=u,this.input=p,this.cases=_,this.outputs=w,this.otherwise=b}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let p,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);const w={},b=[];for(let R=2;R<s.length-1;R+=2){let N=s[R];const B=s[R+1];Array.isArray(N)||(N=[N]);const G=u.concat(R);if(N.length===0)return G.error("Expected at least one branch label.");for(const Y of N){if(typeof Y!="number"&&typeof Y!="string")return G.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return G.error("Numeric branch labels must be integer values.");if(p){if(G.checkSubtype(p,En(Y)))return null}else p=En(Y);if(w[String(Y)]!==void 0)return G.error("Branch labels must be unique.");w[String(Y)]=b.length}const X=u.parse(B,R,_);if(!X)return null;_=_||X.type,b.push(X)}const I=u.parse(s[1],1,kt);if(!I)return null;const k=u.parse(s[s.length-1],s.length-1,_);return k?I.type.kind!=="value"&&u.concat(1).checkSubtype(p,I.type)?null:new Mi(p,_,I,w,b,k):null}evaluate(s){const u=this.input.evaluate(s);return(En(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class ta{constructor(s,u,p){this.type=s,this.branches=u,this.otherwise=p}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const _=[];for(let b=1;b<s.length-1;b+=2){const I=u.parse(s[b],b,Ct);if(!I)return null;const k=u.parse(s[b+1],b+1,p);if(!k)return null;_.push([I,k]),p=p||k.type}const w=u.parse(s[s.length-1],s.length-1,p);if(!w)return null;if(!p)throw new Error("Can't infer output type");return new ta(p,_,w)}evaluate(s){for(const[u,p]of this.branches)if(u.evaluate(s))return p.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,p]of this.branches)s(u),s(p);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class Ro{constructor(s,u,p,_){this.type=s,this.input=u,this.beginIndex=p,this.endIndex=_}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const p=u.parse(s[1],1,kt),_=u.parse(s[2],2,nt);if(!p||!_)return null;if(!Qa(p.type,[Cr(kt),wt,kt]))return u.error(`Expected first argument to be of type array or string, but found ${ii(p.type)} instead`);if(s.length===4){const w=u.parse(s[3],3,nt);return w?new Ro(p.type,p,_,w):null}return new Ro(p.type,p,_)}evaluate(s){const u=this.input.evaluate(s),p=this.beginIndex.evaluate(s);let _;if(this.endIndex&&(_=this.endIndex.evaluate(s)),Io(u,["string"]))return[...u].slice(p,_).join("");if(Io(u,["array"]))return u.slice(p,_);throw new ri(`Expected first argument to be of type array or string, but found ${ii(En(u))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function oi(c,s){const u=c.length-1;let p,_,w=0,b=u,I=0;for(;w<=b;)if(I=Math.floor((w+b)/2),p=c[I],_=c[I+1],p<=s){if(I===u||s<_)return I;w=I+1}else{if(!(p>s))throw new ri("Input is not a number.");b=I-1}return 0}class Lo{constructor(s,u,p){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[_,w]of p)this.labels.push(_),this.outputs.push(w)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const p=u.parse(s[1],1,nt);if(!p)return null;const _=[];let w=null;u.expectedType&&u.expectedType.kind!=="value"&&(w=u.expectedType);for(let b=1;b<s.length;b+=2){const I=b===1?-1/0:s[b],k=s[b+1],R=b,N=b+1;if(typeof I!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=I)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const B=u.parse(k,N,w);if(!B)return null;w=w||B.type,_.push([I,B])}return new Lo(w,p,_)}evaluate(s){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=u[0])return p[0].evaluate(s);const w=u.length;return _>=u[w-1]?p[w-1].evaluate(s):p[oi(u,_)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function ql(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Hl,sl,In=function(){if(sl)return Hl;function c(s,u,p,_){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(_-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=u,this.p2x=p,this.p2y=_}return sl=1,Hl=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,u){if(u===void 0&&(u=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,_=0;_<8;_++){var w=this.sampleCurveX(p)-s;if(Math.abs(w)<u)return p;var b=this.sampleCurveDerivativeX(p);if(Math.abs(b)<1e-6)break;p-=w/b}var I=0,k=1;for(p=s,_=0;_<20&&(w=this.sampleCurveX(p),!(Math.abs(w-s)<u));_++)s>w?I=p:k=p,p=.5*(k-I)+I;return p},solve:function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))}},Hl}(),Do=ql(In);class wn{constructor(s,u,p,_,w){this.type=s,this.operator=u,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[b,I]of w)this.labels.push(b),this.outputs.push(I)}static interpolationFactor(s,u,p,_){let w=0;if(s.name==="exponential")w=Qi(u,s.base,p,_);else if(s.name==="linear")w=Qi(u,1,p,_);else if(s.name==="cubic-bezier"){const b=s.controlPoints;w=new Do(b[0],b[1],b[2],b[3]).solve(Qi(u,1,p,_))}return w}static parse(s,u){let[p,_,w,...b]=s;if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const R=_[1];if(typeof R!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:R}}else{if(_[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const R=_.slice(1);if(R.length!==4||R.some(N=>typeof N!="number"||N<0||N>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:R}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(w=u.parse(w,2,nt),!w)return null;const I=[];let k=null;p==="interpolate-hcl"||p==="interpolate-lab"?k=xt:u.expectedType&&u.expectedType.kind!=="value"&&(k=u.expectedType);for(let R=0;R<b.length;R+=2){const N=b[R],B=b[R+1],G=R+3,X=R+4;if(typeof N!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(I.length&&I[I.length-1][0]>=N)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const Y=u.parse(B,X,k);if(!Y)return null;k=k||Y.type,I.push([N,Y])}return Fs(k,nt)||Fs(k,hn)||Fs(k,xt)||Fs(k,Si)||Fs(k,zn)||Fs(k,Cr(nt))?new wn(k,p,_,w,I):u.error(`Type ${ii(k)} is not interpolatable.`)}evaluate(s){const u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=u[0])return p[0].evaluate(s);const w=u.length;if(_>=u[w-1])return p[w-1].evaluate(s);const b=oi(u,_),I=wn.interpolationFactor(this.interpolation,_,u[b],u[b+1]),k=p[b].evaluate(s),R=p[b+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Bt(k,R,I);case"color":return ln.interpolate(k,R,I);case"padding":return ei.interpolate(k,R,I);case"variableAnchorOffsetCollection":return Xi.interpolate(k,R,I);case"array":return Ur(k,R,I);case"projectionDefinition":return qi.interpolate(k,R,I)}case"interpolate-hcl":return ln.interpolate(k,R,I,"hcl");case"interpolate-lab":return ln.interpolate(k,R,I,"lab")}}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Qi(c,s,u,p){const _=p-u,w=c-u;return _===0?0:s===1?w/_:(Math.pow(s,w)-1)/(Math.pow(s,_)-1)}const Hr={color:ln.interpolate,number:Bt,padding:ei.interpolate,variableAnchorOffsetCollection:Xi.interpolate,array:Ur};class na{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let p=null;const _=u.expectedType;_&&_.kind!=="value"&&(p=_);const w=[];for(const I of s.slice(1)){const k=u.parse(I,1+w.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,w.push(k)}if(!p)throw new Error("No output type");const b=_&&w.some(I=>Eo(_,I.type));return new na(b?kt:p,w)}evaluate(s){let u,p=null,_=0;for(const w of this.args)if(_++,p=w.evaluate(s),p&&p instanceof Yi&&!p.available&&(u||(u=p.name),p=null,_===this.args.length&&(p=u)),p!==null)break;return p}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}function ci(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Gl(c,s,u,p){return p.compare(s,u)===0}function gs(c,s,u){const p=c!=="=="&&c!=="!=";return class RD{constructor(w,b,I){this.type=Ct,this.lhs=w,this.rhs=b,this.collator=I,this.hasUntypedArgument=w.type.kind==="value"||b.type.kind==="value"}static parse(w,b){if(w.length!==3&&w.length!==4)return b.error("Expected two or three arguments.");const I=w[0];let k=b.parse(w[1],1,kt);if(!k)return null;if(!ci(I,k.type))return b.concat(1).error(`"${I}" comparisons are not supported for type '${ii(k.type)}'.`);let R=b.parse(w[2],2,kt);if(!R)return null;if(!ci(I,R.type))return b.concat(2).error(`"${I}" comparisons are not supported for type '${ii(R.type)}'.`);if(k.type.kind!==R.type.kind&&k.type.kind!=="value"&&R.type.kind!=="value")return b.error(`Cannot compare types '${ii(k.type)}' and '${ii(R.type)}'.`);p&&(k.type.kind==="value"&&R.type.kind!=="value"?k=new $t(R.type,[k]):k.type.kind!=="value"&&R.type.kind==="value"&&(R=new $t(k.type,[R])));let N=null;if(w.length===4){if(k.type.kind!=="string"&&R.type.kind!=="string"&&k.type.kind!=="value"&&R.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(N=b.parse(w[3],3,Qn),!N)return null}return new RD(k,R,N)}evaluate(w){const b=this.lhs.evaluate(w),I=this.rhs.evaluate(w);if(p&&this.hasUntypedArgument){const k=En(b),R=En(I);if(k.kind!==R.kind||k.kind!=="string"&&k.kind!=="number")throw new ri(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${k.kind}, ${R.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const k=En(b),R=En(I);if(k.kind!=="string"||R.kind!=="string")return s(w,b,I)}return this.collator?u(w,b,I,this.collator.evaluate(w)):s(w,b,I)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const ol=gs("==",function(c,s,u){return s===u},Gl),xc=gs("!=",function(c,s,u){return s!==u},function(c,s,u,p){return!Gl(0,s,u,p)}),io=gs("<",function(c,s,u){return s<u},function(c,s,u,p){return p.compare(s,u)<0}),Au=gs(">",function(c,s,u){return s>u},function(c,s,u,p){return p.compare(s,u)>0}),_s=gs("<=",function(c,s,u){return s<=u},function(c,s,u,p){return p.compare(s,u)<=0}),zo=gs(">=",function(c,s,u){return s>=u},function(c,s,u,p){return p.compare(s,u)>=0});class ro{constructor(s,u,p){this.type=Qn,this.locale=p,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const p=s[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");const _=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ct);if(!_)return null;const w=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ct);if(!w)return null;let b=null;return p.locale&&(b=u.parse(p.locale,1,wt),!b)?null:new ro(_,w,b)}evaluate(s){return new ms(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class Ri{constructor(s,u,p,_,w){this.type=wt,this.number=s,this.locale=u,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const p=u.parse(s[1],1,nt);if(!p)return null;const _=s[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=u.parse(_.locale,1,wt),!w))return null;let b=null;if(_.currency&&(b=u.parse(_.currency,1,wt),!b))return null;let I=null;if(_["min-fraction-digits"]&&(I=u.parse(_["min-fraction-digits"],1,nt),!I))return null;let k=null;return _["max-fraction-digits"]&&(k=u.parse(_["max-fraction-digits"],1,nt),!k)?null:new Ri(p,w,b,I,k)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class No{constructor(s){this.type=ps,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const p=s[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");const _=[];let w=!1;for(let b=1;b<=s.length-1;++b){const I=s[b];if(w&&typeof I=="object"&&!Array.isArray(I)){w=!1;let k=null;if(I["font-scale"]&&(k=u.parse(I["font-scale"],1,nt),!k))return null;let R=null;if(I["text-font"]&&(R=u.parse(I["text-font"],1,Cr(wt)),!R))return null;let N=null;if(I["text-color"]&&(N=u.parse(I["text-color"],1,xt),!N))return null;let B=null;if(I["vertical-align"]){if(typeof I["vertical-align"]=="string"&&!un.includes(I["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${I["vertical-align"]}' instead.`);if(B=u.parse(I["vertical-align"],1,wt),!B)return null}const G=_[_.length-1];G.scale=k,G.font=R,G.textColor=N,G.verticalAlign=B}else{const k=u.parse(s[b],1,kt);if(!k)return null;const R=k.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:k,scale:null,font:null,textColor:null,verticalAlign:null})}}return new No(_)}evaluate(s){return new Vn(this.sections.map(u=>{const p=u.content.evaluate(s);return En(p)===Zn?new Ar("",p,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(s):null):new Ar(ea(p),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null,u.verticalAlign?u.verticalAlign.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor),u.verticalAlign&&s(u.verticalAlign)}outputDefined(){return!1}}class so{constructor(s){this.type=Zn,this.input=s}static parse(s,u){if(s.length!==2)return u.error("Expected two arguments.");const p=u.parse(s[1],1,wt);return p?new so(p):u.error("No image name provided.")}evaluate(s){const u=this.input.evaluate(s),p=Yi.fromString(u);return p&&s.availableImages&&(p.available=s.availableImages.indexOf(u)>-1),p}eachChild(s){s(this.input)}outputDefined(){return!1}}class Sa{constructor(s){this.type=nt,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const p=u.parse(s[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${ii(p.type)} instead.`):new Sa(p):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new ri(`Expected value to be of type string or array, but found ${ii(En(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const vr=8192;function ku(c,s){const u=(180+c[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(u*_*vr),Math.round(p*_*vr)]}function al(c,s){const u=Math.pow(2,s.z);return[(_=(c[0]/vr+s.x)/u,360*_-180),(p=(c[1]/vr+s.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function ys(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Ea(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function ia(c,s,u){const p=c[0]-s[0],_=c[1]-s[1],w=c[0]-u[0],b=c[1]-u[1];return p*b-w*_==0&&p*w<=0&&_*b<=0}function ll(c,s,u,p){return(_=[p[0]-u[0],p[1]-u[1]])[0]*(w=[s[0]-c[0],s[1]-c[1]])[1]-_[1]*w[0]!=0&&!(!xs(c,s,u,p)||!xs(u,p,c,s));var _,w}function Zl(c,s,u){for(const p of u)for(let _=0;_<p.length-1;++_)if(ll(c,s,p[_],p[_+1]))return!0;return!1}function vs(c,s,u=!1){let p=!1;for(const I of s)for(let k=0;k<I.length-1;k++){if(ia(c,I[k],I[k+1]))return u;(w=I[k])[1]>(_=c)[1]!=(b=I[k+1])[1]>_[1]&&_[0]<(b[0]-w[0])*(_[1]-w[1])/(b[1]-w[1])+w[0]&&(p=!p)}var _,w,b;return p}function dr(c,s){for(const u of s)if(vs(c,u))return!0;return!1}function Us(c,s){for(const u of c)if(!vs(u,s))return!1;for(let u=0;u<c.length-1;++u)if(Zl(c[u],c[u+1],s))return!1;return!0}function wc(c,s){for(const u of s)if(Us(c,u))return!0;return!1}function xs(c,s,u,p){const _=p[0]-u[0],w=p[1]-u[1],b=(c[0]-u[0])*w-_*(c[1]-u[1]),I=(s[0]-u[0])*w-_*(s[1]-u[1]);return b>0&&I<0||b<0&&I>0}function E(c,s,u){const p=[];for(let _=0;_<c.length;_++){const w=[];for(let b=0;b<c[_].length;b++){const I=ku(c[_][b],u);ys(s,I),w.push(I)}p.push(w)}return p}function F(c,s,u){const p=[];for(let _=0;_<c.length;_++){const w=E(c[_],s,u);p.push(w)}return p}function W(c,s,u,p){if(c[0]<u[0]||c[0]>u[2]){const _=.5*p;let w=c[0]-u[0]>_?-p:u[0]-c[0]>_?p:0;w===0&&(w=c[0]-u[2]>_?-p:u[2]-c[0]>_?p:0),c[0]+=w}ys(s,c)}function de(c,s,u,p){const _=Math.pow(2,p.z)*vr,w=[p.x*vr,p.y*vr],b=[];for(const I of c)for(const k of I){const R=[k.x+w[0],k.y+w[1]];W(R,s,u,_),b.push(R)}return b}function $e(c,s,u,p){const _=Math.pow(2,p.z)*vr,w=[p.x*vr,p.y*vr],b=[];for(const k of c){const R=[];for(const N of k){const B=[N.x+w[0],N.y+w[1]];ys(s,B),R.push(B)}b.push(R)}if(s[2]-s[0]<=_/2){(I=s)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const k of b)for(const R of k)W(R,s,u,_)}var I;return b}class Je{constructor(s,u){this.type=Ct,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if($r(s[1])){const p=s[1];if(p.type==="FeatureCollection"){const _=[];for(const w of p.features){const{type:b,coordinates:I}=w.geometry;b==="Polygon"&&_.push(I),b==="MultiPolygon"&&_.push(...I)}if(_.length)return new Je(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Je(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Je(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(p.type==="Polygon"){const I=E(p.coordinates,w,b),k=de(u.geometry(),_,w,b);if(!Ea(_,w))return!1;for(const R of k)if(!vs(R,I))return!1}if(p.type==="MultiPolygon"){const I=F(p.coordinates,w,b),k=de(u.geometry(),_,w,b);if(!Ea(_,w))return!1;for(const R of k)if(!dr(R,I))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,p){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(p.type==="Polygon"){const I=E(p.coordinates,w,b),k=$e(u.geometry(),_,w,b);if(!Ea(_,w))return!1;for(const R of k)if(!Us(R,I))return!1}if(p.type==="MultiPolygon"){const I=F(p.coordinates,w,b),k=$e(u.geometry(),_,w,b);if(!Ea(_,w))return!1;for(const R of k)if(!wc(R,I))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let At=class{constructor(c=[],s=(u,p)=>u<p?-1:u>p?1:0){if(this.data=c,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:s,compare:u}=this,p=s[c];for(;c>0;){const _=c-1>>1,w=s[_];if(u(p,w)>=0)break;s[c]=w,c=_}s[c]=p}_down(c){const{data:s,compare:u}=this,p=this.length>>1,_=s[c];for(;c<p;){let w=1+(c<<1);const b=w+1;if(b<this.length&&u(s[b],s[w])<0&&(w=b),u(s[w],_)>=0)break;s[c]=s[w],c=w}s[c]=_}};function Kn(c,s,u=0,p=c.length-1,_=Dn){for(;p>u;){if(p-u>600){const k=p-u+1,R=s-u+1,N=Math.log(k),B=.5*Math.exp(2*N/3),G=.5*Math.sqrt(N*B*(k-B)/k)*(R-k/2<0?-1:1);Kn(c,s,Math.max(u,Math.floor(s-R*B/k+G)),Math.min(p,Math.floor(s+(k-R)*B/k+G)),_)}const w=c[s];let b=u,I=p;for(Ei(c,u,s),_(c[p],w)>0&&Ei(c,u,p);b<I;){for(Ei(c,b,I),b++,I--;_(c[b],w)<0;)b++;for(;_(c[I],w)>0;)I--}_(c[u],w)===0?Ei(c,u,I):(I++,Ei(c,I,p)),I<=s&&(u=I+1),s<=I&&(p=I-1)}}function Ei(c,s,u){const p=c[s];c[s]=c[u],c[u]=p}function Dn(c,s){return c<s?-1:c>s?1:0}function qn(c,s){if(c.length<=1)return[c];const u=[];let p,_;for(const w of c){const b=Ia(w);b!==0&&(w.area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(p&&u.push(p),p=[w]):p.push(w))}if(p&&u.push(p),s>1)for(let w=0;w<u.length;w++)u[w].length<=s||(Kn(u[w],s,1,u[w].length-1,Li),u[w]=u[w].slice(0,s));return u}function Li(c,s){return s.area-c.area}function Ia(c){let s=0;for(let u,p,_=0,w=c.length,b=w-1;_<w;b=_++)u=c[_],p=c[b],s+=(p.x-u.x)*(u.y+p.y);return s}const Di=1/298.257223563,Pa=Di*(2-Di),oo=Math.PI/180;class Ch{constructor(s){const u=6378.137*oo*1e3,p=Math.cos(s*oo),_=1/(1-Pa*(1-p*p)),w=Math.sqrt(_);this.kx=u*w*p,this.ky=u*w*_*(1-Pa)}distance(s,u){const p=this.wrap(s[0]-u[0])*this.kx,_=(s[1]-u[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(s,u){let p,_,w,b,I=1/0;for(let k=0;k<s.length-1;k++){let R=s[k][0],N=s[k][1],B=this.wrap(s[k+1][0]-R)*this.kx,G=(s[k+1][1]-N)*this.ky,X=0;B===0&&G===0||(X=(this.wrap(u[0]-R)*this.kx*B+(u[1]-N)*this.ky*G)/(B*B+G*G),X>1?(R=s[k+1][0],N=s[k+1][1]):X>0&&(R+=B/this.kx*X,N+=G/this.ky*X)),B=this.wrap(u[0]-R)*this.kx,G=(u[1]-N)*this.ky;const Y=B*B+G*G;Y<I&&(I=Y,p=R,_=N,w=k,b=X)}return{point:[p,_],index:w,t:Math.max(0,Math.min(1,b))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function ul(c,s){return s[0]-c[0]}function Wl(c){return c[1]-c[0]+1}function $s(c,s){return c[1]>=c[0]&&c[1]<s}function Ah(c,s){if(c[0]>c[1])return[null,null];const u=Wl(c);if(s){if(u===2)return[c,null];const _=Math.floor(u/2);return[[c[0],c[0]+_],[c[0]+_,c[1]]]}if(u===1)return[c,null];const p=Math.floor(u/2)-1;return[[c[0],c[0]+p],[c[0]+p+1,c[1]]]}function Oo(c,s){if(!$s(s,c.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let p=s[0];p<=s[1];++p)ys(u,c[p]);return u}function cl(c){const s=[1/0,1/0,-1/0,-1/0];for(const u of c)for(const p of u)ys(s,p);return s}function Ud(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function Mu(c,s,u){if(!Ud(c)||!Ud(s))return NaN;let p=0,_=0;return c[2]<s[0]&&(p=s[0]-c[2]),c[0]>s[2]&&(p=c[0]-s[2]),c[1]>s[3]&&(_=c[1]-s[3]),c[3]<s[1]&&(_=s[1]-c[3]),u.distance([0,0],[p,_])}function hl(c,s,u){const p=u.pointOnLine(s,c);return u.distance(c,p.point)}function ao(c,s,u,p,_){const w=Math.min(hl(c,[u,p],_),hl(s,[u,p],_)),b=Math.min(hl(u,[c,s],_),hl(p,[c,s],_));return Math.min(w,b)}function jn(c,s,u,p,_){if(!$s(s,c.length)||!$s(p,u.length))return 1/0;let w=1/0;for(let b=s[0];b<s[1];++b){const I=c[b],k=c[b+1];for(let R=p[0];R<p[1];++R){const N=u[R],B=u[R+1];if(ll(I,k,N,B))return 0;w=Math.min(w,ao(I,k,N,B,_))}}return w}function Kl(c,s,u,p,_){if(!$s(s,c.length)||!$s(p,u.length))return NaN;let w=1/0;for(let b=s[0];b<=s[1];++b)for(let I=p[0];I<=p[1];++I)if(w=Math.min(w,_.distance(c[b],u[I])),w===0)return w;return w}function Fp(c,s,u){if(vs(c,s,!0))return 0;let p=1/0;for(const _ of s){const w=_[0],b=_[_.length-1];if(w!==b&&(p=Math.min(p,hl(c,[b,w],u)),p===0))return p;const I=u.pointOnLine(_,c);if(p=Math.min(p,u.distance(c,I.point)),p===0)return p}return p}function ra(c,s,u,p){if(!$s(s,c.length))return NaN;for(let w=s[0];w<=s[1];++w)if(vs(c[w],u,!0))return 0;let _=1/0;for(let w=s[0];w<s[1];++w){const b=c[w],I=c[w+1];for(const k of u)for(let R=0,N=k.length,B=N-1;R<N;B=R++){const G=k[B],X=k[R];if(ll(b,I,G,X))return 0;_=Math.min(_,ao(b,I,G,X,p))}}return _}function Ru(c,s){for(const u of c)for(const p of u)if(vs(p,s,!0))return!0;return!1}function $d(c,s,u,p=1/0){const _=cl(c),w=cl(s);if(p!==1/0&&Mu(_,w,u)>=p)return p;if(Ea(_,w)){if(Ru(c,s))return 0}else if(Ru(s,c))return 0;let b=1/0;for(const I of c)for(let k=0,R=I.length,N=R-1;k<R;N=k++){const B=I[N],G=I[k];for(const X of s)for(let Y=0,te=X.length,he=te-1;Y<te;he=Y++){const we=X[he],Ne=X[Y];if(ll(B,G,we,Ne))return 0;b=Math.min(b,ao(B,G,we,Ne,u))}}return b}function bc(c,s,u,p,_,w){if(!w)return;const b=Mu(Oo(p,w),_,u);b<s&&c.push([b,w,[0,0]])}function dl(c,s,u,p,_,w,b){if(!w||!b)return;const I=Mu(Oo(p,w),Oo(_,b),u);I<s&&c.push([I,w,b])}function Xl(c,s,u,p,_=1/0){let w=Math.min(p.distance(c[0],u[0][0]),_);if(w===0)return w;const b=new At([[0,[0,c.length-1],[0,0]]],ul),I=cl(u);for(;b.length>0;){const k=b.pop();if(k[0]>=w)continue;const R=k[1],N=s?50:100;if(Wl(R)<=N){if(!$s(R,c.length))return NaN;if(s){const B=ra(c,R,u,p);if(isNaN(B)||B===0)return B;w=Math.min(w,B)}else for(let B=R[0];B<=R[1];++B){const G=Fp(c[B],u,p);if(w=Math.min(w,G),w===0)return 0}}else{const B=Ah(R,s);bc(b,w,p,c,I,B[0]),bc(b,w,p,c,I,B[1])}}return w}function fl(c,s,u,p,_,w=1/0){let b=Math.min(w,_.distance(c[0],u[0]));if(b===0)return b;const I=new At([[0,[0,c.length-1],[0,u.length-1]]],ul);for(;I.length>0;){const k=I.pop();if(k[0]>=b)continue;const R=k[1],N=k[2],B=s?50:100,G=p?50:100;if(Wl(R)<=B&&Wl(N)<=G){if(!$s(R,c.length)&&$s(N,u.length))return NaN;let X;if(s&&p)X=jn(c,R,u,N,_),b=Math.min(b,X);else if(s&&!p){const Y=c.slice(R[0],R[1]+1);for(let te=N[0];te<=N[1];++te)if(X=hl(u[te],Y,_),b=Math.min(b,X),b===0)return b}else if(!s&&p){const Y=u.slice(N[0],N[1]+1);for(let te=R[0];te<=R[1];++te)if(X=hl(c[te],Y,_),b=Math.min(b,X),b===0)return b}else X=Kl(c,R,u,N,_),b=Math.min(b,X)}else{const X=Ah(R,s),Y=Ah(N,p);dl(I,b,_,c,u,X[0],Y[0]),dl(I,b,_,c,u,X[0],Y[1]),dl(I,b,_,c,u,X[1],Y[0]),dl(I,b,_,c,u,X[1],Y[1])}}return b}function Ca(c){return c.type==="MultiPolygon"?c.coordinates.map(s=>({type:"Polygon",coordinates:s})):c.type==="MultiLineString"?c.coordinates.map(s=>({type:"LineString",coordinates:s})):c.type==="MultiPoint"?c.coordinates.map(s=>({type:"Point",coordinates:s})):[c]}class Fo{constructor(s,u){this.type=nt,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if($r(s[1])){const p=s[1];if(p.type==="FeatureCollection")return new Fo(p,p.features.map(_=>Ca(_.geometry)).flat());if(p.type==="Feature")return new Fo(p,Ca(p.geometry));if("type"in p&&"coordinates"in p)return new Fo(p,Ca(p))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,p){const _=u.geometry(),w=_.flat().map(k=>al([k.x,k.y],u.canonical));if(_.length===0)return NaN;const b=new Ch(w[0][1]);let I=1/0;for(const k of p){switch(k.type){case"Point":I=Math.min(I,fl(w,!1,[k.coordinates],!1,b,I));break;case"LineString":I=Math.min(I,fl(w,!1,k.coordinates,!0,b,I));break;case"Polygon":I=Math.min(I,Xl(w,!1,k.coordinates,b,I))}if(I===0)return I}return I}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,p){const _=u.geometry(),w=_.flat().map(k=>al([k.x,k.y],u.canonical));if(_.length===0)return NaN;const b=new Ch(w[0][1]);let I=1/0;for(const k of p){switch(k.type){case"Point":I=Math.min(I,fl(w,!0,[k.coordinates],!1,b,I));break;case"LineString":I=Math.min(I,fl(w,!0,k.coordinates,!0,b,I));break;case"Polygon":I=Math.min(I,Xl(w,!0,k.coordinates,b,I))}if(I===0)return I}return I}(s,this.geometries);if(s.geometryType()==="Polygon")return function(u,p){const _=u.geometry();if(_.length===0||_[0].length===0)return NaN;const w=qn(_,0).map(k=>k.map(R=>R.map(N=>al([N.x,N.y],u.canonical)))),b=new Ch(w[0][0][0][1]);let I=1/0;for(const k of p)for(const R of w){switch(k.type){case"Point":I=Math.min(I,Xl([k.coordinates],!1,R,b,I));break;case"LineString":I=Math.min(I,Xl(k.coordinates,!0,R,b,I));break;case"Polygon":I=Math.min(I,$d(R,k.coordinates,b,I))}if(I===0)return I}return I}(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Aa={"==":ol,"!=":xc,">":Au,"<":io,">=":zo,"<=":_s,array:$t,at:js,boolean:$t,case:ta,coalesce:na,collator:ro,format:No,image:so,in:fn,"index-of":si,interpolate:wn,"interpolate-hcl":wn,"interpolate-lab":wn,length:Sa,let:xn,literal:qr,match:Mi,number:$t,"number-format":Ri,object:$t,slice:Ro,step:Lo,string:$t,"to-boolean":Ln,"to-color":Ln,"to-number":Ln,"to-string":Ln,var:Wt,within:Je,distance:Fo};class ws{constructor(s,u,p,_){this.name=s,this.type=u,this._evaluate=p,this.args=_}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,u){const p=s[0],_=ws.definitions[p];if(!_)return u.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,b=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,I=b.filter(([R])=>!Array.isArray(R)||R.length===s.length-1);let k=null;for(const[R,N]of I){k=new Mo(u.registry,Tc,u.path,null,u.scope);const B=[];let G=!1;for(let X=1;X<s.length;X++){const Y=s[X],te=Array.isArray(R)?R[X-1]:R.type,he=k.parse(Y,1+B.length,te);if(!he){G=!0;break}B.push(he)}if(!G)if(Array.isArray(R)&&R.length!==B.length)k.error(`Expected ${R.length} arguments, but found ${B.length} instead.`);else{for(let X=0;X<B.length;X++){const Y=Array.isArray(R)?R[X]:R.type,te=B[X];k.concat(X+1).checkSubtype(Y,te.type)}if(k.errors.length===0)return new ws(p,w,N,B)}}if(I.length===1)u.errors.push(...k.errors);else{const R=(I.length?I:b).map(([B])=>{return G=B,Array.isArray(G)?`(${G.map(ii).join(", ")})`:`(${ii(G.type)}...)`;var G}).join(" | "),N=[];for(let B=1;B<s.length;B++){const G=u.parse(s[B],1+N.length);if(!G)return null;N.push(ii(G.type))}u.error(`Expected arguments of type ${R}, but found (${N.join(", ")}) instead.`)}return null}static register(s,u){ws.definitions=u;for(const p in u)s[p]=ws}}function qd(c,[s,u,p,_]){s=s.evaluate(c),u=u.evaluate(c),p=p.evaluate(c);const w=_?_.evaluate(c):1,b=il(s,u,p,w);if(b)throw new ri(b);return new ln(s/255,u/255,p/255,w,!1)}function Lu(c,s){return c in s}function kh(c,s){const u=s[c];return u===void 0?null:u}function ka(c){return{type:c}}function Tc(c){if(c instanceof Wt)return Tc(c.boundExpression);if(c instanceof ws&&c.name==="error"||c instanceof ro||c instanceof Je||c instanceof Fo)return!1;const s=c instanceof Ln||c instanceof $t;let u=!0;return c.eachChild(p=>{u=s?u&&Tc(p):u&&p instanceof qr}),!!u&&Du(c)&&bs(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Du(c){if(c instanceof ws&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Je||c instanceof Fo)return!1;let s=!0;return c.eachChild(u=>{s&&!Du(u)&&(s=!1)}),s}function zu(c){if(c instanceof ws&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(u=>{s&&!zu(u)&&(s=!1)}),s}function bs(c,s){if(c instanceof ws&&s.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(p=>{u&&!bs(p,s)&&(u=!1)}),u}function Nu(c){return{result:"success",value:c}}function Yl(c){return{result:"error",value:c}}function sa(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Hd(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Sc(c){return!!c.expression&&c.expression.interpolated}function Nn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Ma(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Bp(c){return c}function pl(c,s){const u=s.type==="color",p=c.stops&&typeof c.stops[0][0]=="object",_=p||!(p||c.property!==void 0),w=c.type||(Sc(s)?"exponential":"interval");if(u||s.type==="padding"){const N=u?ln.parse:ei.parse;(c=yt({},c)).stops&&(c.stops=c.stops.map(B=>[B[0],N(B[1])])),c.default=N(c.default?c.default:s.default)}if(c.colorSpace&&(b=c.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var b;let I,k,R;if(w==="exponential")I=Bo;else if(w==="interval")I=Vp;else if(w==="categorical"){I=Ec,k=Object.create(null);for(const N of c.stops)k[N[0]]=N[1];R=typeof c.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);I=Gd}if(p){const N={},B=[];for(let Y=0;Y<c.stops.length;Y++){const te=c.stops[Y],he=te[0].zoom;N[he]===void 0&&(N[he]={zoom:he,type:c.type,property:c.property,default:c.default,stops:[]},B.push(he)),N[he].stops.push([te[0].value,te[1]])}const G=[];for(const Y of B)G.push([N[Y].zoom,pl(N[Y],s)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:wn.interpolationFactor.bind(void 0,X),zoomStops:G.map(Y=>Y[0]),evaluate:({zoom:Y},te)=>Bo({stops:G,base:c.base},s,Y).evaluate(Y,te)}}if(_){const N=w==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:wn.interpolationFactor.bind(void 0,N),zoomStops:c.stops.map(B=>B[0]),evaluate:({zoom:B})=>I(c,s,B,k,R)}}return{kind:"source",evaluate(N,B){const G=B&&B.properties?B.properties[c.property]:void 0;return G===void 0?Ql(c.default,s.default):I(c,s,G,k,R)}}}function Ql(c,s,u){return c!==void 0?c:s!==void 0?s:u!==void 0?u:void 0}function Ec(c,s,u,p,_){return Ql(typeof u===_?p[u]:void 0,c.default,s.default)}function Vp(c,s,u){if(Nn(u)!=="number")return Ql(c.default,s.default);const p=c.stops.length;if(p===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[p-1][0])return c.stops[p-1][1];const _=oi(c.stops.map(w=>w[0]),u);return c.stops[_][1]}function Bo(c,s,u){const p=c.base!==void 0?c.base:1;if(Nn(u)!=="number")return Ql(c.default,s.default);const _=c.stops.length;if(_===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[_-1][0])return c.stops[_-1][1];const w=oi(c.stops.map(N=>N[0]),u),b=function(N,B,G,X){const Y=X-G,te=N-G;return Y===0?0:B===1?te/Y:(Math.pow(B,te)-1)/(Math.pow(B,Y)-1)}(u,p,c.stops[w][0],c.stops[w+1][0]),I=c.stops[w][1],k=c.stops[w+1][1],R=Hr[s.type]||Bp;return typeof I.evaluate=="function"?{evaluate(...N){const B=I.evaluate.apply(void 0,N),G=k.evaluate.apply(void 0,N);if(B!==void 0&&G!==void 0)return R(B,G,b,c.colorSpace)}}:R(I,k,b,c.colorSpace)}function Gd(c,s,u){switch(s.type){case"color":u=ln.parse(u);break;case"formatted":u=Vn.fromString(u.toString());break;case"resolvedImage":u=Yi.fromString(u.toString());break;case"padding":u=ei.parse(u);break;default:Nn(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0)}return Ql(u,c.default,s.default)}ws.register(Aa,{error:[{kind:"error"},[wt],(c,[s])=>{throw new ri(s.evaluate(c))}],typeof:[wt,[kt],(c,[s])=>ii(En(s.evaluate(c)))],"to-rgba":[Cr(nt,4),[xt],(c,[s])=>{const[u,p,_,w]=s.evaluate(c).rgb;return[255*u,255*p,255*_,w]}],rgb:[xt,[nt,nt,nt],qd],rgba:[xt,[nt,nt,nt,nt],qd],has:{type:Ct,overloads:[[[wt],(c,[s])=>Lu(s.evaluate(c),c.properties())],[[wt,qt],(c,[s,u])=>Lu(s.evaluate(c),u.evaluate(c))]]},get:{type:kt,overloads:[[[wt],(c,[s])=>kh(s.evaluate(c),c.properties())],[[wt,qt],(c,[s,u])=>kh(s.evaluate(c),u.evaluate(c))]]},"feature-state":[kt,[wt],(c,[s])=>kh(s.evaluate(c),c.featureState||{})],properties:[qt,[],c=>c.properties()],"geometry-type":[wt,[],c=>c.geometryType()],id:[kt,[],c=>c.id()],zoom:[nt,[],c=>c.globals.zoom],"heatmap-density":[nt,[],c=>c.globals.heatmapDensity||0],"line-progress":[nt,[],c=>c.globals.lineProgress||0],accumulated:[kt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[nt,ka(nt),(c,s)=>{let u=0;for(const p of s)u+=p.evaluate(c);return u}],"*":[nt,ka(nt),(c,s)=>{let u=1;for(const p of s)u*=p.evaluate(c);return u}],"-":{type:nt,overloads:[[[nt,nt],(c,[s,u])=>s.evaluate(c)-u.evaluate(c)],[[nt],(c,[s])=>-s.evaluate(c)]]},"/":[nt,[nt,nt],(c,[s,u])=>s.evaluate(c)/u.evaluate(c)],"%":[nt,[nt,nt],(c,[s,u])=>s.evaluate(c)%u.evaluate(c)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(c,[s,u])=>Math.pow(s.evaluate(c),u.evaluate(c))],sqrt:[nt,[nt],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[nt,[nt],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[nt,[nt],(c,[s])=>Math.log(s.evaluate(c))],log2:[nt,[nt],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[nt,[nt],(c,[s])=>Math.sin(s.evaluate(c))],cos:[nt,[nt],(c,[s])=>Math.cos(s.evaluate(c))],tan:[nt,[nt],(c,[s])=>Math.tan(s.evaluate(c))],asin:[nt,[nt],(c,[s])=>Math.asin(s.evaluate(c))],acos:[nt,[nt],(c,[s])=>Math.acos(s.evaluate(c))],atan:[nt,[nt],(c,[s])=>Math.atan(s.evaluate(c))],min:[nt,ka(nt),(c,s)=>Math.min(...s.map(u=>u.evaluate(c)))],max:[nt,ka(nt),(c,s)=>Math.max(...s.map(u=>u.evaluate(c)))],abs:[nt,[nt],(c,[s])=>Math.abs(s.evaluate(c))],round:[nt,[nt],(c,[s])=>{const u=s.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[nt,[nt],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[nt,[nt],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[Ct,[wt,kt],(c,[s,u])=>c.properties()[s.value]===u.value],"filter-id-==":[Ct,[kt],(c,[s])=>c.id()===s.value],"filter-type-==":[Ct,[wt],(c,[s])=>c.geometryType()===s.value],"filter-<":[Ct,[wt,kt],(c,[s,u])=>{const p=c.properties()[s.value],_=u.value;return typeof p==typeof _&&p<_}],"filter-id-<":[Ct,[kt],(c,[s])=>{const u=c.id(),p=s.value;return typeof u==typeof p&&u<p}],"filter->":[Ct,[wt,kt],(c,[s,u])=>{const p=c.properties()[s.value],_=u.value;return typeof p==typeof _&&p>_}],"filter-id->":[Ct,[kt],(c,[s])=>{const u=c.id(),p=s.value;return typeof u==typeof p&&u>p}],"filter-<=":[Ct,[wt,kt],(c,[s,u])=>{const p=c.properties()[s.value],_=u.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[Ct,[kt],(c,[s])=>{const u=c.id(),p=s.value;return typeof u==typeof p&&u<=p}],"filter->=":[Ct,[wt,kt],(c,[s,u])=>{const p=c.properties()[s.value],_=u.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[Ct,[kt],(c,[s])=>{const u=c.id(),p=s.value;return typeof u==typeof p&&u>=p}],"filter-has":[Ct,[kt],(c,[s])=>s.value in c.properties()],"filter-has-id":[Ct,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Ct,[Cr(wt)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[Ct,[Cr(kt)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[Ct,[wt,Cr(kt)],(c,[s,u])=>u.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[Ct,[wt,Cr(kt)],(c,[s,u])=>function(p,_,w,b){for(;w<=b;){const I=w+b>>1;if(_[I]===p)return!0;_[I]>p?b=I-1:w=I+1}return!1}(c.properties()[s.value],u.value,0,u.value.length-1)],all:{type:Ct,overloads:[[[Ct,Ct],(c,[s,u])=>s.evaluate(c)&&u.evaluate(c)],[ka(Ct),(c,s)=>{for(const u of s)if(!u.evaluate(c))return!1;return!0}]]},any:{type:Ct,overloads:[[[Ct,Ct],(c,[s,u])=>s.evaluate(c)||u.evaluate(c)],[ka(Ct),(c,s)=>{for(const u of s)if(u.evaluate(c))return!0;return!1}]]},"!":[Ct,[Ct],(c,[s])=>!s.evaluate(c)],"is-supported-script":[Ct,[wt],(c,[s])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(s.evaluate(c))}],upcase:[wt,[wt],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[wt,[wt],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[wt,ka(kt),(c,s)=>s.map(u=>ea(u.evaluate(c))).join("")],"resolved-locale":[wt,[Qn],(c,[s])=>s.evaluate(c).resolvedLocale()]});class Ou{constructor(s,u){var p;this.expression=s,this._warningHistory={},this._evaluator=new Mn,this._defaultValue=u?(p=u).type==="color"&&Ma(p.default)?new ln(0,0,0,0):p.type==="color"?ln.parse(p.default)||null:p.type==="padding"?ei.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Xi.parse(p.default)||null:p.type==="projectionDefinition"?qi.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(s,u,p,_,w,b){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(s,u,p,_,w,b){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=b||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new ri(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Ra(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Aa}function Ic(c,s){const u=new Mo(Aa,Tc,[],s?function(_){const w={color:xt,string:wt,number:nt,enum:wt,boolean:Ct,formatted:ps,padding:Si,projectionDefinition:hn,resolvedImage:Zn,variableAnchorOffsetCollection:zn};return _.type==="array"?Cr(w[_.value]||kt,_.length):w[_.type]}(s):void 0),p=u.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Nu(new Ou(p,s)):Yl(u.errors)}class oa{constructor(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!zu(u.expression)}evaluateWithoutErrorHandling(s,u,p,_,w,b){return this._styleExpression.evaluateWithoutErrorHandling(s,u,p,_,w,b)}evaluate(s,u,p,_,w,b){return this._styleExpression.evaluate(s,u,p,_,w,b)}}class La{constructor(s,u,p,_){this.kind=s,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!zu(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(s,u,p,_,w,b){return this._styleExpression.evaluateWithoutErrorHandling(s,u,p,_,w,b)}evaluate(s,u,p,_,w,b){return this._styleExpression.evaluate(s,u,p,_,w,b)}interpolationFactor(s,u,p){return this.interpolationType?wn.interpolationFactor(this.interpolationType,s,u,p):0}}function Mh(c,s){const u=Ic(c,s);if(u.result==="error")return u;const p=u.value.expression,_=Du(p);if(!_&&!sa(s))return Yl([new vt("","data expressions not supported")]);const w=bs(p,["zoom"]);if(!w&&!Hd(s))return Yl([new vt("","zoom expressions not supported")]);const b=Pc(p);return b||w?b instanceof vt?Yl([b]):b instanceof wn&&!Sc(s)?Yl([new vt("",'"interpolate" expressions cannot be used with this property')]):Nu(b?new La(_?"camera":"composite",u.value,b.labels,b instanceof wn?b.interpolation:void 0):new oa(_?"constant":"source",u.value)):Yl([new vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fu{constructor(s,u){this._parameters=s,this._specification=u,yt(this,pl(this._parameters,this._specification))}static deserialize(s){return new Fu(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Pc(c){let s=null;if(c instanceof xn)s=Pc(c.result);else if(c instanceof na){for(const u of c.args)if(s=Pc(u),s)break}else(c instanceof Lo||c instanceof wn)&&c.input instanceof ws&&c.input.name==="zoom"&&(s=c);return s instanceof vt||c.eachChild(u=>{const p=Pc(u);p instanceof vt?s=p:!s&&p?s=new vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&p&&s!==p&&(s=new vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Cc(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!Cc(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Zd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bu(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Cc(c)||(c=Ac(c));const s=Ic(c,Zd);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,p,_)=>s.value.evaluate(u,p,{},_),needGeometry:Lh(c)}}function Rh(c,s){return c<s?-1:c>s?1:0}function Lh(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let s=1;s<c.length;s++)if(Lh(c[s]))return!0;return!1}function Ac(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?Vu(c[1],c[2],"=="):s==="!="?d(Vu(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Vu(c[1],c[2],s):s==="any"?(u=c.slice(1),["any"].concat(u.map(Ac))):s==="all"?["all"].concat(c.slice(1).map(Ac)):s==="none"?["all"].concat(c.slice(1).map(Ac).map(d)):s==="in"?kc(c[1],c.slice(2)):s==="!in"?d(kc(c[1],c.slice(2))):s==="has"?Dh(c[1]):s!=="!has"||d(Dh(c[1]));var u}function Vu(c,s,u){switch(c){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,c,s]}}function kc(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",c,["literal",s.sort(Rh)]]:["filter-in-small",c,["literal",s]]}}function Dh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function d(c){return["!",c]}function y(c){const s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const w of c)_+=`${y(w)},`;return`${_}]`}const u=Object.keys(c).sort();let p="{";for(let _=0;_<u.length;_++)p+=`${JSON.stringify(u[_])}:${y(c[u[_]])},`;return`${p}}`}function P(c){let s="";for(const u of ee)s+=`/${y(c[u])}`;return s}function D(c){const s=c.value;return s?[new Oe(c.key,s,"constants have been deprecated as of v8")]:[]}function j(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function se(c){if(Array.isArray(c))return c.map(se);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const u in c)s[u]=se(c[u]);return s}return j(c)}function Ae(c){const s=c.key,u=c.value,p=c.valueSpec||{},_=c.objectElementValidators||{},w=c.style,b=c.styleSpec,I=c.validateSpec;let k=[];const R=Nn(u);if(R!=="object")return[new Oe(s,u,`object expected, ${R} found`)];for(const N in u){const B=N.split(".")[0],G=p[B]||p["*"];let X;if(_[B])X=_[B];else if(p[B])X=I;else if(_["*"])X=_["*"];else{if(!p["*"]){k.push(new Oe(s,u[N],`unknown property "${N}"`));continue}X=I}k=k.concat(X({key:(s&&`${s}.`)+N,value:u[N],valueSpec:G,style:w,styleSpec:b,object:u,objectKey:N,validateSpec:I},u))}for(const N in p)_[N]||p[N].required&&p[N].default===void 0&&u[N]===void 0&&k.push(new Oe(s,u,`missing required property "${N}"`));return k}function Ge(c){const s=c.value,u=c.valueSpec,p=c.style,_=c.styleSpec,w=c.key,b=c.arrayElementValidator||c.validateSpec;if(Nn(s)!=="array")return[new Oe(w,s,`array expected, ${Nn(s)} found`)];if(u.length&&s.length!==u.length)return[new Oe(w,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new Oe(w,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let I={type:u.value,values:u.values};_.$version<7&&(I.function=u.function),Nn(u.value)==="object"&&(I=u.value);let k=[];for(let R=0;R<s.length;R++)k=k.concat(b({array:s,arrayIndex:R,value:s[R],valueSpec:I,validateSpec:c.validateSpec,style:p,styleSpec:_,key:`${w}[${R}]`}));return k}function et(c){const s=c.key,u=c.value,p=c.valueSpec;let _=Nn(u);return _==="number"&&u!=u&&(_="NaN"),_!=="number"?[new Oe(s,u,`number expected, ${_} found`)]:"minimum"in p&&u<p.minimum?[new Oe(s,u,`${u} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&u>p.maximum?[new Oe(s,u,`${u} is greater than the maximum value ${p.maximum}`)]:[]}function pt(c){const s=c.valueSpec,u=j(c.value.type);let p,_,w,b={};const I=u!=="categorical"&&c.value.property===void 0,k=!I,R=Nn(c.value.stops)==="array"&&Nn(c.value.stops[0])==="array"&&Nn(c.value.stops[0][0])==="object",N=Ae({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new Oe(X.key,X.value,'identity function may not have a "stops" property')];let Y=[];const te=X.value;return Y=Y.concat(Ge({key:X.key,value:te,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:B})),Nn(te)==="array"&&te.length===0&&Y.push(new Oe(X.key,te,"array must have at least one stop")),Y},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:s,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&I&&N.push(new Oe(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||N.push(new Oe(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!Sc(c.valueSpec)&&N.push(new Oe(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(k&&!sa(c.valueSpec)?N.push(new Oe(c.key,c.value,"property functions not supported")):I&&!Hd(c.valueSpec)&&N.push(new Oe(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!R||c.value.property!==void 0||N.push(new Oe(c.key,c.value,'"property" property is required')),N;function B(X){let Y=[];const te=X.value,he=X.key;if(Nn(te)!=="array")return[new Oe(he,te,`array expected, ${Nn(te)} found`)];if(te.length!==2)return[new Oe(he,te,`array length 2 expected, length ${te.length} found`)];if(R){if(Nn(te[0])!=="object")return[new Oe(he,te,`object expected, ${Nn(te[0])} found`)];if(te[0].zoom===void 0)return[new Oe(he,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new Oe(he,te,"object stop key must have value")];if(w&&w>j(te[0].zoom))return[new Oe(he,te[0].zoom,"stop zoom values must appear in ascending order")];j(te[0].zoom)!==w&&(w=j(te[0].zoom),_=void 0,b={}),Y=Y.concat(Ae({key:`${he}[0]`,value:te[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:et,value:G}}))}else Y=Y.concat(G({key:`${he}[0]`,value:te[0],valueSpec:{},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},te));return Ra(se(te[1]))?Y.concat([new Oe(`${he}[1]`,te[1],"expressions are not allowed in function stops.")]):Y.concat(X.validateSpec({key:`${he}[1]`,value:te[1],valueSpec:s,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function G(X,Y){const te=Nn(X.value),he=j(X.value),we=X.value!==null?X.value:Y;if(p){if(te!==p)return[new Oe(X.key,we,`${te} stop domain type must match previous stop domain type ${p}`)]}else p=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new Oe(X.key,we,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&u!=="categorical"){let Ne=`number expected, ${te} found`;return sa(s)&&u===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(X.key,we,Ne)]}return u!=="categorical"||te!=="number"||isFinite(he)&&Math.floor(he)===he?u!=="categorical"&&te==="number"&&_!==void 0&&he<_?[new Oe(X.key,we,"stop domain values must appear in ascending order")]:(_=he,u==="categorical"&&he in b?[new Oe(X.key,we,"stop domain values must be unique")]:(b[he]=!0,[])):[new Oe(X.key,we,`integer expected, found ${he}`)]}}function Dt(c){const s=(c.expressionContext==="property"?Mh:Ic)(se(c.value),c.valueSpec);if(s.result==="error")return s.value.map(p=>new Oe(`${c.key}${p.key}`,c.value,p.message));const u=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new Oe(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!zu(u))return[new Oe(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!zu(u))return[new Oe(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!bs(u,["zoom","feature-state"]))return[new Oe(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Du(u))return[new Oe(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function en(c){const s=c.key,u=c.value,p=c.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(j(u))===-1&&_.push(new Oe(s,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(j(u))===-1&&_.push(new Oe(s,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function bn(c){return Cc(se(c.value))?Dt(yt({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):nr(c)}function nr(c){const s=c.value,u=c.key;if(Nn(s)!=="array")return[new Oe(u,s,`array expected, ${Nn(s)} found`)];const p=c.styleSpec;let _,w=[];if(s.length<1)return[new Oe(u,s,"filter array must have at least 1 element")];switch(w=w.concat(en({key:`${u}[0]`,value:s[0],valueSpec:p.filter_operator,style:c.style,styleSpec:c.styleSpec})),j(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&j(s[1])==="$type"&&w.push(new Oe(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&w.push(new Oe(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(_=Nn(s[1]),_!=="string"&&w.push(new Oe(`${u}[1]`,s[1],`string expected, ${_} found`)));for(let b=2;b<s.length;b++)_=Nn(s[b]),j(s[1])==="$type"?w=w.concat(en({key:`${u}[${b}]`,value:s[b],valueSpec:p.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new Oe(`${u}[${b}]`,s[b],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let b=1;b<s.length;b++)w=w.concat(nr({key:`${u}[${b}]`,value:s[b],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=Nn(s[1]),s.length!==2?w.push(new Oe(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new Oe(`${u}[1]`,s[1],`string expected, ${_} found`))}return w}function ir(c,s){const u=c.key,p=c.validateSpec,_=c.style,w=c.styleSpec,b=c.value,I=c.objectKey,k=w[`${s}_${c.layerType}`];if(!k)return[];const R=I.match(/^(.*)-transition$/);if(s==="paint"&&R&&k[R[1]]&&k[R[1]].transition)return p({key:u,value:b,valueSpec:w.transition,style:_,styleSpec:w});const N=c.valueSpec||k[I];if(!N)return[new Oe(u,b,`unknown property "${I}"`)];let B;if(Nn(b)==="string"&&sa(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(b)))return[new Oe(u,b,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const G=[];return c.layerType==="symbol"&&(I==="text-field"&&_&&!_.glyphs&&G.push(new Oe(u,b,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Ma(se(b))&&j(b.type)==="identity"&&G.push(new Oe(u,b,'"text-font" does not support identity functions'))),G.concat(p({key:c.key,value:b,valueSpec:N,style:_,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:I}))}function rs(c){return ir(c,"paint")}function kr(c){return ir(c,"layout")}function ml(c){let s=[];const u=c.value,p=c.key,_=c.style,w=c.styleSpec;u.type||u.ref||s.push(new Oe(p,u,'either "type" or "ref" is required'));let b=j(u.type);const I=j(u.ref);if(u.id){const k=j(u.id);for(let R=0;R<c.arrayIndex;R++){const N=_.layers[R];j(N.id)===k&&s.push(new Oe(p,u.id,`duplicate layer id "${u.id}", previously used at line ${N.id.__line__}`))}}if("ref"in u){let k;["type","source","source-layer","filter","layout"].forEach(R=>{R in u&&s.push(new Oe(p,u[R],`"${R}" is prohibited for ref layers`))}),_.layers.forEach(R=>{j(R.id)===I&&(k=R)}),k?k.ref?s.push(new Oe(p,u.ref,"ref cannot reference another ref layer")):b=j(k.type):s.push(new Oe(p,u.ref,`ref layer "${I}" not found`))}else if(b!=="background")if(u.source){const k=_.sources&&_.sources[u.source],R=k&&j(k.type);k?R==="vector"&&b==="raster"?s.push(new Oe(p,u.source,`layer "${u.id}" requires a raster source`)):R!=="raster-dem"&&b==="hillshade"?s.push(new Oe(p,u.source,`layer "${u.id}" requires a raster-dem source`)):R==="raster"&&b!=="raster"?s.push(new Oe(p,u.source,`layer "${u.id}" requires a vector source`)):R!=="vector"||u["source-layer"]?R==="raster-dem"&&b!=="hillshade"?s.push(new Oe(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!u.paint||!u.paint["line-gradient"]||R==="geojson"&&k.lineMetrics||s.push(new Oe(p,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Oe(p,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new Oe(p,u.source,`source "${u.source}" not found`))}else s.push(new Oe(p,u,'missing required property "source"'));return s=s.concat(Ae({key:p,value:u,valueSpec:w.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${p}.type`,value:u.type,valueSpec:w.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:u,objectKey:"type"}),filter:bn,layout:k=>Ae({layer:u,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":R=>kr(yt({layerType:b},R))}}),paint:k=>Ae({layer:u,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":R=>rs(yt({layerType:b},R))}})}})),s}function Da(c){const s=c.value,u=c.key,p=Nn(s);return p!=="string"?[new Oe(u,s,`string expected, ${p} found`)]:[]}const zh={promoteId:function({key:c,value:s}){if(Nn(s)==="string")return Da({key:c,value:s});{const u=[];for(const p in s)u.push(...Da({key:`${c}.${p}`,value:s[p]}));return u}}};function Jl(c){const s=c.value,u=c.key,p=c.styleSpec,_=c.style,w=c.validateSpec;if(!s.type)return[new Oe(u,s,'"type" is required')];const b=j(s.type);let I;switch(b){case"vector":case"raster":return I=Ae({key:u,value:s,valueSpec:p[`source_${b.replace("-","_")}`],style:c.style,styleSpec:p,objectElementValidators:zh,validateSpec:w}),I;case"raster-dem":return I=function(k){var R;const N=(R=k.sourceName)!==null&&R!==void 0?R:"",B=k.value,G=k.styleSpec,X=G.source_raster_dem,Y=k.style;let te=[];const he=Nn(B);if(B===void 0)return te;if(he!=="object")return te.push(new Oe("source_raster_dem",B,`object expected, ${he} found`)),te;const we=j(B.encoding)==="custom",Ne=["redFactor","greenFactor","blueFactor","baseShift"],Se=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const K in B)!we&&Ne.includes(K)?te.push(new Oe(K,B[K],`In "${N}": "${K}" is only valid when "encoding" is set to "custom". ${Se} encoding found`)):X[K]?te=te.concat(k.validateSpec({key:K,value:B[K],valueSpec:X[K],validateSpec:k.validateSpec,style:Y,styleSpec:G})):te.push(new Oe(K,B[K],`unknown property "${K}"`));return te}({sourceName:u,value:s,style:c.style,styleSpec:p,validateSpec:w}),I;case"geojson":if(I=Ae({key:u,value:s,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:w,objectElementValidators:zh}),s.cluster)for(const k in s.clusterProperties){const[R,N]=s.clusterProperties[k],B=typeof R=="string"?[R,["accumulated"],["get",k]]:R;I.push(...Dt({key:`${u}.${k}.map`,value:N,validateSpec:w,expressionContext:"cluster-map"})),I.push(...Dt({key:`${u}.${k}.reduce`,value:B,validateSpec:w,expressionContext:"cluster-reduce"}))}return I;case"video":return Ae({key:u,value:s,valueSpec:p.source_video,style:_,validateSpec:w,styleSpec:p});case"image":return Ae({key:u,value:s,valueSpec:p.source_image,style:_,validateSpec:w,styleSpec:p});case"canvas":return[new Oe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return en({key:`${u}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:w,styleSpec:p})}}function Nh(c){const s=c.value,u=c.styleSpec,p=u.light,_=c.style;let w=[];const b=Nn(s);if(s===void 0)return w;if(b!=="object")return w=w.concat([new Oe("light",s,`object expected, ${b} found`)]),w;for(const I in s){const k=I.match(/^(.*)-transition$/);w=w.concat(k&&p[k[1]]&&p[k[1]].transition?c.validateSpec({key:I,value:s[I],valueSpec:u.transition,validateSpec:c.validateSpec,style:_,styleSpec:u}):p[I]?c.validateSpec({key:I,value:s[I],valueSpec:p[I],validateSpec:c.validateSpec,style:_,styleSpec:u}):[new Oe(I,s[I],`unknown property "${I}"`)])}return w}function Wd(c){const s=c.value,u=c.styleSpec,p=u.sky,_=c.style,w=Nn(s);if(s===void 0)return[];if(w!=="object")return[new Oe("sky",s,`object expected, ${w} found`)];let b=[];for(const I in s)b=b.concat(p[I]?c.validateSpec({key:I,value:s[I],valueSpec:p[I],style:_,styleSpec:u}):[new Oe(I,s[I],`unknown property "${I}"`)]);return b}function Oh(c){const s=c.value,u=c.styleSpec,p=u.terrain,_=c.style;let w=[];const b=Nn(s);if(s===void 0)return w;if(b!=="object")return w=w.concat([new Oe("terrain",s,`object expected, ${b} found`)]),w;for(const I in s)w=w.concat(p[I]?c.validateSpec({key:I,value:s[I],valueSpec:p[I],validateSpec:c.validateSpec,style:_,styleSpec:u}):[new Oe(I,s[I],`unknown property "${I}"`)]);return w}function Hi(c){let s=[];const u=c.value,p=c.key;if(Array.isArray(u)){const _=[],w=[];for(const b in u)u[b].id&&_.includes(u[b].id)&&s.push(new Oe(p,u,`all the sprites' ids must be unique, but ${u[b].id} is duplicated`)),_.push(u[b].id),u[b].url&&w.includes(u[b].url)&&s.push(new Oe(p,u,`all the sprites' URLs must be unique, but ${u[b].url} is duplicated`)),w.push(u[b].url),s=s.concat(Ae({key:`${p}[${b}]`,value:u[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return Da({key:p,value:u})}const ju={"*":()=>[],array:Ge,boolean:function(c){const s=c.value,u=c.key,p=Nn(s);return p!=="boolean"?[new Oe(u,s,`boolean expected, ${p} found`)]:[]},number:et,color:function(c){const s=c.key,u=c.value,p=Nn(u);return p!=="string"?[new Oe(s,u,`color expected, ${p} found`)]:ln.parse(String(u))?[]:[new Oe(s,u,`color expected, "${u}" found`)]},constants:D,enum:en,filter:bn,function:pt,layer:ml,object:Ae,source:Jl,light:Nh,sky:Wd,terrain:Oh,projection:function(c){const s=c.value,u=c.styleSpec,p=u.projection,_=c.style,w=Nn(s);if(s===void 0)return[];if(w!=="object")return[new Oe("projection",s,`object expected, ${w} found`)];let b=[];for(const I in s)b=b.concat(p[I]?c.validateSpec({key:I,value:s[I],valueSpec:p[I],style:_,styleSpec:u}):[new Oe(I,s[I],`unknown property "${I}"`)]);return b},projectionDefinition:function(c){const s=c.key;let u=c.value;u=u instanceof String?u.valueOf():u;const p=Nn(u);return p!=="array"||function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"}(u)||function(_){return!!["interpolate","step","literal"].includes(_[0])}(u)?["array","string"].includes(p)?[]:[new Oe(s,u,`projection expected, invalid type "${p}" found`)]:[new Oe(s,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:Da,formatted:function(c){return Da(c).length===0?[]:Dt(c)},resolvedImage:function(c){return Da(c).length===0?[]:Dt(c)},padding:function(c){const s=c.key,u=c.value;if(Nn(u)==="array"){if(u.length<1||u.length>4)return[new Oe(s,u,`padding requires 1 to 4 values; ${u.length} values found`)];const p={type:"number"};let _=[];for(let w=0;w<u.length;w++)_=_.concat(c.validateSpec({key:`${s}[${w}]`,value:u[w],validateSpec:c.validateSpec,valueSpec:p}));return _}return et({key:s,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const s=c.key,u=c.value,p=Nn(u),_=c.styleSpec;if(p!=="array"||u.length<1||u.length%2!=0)return[new Oe(s,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let b=0;b<u.length;b+=2)w=w.concat(en({key:`${s}[${b}]`,value:u[b],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(Ge({key:`${s}[${b+1}]`,value:u[b+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return w},sprite:Hi};function Uu(c){const s=c.value,u=c.valueSpec,p=c.styleSpec;return c.validateSpec=Uu,u.expression&&Ma(j(s))?pt(c):u.expression&&Ra(se(s))?Dt(c):u.type&&ju[u.type]?ju[u.type](c):Ae(yt({},c,{valueSpec:u.type?p[u.type]:u}))}function eu(c){const s=c.value,u=c.key,p=Da(c);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new Oe(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new Oe(u,s,'"glyphs" url must include a "{range}" token'))),p}function Gr(c,s=pe){let u=[];return u=u.concat(Uu({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:Uu,objectElementValidators:{glyphs:eu,"*":()=>[]}})),c.constants&&(u=u.concat(D({key:"constants",value:c.constants,style:c,styleSpec:s,validateSpec:Uu}))),gl(u)}function Ii(c){return function(s){return c({...s,validateSpec:Uu})}}function gl(c){return[].concat(c).sort((s,u)=>s.line-u.line)}function lo(c){return function(...s){return gl(c.apply(this,s))}}Gr.source=lo(Ii(Jl)),Gr.sprite=lo(Ii(Hi)),Gr.glyphs=lo(Ii(eu)),Gr.light=lo(Ii(Nh)),Gr.sky=lo(Ii(Wd)),Gr.terrain=lo(Ii(Oh)),Gr.layer=lo(Ii(ml)),Gr.filter=lo(Ii(bn)),Gr.paintProperty=lo(Ii(rs)),Gr.layoutProperty=lo(Ii(kr));const Mc=Gr,Q0=Mc.light,Fh=Mc.sky,u_=Mc.paintProperty,jp=Mc.layoutProperty;function c_(c,s){let u=!1;if(s&&s.length)for(const p of s)c.fire(new Qo(new Error(p.message))),u=!0;return u}class $u{constructor(s,u,p){const _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const b=new Int32Array(this.arrayBuffer);s=b[0],this.d=(u=b[1])+2*(p=b[2]);for(let k=0;k<this.d*this.d;k++){const R=b[3+k],N=b[3+k+1];_.push(R===N?null:b.subarray(R,N))}const I=b[3+_.length+1];this.keys=b.subarray(b[3+_.length],I),this.bboxes=b.subarray(I),this.insert=this._insertReadonly}else{this.d=u+2*p;for(let b=0;b<this.d*this.d;b++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=p,this.scale=u/s,this.uid=0;const w=p/u*s;this.min=-w,this.max=s+w}insert(s,u,p,_,w){this._forEachCell(u,p,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,u,p,_,w,b){this.cells[w].push(b)}query(s,u,p,_,w){const b=this.min,I=this.max;if(s<=b&&u<=b&&I<=p&&I<=_&&!w)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(s,u,p,_,this._queryCell,k,{},w),k}}_queryCell(s,u,p,_,w,b,I,k){const R=this.cells[w];if(R!==null){const N=this.keys,B=this.bboxes;for(let G=0;G<R.length;G++){const X=R[G];if(I[X]===void 0){const Y=4*X;(k?k(B[Y+0],B[Y+1],B[Y+2],B[Y+3]):s<=B[Y+2]&&u<=B[Y+3]&&p>=B[Y+0]&&_>=B[Y+1])?(I[X]=!0,b.push(N[X])):I[X]=!1}}}}_forEachCell(s,u,p,_,w,b,I,k){const R=this._convertToCellCoord(s),N=this._convertToCellCoord(u),B=this._convertToCellCoord(p),G=this._convertToCellCoord(_);for(let X=R;X<=B;X++)for(let Y=N;Y<=G;Y++){const te=this.d*Y+X;if((!k||k(this._convertFromCellCoord(X),this._convertFromCellCoord(Y),this._convertFromCellCoord(X+1),this._convertFromCellCoord(Y+1)))&&w.call(this,s,u,p,_,te,b,I,k))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,u=3+this.cells.length+1+1;let p=0;for(let b=0;b<this.cells.length;b++)p+=this.cells[b].length;const _=new Int32Array(u+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=u;for(let b=0;b<s.length;b++){const I=s[b];_[3+b]=w,_.set(I,w),w+=I.length}return _[3+s.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+s.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(s,u){const p=s.toArrayBuffer();return u&&u.push(p),{buffer:p}}static deserialize(s){return new $u(s.buffer)}}const _l={};function Rt(c,s,u={}){if(_l[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),_l[c]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}Rt("Object",Object),Rt("TransferableGridIndex",$u),Rt("Color",ln),Rt("Error",Error),Rt("AJAXError",ni),Rt("ResolvedImage",Yi),Rt("StylePropertyFunction",Fu),Rt("StyleExpression",Ou,{omit:["_evaluator"]}),Rt("ZoomDependentExpression",La),Rt("ZoomConstantExpression",oa),Rt("CompoundExpression",ws,{omit:["_evaluate"]});for(const c in Aa)Aa[c]._classRegistryKey||Rt(`Expression_${c}`,Aa[c]);function h_(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function qu(c){return c.$name||c.constructor._classRegistryKey}function d_(c){return!function(s){if(s===null||typeof s!="object")return!1;const u=qu(s);return!(!u||u==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||h_(c)||Ds(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function Bh(c,s){if(d_(c))return(h_(c)||Ds(c))&&s&&s.push(c),ArrayBuffer.isView(c)&&s&&s.push(c.buffer),c instanceof ImageData&&s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const w=[];for(const b of c)w.push(Bh(b,s));return w}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const u=qu(c);if(!u)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!_l[u])throw new Error(`${u} is not registered.`);const{klass:p}=_l[u],_=p.serialize?p.serialize(c,s):{};if(p.serialize){if(s&&_===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in c){if(!c.hasOwnProperty(w)||_l[u].omit.indexOf(w)>=0)continue;const b=c[w];_[w]=_l[u].shallow.indexOf(w)>=0?b:Bh(b,s)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(_.$name=u),_}function tu(c){if(d_(c))return c;if(Array.isArray(c))return c.map(tu);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const s=qu(c)||"Object";if(!_l[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:u}=_l[s];if(!u)throw new Error(`can't deserialize unregistered class ${s}`);if(u.deserialize)return u.deserialize(c);const p=Object.create(u.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const w=c[_];p[_]=_l[s].shallow.indexOf(_)>=0?w:tu(w)}return p}class f_{constructor(){this.first=!0}update(s,u){const p=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=p,!0))}}const Pn={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Rc(c){for(const s of c)if(Yd(s.charCodeAt(0)))return!0;return!1}function p_(c){for(const s of c)if(!g_(s.charCodeAt(0)))return!1;return!0}function Kd(c){const s=c.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(s.join("|"),"u")}const m_=Kd(["Arab","Dupl","Mong","Ougr","Syrc"]);function g_(c){return!m_.test(String.fromCodePoint(c))}const Xd=Kd(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Yd(c){return!(c!==746&&c!==747&&(c<4352||!(Pn["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Pn["CJK Compatibility"](c)||Pn["CJK Strokes"](c)||!(!Pn["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Pn["Enclosed CJK Letters and Months"](c)||Pn["Ideographic Description Characters"](c)||Pn.Kanbun(c)||Pn.Katakana(c)&&c!==12540||!(!Pn["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Pn["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Pn["Vertical Forms"](c)||Pn["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Xd.test(String.fromCodePoint(c)))))}function __(c){return!(Yd(c)||function(s){return!!(Pn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Pn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Pn["Letterlike Symbols"](s)||Pn["Number Forms"](s)||Pn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Pn["Control Pictures"](s)&&s!==9251||Pn["Optical Character Recognition"](s)||Pn["Enclosed Alphanumerics"](s)||Pn["Geometric Shapes"](s)||Pn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Pn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Pn["CJK Symbols and Punctuation"](s)||Pn.Katakana(s)||Pn["Private Use Area"](s)||Pn["CJK Compatibility Forms"](s)||Pn["Small Form Variants"](s)||Pn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}const y_=Kd(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function v_(c){return y_.test(String.fromCodePoint(c))}function x_(c,s){return!(!s&&v_(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Pn.Khmer(c))}function w_(c){for(const s of c)if(v_(s.charCodeAt(0)))return!0;return!1}const yl=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(yl.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,s){return l(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(c.pluginStatus!=="loading")return this.setState(c),c;const u=c.pluginURL,p=new Promise(w=>{this.loadScriptResolve=w});s(u);const _=new Promise(w=>setTimeout(()=>w(),this.TIMEOUT));if(yield Promise.race([p,_]),this.isParsed()){const w={pluginStatus:"loaded",pluginURL:u};return this.setState(w),w}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)})}};class zi{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f_,this.transition={})}isSupportedScript(s){return function(u,p){for(const _ of u)if(!x_(_.charCodeAt(0),p))return!1;return!0}(s,yl.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,u=s-Math.floor(s),p=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}}}class Qd{constructor(s,u){this.property=s,this.value=u,this.expression=function(p,_){if(Ma(p))return new Fu(p,_);if(Ra(p)){const w=Mh(p,_);if(w.result==="error")throw new Error(w.value.map(b=>`${b.key}: ${b.message}`).join(", "));return w.value}{let w=p;return _.type==="color"&&typeof p=="string"?w=ln.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?w=Xi.parse(p):_.type==="projectionDefinition"&&typeof p=="string"&&(w=qi.parse(p)):w=ei.parse(p),{kind:"constant",evaluate:()=>w}}}(u===void 0?s.specification.default:u,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,p){return this.property.possiblyEvaluate(this,s,u,p)}}class Jd{constructor(s){this.property=s,this.value=new Qd(s,void 0)}transitioned(s,u){return new $p(this.property,this.value,u,Jt({},s.transition,this.transition),s.now)}untransitioned(){return new $p(this.property,this.value,null,{},0)}}class Up{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Pr(this._values[s].value.value)}setValue(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Jd(this._values[s].property)),this._values[s].value=new Qd(this._values[s].property,u===null?void 0:Pr(u))}getTransition(s){return Pr(this._values[s].transition)}setTransition(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Jd(this._values[s].property)),this._values[s].transition=Pr(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(s[u]=p);const _=this.getTransition(u);_!==void 0&&(s[`${u}-transition`]=_)}return s}transitioned(s,u){const p=new qp(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(s,u._values[_]);return p}untransitioned(){const s=new qp(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}}class $p{constructor(s,u,p,_,w){this.property=s,this.value=u,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(s,u,p){const _=s.now||0,w=this.value.possiblyEvaluate(s,u,p),b=this.prior;if(b){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return b.possiblyEvaluate(s,u,p);{const I=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(s,u,p),w,Tt(I))}}return w}}class qp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,p){const _=new Lc(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(s,u,p);return _}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class ef{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Pr(this._values[s].value)}setValue(s,u){this._values[s]=new Qd(this._values[s].property,u===null?void 0:Pr(u))}serialize(){const s={};for(const u of Object.keys(this._values)){const p=this.getValue(u);p!==void 0&&(s[u]=p)}return s}possiblyEvaluate(s,u,p){const _=new Lc(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(s,u,p);return _}}class za{constructor(s,u,p){this.property=s,this.value=u,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,p,_){return this.property.evaluate(this.value,this.parameters,s,u,p,_)}}class Lc{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class Vt{constructor(s){this.specification=s}possiblyEvaluate(s,u){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(u)}interpolate(s,u,p){const _=Hr[this.specification.type];return _?_(s,u,p):s}}class Kt{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,p,_){return new za(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},p,_)}:s.expression,u)}interpolate(s,u,p){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new za(this,{kind:"constant",value:void 0},s.parameters);const _=Hr[this.specification.type];if(_){const w=_(s.value.value,u.value.value,p);return new za(this,{kind:"constant",value:w},s.parameters)}return s}evaluate(s,u,p,_,w,b){return s.kind==="constant"?s.value:s.evaluate(u,p,_,w,b)}}class Vh extends Kt{possiblyEvaluate(s,u,p,_){if(s.value===void 0)return new za(this,{kind:"constant",value:void 0},u);if(s.expression.kind==="constant"){const w=s.expression.evaluate(u,null,{},p,_),b=s.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(b,b,b,u);return new za(this,{kind:"constant",value:I},u)}if(s.expression.kind==="camera"){const w=this._calculate(s.expression.evaluate({zoom:u.zoom-1}),s.expression.evaluate({zoom:u.zoom}),s.expression.evaluate({zoom:u.zoom+1}),u);return new za(this,{kind:"constant",value:w},u)}return new za(this,s.expression,u)}evaluate(s,u,p,_,w,b){if(s.kind==="source"){const I=s.evaluate(u,p,_,w,b);return this._calculate(I,I,I,u)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(u.zoom)-1},p,_),s.evaluate({zoom:Math.floor(u.zoom)},p,_),s.evaluate({zoom:Math.floor(u.zoom)+1},p,_),u):s.value}_calculate(s,u,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:p,to:u}}interpolate(s){return s}}class tf{constructor(s){this.specification=s}possiblyEvaluate(s,u,p,_){if(s.value!==void 0){if(s.expression.kind==="constant"){const w=s.expression.evaluate(u,null,{},p,_);return this._calculate(w,w,w,u)}return this._calculate(s.expression.evaluate(new zi(Math.floor(u.zoom-1),u)),s.expression.evaluate(new zi(Math.floor(u.zoom),u)),s.expression.evaluate(new zi(Math.floor(u.zoom+1),u)),u)}}_calculate(s,u,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:p,to:u}}interpolate(s){return s}}class nf{constructor(s){this.specification=s}possiblyEvaluate(s,u,p,_){return!!s.expression.evaluate(u,null,{},p,_)}interpolate(){return!1}}class qs{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in s){const p=s[u];p.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new Qd(p,void 0),w=this.defaultTransitionablePropertyValues[u]=new Jd(p);this.defaultTransitioningPropertyValues[u]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate({})}}}Rt("DataDrivenProperty",Kt),Rt("DataConstantProperty",Vt),Rt("CrossFadedDataDrivenProperty",Vh),Rt("CrossFadedProperty",tf),Rt("ColorRampProperty",nf);const b_="-transition";class Na extends fs{constructor(s,u){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),u.layout&&(this._unevaluatedLayout=new ef(u.layout)),u.paint)){this._transitionablePaint=new Up(u.paint);for(const p in s.paint)this.setPaintProperty(p,s.paint[p],{validate:!1});for(const p in s.layout)this.setLayoutProperty(p,s.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Lc(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u,p={}){u!=null&&this._validate(jp,`layers.${this.id}.layout.${s}`,s,u,p)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,u):this.visibility=u)}getPaintProperty(s){return s.endsWith(b_)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,u,p={}){if(u!=null&&this._validate(u_,`layers.${this.id}.paint.${s}`,s,u,p))return!1;if(s.endsWith(b_))return this._transitionablePaint.setTransition(s.slice(0,-11),u||void 0),!1;{const _=this._transitionablePaint._values[s],w=_.property.specification["property-type"]==="cross-faded-data-driven",b=_.value.isDataDriven(),I=_.value;this._transitionablePaint.setValue(s,u),this._handleSpecialPaintPropertyUpdate(s);const k=this._transitionablePaint._values[s].value;return k.isDataDriven()||b||w||this._handleOverridablePaintPropertyUpdate(s,I,k)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,u,p){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Ir(s,(u,p)=>!(u===void 0||p==="layout"&&!Object.keys(u).length||p==="paint"&&!Object.keys(u).length))}_validate(s,u,p,_,w={}){return(!w||w.validate!==!1)&&c_(this,s.call(Mc,{key:u,layerType:this.type,objectKey:p,value:_,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof za&&sa(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const J0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jh{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function rr(c,s=1){let u=0,p=0;return{members:c.map(_=>{const w=J0[_.type].BYTES_PER_ELEMENT,b=u=T_(u,Math.max(s,w)),I=_.components||1;return p=Math.max(p,w),u+=w*I,{name:_.name,type:_.type,components:I,offset:b}}),size:T_(u,Math.max(p,s)),alignment:s}}function T_(c,s){return Math.ceil(c/s)*s}class Uh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const p=this.length;return this.resize(p+1),this.emplace(p,s,u)}emplace(s,u,p){const _=2*s;return this.int16[_+0]=u,this.int16[_+1]=p,s}}Uh.prototype.bytesPerElement=4,Rt("StructArrayLayout2i4",Uh);class $h extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,p)}emplace(s,u,p,_){const w=3*s;return this.int16[w+0]=u,this.int16[w+1]=p,this.int16[w+2]=_,s}}$h.prototype.bytesPerElement=6,Rt("StructArrayLayout3i6",$h);class Hp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p,_){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,p,_)}emplace(s,u,p,_,w){const b=4*s;return this.int16[b+0]=u,this.int16[b+1]=p,this.int16[b+2]=_,this.int16[b+3]=w,s}}Hp.prototype.bytesPerElement=8,Rt("StructArrayLayout4i8",Hp);class Gp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b){const I=this.length;return this.resize(I+1),this.emplace(I,s,u,p,_,w,b)}emplace(s,u,p,_,w,b,I){const k=6*s;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=_,this.int16[k+3]=w,this.int16[k+4]=b,this.int16[k+5]=I,s}}Gp.prototype.bytesPerElement=12,Rt("StructArrayLayout2i4i12",Gp);class vl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b){const I=this.length;return this.resize(I+1),this.emplace(I,s,u,p,_,w,b)}emplace(s,u,p,_,w,b,I){const k=4*s,R=8*s;return this.int16[k+0]=u,this.int16[k+1]=p,this.uint8[R+4]=_,this.uint8[R+5]=w,this.uint8[R+6]=b,this.uint8[R+7]=I,s}}vl.prototype.bytesPerElement=8,Rt("StructArrayLayout2i4ub8",vl);class Dc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const p=this.length;return this.resize(p+1),this.emplace(p,s,u)}emplace(s,u,p){const _=2*s;return this.float32[_+0]=u,this.float32[_+1]=p,s}}Dc.prototype.bytesPerElement=8,Rt("StructArrayLayout2f8",Dc);class qh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b,I,k,R,N){const B=this.length;return this.resize(B+1),this.emplace(B,s,u,p,_,w,b,I,k,R,N)}emplace(s,u,p,_,w,b,I,k,R,N,B){const G=10*s;return this.uint16[G+0]=u,this.uint16[G+1]=p,this.uint16[G+2]=_,this.uint16[G+3]=w,this.uint16[G+4]=b,this.uint16[G+5]=I,this.uint16[G+6]=k,this.uint16[G+7]=R,this.uint16[G+8]=N,this.uint16[G+9]=B,s}}qh.prototype.bytesPerElement=20,Rt("StructArrayLayout10ui20",qh);class rf extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b,I,k,R,N,B,G){const X=this.length;return this.resize(X+1),this.emplace(X,s,u,p,_,w,b,I,k,R,N,B,G)}emplace(s,u,p,_,w,b,I,k,R,N,B,G,X){const Y=12*s;return this.int16[Y+0]=u,this.int16[Y+1]=p,this.int16[Y+2]=_,this.int16[Y+3]=w,this.uint16[Y+4]=b,this.uint16[Y+5]=I,this.uint16[Y+6]=k,this.uint16[Y+7]=R,this.int16[Y+8]=N,this.int16[Y+9]=B,this.int16[Y+10]=G,this.int16[Y+11]=X,s}}rf.prototype.bytesPerElement=24,Rt("StructArrayLayout4i4ui4i24",rf);class Hh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,p)}emplace(s,u,p,_){const w=3*s;return this.float32[w+0]=u,this.float32[w+1]=p,this.float32[w+2]=_,s}}Hh.prototype.bytesPerElement=12,Rt("StructArrayLayout3f12",Hh);class Zp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}Zp.prototype.bytesPerElement=4,Rt("StructArrayLayout1ul4",Zp);class zc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b,I,k,R){const N=this.length;return this.resize(N+1),this.emplace(N,s,u,p,_,w,b,I,k,R)}emplace(s,u,p,_,w,b,I,k,R,N){const B=10*s,G=5*s;return this.int16[B+0]=u,this.int16[B+1]=p,this.int16[B+2]=_,this.int16[B+3]=w,this.int16[B+4]=b,this.int16[B+5]=I,this.uint32[G+3]=k,this.uint16[B+8]=R,this.uint16[B+9]=N,s}}zc.prototype.bytesPerElement=20,Rt("StructArrayLayout6i1ul2ui20",zc);class Hu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b){const I=this.length;return this.resize(I+1),this.emplace(I,s,u,p,_,w,b)}emplace(s,u,p,_,w,b,I){const k=6*s;return this.int16[k+0]=u,this.int16[k+1]=p,this.int16[k+2]=_,this.int16[k+3]=w,this.int16[k+4]=b,this.int16[k+5]=I,s}}Hu.prototype.bytesPerElement=12,Rt("StructArrayLayout2i2i2i12",Hu);class Wp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w){const b=this.length;return this.resize(b+1),this.emplace(b,s,u,p,_,w)}emplace(s,u,p,_,w,b){const I=4*s,k=8*s;return this.float32[I+0]=u,this.float32[I+1]=p,this.float32[I+2]=_,this.int16[k+6]=w,this.int16[k+7]=b,s}}Wp.prototype.bytesPerElement=16,Rt("StructArrayLayout2f1f2i16",Wp);class sf extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b){const I=this.length;return this.resize(I+1),this.emplace(I,s,u,p,_,w,b)}emplace(s,u,p,_,w,b,I){const k=16*s,R=4*s,N=8*s;return this.uint8[k+0]=u,this.uint8[k+1]=p,this.float32[R+1]=_,this.float32[R+2]=w,this.int16[N+6]=b,this.int16[N+7]=I,s}}sf.prototype.bytesPerElement=16,Rt("StructArrayLayout2ub2f2i16",sf);class nu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,p)}emplace(s,u,p,_){const w=3*s;return this.uint16[w+0]=u,this.uint16[w+1]=p,this.uint16[w+2]=_,s}}nu.prototype.bytesPerElement=6,Rt("StructArrayLayout3ui6",nu);class Kp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,s,u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we)}emplace(s,u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we,Ne){const Se=24*s,K=12*s,ae=48*s;return this.int16[Se+0]=u,this.int16[Se+1]=p,this.uint16[Se+2]=_,this.uint16[Se+3]=w,this.uint32[K+2]=b,this.uint32[K+3]=I,this.uint32[K+4]=k,this.uint16[Se+10]=R,this.uint16[Se+11]=N,this.uint16[Se+12]=B,this.float32[K+7]=G,this.float32[K+8]=X,this.uint8[ae+36]=Y,this.uint8[ae+37]=te,this.uint8[ae+38]=he,this.uint32[K+10]=we,this.int16[Se+22]=Ne,s}}Kp.prototype.bytesPerElement=48,Rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Kp);class Xp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we,Ne,Se,K,ae,Ie,We,ct,Xe,it,gt,dt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,s,u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we,Ne,Se,K,ae,Ie,We,ct,Xe,it,gt,dt)}emplace(s,u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we,Ne,Se,K,ae,Ie,We,ct,Xe,it,gt,dt,_t){const ot=32*s,Nt=16*s;return this.int16[ot+0]=u,this.int16[ot+1]=p,this.int16[ot+2]=_,this.int16[ot+3]=w,this.int16[ot+4]=b,this.int16[ot+5]=I,this.int16[ot+6]=k,this.int16[ot+7]=R,this.uint16[ot+8]=N,this.uint16[ot+9]=B,this.uint16[ot+10]=G,this.uint16[ot+11]=X,this.uint16[ot+12]=Y,this.uint16[ot+13]=te,this.uint16[ot+14]=he,this.uint16[ot+15]=we,this.uint16[ot+16]=Ne,this.uint16[ot+17]=Se,this.uint16[ot+18]=K,this.uint16[ot+19]=ae,this.uint16[ot+20]=Ie,this.uint16[ot+21]=We,this.uint16[ot+22]=ct,this.uint32[Nt+12]=Xe,this.float32[Nt+13]=it,this.float32[Nt+14]=gt,this.uint16[ot+30]=dt,this.uint16[ot+31]=_t,s}}Xp.prototype.bytesPerElement=64,Rt("StructArrayLayout8i15ui1ul2f2ui64",Xp);class Gh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}Gh.prototype.bytesPerElement=4,Rt("StructArrayLayout1f4",Gh);class Yp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,p)}emplace(s,u,p,_){const w=3*s;return this.uint16[6*s+0]=u,this.float32[w+1]=p,this.float32[w+2]=_,s}}Yp.prototype.bytesPerElement=12,Rt("StructArrayLayout1ui2f12",Yp);class v extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,p)}emplace(s,u,p,_){const w=4*s;return this.uint32[2*s+0]=u,this.uint16[w+2]=p,this.uint16[w+3]=_,s}}v.prototype.bytesPerElement=8,Rt("StructArrayLayout1ul2ui8",v);class i extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const p=this.length;return this.resize(p+1),this.emplace(p,s,u)}emplace(s,u,p){const _=2*s;return this.uint16[_+0]=u,this.uint16[_+1]=p,s}}i.prototype.bytesPerElement=4,Rt("StructArrayLayout2ui4",i);class a extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}a.prototype.bytesPerElement=2,Rt("StructArrayLayout1ui2",a);class m extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,p,_){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,p,_)}emplace(s,u,p,_,w){const b=4*s;return this.float32[b+0]=u,this.float32[b+1]=p,this.float32[b+2]=_,this.float32[b+3]=w,s}}m.prototype.bytesPerElement=16,Rt("StructArrayLayout4f16",m);class g extends jh{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ie(this.anchorPointX,this.anchorPointY)}}g.prototype.size=20;class x extends zc{get(s){return new g(this,s)}}Rt("CollisionBoxArray",x);class T extends jh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}T.prototype.size=48;class C extends Kp{get(s){return new T(this,s)}}Rt("PlacedSymbolArray",C);class M extends jh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}M.prototype.size=64;class z extends Xp{get(s){return new M(this,s)}}Rt("SymbolInstanceArray",z);class V extends Gh{getoffsetX(s){return this.float32[1*s+0]}}Rt("GlyphOffsetArray",V);class q extends $h{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Rt("SymbolLineVertexArray",q);class Z extends jh{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Z.prototype.size=12;class J extends Yp{get(s){return new Z(this,s)}}Rt("TextAnchorOffsetArray",J);class ne extends jh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ne.prototype.size=8;class ye extends v{get(s){return new ne(this,s)}}Rt("FeatureIndexArray",ye);class _e extends Uh{}class xe extends Uh{}class be extends Uh{}class Ce extends Gp{}class ke extends vl{}class Re extends Dc{}class ze extends qh{}class De extends rf{}class Ze extends Hh{}class Ke extends Zp{}class st extends Hu{}class at extends sf{}class tt extends nu{}class St extends i{}const bt=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ht}=bt;class It{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,u,p,_){const w=this.segments[this.segments.length-1];return s>It.MAX_VERTEX_ARRAY_LENGTH&&ki(`Max vertices per segment is ${It.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${It.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!w||w.vertexLength+s>It.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_?this.createNewSegment(u,p,_):w}createNewSegment(s,u,p){const _={vertexOffset:s.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(_.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(s,u,p){return this.prepareSegment(0,s,u,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,p,_){return new It([{vertexOffset:s,primitiveOffset:u,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function pn(c,s){return 256*(c=cn(Math.floor(c),0,255))+cn(Math.floor(s),0,255)}It.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt("SegmentVector",It);const Fn=rr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ni,hi,Oi,di={exports:{}},ai={exports:{}},fi={exports:{}},Zr=function(){if(Oi)return di.exports;Oi=1;var c=(Ni||(Ni=1,ai.exports=function(u,p){var _,w,b,I,k,R,N,B;for(w=u.length-(_=3&u.length),b=p,k=3432918353,R=461845907,B=0;B<w;)N=255&u.charCodeAt(B)|(255&u.charCodeAt(++B))<<8|(255&u.charCodeAt(++B))<<16|(255&u.charCodeAt(++B))<<24,++B,b=27492+(65535&(I=5*(65535&(b=(b^=N=(65535&(N=(N=(65535&N)*k+(((N>>>16)*k&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch(N=0,_){case 3:N^=(255&u.charCodeAt(B+2))<<16;case 2:N^=(255&u.charCodeAt(B+1))<<8;case 1:b^=N=(65535&(N=(N=(65535&(N^=255&u.charCodeAt(B)))*k+(((N>>>16)*k&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295}return b^=u.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),ai.exports),s=(hi||(hi=1,fi.exports=function(u,p){for(var _,w=u.length,b=p^w,I=0;w>=4;)_=1540483477*(65535&(_=255&u.charCodeAt(I)|(255&u.charCodeAt(++I))<<8|(255&u.charCodeAt(++I))<<16|(255&u.charCodeAt(++I))<<24))+((1540483477*(_>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),w-=4,++I;switch(w){case 3:b^=(255&u.charCodeAt(I+2))<<16;case 2:b^=(255&u.charCodeAt(I+1))<<8;case 1:b=1540483477*(65535&(b^=255&u.charCodeAt(I)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),fi.exports);return di.exports=c,di.exports.murmur3=c,di.exports.murmur2=s,di.exports}(),fr=S(Zr);class pr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,u,p,_){this.ids.push(Ts(s)),this.positions.push(u,p,_)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Ts(s);let p=0,_=this.ids.length-1;for(;p<_;){const b=p+_>>1;this.ids[b]>=u?_=b:p=b+1}const w=[];for(;this.ids[p]===u;)w.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return w}static serialize(s,u){const p=new Float64Array(s.ids),_=new Uint32Array(s.positions);return xl(p,_,0,p.length-1),u&&u.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(s){const u=new pr;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u}}function Ts(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:fr(String(c))}function xl(c,s,u,p){for(;u<p;){const _=c[u+p>>1];let w=u-1,b=p+1;for(;;){do w++;while(c[w]<_);do b--;while(c[b]>_);if(w>=b)break;Oa(c,w,b),Oa(s,3*w,3*b),Oa(s,3*w+1,3*b+1),Oa(s,3*w+2,3*b+2)}b-u<p-b?(xl(c,s,u,b),u=b+1):(xl(c,s,b+1,p),p=b)}}function Oa(c,s,u){const p=c[s];c[s]=c[u],c[u]=p}Rt("FeaturePositionMap",pr);class uo{constructor(s,u){this.gl=s.gl,this.location=u}}class wl extends uo{constructor(s,u){super(s,u),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Zh extends uo{constructor(s,u){super(s,u),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Wh extends uo{constructor(s,u){super(s,u),this.current=ln.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const Nc=new Float32Array(16);function Hs(c){return[pn(255*c.r,255*c.g),pn(255*c.b,255*c.a)]}class Vo{constructor(s,u,p){this.value=s,this.uniformNames=u.map(_=>`u_${_}`),this.type=p}setUniform(s,u,p){s.set(p.constantOr(this.value))}getBinding(s,u,p){return this.type==="color"?new Wh(s,u):new wl(s,u)}}class jo{constructor(s,u){this.uniformNames=u.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr}setUniform(s,u,p,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&s.set(w)}getBinding(s,u,p){return p.substr(0,9)==="u_pattern"?new Zh(s,u):new wl(s,u)}}class co{constructor(s,u,p,_){this.expression=s,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(w=>({name:`a_${w}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(s,u,p,_,w){const b=this.paintVertexArray.length,I=this.expression.evaluate(new zi(0),u,{},_,[],w);this.paintVertexArray.resize(s),this._setPaintValue(b,s,I)}updatePaintArray(s,u,p,_){const w=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(s,u,w)}_setPaintValue(s,u,p){if(this.type==="color"){const _=Hs(p);for(let w=s;w<u;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=s;_<u;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pi{constructor(s,u,p,_,w,b){this.expression=s,this.uniformNames=u.map(I=>`u_${I}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=u.map(I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(s,u,p,_,w){const b=this.expression.evaluate(new zi(this.zoom),u,{},_,[],w),I=this.expression.evaluate(new zi(this.zoom+1),u,{},_,[],w),k=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(k,s,b,I)}updatePaintArray(s,u,p,_){const w=this.expression.evaluate({zoom:this.zoom},p,_),b=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(s,u,w,b)}_setPaintValue(s,u,p,_){if(this.type==="color"){const w=Hs(p),b=Hs(_);for(let I=s;I<u;I++)this.paintVertexArray.emplace(I,w[0],w[1],b[0],b[1])}else{for(let w=s;w<u;w++)this.paintVertexArray.emplace(w,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u){const p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,_=cn(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);s.set(_)}getBinding(s,u,p){return new wl(s,u)}}class Fi{constructor(s,u,p,_,w,b){this.expression=s,this.type=u,this.useIntegerZoom=p,this.zoom=_,this.layerId=b,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(s,u,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,u.patterns&&u.patterns[this.layerId],p)}updatePaintArray(s,u,p,_,w){this._setPaintValues(s,u,p.patterns&&p.patterns[this.layerId],w)}_setPaintValues(s,u,p,_){if(!_||!p)return;const{min:w,mid:b,max:I}=p,k=_[w],R=_[b],N=_[I];if(k&&R&&N)for(let B=s;B<u;B++)this.zoomInPaintVertexArray.emplace(B,R.tl[0],R.tl[1],R.br[0],R.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],R.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,R.tl[0],R.tl[1],R.br[0],R.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],R.pixelRatio,N.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Fn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Fn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ho{constructor(s,u,p){this.binders={},this._buffers=[];const _=[];for(const w in s.paint._values){if(!p(w))continue;const b=s.paint.get(w);if(!(b instanceof za&&sa(b.property.specification)))continue;const I=ex(w,s.type),k=b.value,R=b.property.specification.type,N=b.property.useIntegerZoom,B=b.property.specification["property-type"],G=B==="cross-faded"||B==="cross-faded-data-driven";if(k.kind==="constant")this.binders[w]=G?new jo(k.value,I):new Vo(k.value,I,R),_.push(`/u_${w}`);else if(k.kind==="source"||G){const X=S_(w,R,"source");this.binders[w]=G?new Fi(k,R,N,u,X,s.id):new co(k,I,R,X),_.push(`/a_${w}`)}else{const X=S_(w,R,"composite");this.binders[w]=new pi(k,I,R,N,u,X),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof co||u instanceof pi?u.maxValue:0}populatePaintArrays(s,u,p,_,w){for(const b in this.binders){const I=this.binders[b];(I instanceof co||I instanceof pi||I instanceof Fi)&&I.populatePaintArray(s,u,p,_,w)}}setConstantPatternPositions(s,u){for(const p in this.binders){const _=this.binders[p];_ instanceof jo&&_.setConstantPatternPositions(s,u)}}updatePaintArrays(s,u,p,_,w){let b=!1;for(const I in s){const k=u.getPositions(I);for(const R of k){const N=p.feature(R.index);for(const B in this.binders){const G=this.binders[B];if((G instanceof co||G instanceof pi||G instanceof Fi)&&G.expression.isStateDependent===!0){const X=_.paint.get(B);G.expression=X.value,G.updatePaintArray(R.start,R.end,N,s[I],w),b=!0}}}}return b}defines(){const s=[];for(const u in this.binders){const p=this.binders[u];(p instanceof Vo||p instanceof jo)&&s.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return s}getBinderAttributes(){const s=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof co||p instanceof pi)for(let _=0;_<p.paintVertexAttributes.length;_++)s.push(p.paintVertexAttributes[_].name);else if(p instanceof Fi)for(let _=0;_<Fn.members.length;_++)s.push(Fn.members[_].name)}return s}getBinderUniforms(){const s=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Vo||p instanceof jo||p instanceof pi)for(const _ of p.uniformNames)s.push(_)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,u){const p=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof Vo||w instanceof jo||w instanceof pi){for(const b of w.uniformNames)if(u[b]){const I=w.getBinding(s,u[b],b);p.push({name:b,property:_,binding:I})}}}return p}setUniforms(s,u,p,_){for(const{name:w,property:b,binding:I}of u)this.binders[b].setUniform(I,_,p.get(b),w)}updatePaintBuffers(s){this._buffers=[];for(const u in this.binders){const p=this.binders[u];if(s&&p instanceof Fi){const _=s.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof co||p instanceof pi)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(s){for(const u in this.binders){const p=this.binders[u];(p instanceof co||p instanceof pi||p instanceof Fi)&&p.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof co||u instanceof pi||u instanceof Fi)&&u.destroy()}}}class Bi{constructor(s,u,p=()=>!0){this.programConfigurations={};for(const _ of s)this.programConfigurations[_.id]=new ho(_,u,p);this.needsUpload=!1,this._featureMap=new pr,this._bufferOffset=0}populatePaintArrays(s,u,p,_,w,b){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(s,u,_,w,b);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,p,_){for(const w of p)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(s,this._featureMap,u,w,_)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function ex(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function S_(c,s,u){const p={color:{source:Dc,composite:m},number:{source:Gh,composite:Dc}},_=function(w){return{"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze}}[w]}(c);return _&&_[u]||p[s][u]}Rt("ConstantBinder",Vo),Rt("CrossFadedConstantBinder",jo),Rt("SourceExpressionBinder",co),Rt("CrossFadedCompositeBinder",Fi),Rt("CompositeExpressionBinder",pi),Rt("ProgramConfiguration",ho,{omit:["_buffers"]}),Rt("ProgramConfigurationSet",Bi);const Qp=Math.pow(2,14)-1,E_=-Qp-1;function Gu(c){const s=Yt/c.extent,u=c.loadGeometry();for(let p=0;p<u.length;p++){const _=u[p];for(let w=0;w<_.length;w++){const b=_[w],I=Math.round(b.x*s),k=Math.round(b.y*s);b.x=cn(I,E_,Qp),b.y=cn(k,E_,Qp),(I<b.x||I>b.x+1||k<b.y||k>b.y+1)&&ki("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Zu(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?Gu(c):[]}}const iu=-32768;function I_(c,s,u,p,_){c.emplaceBack(iu+8*s+p,iu+8*u+_)}class of{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new xe,this.indexArray=new tt,this.segments=new It,this.programConfigurations=new Bi(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,p){const _=this.layers[0],w=[];let b=null,I=!1,k=_.type==="heatmap";if(_.type==="circle"){const N=_;b=N.layout.get("circle-sort-key"),I=!b.isConstant(),k=k||N.paint.get("circle-pitch-alignment")==="map"}const R=k?u.subdivisionGranularity.circle:1;for(const{feature:N,id:B,index:G,sourceLayerIndex:X}of s){const Y=this.layers[0]._featureFilter.needGeometry,te=Zu(N,Y);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),te,p))continue;const he=I?b.evaluate(te,{},p):void 0,we={id:B,properties:N.properties,type:N.type,sourceLayerIndex:X,index:G,geometry:Y?te.geometry:Gu(N),patterns:{},sortKey:he};w.push(we)}I&&w.sort((N,B)=>N.sortKey-B.sortKey);for(const N of w){const{geometry:B,index:G,sourceLayerIndex:X}=N,Y=s[G].feature;this.addFeature(N,B,G,p,R),u.featureIndex.insert(Y,B,G,X,this.index)}}update(s,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ht),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,p,_,w=1){let b;switch(w){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${w}; valid values are 1, 3, 5, 7.`)}const I=b.length;for(const k of u)for(const R of k){const N=R.x,B=R.y;if(N<0||N>=Yt||B<0||B>=Yt)continue;const G=this.segments.prepareSegment(I*I,this.layoutVertexArray,this.indexArray,s.sortKey),X=G.vertexLength;for(let Y=0;Y<I;Y++)for(let te=0;te<I;te++)I_(this.layoutVertexArray,N,B,b[te],b[Y]);for(let Y=0;Y<I-1;Y++)for(let te=0;te<I-1;te++){const he=X+Y*I+te,we=X+(Y+1)*I+te;this.indexArray.emplaceBack(he,we+1,he+1),this.indexArray.emplaceBack(he,we,we+1)}G.vertexLength+=I*I,G.primitiveLength+=(I-1)*(I-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{},_)}}function Jp(c,s){for(let u=0;u<c.length;u++)if(af(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(af(c,s[u]))return!0;return!!tx(c,s)}function em(c,s,u){return!!af(c,s)||!!nx(s,c,u)}function tm(c,s){if(c.length===1)return eS(s,c[0]);for(let u=0;u<s.length;u++){const p=s[u];for(let _=0;_<p.length;_++)if(af(c,p[_]))return!0}for(let u=0;u<c.length;u++)if(eS(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(tx(c,s[u]))return!0;return!1}function nm(c,s,u){if(c.length>1){if(tx(c,s))return!0;for(let p=0;p<s.length;p++)if(nx(s[p],c,u))return!0}for(let p=0;p<c.length;p++)if(nx(c[p],s,u))return!0;return!1}function tx(c,s){if(c.length===0||s.length===0)return!1;for(let u=0;u<c.length-1;u++){const p=c[u],_=c[u+1];for(let w=0;w<s.length-1;w++)if(i5(p,_,s[w],s[w+1]))return!0}return!1}function i5(c,s,u,p){return ui(c,u,p)!==ui(s,u,p)&&ui(c,s,u)!==ui(c,s,p)}function nx(c,s,u){const p=u*u;if(s.length===1)return c.distSqr(s[0])<p;for(let _=1;_<s.length;_++)if(J2(c,s[_-1],s[_])<p)return!0;return!1}function J2(c,s,u){const p=s.distSqr(u);if(p===0)return c.distSqr(s);const _=((c.x-s.x)*(u.x-s.x)+(c.y-s.y)*(u.y-s.y))/p;return c.distSqr(_<0?s:_>1?u:u.sub(s)._mult(_)._add(s))}function eS(c,s){let u,p,_,w=!1;for(let b=0;b<c.length;b++){u=c[b];for(let I=0,k=u.length-1;I<u.length;k=I++)p=u[I],_=u[k],p.y>s.y!=_.y>s.y&&s.x<(_.x-p.x)*(s.y-p.y)/(_.y-p.y)+p.x&&(w=!w)}return w}function af(c,s){let u=!1;for(let p=0,_=c.length-1;p<c.length;_=p++){const w=c[p],b=c[_];w.y>s.y!=b.y>s.y&&s.x<(b.x-w.x)*(s.y-w.y)/(b.y-w.y)+w.x&&(u=!u)}return u}function r5(c,s,u){const p=u[0],_=u[2];if(c.x<p.x&&s.x<p.x||c.x>_.x&&s.x>_.x||c.y<p.y&&s.y<p.y||c.y>_.y&&s.y>_.y)return!1;const w=ui(c,s,u[0]);return w!==ui(c,s,u[1])||w!==ui(c,s,u[2])||w!==ui(c,s,u[3])}function im(c,s,u){const p=s.paint.get(c).value;return p.kind==="constant"?p.value:u.programConfigurations.get(s.id).getMaxValue(c)}function P_(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function C_(c,s,u,p,_){if(!s[0]&&!s[1])return c;const w=ie.convert(s)._mult(_);u==="viewport"&&w._rotate(-p);const b=[];for(let I=0;I<c.length;I++)b.push(c[I].sub(w));return b}let tS,nS;Rt("CircleBucket",of,{omit:["layers"]});var s5={get paint(){return nS=nS||new qs({"circle-radius":new Kt(pe.paint_circle["circle-radius"]),"circle-color":new Kt(pe.paint_circle["circle-color"]),"circle-blur":new Kt(pe.paint_circle["circle-blur"]),"circle-opacity":new Kt(pe.paint_circle["circle-opacity"]),"circle-translate":new Vt(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(pe.paint_circle["circle-stroke-opacity"])})},get layout(){return tS=tS||new qs({"circle-sort-key":new Kt(pe.layout_circle["circle-sort-key"])})}};class o5 extends Na{constructor(s){super(s,s5)}createBucket(s){return new of(s)}queryRadius(s){const u=s;return im("circle-radius",this,u)+im("circle-stroke-width",this,u)+P_(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:u,featureState:p,geometry:_,transform:w,pixelsToTileUnits:b,pixelPosMatrix:I}){const k=C_(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-w.bearingInRadians,b),R=this.paint.get("circle-radius").evaluate(u,p)+this.paint.get("circle-stroke-width").evaluate(u,p),N=this.paint.get("circle-pitch-alignment")==="map",B=N?k:function(X,Y){return X.map(te=>iS(te,Y))}(k,I),G=N?R*b:R;for(const X of _)for(const Y of X){const te=N?Y:iS(Y,I);let he=G;const we=Ve([],[Y.x,Y.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=we[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=w.cameraToCenterDistance/we[3]),em(B,te,he))return!0}return!1}}function iS(c,s){const u=Ve([],[c.x,c.y,0,1],s);return new ie(u[0]/u[3],u[1]/u[3])}class rS extends of{}let sS;Rt("HeatmapBucket",rS,{omit:["layers"]});var a5={get paint(){return sS=sS||new qs({"heatmap-radius":new Kt(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nf(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(pe.paint_heatmap["heatmap-opacity"])})}};function ix(c,{width:s,height:u},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==s*u*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${s*u*p}`)}else _=new Uint8Array(s*u*p);return c.width=s,c.height=u,c.data=_,c}function oS(c,{width:s,height:u},p){if(s===c.width&&u===c.height)return;const _=ix({},{width:s,height:u},p);rx(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,u)},p),c.width=s,c.height=u,c.data=_.data}function rx(c,s,u,p,_,w){if(_.width===0||_.height===0)return s;if(_.width>c.width||_.height>c.height||u.x>c.width-_.width||u.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||p.x>s.width-_.width||p.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const b=c.data,I=s.data;if(b===I)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<_.height;k++){const R=((u.y+k)*c.width+u.x)*w,N=((p.y+k)*s.width+p.x)*w;for(let B=0;B<_.width*w;B++)I[N+B]=b[R+B]}return s}class rm{constructor(s,u){ix(this,s,1,u)}resize(s){oS(this,s,1)}clone(){return new rm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,p,_,w){rx(s,u,p,_,w,1)}}class aa{constructor(s,u){ix(this,s,4,u)}resize(s){oS(this,s,4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,p,_,w){rx(s,u,p,_,w,4)}}function aS(c){const s={},u=c.resolution||256,p=c.clips?c.clips.length:1,_=c.image||new aa({width:u,height:p});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const w=(b,I,k)=>{s[c.evaluationKey]=k;const R=c.expression.evaluate(s);_.data[b+I+0]=Math.floor(255*R.r/R.a),_.data[b+I+1]=Math.floor(255*R.g/R.a),_.data[b+I+2]=Math.floor(255*R.b/R.a),_.data[b+I+3]=Math.floor(255*R.a)};if(c.clips)for(let b=0,I=0;b<p;++b,I+=4*u)for(let k=0,R=0;k<u;k++,R+=4){const N=k/(u-1),{start:B,end:G}=c.clips[b];w(I,R,B*(1-N)+G*N)}else for(let b=0,I=0;b<u;b++,I+=4)w(0,I,b/(u-1));return _}Rt("AlphaImage",rm),Rt("RGBAImage",aa);const sx="big-fb";class l5 extends Na{createBucket(s){return new rS(s)}constructor(s){super(s,a5),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=aS({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sx)&&this.heatmapFbos.delete(sx)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let lS;var u5={get paint(){return lS=lS||new qs({"hillshade-illumination-direction":new Vt(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(pe.paint_hillshade["hillshade-accent-color"])})}};class c5 extends Na{constructor(s){super(s,u5)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const h5=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:d5}=h5;function ox(c,s,u){const p=u.patternDependencies;let _=!1;for(const w of s){const b=w.paint.get(`${c}-pattern`);b.isConstant()||(_=!0);const I=b.constantOr(null);I&&(_=!0,p[I.to]=!0,p[I.from]=!0)}return _}function ax(c,s,u,p,_){const w=_.patternDependencies;for(const b of s){const I=b.paint.get(`${c}-pattern`).value;if(I.kind!=="constant"){let k=I.evaluate({zoom:p-1},u,{},_.availableImages),R=I.evaluate({zoom:p},u,{},_.availableImages),N=I.evaluate({zoom:p+1},u,{},_.availableImages);k=k&&k.name?k.name:k,R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,w[k]=!0,w[R]=!0,w[N]=!0,u.patterns[b.id]={min:k,mid:R,max:N}}}return u}function uS(c,s,u,p,_){let w;if(_===function(b,I,k,R){let N=0;for(let B=I,G=k-R;B<k;B+=R)N+=(b[G]-b[B])*(b[B+1]+b[G+1]),G=B;return N}(c,s,u,p)>0)for(let b=s;b<u;b+=p)w=fS(b/p|0,c[b],c[b+1],w);else for(let b=u-p;b>=s;b-=p)w=fS(b/p|0,c[b],c[b+1],w);return w&&lf(w,w.next)&&(lm(w),w=w.next),w}function Kh(c,s){if(!c)return c;s||(s=c);let u,p=c;do if(u=!1,p.steiner||!lf(p,p.next)&&sr(p.prev,p,p.next)!==0)p=p.next;else{if(lm(p),p=s=p.prev,p===p.next)break;u=!0}while(u||p!==s);return s}function sm(c,s,u,p,_,w,b){if(!c)return;!b&&w&&function(k,R,N,B){let G=k;do G.z===0&&(G.z=lx(G.x,G.y,R,N,B)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==k);G.prevZ.nextZ=null,G.prevZ=null,function(X){let Y,te=1;do{let he,we=X;X=null;let Ne=null;for(Y=0;we;){Y++;let Se=we,K=0;for(let Ie=0;Ie<te&&(K++,Se=Se.nextZ,Se);Ie++);let ae=te;for(;K>0||ae>0&&Se;)K!==0&&(ae===0||!Se||we.z<=Se.z)?(he=we,we=we.nextZ,K--):(he=Se,Se=Se.nextZ,ae--),Ne?Ne.nextZ=he:X=he,he.prevZ=Ne,Ne=he;we=Se}Ne.nextZ=null,te*=2}while(Y>1)}(G)}(c,p,_,w);let I=c;for(;c.prev!==c.next;){const k=c.prev,R=c.next;if(w?p5(c,p,_,w):f5(c))s.push(k.i,c.i,R.i),lm(c),c=R.next,I=R.next;else if((c=R)===I){b?b===1?sm(c=m5(Kh(c),s),s,u,p,_,w,2):b===2&&g5(c,s,u,p,_,w):sm(Kh(c),s,u,p,_,w,1);break}}}function f5(c){const s=c.prev,u=c,p=c.next;if(sr(s,u,p)>=0)return!1;const _=s.x,w=u.x,b=p.x,I=s.y,k=u.y,R=p.y,N=Math.min(_,w,b),B=Math.min(I,k,R),G=Math.max(_,w,b),X=Math.max(I,k,R);let Y=p.next;for(;Y!==s;){if(Y.x>=N&&Y.x<=G&&Y.y>=B&&Y.y<=X&&om(_,I,w,k,b,R,Y.x,Y.y)&&sr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function p5(c,s,u,p){const _=c.prev,w=c,b=c.next;if(sr(_,w,b)>=0)return!1;const I=_.x,k=w.x,R=b.x,N=_.y,B=w.y,G=b.y,X=Math.min(I,k,R),Y=Math.min(N,B,G),te=Math.max(I,k,R),he=Math.max(N,B,G),we=lx(X,Y,s,u,p),Ne=lx(te,he,s,u,p);let Se=c.prevZ,K=c.nextZ;for(;Se&&Se.z>=we&&K&&K.z<=Ne;){if(Se.x>=X&&Se.x<=te&&Se.y>=Y&&Se.y<=he&&Se!==_&&Se!==b&&om(I,N,k,B,R,G,Se.x,Se.y)&&sr(Se.prev,Se,Se.next)>=0||(Se=Se.prevZ,K.x>=X&&K.x<=te&&K.y>=Y&&K.y<=he&&K!==_&&K!==b&&om(I,N,k,B,R,G,K.x,K.y)&&sr(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;Se&&Se.z>=we;){if(Se.x>=X&&Se.x<=te&&Se.y>=Y&&Se.y<=he&&Se!==_&&Se!==b&&om(I,N,k,B,R,G,Se.x,Se.y)&&sr(Se.prev,Se,Se.next)>=0)return!1;Se=Se.prevZ}for(;K&&K.z<=Ne;){if(K.x>=X&&K.x<=te&&K.y>=Y&&K.y<=he&&K!==_&&K!==b&&om(I,N,k,B,R,G,K.x,K.y)&&sr(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function m5(c,s){let u=c;do{const p=u.prev,_=u.next.next;!lf(p,_)&&hS(p,u,u.next,_)&&am(p,_)&&am(_,p)&&(s.push(p.i,u.i,_.i),lm(u),lm(u.next),u=c=_),u=u.next}while(u!==c);return Kh(u)}function g5(c,s,u,p,_,w){let b=c;do{let I=b.next.next;for(;I!==b.prev;){if(b.i!==I.i&&w5(b,I)){let k=dS(b,I);return b=Kh(b,b.next),k=Kh(k,k.next),sm(b,s,u,p,_,w,0),void sm(k,s,u,p,_,w,0)}I=I.next}b=b.next}while(b!==c)}function _5(c,s){let u=c.x-s.x;return u===0&&(u=c.y-s.y,u===0)&&(u=(c.next.y-c.y)/(c.next.x-c.x)-(s.next.y-s.y)/(s.next.x-s.x)),u}function y5(c,s){const u=function(_,w){let b=w;const I=_.x,k=_.y;let R,N=-1/0;if(lf(_,b))return b;do{if(lf(_,b.next))return b.next;if(k<=b.y&&k>=b.next.y&&b.next.y!==b.y){const te=b.x+(k-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(te<=I&&te>N&&(N=te,R=b.x<b.next.x?b:b.next,te===I))return R}b=b.next}while(b!==w);if(!R)return null;const B=R,G=R.x,X=R.y;let Y=1/0;b=R;do{if(I>=b.x&&b.x>=G&&I!==b.x&&cS(k<X?I:N,k,G,X,k<X?N:I,k,b.x,b.y)){const te=Math.abs(k-b.y)/(I-b.x);am(b,_)&&(te<Y||te===Y&&(b.x>R.x||b.x===R.x&&v5(R,b)))&&(R=b,Y=te)}b=b.next}while(b!==B);return R}(c,s);if(!u)return s;const p=dS(u,c);return Kh(p,p.next),Kh(u,u.next)}function v5(c,s){return sr(c.prev,c,s.prev)<0&&sr(s.next,c,c.next)<0}function lx(c,s,u,p,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-p)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function x5(c){let s=c,u=c;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==c);return u}function cS(c,s,u,p,_,w,b,I){return(_-b)*(s-I)>=(c-b)*(w-I)&&(c-b)*(p-I)>=(u-b)*(s-I)&&(u-b)*(w-I)>=(_-b)*(p-I)}function om(c,s,u,p,_,w,b,I){return!(c===b&&s===I)&&cS(c,s,u,p,_,w,b,I)}function w5(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(u,p){let _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==p.i&&_.next.i!==p.i&&hS(_,_.next,u,p))return!0;_=_.next}while(_!==u);return!1}(c,s)&&(am(c,s)&&am(s,c)&&function(u,p){let _=u,w=!1;const b=(u.x+p.x)/2,I=(u.y+p.y)/2;do _.y>I!=_.next.y>I&&_.next.y!==_.y&&b<(_.next.x-_.x)*(I-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==u);return w}(c,s)&&(sr(c.prev,c,s.prev)||sr(c,s.prev,s))||lf(c,s)&&sr(c.prev,c,c.next)>0&&sr(s.prev,s,s.next)>0)}function sr(c,s,u){return(s.y-c.y)*(u.x-s.x)-(s.x-c.x)*(u.y-s.y)}function lf(c,s){return c.x===s.x&&c.y===s.y}function hS(c,s,u,p){const _=k_(sr(c,s,u)),w=k_(sr(c,s,p)),b=k_(sr(u,p,c)),I=k_(sr(u,p,s));return _!==w&&b!==I||!(_!==0||!A_(c,u,s))||!(w!==0||!A_(c,p,s))||!(b!==0||!A_(u,c,p))||!(I!==0||!A_(u,s,p))}function A_(c,s,u){return s.x<=Math.max(c.x,u.x)&&s.x>=Math.min(c.x,u.x)&&s.y<=Math.max(c.y,u.y)&&s.y>=Math.min(c.y,u.y)}function k_(c){return c>0?1:c<0?-1:0}function am(c,s){return sr(c.prev,c,c.next)<0?sr(c,s,c.next)>=0&&sr(c,c.prev,s)>=0:sr(c,s,c.prev)<0||sr(c,c.next,s)<0}function dS(c,s){const u=ux(c.i,c.x,c.y),p=ux(s.i,s.x,s.y),_=c.next,w=s.prev;return c.next=s,s.prev=c,u.next=_,_.prev=u,p.next=u,u.prev=p,w.next=p,p.prev=w,p}function fS(c,s,u,p){const _=ux(c,s,u);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function lm(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ux(c,s,u){return{i:c,x:s,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class uf{constructor(s,u){if(u>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=u}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class M_{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}M_.noSubdivision=new M_({fill:new uf(0,0),line:new uf(0,0),tile:new uf(0,0),stencil:new uf(0,0),circle:1}),Rt("SubdivisionGranularityExpression",uf),Rt("SubdivisionGranularitySetting",M_);const cf=-32768,um=32767;class b5{constructor(s,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=Yt/s,this._canonical=u}_getKey(s,u){return(s+=32768)<<16|(u+=32768)<<0}_vertexToIndex(s,u){if(s<-32768||u<-32768||s>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(s),_=0|Math.round(u),w=this._getKey(p,_);if(this._vertexDictionary.has(w))return this._vertexDictionary.get(w);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(w,b),this._vertexBuffer.push(p,_),b}_subdivideTrianglesScanline(s){if(this._granularity<2)return function(_,w){const b=[];for(let I=0;I<w.length;I+=3){const k=w[I],R=w[I+1],N=w[I+2],B=_[2*k],G=_[2*k+1];(_[2*R]-B)*(_[2*N+1]-G)-(_[2*R+1]-G)*(_[2*N]-B)>0?(b.push(k),b.push(N),b.push(R)):(b.push(k),b.push(R),b.push(N))}return b}(this._vertexBuffer,s);const u=[],p=s.length;for(let _=0;_<p;_+=3){const w=[s[_+0],s[_+1],s[_+2]],b=[this._vertexBuffer[2*s[_+0]+0],this._vertexBuffer[2*s[_+0]+1],this._vertexBuffer[2*s[_+1]+0],this._vertexBuffer[2*s[_+1]+1],this._vertexBuffer[2*s[_+2]+0],this._vertexBuffer[2*s[_+2]+1]];let I=1/0,k=1/0,R=-1/0,N=-1/0;for(let te=0;te<3;te++){const he=b[2*te],we=b[2*te+1];I=Math.min(I,he),R=Math.max(R,he),k=Math.min(k,we),N=Math.max(N,we)}if(I===R||k===N)continue;const B=Math.floor(I/this._granularityCellSize),G=Math.ceil(R/this._granularityCellSize),X=Math.floor(k/this._granularityCellSize),Y=Math.ceil(N/this._granularityCellSize);if(B!==G||X!==Y)for(let te=X;te<Y;te++){const he=this._scanlineGenerateVertexRingForCellRow(te,b,w);T5(this._vertexBuffer,he,u)}else u.push(...w)}return u}_scanlineGenerateVertexRingForCellRow(s,u,p){const _=s*this._granularityCellSize,w=_+this._granularityCellSize,b=[];for(let I=0;I<3;I++){const k=u[2*I],R=u[2*I+1],N=u[2*(I+1)%6],B=u[(2*(I+1)+1)%6],G=u[2*(I+2)%6],X=u[(2*(I+2)+1)%6],Y=N-k,te=B-R,he=Y===0,we=te===0,Ne=(_-R)/te,Se=(w-R)/te,K=Math.min(Ne,Se),ae=Math.max(Ne,Se);if(!we&&(K>=1||ae<=0)||we&&(R<_||R>w)){B>=_&&B<=w&&b.push(p[(I+1)%3]);continue}!we&&K>0&&b.push(this._vertexToIndex(k+Y*K,R+te*K));const Ie=k+Y*Math.max(K,0),We=k+Y*Math.min(ae,1);he||this._generateIntraEdgeVertices(b,k,R,N,B,Ie,We),!we&&ae<1&&b.push(this._vertexToIndex(k+Y*ae,R+te*ae)),(we||B>=_&&B<=w)&&b.push(p[(I+1)%3]),!we&&(B<=_||B>=w)&&this._generateInterEdgeVertices(b,k,R,N,B,G,X,We,_,w)}return b}_generateIntraEdgeVertices(s,u,p,_,w,b,I){const k=_-u,R=w-p,N=R===0,B=N?Math.min(u,_):Math.min(b,I),G=N?Math.max(u,_):Math.max(b,I),X=Math.floor(B/this._granularityCellSize)+1,Y=Math.ceil(G/this._granularityCellSize)-1;if(N?u<_:b<I)for(let te=X;te<=Y;te++){const he=te*this._granularityCellSize;s.push(this._vertexToIndex(he,p+R*(he-u)/k))}else for(let te=Y;te>=X;te--){const he=te*this._granularityCellSize;s.push(this._vertexToIndex(he,p+R*(he-u)/k))}}_generateInterEdgeVertices(s,u,p,_,w,b,I,k,R,N){const B=w-p,G=b-_,X=I-w,Y=(R-w)/X,te=(N-w)/X,he=Math.min(Y,te),we=Math.max(Y,te),Ne=_+G*he;let Se=Math.floor(Math.min(Ne,k)/this._granularityCellSize)+1,K=Math.ceil(Math.max(Ne,k)/this._granularityCellSize)-1,ae=k<Ne;const Ie=X===0;if(Ie&&(I===R||I===N))return;if(Ie||he>=1||we<=0){const ct=p-I,Xe=b+(u-b)*Math.min((R-I)/ct,(N-I)/ct);Se=Math.floor(Math.min(Xe,k)/this._granularityCellSize)+1,K=Math.ceil(Math.max(Xe,k)/this._granularityCellSize)-1,ae=k<Xe}const We=B>0?N:R;if(ae)for(let ct=Se;ct<=K;ct++)s.push(this._vertexToIndex(ct*this._granularityCellSize,We));else for(let ct=K;ct>=Se;ct--)s.push(this._vertexToIndex(ct*this._granularityCellSize,We))}_generateOutline(s){const u=[];for(const p of s){const _=Xh(p,this._granularity,!0),w=this._pointArrayToIndices(_),b=[];for(let I=1;I<w.length;I++)b.push(w[I-1]),b.push(w[I]);u.push(b)}return u}_handlePoles(s){let u=!1,p=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(u||p)&&this._fillPoles(s,u,p)}_ensureNoPoleVertices(){const s=this._vertexBuffer;for(let u=0;u<s.length;u+=2){const p=s[u+1];p===cf&&(s[u+1]=-32767),p===um&&(s[u+1]=32766)}}_generatePoleQuad(s,u,p,_,w,b){_>w!=(b===cf)?(s.push(u),s.push(p),s.push(this._vertexToIndex(_,b)),s.push(p),s.push(this._vertexToIndex(w,b)),s.push(this._vertexToIndex(_,b))):(s.push(p),s.push(u),s.push(this._vertexToIndex(_,b)),s.push(this._vertexToIndex(w,b)),s.push(p),s.push(this._vertexToIndex(_,b)))}_fillPoles(s,u,p){const _=this._vertexBuffer,w=Yt,b=s.length;for(let I=2;I<b;I+=3){const k=s[I-2],R=s[I-1],N=s[I],B=_[2*k],G=_[2*k+1],X=_[2*R],Y=_[2*R+1],te=_[2*N],he=_[2*N+1];u&&(G===0&&Y===0&&this._generatePoleQuad(s,k,R,B,X,cf),Y===0&&he===0&&this._generatePoleQuad(s,R,N,X,te,cf),he===0&&G===0&&this._generatePoleQuad(s,N,k,te,B,cf)),p&&(G===w&&Y===w&&this._generatePoleQuad(s,k,R,B,X,um),Y===w&&he===w&&this._generatePoleQuad(s,R,N,X,te,um),he===w&&G===w&&this._generatePoleQuad(s,N,k,te,B,um))}}_initializeVertices(s){for(let u=0;u<s.length;u+=2)this._vertexToIndex(s[u],s[u+1])}subdividePolygonInternal(s,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:_}=function(I){const k=[],R=[];for(const N of I)if(N.length!==0){N!==I[0]&&k.push(R.length/2);for(let B=0;B<N.length;B++)R.push(N[B].x),R.push(N[B].y)}return{flattened:R,holeIndices:k}}(s);let w;this._initializeVertices(p);try{const I=function(R,N,B=2){const G=N&&N.length,X=G?N[0]*B:R.length;let Y=uS(R,0,X,B,!0);const te=[];if(!Y||Y.next===Y.prev)return te;let he,we,Ne;if(G&&(Y=function(Se,K,ae,Ie){const We=[];for(let ct=0,Xe=K.length;ct<Xe;ct++){const it=uS(Se,K[ct]*Ie,ct<Xe-1?K[ct+1]*Ie:Se.length,Ie,!1);it===it.next&&(it.steiner=!0),We.push(x5(it))}We.sort(_5);for(let ct=0;ct<We.length;ct++)ae=y5(We[ct],ae);return ae}(R,N,Y,B)),R.length>80*B){he=1/0,we=1/0;let Se=-1/0,K=-1/0;for(let ae=B;ae<X;ae+=B){const Ie=R[ae],We=R[ae+1];Ie<he&&(he=Ie),We<we&&(we=We),Ie>Se&&(Se=Ie),We>K&&(K=We)}Ne=Math.max(Se-he,K-we),Ne=Ne!==0?32767/Ne:0}return sm(Y,te,B,he,we,Ne,0),te}(p,_),k=this._convertIndices(p,I);w=this._subdivideTrianglesScanline(k)}catch(I){console.error(I)}let b=[];return u&&(b=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(w),{verticesFlattened:this._vertexBuffer,indicesTriangles:w,indicesLineList:b}}_convertIndices(s,u){const p=[];for(let _=0;_<u.length;_++)p.push(this._vertexToIndex(s[2*u[_]],s[2*u[_]+1]));return p}_pointArrayToIndices(s){const u=[];for(let p=0;p<s.length;p++){const _=s[p];u.push(this._vertexToIndex(_.x,_.y))}return u}}function pS(c,s,u,p=!0){return new b5(u,s).subdividePolygonInternal(c,p)}function Xh(c,s,u=!1){if(!c||c.length<1)return[];if(c.length<2)return[];const p=c[0],_=c[c.length-1],w=u&&(p.x!==_.x||p.y!==_.y);if(s<2)return w?[...c,c[0]]:[...c];const b=Math.floor(Yt/s),I=[];I.push(new ie(c[0].x,c[0].y));const k=c.length,R=w?k:k-1;for(let N=0;N<R;N++){const B=c[N],G=N<k-1?c[N+1]:c[0],X=B.x,Y=B.y,te=G.x,he=G.y,we=X!==te,Ne=Y!==he;if(!we&&!Ne)continue;const Se=te-X,K=he-Y,ae=Math.abs(Se),Ie=Math.abs(K);let We=X,ct=Y;for(;;){const it=Se>0?(Math.floor(We/b)+1)*b:(Math.ceil(We/b)-1)*b,gt=K>0?(Math.floor(ct/b)+1)*b:(Math.ceil(ct/b)-1)*b,dt=Math.abs(We-it),_t=Math.abs(ct-gt),ot=Math.abs(We-te),Nt=Math.abs(ct-he),Gt=we?dt/ae:Number.POSITIVE_INFINITY,Ht=Ne?_t/Ie:Number.POSITIVE_INFINITY;if((ot<=dt||!we)&&(Nt<=_t||!Ne))break;if(Gt<Ht&&we||!Ne){We=it,ct+=K*Gt;const Ot=new ie(We,Math.round(ct));I[I.length-1].x===Ot.x&&I[I.length-1].y===Ot.y||I.push(Ot)}else{We+=Se*Ht,ct=gt;const Ot=new ie(Math.round(We),ct);I[I.length-1].x===Ot.x&&I[I.length-1].y===Ot.y||I.push(Ot)}}const Xe=new ie(te,he);I[I.length-1].x===Xe.x&&I[I.length-1].y===Xe.y||I.push(Xe)}return I}function T5(c,s,u){if(s.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,_=c[2*s[0]];for(let k=1;k<s.length;k++){const R=c[2*s[k]];R<_&&(_=R,p=k)}const w=s.length;let b=p,I=(b+1)%w;for(;;){const k=b-1>=0?b-1:w-1,R=(I+1)%w,N=c[2*s[k]],B=c[2*s[R]],G=c[2*s[b]],X=c[2*s[b]+1],Y=c[2*s[I]+1];let te=!1;if(N<B)te=!0;else if(N>B)te=!1;else{const he=Y-X,we=-(c[2*s[I]]-G),Ne=X<Y?1:-1;((N-G)*he+(c[2*s[k]+1]-X)*we)*Ne>((B-G)*he+(c[2*s[R]+1]-X)*we)*Ne&&(te=!0)}if(te){const he=s[k],we=s[b],Ne=s[I];he!==we&&he!==Ne&&we!==Ne&&u.push(Ne,we,he),b--,b<0&&(b=w-1)}else{const he=s[R],we=s[b],Ne=s[I];he!==we&&he!==Ne&&we!==Ne&&u.push(Ne,we,he),I++,I>=w&&(I=0)}if(k===R)break}}function mS(c,s,u,p,_,w,b,I,k){const R=_.length/2,N=b&&I&&k;if(R<It.MAX_VERTEX_ARRAY_LENGTH){const B=s.prepareSegment(R,u,p),G=B.vertexLength;for(let te=0;te<w.length;te+=3)p.emplaceBack(G+w[te],G+w[te+1],G+w[te+2]);let X,Y;B.vertexLength+=R,B.primitiveLength+=w.length/3,N&&(Y=b.prepareSegment(R,u,I),X=Y.vertexLength,Y.vertexLength+=R);for(let te=0;te<_.length;te+=2)c(_[te],_[te+1]);if(N)for(let te=0;te<k.length;te++){const he=k[te];for(let we=1;we<he.length;we+=2)I.emplaceBack(X+he[we-1],X+he[we]);Y.primitiveLength+=he.length/2}}else(function(B,G,X,Y,te,he){const we=[];for(let Ie=0;Ie<Y.length/2;Ie++)we.push(-1);const Ne={count:0};let Se=0,K=B.getOrCreateLatestSegment(G,X),ae=K.vertexLength;for(let Ie=2;Ie<te.length;Ie+=3){const We=te[Ie-2],ct=te[Ie-1],Xe=te[Ie];let it=we[We]<Se,gt=we[ct]<Se,dt=we[Xe]<Se;K.vertexLength+((it?1:0)+(gt?1:0)+(dt?1:0))>It.MAX_VERTEX_ARRAY_LENGTH&&(K=B.createNewSegment(G,X),Se=Ne.count,it=!0,gt=!0,dt=!0,ae=0);const _t=cm(we,Y,he,Ne,We,it,K),ot=cm(we,Y,he,Ne,ct,gt,K),Nt=cm(we,Y,he,Ne,Xe,dt,K);X.emplaceBack(ae+_t-Se,ae+ot-Se,ae+Nt-Se),K.primitiveLength++}})(s,u,p,_,w,c),N&&function(B,G,X,Y,te,he){const we=[];for(let Ie=0;Ie<Y.length/2;Ie++)we.push(-1);const Ne={count:0};let Se=0,K=B.getOrCreateLatestSegment(G,X),ae=K.vertexLength;for(let Ie=0;Ie<te.length;Ie++){const We=te[Ie];for(let ct=1;ct<te[Ie].length;ct+=2){const Xe=We[ct-1],it=We[ct];let gt=we[Xe]<Se,dt=we[it]<Se;K.vertexLength+((gt?1:0)+(dt?1:0))>It.MAX_VERTEX_ARRAY_LENGTH&&(K=B.createNewSegment(G,X),Se=Ne.count,gt=!0,dt=!0,ae=0);const _t=cm(we,Y,he,Ne,Xe,gt,K),ot=cm(we,Y,he,Ne,it,dt,K);X.emplaceBack(ae+_t-Se,ae+ot-Se),K.primitiveLength++}}}(b,u,I,_,k,c),s.forceNewSegmentOnNextPrepare(),b==null||b.forceNewSegmentOnNextPrepare()}function cm(c,s,u,p,_,w,b){if(w){const I=p.count;return u(s[2*_],s[2*_+1]),c[_]=p.count,p.count++,b.vertexLength++,I}return c[_]}class cx{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new be,this.indexArray=new tt,this.indexArray2=new St,this.programConfigurations=new Bi(s.layers,s.zoom),this.segments=new It,this.segments2=new It,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,p){this.hasPattern=ox("fill",this.layers,u);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),b=[];for(const{feature:I,id:k,index:R,sourceLayerIndex:N}of s){const B=this.layers[0]._featureFilter.needGeometry,G=Zu(I,B);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),G,p))continue;const X=w?_.evaluate(G,{},p,u.availableImages):void 0,Y={id:k,properties:I.properties,type:I.type,sourceLayerIndex:N,index:R,geometry:B?G.geometry:Gu(I),patterns:{},sortKey:X};b.push(Y)}w&&b.sort((I,k)=>I.sortKey-k.sortKey);for(const I of b){const{geometry:k,index:R,sourceLayerIndex:N}=I;if(this.hasPattern){const B=ax("fill",this.layers,I,this.zoom,u);this.patternFeatures.push(B)}else this.addFeature(I,k,R,p,{},u.subdivisionGranularity);u.featureIndex.insert(s[R].feature,k,R,N,this.index)}}update(s,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,p)}addFeatures(s,u,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,p,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,d5),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,u,p,_,w,b){for(const I of qn(u,500)){const k=pS(I,_,b.fill.getGranularityForZoomLevel(_.z)),R=this.layoutVertexArray;mS((N,B)=>{R.emplaceBack(N,B)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles,this.segments2,this.indexArray2,k.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,w,_)}}let gS,_S;Rt("FillBucket",cx,{omit:["layers","patternFeatures"]});var S5={get paint(){return _S=_S||new qs({"fill-antialias":new Vt(pe.paint_fill["fill-antialias"]),"fill-opacity":new Kt(pe.paint_fill["fill-opacity"]),"fill-color":new Kt(pe.paint_fill["fill-color"]),"fill-outline-color":new Kt(pe.paint_fill["fill-outline-color"]),"fill-translate":new Vt(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vh(pe.paint_fill["fill-pattern"])})},get layout(){return gS=gS||new qs({"fill-sort-key":new Kt(pe.layout_fill["fill-sort-key"])})}};class E5 extends Na{constructor(s){super(s,S5)}recalculate(s,u){super.recalculate(s,u);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new cx(s)}queryRadius(){return P_(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:u,transform:p,pixelsToTileUnits:_}){return tm(C_(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,_),u)}isTileClipped(){return!0}}const I5=rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),P5=rr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:C5}=I5;var hx,yS,dx,vS,fx,xS,wS,R_={};function bS(){if(yS)return hx;yS=1;var c=U();function s(_,w,b,I,k){this.properties={},this.extent=b,this.type=0,this._pbf=_,this._geometry=-1,this._keys=I,this._values=k,_.readFields(u,this,w)}function u(_,w,b){_==1?w.id=b.readVarint():_==2?function(I,k){for(var R=I.readVarint()+I.pos;I.pos<R;){var N=k._keys[I.readVarint()],B=k._values[I.readVarint()];k.properties[N]=B}}(b,w):_==3?w.type=b.readVarint():_==4&&(w._geometry=b.pos)}function p(_){for(var w,b,I=0,k=0,R=_.length,N=R-1;k<R;N=k++)I+=((b=_[N]).x-(w=_[k]).x)*(w.y+b.y);return I}return hx=s,s.types=["Unknown","Point","LineString","Polygon"],s.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var w,b=_.readVarint()+_.pos,I=1,k=0,R=0,N=0,B=[];_.pos<b;){if(k<=0){var G=_.readVarint();I=7&G,k=G>>3}if(k--,I===1||I===2)R+=_.readSVarint(),N+=_.readSVarint(),I===1&&(w&&B.push(w),w=[]),w.push(new c(R,N));else{if(I!==7)throw new Error("unknown command "+I);w&&w.push(w[0].clone())}}return w&&B.push(w),B},s.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var w=_.readVarint()+_.pos,b=1,I=0,k=0,R=0,N=1/0,B=-1/0,G=1/0,X=-1/0;_.pos<w;){if(I<=0){var Y=_.readVarint();b=7&Y,I=Y>>3}if(I--,b===1||b===2)(k+=_.readSVarint())<N&&(N=k),k>B&&(B=k),(R+=_.readSVarint())<G&&(G=R),R>X&&(X=R);else if(b!==7)throw new Error("unknown command "+b)}return[N,G,B,X]},s.prototype.toGeoJSON=function(_,w,b){var I,k,R=this.extent*Math.pow(2,b),N=this.extent*_,B=this.extent*w,G=this.loadGeometry(),X=s.types[this.type];function Y(we){for(var Ne=0;Ne<we.length;Ne++){var Se=we[Ne];we[Ne]=[360*(Se.x+N)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*(Se.y+B)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(I=0;I<G.length;I++)te[I]=G[I][0];Y(G=te);break;case 2:for(I=0;I<G.length;I++)Y(G[I]);break;case 3:for(G=function(we){var Ne=we.length;if(Ne<=1)return[we];for(var Se,K,ae=[],Ie=0;Ie<Ne;Ie++){var We=p(we[Ie]);We!==0&&(K===void 0&&(K=We<0),K===We<0?(Se&&ae.push(Se),Se=[we[Ie]]):Se.push(we[Ie]))}return Se&&ae.push(Se),ae}(G),I=0;I<G.length;I++)for(k=0;k<G[I].length;k++)Y(G[I][k])}G.length===1?G=G[0]:X="Multi"+X;var he={type:"Feature",geometry:{type:X,coordinates:G},properties:this.properties};return"id"in this&&(he.id=this.id),he},hx}function TS(){if(vS)return dx;vS=1;var c=bS();function s(p,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(u,this,_),this.length=this._features.length}function u(p,_,w){p===15?_.version=w.readVarint():p===1?_.name=w.readString():p===5?_.extent=w.readVarint():p===2?_._features.push(w.pos):p===3?_._keys.push(w.readString()):p===4&&_._values.push(function(b){for(var I=null,k=b.readVarint()+b.pos;b.pos<k;){var R=b.readVarint()>>3;I=R===1?b.readString():R===2?b.readFloat():R===3?b.readDouble():R===4?b.readVarint64():R===5?b.readVarint():R===6?b.readSVarint():R===7?b.readBoolean():null}return I}(w))}return dx=s,s.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var _=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,_,this.extent,this._keys,this._values)},dx}function SS(){return wS||(wS=1,R_.VectorTile=function(){if(xS)return fx;xS=1;var c=TS();function s(u,p,_){if(u===3){var w=new c(_,_.readVarint()+_.pos);w.length&&(p[w.name]=w)}}return fx=function(u,p){this.layers=u.readFields(s,{},p)},fx}(),R_.VectorTileFeature=bS(),R_.VectorTileLayer=TS()),R_}var hm=S(SS());const A5=hm.VectorTileFeature.types,px=Math.pow(2,13);function dm(c,s,u,p,_,w,b,I){c.emplaceBack(s,u,2*Math.floor(p*px)+b,_*px*2,w*px*2,Math.round(I))}class mx{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ce,this.centroidVertexArray=new _e,this.indexArray=new tt,this.programConfigurations=new Bi(s.layers,s.zoom),this.segments=new It,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,p){this.features=[],this.hasPattern=ox("fill-extrusion",this.layers,u);for(const{feature:_,id:w,index:b,sourceLayerIndex:I}of s){const k=this.layers[0]._featureFilter.needGeometry,R=Zu(_,k);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),R,p))continue;const N={id:w,sourceLayerIndex:I,index:b,geometry:k?R.geometry:Gu(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(ax("fill-extrusion",this.layers,N,this.zoom,u)):this.addFeature(N,N.geometry,b,p,{},u.subdivisionGranularity),u.featureIndex.insert(_,N.geometry,b,I,this.index,!0)}}addFeatures(s,u,p){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,u,p,s.subdivisionGranularity)}}update(s,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,C5),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,P5.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,u,p,_,w,b){for(const I of qn(u,500)){const k={x:0,y:0,sampleCount:0},R=this.layoutVertexArray.length;this.processPolygon(k,_,s,I,b);const N=this.layoutVertexArray.length-R,B=Math.floor(k.x/k.sampleCount),G=Math.floor(k.y/k.sampleCount);for(let X=0;X<N;X++)this.centroidVertexArray.emplaceBack(B,G)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,w,_)}processPolygon(s,u,p,_,w){if(_.length<1||ES(_[0]))return;for(const B of _)B.length!==0&&k5(s,B);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},I=w.fill.getGranularityForZoomLevel(u.z),k=A5[p.type]==="Polygon";for(const B of _){if(B.length===0||ES(B))continue;const G=Xh(B,I,k);this._generateSideFaces(G,b)}if(!k)return;const R=pS(_,u,I,!1),N=this.layoutVertexArray;mS((B,G)=>{dm(N,B,G,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles)}_generateSideFaces(s,u){let p=0;for(let _=1;_<s.length;_++){const w=s[_],b=s[_-1];if(M5(w,b))continue;u.segment.vertexLength+4>It.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const I=w.sub(b)._perp()._unit(),k=b.dist(w);p+k>32768&&(p=0),dm(this.layoutVertexArray,w.x,w.y,I.x,I.y,0,0,p),dm(this.layoutVertexArray,w.x,w.y,I.x,I.y,0,1,p),p+=k,dm(this.layoutVertexArray,b.x,b.y,I.x,I.y,0,0,p),dm(this.layoutVertexArray,b.x,b.y,I.x,I.y,0,1,p);const R=u.segment.vertexLength;this.indexArray.emplaceBack(R,R+2,R+1),this.indexArray.emplaceBack(R+1,R+2,R+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function k5(c,s){for(let u=0;u<s.length;u++){const p=s[u];u===s.length-1&&s[0].x===p.x&&s[0].y===p.y||(c.x+=p.x,c.y+=p.y,c.sampleCount++)}}function M5(c,s){return c.x===s.x&&(c.x<0||c.x>Yt)||c.y===s.y&&(c.y<0||c.y>Yt)}function ES(c){return c.every(s=>s.x<0)||c.every(s=>s.x>Yt)||c.every(s=>s.y<0)||c.every(s=>s.y>Yt)}let IS;Rt("FillExtrusionBucket",mx,{omit:["layers","features"]});var R5={get paint(){return IS=IS||new qs({"fill-extrusion-opacity":new Vt(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vh(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class L5 extends Na{constructor(s){super(s,R5)}createBucket(s){return new mx(s)}queryRadius(){return P_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:u,featureState:p,geometry:_,transform:w,pixelsToTileUnits:b,pixelPosMatrix:I}){const k=C_(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-w.bearingInRadians,b),R=this.paint.get("fill-extrusion-height").evaluate(u,p),N=this.paint.get("fill-extrusion-base").evaluate(u,p),B=function(X,Y,te){const he=[];for(const we of X){const Ne=[we.x,we.y,0,1];Ve(Ne,Ne,Y),he.push(new ie(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return he}(k,I),G=function(X,Y,te,he){const we=[],Ne=[],Se=he[8]*Y,K=he[9]*Y,ae=he[10]*Y,Ie=he[11]*Y,We=he[8]*te,ct=he[9]*te,Xe=he[10]*te,it=he[11]*te;for(const gt of X){const dt=[],_t=[];for(const ot of gt){const Nt=ot.x,Gt=ot.y,Ht=he[0]*Nt+he[4]*Gt+he[12],Ot=he[1]*Nt+he[5]*Gt+he[13],Rn=he[2]*Nt+he[6]*Gt+he[14],Gi=he[3]*Nt+he[7]*Gt+he[15],wr=Rn+ae,os=Gi+Ie,ua=Ht+We,po=Ot+ct,Wr=Rn+Xe,Vi=Gi+it,Mr=new ie((Ht+Se)/os,(Ot+K)/os);Mr.z=wr/os,dt.push(Mr);const Kr=new ie(ua/Vi,po/Vi);Kr.z=Wr/Vi,_t.push(Kr)}we.push(dt),Ne.push(_t)}return[we,Ne]}(_,N,R,I);return function(X,Y,te){let he=1/0;tm(te,Y)&&(he=PS(te,Y[0]));for(let we=0;we<Y.length;we++){const Ne=Y[we],Se=X[we];for(let K=0;K<Ne.length-1;K++){const ae=Ne[K],Ie=[ae,Ne[K+1],Se[K+1],Se[K],ae];Jp(te,Ie)&&(he=Math.min(he,PS(te,Ie)))}}return he!==1/0&&he}(G[0],G[1],B)}}function fm(c,s){return c.x*s.x+c.y*s.y}function PS(c,s){if(c.length===1){let u=0;const p=s[u++];let _;for(;!_||p.equals(_);)if(_=s[u++],!_)return 1/0;for(;u<s.length;u++){const w=s[u],b=c[0],I=_.sub(p),k=w.sub(p),R=b.sub(p),N=fm(I,I),B=fm(I,k),G=fm(k,k),X=fm(R,I),Y=fm(R,k),te=N*G-B*B,he=(G*X-B*Y)/te,we=(N*Y-B*X)/te,Ne=p.z*(1-he-we)+_.z*he+w.z*we;if(isFinite(Ne))return Ne}return 1/0}{let u=1/0;for(const p of s)u=Math.min(u,p.z);return u}}const D5=rr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:z5}=D5,N5=rr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:O5}=N5,F5=hm.VectorTileFeature.types,B5=Math.cos(Math.PI/180*37.5),CS=Math.pow(2,14)/.5;class gx{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new Re,this.indexArray=new tt,this.programConfigurations=new Bi(s.layers,s.zoom),this.segments=new It,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,p){this.hasPattern=ox("line",this.layers,u);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),b=[];for(const{feature:I,id:k,index:R,sourceLayerIndex:N}of s){const B=this.layers[0]._featureFilter.needGeometry,G=Zu(I,B);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),G,p))continue;const X=w?_.evaluate(G,{},p):void 0,Y={id:k,properties:I.properties,type:I.type,sourceLayerIndex:N,index:R,geometry:B?G.geometry:Gu(I),patterns:{},sortKey:X};b.push(Y)}w&&b.sort((I,k)=>I.sortKey-k.sortKey);for(const I of b){const{geometry:k,index:R,sourceLayerIndex:N}=I;if(this.hasPattern){const B=ax("line",this.layers,I,this.zoom,u);this.patternFeatures.push(B)}else this.addFeature(I,k,R,p,{},u.subdivisionGranularity);u.featureIndex.insert(s[R].feature,k,R,N,this.index)}}update(s,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,p)}addFeatures(s,u,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,p,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,O5)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,z5),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,u,p,_,w,b){const I=this.layers[0].layout,k=I.get("line-join").evaluate(s,{}),R=I.get("line-cap"),N=I.get("line-miter-limit"),B=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const G of u)this.addLine(G,s,k,R,N,B,_,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,w,_)}addLine(s,u,p,_,w,b,I,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=Xh(s,I?k.line.getGranularityForZoomLevel(I.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Se=0;Se<s.length-1;Se++)this.totalDistance+=s[Se].dist(s[Se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R=F5[u.type]==="Polygon";let N=s.length;for(;N>=2&&s[N-1].equals(s[N-2]);)N--;let B=0;for(;B<N-1&&s[B].equals(s[B+1]);)B++;if(N<(R?3:2))return;p==="bevel"&&(w=1.05);const G=this.overscaling<=16?15*Yt/(512*this.overscaling):0,X=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let Y,te,he,we,Ne;this.e1=this.e2=-1,R&&(Y=s[N-2],Ne=s[B].sub(Y)._unit()._perp());for(let Se=B;Se<N;Se++){if(he=Se===N-1?R?s[B+1]:void 0:s[Se+1],he&&s[Se].equals(he))continue;Ne&&(we=Ne),Y&&(te=Y),Y=s[Se],Ne=he?he.sub(Y)._unit()._perp():we,we=we||Ne;let K=we.add(Ne);K.x===0&&K.y===0||K._unit();const ae=we.x*Ne.x+we.y*Ne.y,Ie=K.x*Ne.x+K.y*Ne.y,We=Ie!==0?1/Ie:1/0,ct=2*Math.sqrt(2-2*Ie),Xe=Ie<B5&&te&&he,it=we.x*Ne.y-we.y*Ne.x>0;if(Xe&&Se>B){const _t=Y.dist(te);if(_t>2*G){const ot=Y.sub(Y.sub(te)._mult(G/_t)._round());this.updateDistance(te,ot),this.addCurrentVertex(ot,we,0,0,X),te=ot}}const gt=te&&he;let dt=gt?p:R?"butt":_;if(gt&&dt==="round"&&(We<b?dt="miter":We<=2&&(dt="fakeround")),dt==="miter"&&We>w&&(dt="bevel"),dt==="bevel"&&(We>2&&(dt="flipbevel"),We<w&&(dt="miter")),te&&this.updateDistance(te,Y),dt==="miter")K._mult(We),this.addCurrentVertex(Y,K,0,0,X);else if(dt==="flipbevel"){if(We>100)K=Ne.mult(-1);else{const _t=We*we.add(Ne).mag()/we.sub(Ne).mag();K._perp()._mult(_t*(it?-1:1))}this.addCurrentVertex(Y,K,0,0,X),this.addCurrentVertex(Y,K.mult(-1),0,0,X)}else if(dt==="bevel"||dt==="fakeround"){const _t=-Math.sqrt(We*We-1),ot=it?_t:0,Nt=it?0:_t;if(te&&this.addCurrentVertex(Y,we,ot,Nt,X),dt==="fakeround"){const Gt=Math.round(180*ct/Math.PI/20);for(let Ht=1;Ht<Gt;Ht++){let Ot=Ht/Gt;if(Ot!==.5){const Gi=Ot-.5;Ot+=Ot*Gi*(Ot-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*Gi*Gi+(.848013+ae*(.215638*ae-1.06021)))}const Rn=Ne.sub(we)._mult(Ot)._add(we)._unit()._mult(it?-1:1);this.addHalfVertex(Y,Rn.x,Rn.y,!1,it,0,X)}}he&&this.addCurrentVertex(Y,Ne,-ot,-Nt,X)}else if(dt==="butt")this.addCurrentVertex(Y,K,0,0,X);else if(dt==="square"){const _t=te?1:-1;this.addCurrentVertex(Y,K,_t,_t,X)}else dt==="round"&&(te&&(this.addCurrentVertex(Y,we,0,0,X),this.addCurrentVertex(Y,we,1,1,X,!0)),he&&(this.addCurrentVertex(Y,Ne,-1,-1,X,!0),this.addCurrentVertex(Y,Ne,0,0,X)));if(Xe&&Se<N-1){const _t=Y.dist(he);if(_t>2*G){const ot=Y.add(he.sub(Y)._mult(G/_t)._round());this.updateDistance(Y,ot),this.addCurrentVertex(ot,Ne,0,0,X),Y=ot}}}}addCurrentVertex(s,u,p,_,w,b=!1){const I=u.y*_-u.x,k=-u.y-u.x*_;this.addHalfVertex(s,u.x+u.y*p,u.y-u.x*p,b,!1,p,w),this.addHalfVertex(s,I,k,b,!0,-_,w),this.distance>CS/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,u,p,_,w,b))}addHalfVertex({x:s,y:u},p,_,w,b,I,k){const R=.5*(this.lineClips?this.scaledDistance*(CS-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(w?1:0),(u<<1)+(b?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(I===0?0:I<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),k.primitiveLength++),b?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,u){this.distance+=s.dist(u),this.updateScaledDistance()}}let AS,kS;Rt("LineBucket",gx,{omit:["layers","patternFeatures"]});var MS={get paint(){return kS=kS||new qs({"line-opacity":new Kt(pe.paint_line["line-opacity"]),"line-color":new Kt(pe.paint_line["line-color"]),"line-translate":new Vt(pe.paint_line["line-translate"]),"line-translate-anchor":new Vt(pe.paint_line["line-translate-anchor"]),"line-width":new Kt(pe.paint_line["line-width"]),"line-gap-width":new Kt(pe.paint_line["line-gap-width"]),"line-offset":new Kt(pe.paint_line["line-offset"]),"line-blur":new Kt(pe.paint_line["line-blur"]),"line-dasharray":new tf(pe.paint_line["line-dasharray"]),"line-pattern":new Vh(pe.paint_line["line-pattern"]),"line-gradient":new nf(pe.paint_line["line-gradient"])})},get layout(){return AS=AS||new qs({"line-cap":new Vt(pe.layout_line["line-cap"]),"line-join":new Kt(pe.layout_line["line-join"]),"line-miter-limit":new Vt(pe.layout_line["line-miter-limit"]),"line-round-limit":new Vt(pe.layout_line["line-round-limit"]),"line-sort-key":new Kt(pe.layout_line["line-sort-key"])})}};class V5 extends Kt{possiblyEvaluate(s,u){return u=new zi(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(s,u)}evaluate(s,u,p,_){return u=Jt({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(s,u,p,_)}}let L_;class j5 extends Na{constructor(s){super(s,MS),this.gradientVersion=0,L_||(L_=new V5(MS.paint.properties["line-width"].specification),L_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Lo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,u){super.recalculate(s,u),this.paint._values["line-floorwidth"]=L_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new gx(s)}queryRadius(s){const u=s,p=RS(im("line-width",this,u),im("line-gap-width",this,u)),_=im("line-offset",this,u);return p/2+Math.abs(_)+P_(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:u,featureState:p,geometry:_,transform:w,pixelsToTileUnits:b}){const I=C_(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-w.bearingInRadians,b),k=b/2*RS(this.paint.get("line-width").evaluate(u,p),this.paint.get("line-gap-width").evaluate(u,p)),R=this.paint.get("line-offset").evaluate(u,p);return R&&(_=function(N,B){const G=[];for(let X=0;X<N.length;X++){const Y=N[X],te=[];for(let he=0;he<Y.length;he++){const we=Y[he-1],Ne=Y[he],Se=Y[he+1],K=he===0?new ie(0,0):Ne.sub(we)._unit()._perp(),ae=he===Y.length-1?new ie(0,0):Se.sub(Ne)._unit()._perp(),Ie=K._add(ae)._unit(),We=Ie.x*ae.x+Ie.y*ae.y;We!==0&&Ie._mult(1/We),te.push(Ie._mult(B)._add(Ne))}G.push(te)}return G}(_,R*b)),function(N,B,G){for(let X=0;X<B.length;X++){const Y=B[X];if(N.length>=3){for(let te=0;te<Y.length;te++)if(af(N,Y[te]))return!0}if(nm(N,Y,G))return!0}return!1}(I,_,k)}isTileClipped(){return!0}}function RS(c,s){return s>0?s+2*c:c}const U5=rr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$5=rr([{name:"a_projected_pos",components:3,type:"Float32"}],4);rr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const q5=rr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);rr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const LS=rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),H5=rr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function G5(c,s,u){return c.sections.forEach(p=>{p.text=function(_,w,b){const I=w.layout.get("text-transform").evaluate(b,{});return I==="uppercase"?_=_.toLocaleUpperCase():I==="lowercase"&&(_=_.toLocaleLowerCase()),yl.applyArabicShaping&&(_=yl.applyArabicShaping(_)),_}(p.text,s,u)}),c}rr([{name:"triangle",components:3,type:"Uint16"}]),rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),rr([{type:"Float32",name:"offsetX"}]),rr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),rr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var DS,_x,zS,xr=24,yx={};function Z5(){return DS||(DS=1,yx.read=function(c,s,u,p,_){var w,b,I=8*_-p-1,k=(1<<I)-1,R=k>>1,N=-7,B=u?_-1:0,G=u?-1:1,X=c[s+B];for(B+=G,w=X&(1<<-N)-1,X>>=-N,N+=I;N>0;w=256*w+c[s+B],B+=G,N-=8);for(b=w&(1<<-N)-1,w>>=-N,N+=p;N>0;b=256*b+c[s+B],B+=G,N-=8);if(w===0)w=1-R;else{if(w===k)return b?NaN:1/0*(X?-1:1);b+=Math.pow(2,p),w-=R}return(X?-1:1)*b*Math.pow(2,w-p)},yx.write=function(c,s,u,p,_,w){var b,I,k,R=8*w-_-1,N=(1<<R)-1,B=N>>1,G=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=p?0:w-1,Y=p?1:-1,te=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(I=isNaN(s)?1:0,b=N):(b=Math.floor(Math.log(s)/Math.LN2),s*(k=Math.pow(2,-b))<1&&(b--,k*=2),(s+=b+B>=1?G/k:G*Math.pow(2,1-B))*k>=2&&(b++,k/=2),b+B>=N?(I=0,b=N):b+B>=1?(I=(s*k-1)*Math.pow(2,_),b+=B):(I=s*Math.pow(2,B-1)*Math.pow(2,_),b=0));_>=8;c[u+X]=255&I,X+=Y,I/=256,_-=8);for(b=b<<_|I,R+=_;R>0;c[u+X]=255&b,X+=Y,b/=256,R-=8);c[u+X-Y]|=128*te}),yx}function NS(){if(zS)return _x;zS=1,_x=s;var c=Z5();function s(K){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(K)?K:new Uint8Array(K||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var u=4294967296,p=1/u,_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function w(K){return K.type===s.Bytes?K.readVarint()+K.pos:K.pos+1}function b(K,ae,Ie){return Ie?4294967296*ae+(K>>>0):4294967296*(ae>>>0)+(K>>>0)}function I(K,ae,Ie){var We=ae<=16383?1:ae<=2097151?2:ae<=268435455?3:Math.floor(Math.log(ae)/(7*Math.LN2));Ie.realloc(We);for(var ct=Ie.pos-1;ct>=K;ct--)Ie.buf[ct+We]=Ie.buf[ct]}function k(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeVarint(K[Ie])}function R(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeSVarint(K[Ie])}function N(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeFloat(K[Ie])}function B(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeDouble(K[Ie])}function G(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeBoolean(K[Ie])}function X(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeFixed32(K[Ie])}function Y(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeSFixed32(K[Ie])}function te(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeFixed64(K[Ie])}function he(K,ae){for(var Ie=0;Ie<K.length;Ie++)ae.writeSFixed64(K[Ie])}function we(K,ae){return(K[ae]|K[ae+1]<<8|K[ae+2]<<16)+16777216*K[ae+3]}function Ne(K,ae,Ie){K[Ie]=ae,K[Ie+1]=ae>>>8,K[Ie+2]=ae>>>16,K[Ie+3]=ae>>>24}function Se(K,ae){return(K[ae]|K[ae+1]<<8|K[ae+2]<<16)+(K[ae+3]<<24)}return s.prototype={destroy:function(){this.buf=null},readFields:function(K,ae,Ie){for(Ie=Ie||this.length;this.pos<Ie;){var We=this.readVarint(),ct=We>>3,Xe=this.pos;this.type=7&We,K(ct,ae,this),this.pos===Xe&&this.skip(We)}return ae},readMessage:function(K,ae){return this.readFields(K,ae,this.readVarint()+this.pos)},readFixed32:function(){var K=we(this.buf,this.pos);return this.pos+=4,K},readSFixed32:function(){var K=Se(this.buf,this.pos);return this.pos+=4,K},readFixed64:function(){var K=we(this.buf,this.pos)+we(this.buf,this.pos+4)*u;return this.pos+=8,K},readSFixed64:function(){var K=we(this.buf,this.pos)+Se(this.buf,this.pos+4)*u;return this.pos+=8,K},readFloat:function(){var K=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,K},readDouble:function(){var K=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,K},readVarint:function(K){var ae,Ie,We=this.buf;return ae=127&(Ie=We[this.pos++]),Ie<128?ae:(ae|=(127&(Ie=We[this.pos++]))<<7,Ie<128?ae:(ae|=(127&(Ie=We[this.pos++]))<<14,Ie<128?ae:(ae|=(127&(Ie=We[this.pos++]))<<21,Ie<128?ae:function(ct,Xe,it){var gt,dt,_t=it.buf;if(gt=(112&(dt=_t[it.pos++]))>>4,dt<128||(gt|=(127&(dt=_t[it.pos++]))<<3,dt<128)||(gt|=(127&(dt=_t[it.pos++]))<<10,dt<128)||(gt|=(127&(dt=_t[it.pos++]))<<17,dt<128)||(gt|=(127&(dt=_t[it.pos++]))<<24,dt<128)||(gt|=(1&(dt=_t[it.pos++]))<<31,dt<128))return b(ct,gt,Xe);throw new Error("Expected varint not more than 10 bytes")}(ae|=(15&(Ie=We[this.pos]))<<28,K,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var K=this.readVarint();return K%2==1?(K+1)/-2:K/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var K=this.readVarint()+this.pos,ae=this.pos;return this.pos=K,K-ae>=12&&_?function(Ie,We,ct){return _.decode(Ie.subarray(We,ct))}(this.buf,ae,K):function(Ie,We,ct){for(var Xe="",it=We;it<ct;){var gt,dt,_t,ot=Ie[it],Nt=null,Gt=ot>239?4:ot>223?3:ot>191?2:1;if(it+Gt>ct)break;Gt===1?ot<128&&(Nt=ot):Gt===2?(192&(gt=Ie[it+1]))==128&&(Nt=(31&ot)<<6|63&gt)<=127&&(Nt=null):Gt===3?(dt=Ie[it+2],(192&(gt=Ie[it+1]))==128&&(192&dt)==128&&((Nt=(15&ot)<<12|(63&gt)<<6|63&dt)<=2047||Nt>=55296&&Nt<=57343)&&(Nt=null)):Gt===4&&(dt=Ie[it+2],_t=Ie[it+3],(192&(gt=Ie[it+1]))==128&&(192&dt)==128&&(192&_t)==128&&((Nt=(15&ot)<<18|(63&gt)<<12|(63&dt)<<6|63&_t)<=65535||Nt>=1114112)&&(Nt=null)),Nt===null?(Nt=65533,Gt=1):Nt>65535&&(Nt-=65536,Xe+=String.fromCharCode(Nt>>>10&1023|55296),Nt=56320|1023&Nt),Xe+=String.fromCharCode(Nt),it+=Gt}return Xe}(this.buf,ae,K)},readBytes:function(){var K=this.readVarint()+this.pos,ae=this.buf.subarray(this.pos,K);return this.pos=K,ae},readPackedVarint:function(K,ae){if(this.type!==s.Bytes)return K.push(this.readVarint(ae));var Ie=w(this);for(K=K||[];this.pos<Ie;)K.push(this.readVarint(ae));return K},readPackedSVarint:function(K){if(this.type!==s.Bytes)return K.push(this.readSVarint());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readSVarint());return K},readPackedBoolean:function(K){if(this.type!==s.Bytes)return K.push(this.readBoolean());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readBoolean());return K},readPackedFloat:function(K){if(this.type!==s.Bytes)return K.push(this.readFloat());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readFloat());return K},readPackedDouble:function(K){if(this.type!==s.Bytes)return K.push(this.readDouble());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readDouble());return K},readPackedFixed32:function(K){if(this.type!==s.Bytes)return K.push(this.readFixed32());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readFixed32());return K},readPackedSFixed32:function(K){if(this.type!==s.Bytes)return K.push(this.readSFixed32());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readSFixed32());return K},readPackedFixed64:function(K){if(this.type!==s.Bytes)return K.push(this.readFixed64());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readFixed64());return K},readPackedSFixed64:function(K){if(this.type!==s.Bytes)return K.push(this.readSFixed64());var ae=w(this);for(K=K||[];this.pos<ae;)K.push(this.readSFixed64());return K},skip:function(K){var ae=7&K;if(ae===s.Varint)for(;this.buf[this.pos++]>127;);else if(ae===s.Bytes)this.pos=this.readVarint()+this.pos;else if(ae===s.Fixed32)this.pos+=4;else{if(ae!==s.Fixed64)throw new Error("Unimplemented type: "+ae);this.pos+=8}},writeTag:function(K,ae){this.writeVarint(K<<3|ae)},realloc:function(K){for(var ae=this.length||16;ae<this.pos+K;)ae*=2;if(ae!==this.length){var Ie=new Uint8Array(ae);Ie.set(this.buf),this.buf=Ie,this.length=ae}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(K){this.realloc(4),Ne(this.buf,K,this.pos),this.pos+=4},writeSFixed32:function(K){this.realloc(4),Ne(this.buf,K,this.pos),this.pos+=4},writeFixed64:function(K){this.realloc(8),Ne(this.buf,-1&K,this.pos),Ne(this.buf,Math.floor(K*p),this.pos+4),this.pos+=8},writeSFixed64:function(K){this.realloc(8),Ne(this.buf,-1&K,this.pos),Ne(this.buf,Math.floor(K*p),this.pos+4),this.pos+=8},writeVarint:function(K){(K=+K||0)>268435455||K<0?function(ae,Ie){var We,ct;if(ae>=0?(We=ae%4294967296|0,ct=ae/4294967296|0):(ct=~(-ae/4294967296),4294967295^(We=~(-ae%4294967296))?We=We+1|0:(We=0,ct=ct+1|0)),ae>=18446744073709552e3||ae<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ie.realloc(10),function(Xe,it,gt){gt.buf[gt.pos++]=127&Xe|128,Xe>>>=7,gt.buf[gt.pos++]=127&Xe|128,Xe>>>=7,gt.buf[gt.pos++]=127&Xe|128,Xe>>>=7,gt.buf[gt.pos++]=127&Xe|128,gt.buf[gt.pos]=127&(Xe>>>=7)}(We,0,Ie),function(Xe,it){var gt=(7&Xe)<<4;it.buf[it.pos++]|=gt|((Xe>>>=3)?128:0),Xe&&(it.buf[it.pos++]=127&Xe|((Xe>>>=7)?128:0),Xe&&(it.buf[it.pos++]=127&Xe|((Xe>>>=7)?128:0),Xe&&(it.buf[it.pos++]=127&Xe|((Xe>>>=7)?128:0),Xe&&(it.buf[it.pos++]=127&Xe|((Xe>>>=7)?128:0),Xe&&(it.buf[it.pos++]=127&Xe)))))}(ct,Ie)}(K,this):(this.realloc(4),this.buf[this.pos++]=127&K|(K>127?128:0),K<=127||(this.buf[this.pos++]=127&(K>>>=7)|(K>127?128:0),K<=127||(this.buf[this.pos++]=127&(K>>>=7)|(K>127?128:0),K<=127||(this.buf[this.pos++]=K>>>7&127))))},writeSVarint:function(K){this.writeVarint(K<0?2*-K-1:2*K)},writeBoolean:function(K){this.writeVarint(!!K)},writeString:function(K){K=String(K),this.realloc(4*K.length),this.pos++;var ae=this.pos;this.pos=function(We,ct,Xe){for(var it,gt,dt=0;dt<ct.length;dt++){if((it=ct.charCodeAt(dt))>55295&&it<57344){if(!gt){it>56319||dt+1===ct.length?(We[Xe++]=239,We[Xe++]=191,We[Xe++]=189):gt=it;continue}if(it<56320){We[Xe++]=239,We[Xe++]=191,We[Xe++]=189,gt=it;continue}it=gt-55296<<10|it-56320|65536,gt=null}else gt&&(We[Xe++]=239,We[Xe++]=191,We[Xe++]=189,gt=null);it<128?We[Xe++]=it:(it<2048?We[Xe++]=it>>6|192:(it<65536?We[Xe++]=it>>12|224:(We[Xe++]=it>>18|240,We[Xe++]=it>>12&63|128),We[Xe++]=it>>6&63|128),We[Xe++]=63&it|128)}return Xe}(this.buf,K,this.pos);var Ie=this.pos-ae;Ie>=128&&I(ae,Ie,this),this.pos=ae-1,this.writeVarint(Ie),this.pos+=Ie},writeFloat:function(K){this.realloc(4),c.write(this.buf,K,this.pos,!0,23,4),this.pos+=4},writeDouble:function(K){this.realloc(8),c.write(this.buf,K,this.pos,!0,52,8),this.pos+=8},writeBytes:function(K){var ae=K.length;this.writeVarint(ae),this.realloc(ae);for(var Ie=0;Ie<ae;Ie++)this.buf[this.pos++]=K[Ie]},writeRawMessage:function(K,ae){this.pos++;var Ie=this.pos;K(ae,this);var We=this.pos-Ie;We>=128&&I(Ie,We,this),this.pos=Ie-1,this.writeVarint(We),this.pos+=We},writeMessage:function(K,ae,Ie){this.writeTag(K,s.Bytes),this.writeRawMessage(ae,Ie)},writePackedVarint:function(K,ae){ae.length&&this.writeMessage(K,k,ae)},writePackedSVarint:function(K,ae){ae.length&&this.writeMessage(K,R,ae)},writePackedBoolean:function(K,ae){ae.length&&this.writeMessage(K,G,ae)},writePackedFloat:function(K,ae){ae.length&&this.writeMessage(K,N,ae)},writePackedDouble:function(K,ae){ae.length&&this.writeMessage(K,B,ae)},writePackedFixed32:function(K,ae){ae.length&&this.writeMessage(K,X,ae)},writePackedSFixed32:function(K,ae){ae.length&&this.writeMessage(K,Y,ae)},writePackedFixed64:function(K,ae){ae.length&&this.writeMessage(K,te,ae)},writePackedSFixed64:function(K,ae){ae.length&&this.writeMessage(K,he,ae)},writeBytesField:function(K,ae){this.writeTag(K,s.Bytes),this.writeBytes(ae)},writeFixed32Field:function(K,ae){this.writeTag(K,s.Fixed32),this.writeFixed32(ae)},writeSFixed32Field:function(K,ae){this.writeTag(K,s.Fixed32),this.writeSFixed32(ae)},writeFixed64Field:function(K,ae){this.writeTag(K,s.Fixed64),this.writeFixed64(ae)},writeSFixed64Field:function(K,ae){this.writeTag(K,s.Fixed64),this.writeSFixed64(ae)},writeVarintField:function(K,ae){this.writeTag(K,s.Varint),this.writeVarint(ae)},writeSVarintField:function(K,ae){this.writeTag(K,s.Varint),this.writeSVarint(ae)},writeStringField:function(K,ae){this.writeTag(K,s.Bytes),this.writeString(ae)},writeFloatField:function(K,ae){this.writeTag(K,s.Fixed32),this.writeFloat(ae)},writeDoubleField:function(K,ae){this.writeTag(K,s.Fixed64),this.writeDouble(ae)},writeBooleanField:function(K,ae){this.writeVarintField(K,!!ae)}},_x}var vx=S(NS());const xx=3;function W5(c,s,u){c===1&&u.readMessage(K5,s)}function K5(c,s,u){if(c===3){const{id:p,bitmap:_,width:w,height:b,left:I,top:k,advance:R}=u.readMessage(X5,{});s.push({id:p,bitmap:new rm({width:w+2*xx,height:b+2*xx},_),metrics:{width:w,height:b,left:I,top:k,advance:R}})}}function X5(c,s,u){c===1?s.id=u.readVarint():c===2?s.bitmap=u.readBytes():c===3?s.width=u.readVarint():c===4?s.height=u.readVarint():c===5?s.left=u.readSVarint():c===6?s.top=u.readSVarint():c===7&&(s.advance=u.readVarint())}const Y5=xx;function OS(c){let s=0,u=0;for(const b of c)s+=b.w*b.h,u=Math.max(u,b.w);c.sort((b,I)=>I.h-b.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let _=0,w=0;for(const b of c)for(let I=p.length-1;I>=0;I--){const k=p[I];if(!(b.w>k.w||b.h>k.h)){if(b.x=k.x,b.y=k.y,w=Math.max(w,b.y+b.h),_=Math.max(_,b.x+b.w),b.w===k.w&&b.h===k.h){const R=p.pop();I<p.length&&(p[I]=R)}else b.h===k.h?(k.x+=b.w,k.w-=b.w):b.w===k.w?(k.y+=b.h,k.h-=b.h):(p.push({x:k.x+b.w,y:k.y,w:k.w-b.w,h:b.h}),k.y+=b.h,k.h-=b.h);break}}return{w:_,h:w,fill:s/(_*w)||0}}const fo=1;class wx{constructor(s,{pixelRatio:u,version:p,stretchX:_,stretchY:w,content:b,textFitWidth:I,textFitHeight:k}){this.paddedRect=s,this.pixelRatio=u,this.stretchX=_,this.stretchY=w,this.content=b,this.version=p,this.textFitWidth=I,this.textFitHeight=k}get tl(){return[this.paddedRect.x+fo,this.paddedRect.y+fo]}get br(){return[this.paddedRect.x+this.paddedRect.w-fo,this.paddedRect.y+this.paddedRect.h-fo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*fo)/this.pixelRatio,(this.paddedRect.h-2*fo)/this.pixelRatio]}}class FS{constructor(s,u){const p={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(s,p,w),this.addImages(u,_,w);const{w:b,h:I}=OS(w),k=new aa({width:b||1,height:I||1});for(const R in s){const N=s[R],B=p[R].paddedRect;aa.copy(N.data,k,{x:0,y:0},{x:B.x+fo,y:B.y+fo},N.data)}for(const R in u){const N=u[R],B=_[R].paddedRect,G=B.x+fo,X=B.y+fo,Y=N.data.width,te=N.data.height;aa.copy(N.data,k,{x:0,y:0},{x:G,y:X},N.data),aa.copy(N.data,k,{x:0,y:te-1},{x:G,y:X-1},{width:Y,height:1}),aa.copy(N.data,k,{x:0,y:0},{x:G,y:X+te},{width:Y,height:1}),aa.copy(N.data,k,{x:Y-1,y:0},{x:G-1,y:X},{width:1,height:te}),aa.copy(N.data,k,{x:0,y:0},{x:G+Y,y:X},{width:1,height:te})}this.image=k,this.iconPositions=p,this.patternPositions=_}addImages(s,u,p){for(const _ in s){const w=s[_],b={x:0,y:0,w:w.data.width+2*fo,h:w.data.height+2*fo};p.push(b),u[_]=new wx(b,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(s,u){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in s.updatedImages)this.patchUpdatedImage(this.iconPositions[p],s.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],s.getImage(p),u)}patchUpdatedImage(s,u,p){if(!s||!u||s.version===u.version)return;s.version=u.version;const[_,w]=s.tl;p.update(u.data,void 0,{x:_,y:w})}}var Oc;Rt("ImagePosition",wx),Rt("ImageAtlas",FS),f.ai=void 0,(Oc=f.ai||(f.ai={}))[Oc.none=0]="none",Oc[Oc.horizontal=1]="horizontal",Oc[Oc.vertical=2]="vertical",Oc[Oc.horizontalOnly=3]="horizontalOnly";const D_=-17;class mm{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(s,u,p){const _=new mm;return _.scale=s||1,_.fontStack=u,_.verticalAlign=p||"bottom",_}static forImage(s,u){const p=new mm;return p.imageName=s,p.verticalAlign=u||"bottom",p}}class hf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u){const p=new hf;for(let _=0;_<s.sections.length;_++){const w=s.sections[_];w.image?p.addImageSection(w):p.addTextSection(w,u)}return p}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let u="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,w=s.charCodeAt(p-1)||null;u+=_&&__(_)&&!pm[s[p+1]]||w&&__(w)&&!pm[s[p-1]]||!pm[s[p]]?s[p]:pm[s[p]]}return u}(this.text)}trim(){let s=0;for(let p=0;p<this.text.length&&N_[this.text.charCodeAt(p)];p++)s++;let u=this.text.length;for(let p=this.text.length-1;p>=0&&p>=s&&N_[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const p=new hf;return p.text=this.text.substring(s,u),p.sectionIndex=this.sectionIndex.slice(s,u),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}getMaxImageSize(s){let u=0,p=0;for(let _=0;_<this.length();_++){const w=this.getSection(_);if(w.imageName){const b=s[w.imageName];if(!b)continue;const I=b.displaySize;u=Math.max(u,I[0]),p=Math.max(p,I[1])}}return{maxImageWidth:u,maxImageHeight:p}}addTextSection(s,u){this.text+=s.text,this.sections.push(mm.forText(s.scale,s.fontStack||u,s.verticalAlign));const p=this.sections.length-1;for(let _=0;_<s.text.length;++_)this.sectionIndex.push(p)}addImageSection(s){const u=s.image?s.image.name:"";if(u.length===0)return void ki("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(mm.forImage(u,s.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function z_(c,s,u,p,_,w,b,I,k,R,N,B,G,X,Y){const te=hf.fromFeature(c,_);let he;B===f.ai.vertical&&te.verticalizePunctuation();const{processBidirectionalText:we,processStyledBidirectionalText:Ne}=yl;if(we&&te.sections.length===1){he=[];const ae=we(te.toString(),bx(te,R,w,s,p,X));for(const Ie of ae){const We=new hf;We.text=Ie,We.sections=te.sections;for(let ct=0;ct<Ie.length;ct++)We.sectionIndex.push(0);he.push(We)}}else if(Ne){he=[];const ae=Ne(te.text,te.sectionIndex,bx(te,R,w,s,p,X));for(const Ie of ae){const We=new hf;We.text=Ie[0],We.sectionIndex=Ie[1],We.sections=te.sections,he.push(We)}}else he=function(ae,Ie){const We=[],ct=ae.text;let Xe=0;for(const it of Ie)We.push(ae.substring(Xe,it)),Xe=it;return Xe<ct.length&&We.push(ae.substring(Xe,ct.length)),We}(te,bx(te,R,w,s,p,X));const Se=[],K={positionedLines:Se,text:te.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(ae,Ie,We,ct,Xe,it,gt,dt,_t,ot,Nt,Gt){let Ht=0,Ot=0,Rn=0,Gi=0;const wr=dt==="right"?1:dt==="left"?0:.5,os=xr/Gt;let ua=0;for(const Vi of Xe){Vi.trim();const Mr=Vi.getMaxScale(),Kr={positionedGlyphs:[],lineOffset:0};ae.positionedLines[ua]=Kr;const Xr=Kr.positionedGlyphs;let Gs=0;if(!Vi.length()){Ot+=it,++ua;continue}const ca=tN(ct,Vi,os);for(let mo=0;mo<Vi.length();mo++){const br=Vi.getSection(mo),Lr=Vi.getSectionIndex(mo),Dr=Vi.getCharCode(mo),mr=nN(_t,Nt,Dr);let Pi;if(br.imageName){if(ae.iconsInText=!0,br.scale=br.scale*os,Pi=rN(br,mr,Mr,ca,ct),!Pi)continue;Gs=Math.max(Gs,Pi.imageOffset)}else if(Pi=iN(br,Dr,mr,ca,Ie,We),!Pi)continue;const{rect:bl,metrics:mf,baselineOffset:Tl}=Pi;Xr.push({glyph:Dr,imageName:br.imageName,x:Ht,y:Ot+Tl+D_,vertical:mr,scale:br.scale,fontStack:br.fontStack,sectionIndex:Lr,metrics:mf,rect:bl}),mr?(ae.verticalizable=!0,Ht+=(br.imageName?mf.advance:xr)*br.scale+ot):Ht+=mf.advance*br.scale+ot}Xr.length!==0&&(Rn=Math.max(Ht-ot,Rn),sN(Xr,0,Xr.length-1,wr)),Ht=0,Kr.lineOffset=Math.max(Gs,(Mr-1)*xr);const Rr=it*Mr+Gs;Ot+=Rr,Gi=Math.max(Rr,Gi),++ua}const{horizontalAlign:po,verticalAlign:Wr}=Tx(gt);(function(Vi,Mr,Kr,Xr,Gs,ca,Rr,mo,br){const Lr=(Mr-Kr)*Gs;let Dr=0;Dr=ca!==Rr?-mo*Xr-D_:-Xr*br*Rr+.5*Rr;for(const mr of Vi)for(const Pi of mr.positionedGlyphs)Pi.x+=Lr,Pi.y+=Dr})(ae.positionedLines,wr,po,Wr,Rn,Gi,it,Ot,Xe.length),ae.top+=-Wr*Ot,ae.bottom=ae.top+Ot,ae.left+=-po*Rn,ae.right=ae.left+Rn}(K,s,u,p,he,b,I,k,B,R,G,Y),!function(ae){for(const Ie of ae)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(Se)&&K}const N_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Q5={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},J5={40:!0};function BS(c,s,u,p,_,w){if(s.imageName){const b=p[s.imageName];return b?b.displaySize[0]*s.scale*xr/w+_:0}{const b=u[s.fontStack],I=b&&b[c];return I?I.metrics.advance*s.scale+_:0}}function VS(c,s,u,p){const _=Math.pow(c-s,2);return p?c<s?_/2:2*_:_+Math.abs(u)*u}function eN(c,s,u){let p=0;return c===10&&(p-=1e4),u&&(p+=150),c!==40&&c!==65288||(p+=50),s!==41&&s!==65289||(p+=50),p}function jS(c,s,u,p,_,w){let b=null,I=VS(s,u,_,w);for(const k of p){const R=VS(s-k.x,u,_,w)+k.badness;R<=I&&(b=k,I=R)}return{index:c,x:s,priorBreak:b,badness:I}}function US(c){return c?US(c.priorBreak).concat(c.index):[]}function bx(c,s,u,p,_,w){if(!c)return[];const b=[],I=function(B,G,X,Y,te,he){let we=0;for(let Ne=0;Ne<B.length();Ne++){const Se=B.getSection(Ne);we+=BS(B.getCharCode(Ne),Se,Y,te,G,he)}return we/Math.max(1,Math.ceil(we/X))}(c,s,u,p,_,w),k=c.text.indexOf("")>=0;let R=0;for(let B=0;B<c.length();B++){const G=c.getSection(B),X=c.getCharCode(B);if(N_[X]||(R+=BS(X,G,p,_,s,w)),B<c.length()-1){const Y=!((N=X)<11904)&&(!!Pn["CJK Compatibility Forms"](N)||!!Pn["CJK Compatibility"](N)||!!Pn["CJK Strokes"](N)||!!Pn["CJK Symbols and Punctuation"](N)||!!Pn["Enclosed CJK Letters and Months"](N)||!!Pn["Halfwidth and Fullwidth Forms"](N)||!!Pn["Ideographic Description Characters"](N)||!!Pn["Vertical Forms"](N)||Xd.test(String.fromCodePoint(N)));(Q5[X]||Y||G.imageName||B!==c.length()-2&&J5[c.getCharCode(B+1)])&&b.push(jS(B+1,R,I,b,eN(X,c.getCharCode(B+1),Y&&k),!1))}}var N;return US(jS(c.length(),R,I,b,0,!0))}function Tx(c){let s=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function tN(c,s,u){const p=s.getMaxScale()*xr,{maxImageWidth:_,maxImageHeight:w}=s.getMaxImageSize(c),b=Math.max(p,w*u);return{verticalLineContentWidth:Math.max(p,_*u),horizontalLineContentHeight:b}}function $S(c){switch(c){case"top":return 0;case"center":return .5;default:return 1}}function nN(c,s,u){return!(c===f.ai.horizontal||!s&&!Yd(u)||s&&(N_[u]||(p=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function iN(c,s,u,p,_,w){const b=w[c.fontStack],I=function(R,N,B,G){if(R&&R.rect)return R;const X=N[B.fontStack],Y=X&&X[G];return Y?{rect:null,metrics:Y.metrics}:null}(b&&b[s],_,c,s);if(I===null)return null;let k;if(u)k=p.verticalLineContentWidth-c.scale*xr;else{const R=$S(c.verticalAlign);k=(p.horizontalLineContentHeight-c.scale*xr)*R}return{rect:I.rect,metrics:I.metrics,baselineOffset:k}}function rN(c,s,u,p,_){const w=_[c.imageName];if(!w)return null;const b=w.paddedRect,I=w.displaySize,k={width:I[0],height:I[1],left:fo,top:-3,advance:s?I[1]:I[0]};let R;if(s)R=p.verticalLineContentWidth-I[1]*c.scale;else{const N=$S(c.verticalAlign);R=(p.horizontalLineContentHeight-I[1]*c.scale)*N}return{rect:b,metrics:k,baselineOffset:R,imageOffset:(s?I[0]:I[1])*c.scale-xr*u}}function sN(c,s,u,p){if(p===0)return;const _=c[u],w=(c[u].x+_.metrics.advance*_.scale)*p;for(let b=s;b<=u;b++)c[b].x-=w}function oN(c,s,u){const{horizontalAlign:p,verticalAlign:_}=Tx(u),w=s[0]-c.displaySize[0]*p,b=s[1]-c.displaySize[1]*_;return{image:c,top:b,bottom:b+c.displaySize[1],left:w,right:w+c.displaySize[0]}}function qS(c){var s,u;let p=c.left,_=c.top,w=c.right-p,b=c.bottom-_;const I=(s=c.image.textFitWidth)!==null&&s!==void 0?s:"stretchOrShrink",k=(u=c.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",R=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(k==="proportional"){if(I==="stretchOnly"&&w/b<R||I==="proportional"){const N=Math.ceil(b*R);p*=N/w,w=N}}else if(I==="proportional"&&k==="stretchOnly"&&R!==0&&w/b>R){const N=Math.ceil(w/R);_*=N/b,b=N}return{x1:p,y1:_,x2:p+w,y2:_+b}}function HS(c,s,u,p,_,w){const b=c.image;let I;if(b.content){const he=b.content,we=b.pixelRatio||1;I=[he[0]/we,he[1]/we,b.displaySize[0]-he[2]/we,b.displaySize[1]-he[3]/we]}const k=s.left*w,R=s.right*w;let N,B,G,X;u==="width"||u==="both"?(X=_[0]+k-p[3],B=_[0]+R+p[1]):(X=_[0]+(k+R-b.displaySize[0])/2,B=X+b.displaySize[0]);const Y=s.top*w,te=s.bottom*w;return u==="height"||u==="both"?(N=_[1]+Y-p[0],G=_[1]+te+p[2]):(N=_[1]+(Y+te-b.displaySize[1])/2,G=N+b.displaySize[1]),{image:b,top:N,right:B,bottom:G,left:X,collisionPadding:I}}const gm=255,ru=128,Fc=gm*ru;function GS(c,s){const{expression:u}=s;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new zi(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=u;let w=0;for(;w<p.length&&p[w]<=c;)w++;w=Math.max(0,w-1);let b=w;for(;b<p.length&&p[b]<c+1;)b++;b=Math.min(p.length-1,b);const I=p[w],k=p[b];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:k,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:k,minSize:u.evaluate(new zi(I)),maxSize:u.evaluate(new zi(k)),interpolationType:_}}}function Sx(c,s,u){let p="never";const _=c.get(s);return _?p=_:c.get(u)&&(p="always"),p}const aN=hm.VectorTileFeature.types,lN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function O_(c,s,u,p,_,w,b,I,k,R,N,B,G){const X=I?Math.min(Fc,Math.round(I[0])):0,Y=I?Math.min(Fc,Math.round(I[1])):0;c.emplaceBack(s,u,Math.round(32*p),Math.round(32*_),w,b,(X<<1)+(k?1:0),Y,16*R,16*N,256*B,256*G)}function Ex(c,s,u){c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u)}function uN(c){for(const s of c.sections)if(w_(s.text))return!0;return!1}class Ix{constructor(s){this.layoutVertexArray=new De,this.indexArray=new tt,this.programConfigurations=s,this.segments=new It,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new Ke,this.hasVisibleVertices=!1,this.placedSymbolArray=new C}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,u,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,U5.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,$5.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,lN,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Rt("SymbolBuffers",Ix);class Px{constructor(s,u,p){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new p,this.segments=new It,this.collisionVertexArray=new at}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,q5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Rt("CollisionBuffers",Px);class df{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(b=>b.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=GS(this.zoom,u["text-size"]),this.iconSizeData=GS(this.zoom,u["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),w=p.get("symbol-z-order");this.canOverlap=Sx(p,"text-overlap","text-allow-overlap")!=="never"||Sx(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(b=>f.ai[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=s.sourceID}createArrays(){this.text=new Ix(new Bi(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Ix(new Bi(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new V,this.lineVertexArray=new q,this.symbolInstances=new z,this.textAnchorOffsets=new J}calculateGlyphDependencies(s,u,p,_,w){for(let b=0;b<s.length;b++)if(u[s.charCodeAt(b)]=!0,(p||_)&&w){const I=pm[s.charAt(b)];I&&(u[I.charCodeAt(0)]=!0)}}populate(s,u,p){const _=this.layers[0],w=_.layout,b=w.get("text-font"),I=w.get("text-field"),k=w.get("icon-image"),R=(I.value.kind!=="constant"||I.value.value instanceof Vn&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,B=w.get("symbol-sort-key");if(this.features=[],!R&&!N)return;const G=u.iconDependencies,X=u.glyphDependencies,Y=u.availableImages,te=new zi(this.zoom);for(const{feature:he,id:we,index:Ne,sourceLayerIndex:Se}of s){const K=_._featureFilter.needGeometry,ae=Zu(he,K);if(!_._featureFilter.filter(te,ae,p))continue;let Ie,We;if(K||(ae.geometry=Gu(he)),R){const Xe=_.getValueAndResolveTokens("text-field",ae,p,Y),it=Vn.factory(Xe),gt=this.hasRTLText=this.hasRTLText||uN(it);(!gt||yl.getRTLTextPluginStatus()==="unavailable"||gt&&yl.isParsed())&&(Ie=G5(it,_,ae))}if(N){const Xe=_.getValueAndResolveTokens("icon-image",ae,p,Y);We=Xe instanceof Yi?Xe:Yi.fromString(Xe)}if(!Ie&&!We)continue;const ct=this.sortFeaturesByKey?B.evaluate(ae,{},p):void 0;if(this.features.push({id:we,text:Ie,icon:We,index:Ne,sourceLayerIndex:Se,geometry:ae.geometry,properties:he.properties,type:aN[he.type],sortKey:ct}),We&&(G[We.name]=!0),Ie){const Xe=b.evaluate(ae,{},p).join(","),it=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ai.vertical)>=0;for(const gt of Ie.sections)if(gt.image)G[gt.image.name]=!0;else{const dt=Rc(Ie.toString()),_t=gt.fontStack||Xe,ot=X[_t]=X[_t]||{};this.calculateGlyphDependencies(gt.text,ot,it,this.allowVerticalPlacement,dt)}}}w.get("symbol-placement")==="line"&&(this.features=function(he){const we={},Ne={},Se=[];let K=0;function ae(Xe){Se.push(he[Xe]),K++}function Ie(Xe,it,gt){const dt=Ne[Xe];return delete Ne[Xe],Ne[it]=dt,Se[dt].geometry[0].pop(),Se[dt].geometry[0]=Se[dt].geometry[0].concat(gt[0]),dt}function We(Xe,it,gt){const dt=we[it];return delete we[it],we[Xe]=dt,Se[dt].geometry[0].shift(),Se[dt].geometry[0]=gt[0].concat(Se[dt].geometry[0]),dt}function ct(Xe,it,gt){const dt=gt?it[0][it[0].length-1]:it[0][0];return`${Xe}:${dt.x}:${dt.y}`}for(let Xe=0;Xe<he.length;Xe++){const it=he[Xe],gt=it.geometry,dt=it.text?it.text.toString():null;if(!dt){ae(Xe);continue}const _t=ct(dt,gt),ot=ct(dt,gt,!0);if(_t in Ne&&ot in we&&Ne[_t]!==we[ot]){const Nt=We(_t,ot,gt),Gt=Ie(_t,ot,Se[Nt].geometry);delete we[_t],delete Ne[ot],Ne[ct(dt,Se[Gt].geometry,!0)]=Gt,Se[Nt].geometry=null}else _t in Ne?Ie(_t,ot,gt):ot in we?We(_t,ot,gt):(ae(Xe),we[_t]=K-1,Ne[ot]=K-1)}return Se.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((he,we)=>he.sortKey-we.sortKey)}update(s,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const p=this.lineVertexArray.length;if(s.segment!==void 0){let _=s.dist(u[s.segment+1]),w=s.dist(u[s.segment]);const b={};for(let I=s.segment+1;I<u.length;I++)b[I]={x:u[I].x,y:u[I].y,tileUnitDistanceFromAnchor:_},I<u.length-1&&(_+=u[I+1].dist(u[I]));for(let I=s.segment||0;I>=0;I--)b[I]={x:u[I].x,y:u[I].y,tileUnitDistanceFromAnchor:w},I>0&&(w+=u[I-1].dist(u[I]));for(let I=0;I<u.length;I++){const k=b[I];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(s,u,p,_,w,b,I,k,R,N,B,G){const X=s.indexArray,Y=s.layoutVertexArray,te=s.segments.prepareSegment(4*u.length,Y,X,this.canOverlap?b.sortKey:void 0),he=this.glyphOffsetArray.length,we=te.vertexLength,Ne=this.allowVerticalPlacement&&I===f.ai.vertical?Math.PI/2:0,Se=b.text&&b.text.sections;for(let K=0;K<u.length;K++){const{tl:ae,tr:Ie,bl:We,br:ct,tex:Xe,pixelOffsetTL:it,pixelOffsetBR:gt,minFontScaleX:dt,minFontScaleY:_t,glyphOffset:ot,isSDF:Nt,sectionIndex:Gt}=u[K],Ht=te.vertexLength,Ot=ot[1];O_(Y,k.x,k.y,ae.x,Ot+ae.y,Xe.x,Xe.y,p,Nt,it.x,it.y,dt,_t),O_(Y,k.x,k.y,Ie.x,Ot+Ie.y,Xe.x+Xe.w,Xe.y,p,Nt,gt.x,it.y,dt,_t),O_(Y,k.x,k.y,We.x,Ot+We.y,Xe.x,Xe.y+Xe.h,p,Nt,it.x,gt.y,dt,_t),O_(Y,k.x,k.y,ct.x,Ot+ct.y,Xe.x+Xe.w,Xe.y+Xe.h,p,Nt,gt.x,gt.y,dt,_t),Ex(s.dynamicLayoutVertexArray,k,Ne),X.emplaceBack(Ht,Ht+2,Ht+1),X.emplaceBack(Ht+1,Ht+2,Ht+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),K!==u.length-1&&Gt===u[K+1].sectionIndex||s.programConfigurations.populatePaintArrays(Y.length,b,b.index,{},G,Se&&Se[Gt])}s.placedSymbolArray.emplaceBack(k.x,k.y,he,this.glyphOffsetArray.length-he,we,R,N,k.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],I,0,!1,0,B)}_addCollisionDebugVertex(s,u,p,_,w,b){return u.emplaceBack(0,0),s.emplaceBack(p.x,p.y,_,w,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(s,u,p,_,w,b,I){const k=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),R=k.vertexLength,N=w.layoutVertexArray,B=w.collisionVertexArray,G=I.anchorX,X=I.anchorY;this._addCollisionDebugVertex(N,B,b,G,X,new ie(s,u)),this._addCollisionDebugVertex(N,B,b,G,X,new ie(p,u)),this._addCollisionDebugVertex(N,B,b,G,X,new ie(p,_)),this._addCollisionDebugVertex(N,B,b,G,X,new ie(s,_)),k.vertexLength+=4;const Y=w.indexArray;Y.emplaceBack(R,R+1),Y.emplaceBack(R+1,R+2),Y.emplaceBack(R+2,R+3),Y.emplaceBack(R+3,R),k.primitiveLength+=4}addDebugCollisionBoxes(s,u,p,_){for(let w=s;w<u;w++){const b=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,_?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Px(st,LS.members,St),this.iconCollisionBox=new Px(st,LS.members,St);for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(s,u,p,_,w,b,I,k,R){const N={};for(let B=u;B<p;B++){const G=s.get(B);N.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.textFeatureIndex=G.featureIndex;break}for(let B=_;B<w;B++){const G=s.get(B);N.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.verticalTextFeatureIndex=G.featureIndex;break}for(let B=b;B<I;B++){const G=s.get(B);N.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.iconFeatureIndex=G.featureIndex;break}for(let B=k;B<R;B++){const G=s.get(B);N.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.verticalIconFeatureIndex=G.featureIndex;break}return N}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,u){const p=s.placedSymbolArray.get(u),_=p.vertexStartIndex+4*p.numGlyphs;for(let w=p.vertexStartIndex;w<_;w+=4)s.indexArray.emplaceBack(w,w+2,w+1),s.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),p=Math.cos(s),_=[],w=[],b=[];for(let I=0;I<this.symbolInstances.length;++I){b.push(I);const k=this.symbolInstances.get(I);_.push(0|Math.round(u*k.anchorX+p*k.anchorY)),w.push(k.featureIndex)}return b.sort((I,k)=>_[I]-_[k]||w[k]-w[I]),b}addToSortKeyRanges(s,u){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const p=this.symbolInstances.get(u);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,w,b)=>{_>=0&&b.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ZS,WS;Rt("SymbolBucket",df,{omit:["layers","collisionBoxArray","features","compareText"]}),df.MAX_GLYPHS=65535,df.addDynamicAttributes=Ex;var Cx={get paint(){return WS=WS||new qs({"icon-opacity":new Kt(pe.paint_symbol["icon-opacity"]),"icon-color":new Kt(pe.paint_symbol["icon-color"]),"icon-halo-color":new Kt(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(pe.paint_symbol["text-opacity"]),"text-color":new Kt(pe.paint_symbol["text-color"],{runtimeType:xt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Kt(pe.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(pe.paint_symbol["text-halo-blur"]),"text-translate":new Vt(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(pe.paint_symbol["text-translate-anchor"])})},get layout(){return ZS=ZS||new qs({"symbol-placement":new Vt(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Vt(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Vt(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(pe.layout_symbol["icon-size"]),"icon-text-fit":new Vt(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(pe.layout_symbol["icon-image"]),"icon-rotate":new Kt(pe.layout_symbol["icon-rotate"]),"icon-padding":new Kt(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(pe.layout_symbol["icon-offset"]),"icon-anchor":new Kt(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(pe.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(pe.layout_symbol["text-field"]),"text-font":new Kt(pe.layout_symbol["text-font"]),"text-size":new Kt(pe.layout_symbol["text-size"]),"text-max-width":new Kt(pe.layout_symbol["text-max-width"]),"text-line-height":new Vt(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(pe.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(pe.layout_symbol["text-justify"]),"text-radial-offset":new Kt(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Kt(pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Kt(pe.layout_symbol["text-anchor"]),"text-max-angle":new Vt(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(pe.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(pe.layout_symbol["text-rotate"]),"text-padding":new Vt(pe.layout_symbol["text-padding"]),"text-keep-upright":new Vt(pe.layout_symbol["text-keep-upright"]),"text-transform":new Kt(pe.layout_symbol["text-transform"]),"text-offset":new Kt(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Vt(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Vt(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(pe.layout_symbol["text-optional"])})}};class KS{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:tn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt("FormatSectionOverride",KS,{omit:["defaultValue"]});class F_ extends Na{constructor(s){super(s,Cx)}recalculate(s,u){if(super.recalculate(s,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const w of p)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,u,p,_){const w=this.layout.get(s).evaluate(u,{},p,_),b=this._unevaluatedLayout._values[s];return b.isDataDriven()||Ra(b.value)||!w?w:function(I,k){return k.replace(/{([^{}]+)}/g,(R,N)=>I&&N in I?String(I[N]):"")}(u.properties,w)}createBucket(s){return new df(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Cx.paint.overridableProperties){if(!F_.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),p=new KS(u),_=new Ou(p,u.property.specification);let w=null;w=u.value.kind==="constant"||u.value.kind==="source"?new oa("source",_):new La("composite",_,u.value.zoomStops),this.paint._values[s]=new za(u.property,w,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,p){return!(!this.layout||u.isDataDriven()||p.isDataDriven())&&F_.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const p=s.get("text-field"),_=Cx.paint.properties[u];let w=!1;const b=I=>{for(const k of I)if(_.overrides&&_.overrides.hasOverride(k))return void(w=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Vn)b(p.value.value.sections);else if(p.value.kind==="source"){const I=R=>{w||(R instanceof qr&&En(R.value)===ps?b(R.value.sections):R instanceof No?b(R.sections):R.eachChild(I))},k=p.value;k._styleExpression&&I(k._styleExpression.expression)}return w}}let XS;var cN={get paint(){return XS=XS||new qs({"background-color":new Vt(pe.paint_background["background-color"]),"background-pattern":new tf(pe.paint_background["background-pattern"]),"background-opacity":new Vt(pe.paint_background["background-opacity"])})}};class hN extends Na{constructor(s){super(s,cN)}}let YS;var dN={get paint(){return YS=YS||new qs({"raster-opacity":new Vt(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(pe.paint_raster["raster-saturation"]),"raster-contrast":new Vt(pe.paint_raster["raster-contrast"]),"raster-resampling":new Vt(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(pe.paint_raster["raster-fade-duration"])})}};class fN extends Na{constructor(s){super(s,dN)}}class pN extends Na{constructor(s){super(s,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class mN{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ax=63710088e-1;class Bc{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bc(vn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,p=this.lat*u,_=s.lat*u,w=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((s.lng-this.lng)*u);return Ax*Math.acos(Math.min(w,1))}static convert(s){if(s instanceof Bc)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Bc(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Bc(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const QS=2*Math.PI*Ax;function JS(c){return QS*Math.cos(c*Math.PI/180)}function eE(c){return(180+c)/360}function tE(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function nE(c,s){return c/JS(s)}function kx(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function iE(c,s){return c*JS(kx(s))}class _m{constructor(s,u,p=0){this.x=+s,this.y=+u,this.z=+p}static fromLngLat(s,u=0){const p=Bc.convert(s);return new _m(eE(p.lng),tE(p.lat),nE(u,p.lat))}toLngLat(){return new Bc(360*this.x-180,kx(this.y))}toAltitude(){return iE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/QS*(s=kx(this.y),1/Math.cos(s*Math.PI/180));var s}}function rE(c,s,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[c*p-2*Math.PI*6378137/2,s*p-2*Math.PI*6378137/2]}class Mx{constructor(s,u,p){if(!function(_,w,b){return!(_<0||_>25||b<0||b>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))}(s,u,p))throw new Error(`x=${u}, y=${p}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=u,this.y=p,this.key=ff(0,s,s,u,p)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,u,p){const _=(b=this.y,I=this.z,k=rE(256*(w=this.x),256*(b=Math.pow(2,I)-b-1),I),R=rE(256*(w+1),256*(b+1),I),k[0]+","+k[1]+","+R[0]+","+R[1]);var w,b,I,k,R;const N=function(B,G,X){let Y,te="";for(let he=B;he>0;he--)Y=1<<he-1,te+=(G&Y?1:0)+(X&Y?2:0);return te}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,_)}isChildOf(s){const u=this.z-s.z;return u>0&&s.x===this.x>>u&&s.y===this.y>>u}getTilePoint(s){const u=Math.pow(2,this.z);return new ie((s.x*u-this.x)*Yt,(s.y*u-this.y)*Yt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sE{constructor(s,u){this.wrap=s,this.canonical=u,this.key=ff(s,u.z,u.z,u.x,u.y)}}class la{constructor(s,u,p,_,w){if(this.terrainRttPosMatrix32f=null,s<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${p}`);this.overscaledZ=s,this.wrap=u,this.canonical=new Mx(p,+_,+w),this.key=ff(u,s,p,_,w)}clone(){return new la(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-s;return s>this.canonical.z?new la(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new la(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-s;return s>this.canonical.z?ff(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):ff(this.wrap*+u,s,s,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new la(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new la(u,this.wrap,u,p,_),new la(u,this.wrap,u,p+1,_),new la(u,this.wrap,u,p,_+1),new la(u,this.wrap,u,p+1,_+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new la(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new la(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new _m(s.x-this.wrap,s.y))}}function ff(c,s,u,p,_){(c*=2)<0&&(c=-1*c-1);const w=1<<u;return(w*w*c+w*_+p).toString(36)+u.toString(36)+s.toString(36)}Rt("CanonicalTileID",Mx),Rt("OverscaledTileID",la,{omit:["terrainRttPosMatrix32f"]});class oE{constructor(s,u,p,_=1,w=1,b=1,I=0){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void ki(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const k=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=b,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let R=0;R<k;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(k,R)]=this.data[this._idx(k-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,k)]=this.data[this._idx(R,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<k;R++)for(let N=0;N<k;N++){const B=this.get(R,N);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(s,u){const p=new Uint8Array(this.data.buffer),_=4*this._idx(s,u);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}unpack(s,u,p){return s*this.redFactor+u*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new aa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,u,p){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,w=u*this.dim+this.dim,b=p*this.dim,I=p*this.dim+this.dim;switch(u){case-1:_=w-1;break;case 1:w=_+1}switch(p){case-1:b=I-1;break;case 1:I=b+1}const k=-u*this.dim,R=-p*this.dim;for(let N=b;N<I;N++)for(let B=_;B<w;B++)this.data[this._idx(B,N)]=s.data[this._idx(B+k,N+R)]}}Rt("DEMData",oE);class aE{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const p=s[u];this._stringToNumber[p]=u,this._numberToString[u]=p}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class lE{constructor(s,u,p,_,w){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=p,s._y=_,this.properties=s.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s}}class uE{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new $u(Yt,16,0),this.grid3D=new $u(Yt,16,0),this.featureIndexArray=new ye,this.promoteId=u}insert(s,u,p,_,w,b){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,w);const k=b?this.grid3D:this.grid;for(let R=0;R<u.length;R++){const N=u[R],B=[1/0,1/0,-1/0,-1/0];for(let G=0;G<N.length;G++){const X=N[G];B[0]=Math.min(B[0],X.x),B[1]=Math.min(B[1],X.y),B[2]=Math.max(B[2],X.x),B[3]=Math.max(B[3],X.y)}B[0]<Yt&&B[1]<Yt&&B[2]>=0&&B[3]>=0&&k.insert(I,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hm.VectorTile(new vx(this.rawTileData)).layers,this.sourceLayerCoder=new aE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,u,p,_){this.loadVTLayers();const w=s.params,b=Yt/s.tileSize/s.scale,I=Bu(w.filter),k=s.queryGeometry,R=s.queryPadding*b,N=hE(k),B=this.grid.query(N.minX-R,N.minY-R,N.maxX+R,N.maxY+R),G=hE(s.cameraQueryGeometry),X=this.grid3D.query(G.minX-R,G.minY-R,G.maxX+R,G.maxY+R,(he,we,Ne,Se)=>function(K,ae,Ie,We,ct){for(const it of K)if(ae<=it.x&&Ie<=it.y&&We>=it.x&&ct>=it.y)return!0;const Xe=[new ie(ae,Ie),new ie(ae,ct),new ie(We,ct),new ie(We,Ie)];if(K.length>2){for(const it of Xe)if(af(K,it))return!0}for(let it=0;it<K.length-1;it++)if(r5(K[it],K[it+1],Xe))return!0;return!1}(s.cameraQueryGeometry,he-R,we-R,Ne+R,Se+R));for(const he of X)B.push(he);B.sort(gN);const Y={};let te;for(let he=0;he<B.length;he++){const we=B[he];if(we===te)continue;te=we;const Ne=this.featureIndexArray.get(we);let Se=null;this.loadMatchingFeature(Y,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,I,w.layers,w.availableImages,u,p,_,(K,ae,Ie)=>(Se||(Se=Gu(K)),ae.queryIntersectsFeature({queryGeometry:k,feature:K,featureState:Ie,geometry:Se,zoom:this.z,transform:s.transform,pixelsToTileUnits:b,pixelPosMatrix:s.pixelPosMatrix})))}return Y}loadMatchingFeature(s,u,p,_,w,b,I,k,R,N,B){const G=this.bucketLayerIDs[u];if(b&&!G.some(he=>b.has(he)))return;const X=this.sourceLayerCoder.decode(p),Y=this.vtLayers[X].feature(_);if(w.needGeometry){const he=Zu(Y,!0);if(!w.filter(new zi(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!w.filter(new zi(this.tileID.overscaledZ),Y))return;const te=this.getId(Y,X);for(let he=0;he<G.length;he++){const we=G[he];if(b&&!b.has(we))continue;const Ne=k[we];if(!Ne)continue;let Se={};te&&N&&(Se=N.getState(Ne.sourceLayer||"_geojsonTileLayer",te));const K=Jt({},R[we]);K.paint=cE(K.paint,Ne.paint,Y,Se,I),K.layout=cE(K.layout,Ne.layout,Y,Se,I);const ae=!B||B(Y,Ne,Se);if(!ae)continue;const Ie=new lE(Y,this.z,this.x,this.y,te);Ie.layer=K;let We=s[we];We===void 0&&(We=s[we]=[]),We.push({featureIndex:_,feature:Ie,intersectionZ:ae})}}lookupSymbolFeatures(s,u,p,_,w,b,I,k){const R={};this.loadVTLayers();const N=Bu(w);for(const B of s)this.loadMatchingFeature(R,p,_,B,N,b,I,k,u);return R}hasLayer(s){for(const u of this.bucketLayerIDs)for(const p of u)if(s===p)return!0;return!1}getId(s,u){var p;let _=s.id;return this.promoteId&&(_=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((p=s.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(_=Number(s.properties.cluster_id))),_}}function cE(c,s,u,p,_){return xi(c,(w,b)=>{const I=s instanceof Lc?s.get(b):null;return I&&I.evaluate?I.evaluate(u,p,_):I})}function hE(c){let s=1/0,u=1/0,p=-1/0,_=-1/0;for(const w of c)s=Math.min(s,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),_=Math.max(_,w.y);return{minX:s,minY:u,maxX:p,maxY:_}}function gN(c,s){return s-c}function dE(c,s,u,p,_){const w=[];for(let b=0;b<c.length;b++){const I=c[b];let k;for(let R=0;R<I.length-1;R++){let N=I[R],B=I[R+1];N.x<s&&B.x<s||(N.x<s?N=new ie(s,N.y+(s-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x<s&&(B=new ie(s,N.y+(s-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y<u&&B.y<u||(N.y<u?N=new ie(N.x+(u-N.y)/(B.y-N.y)*(B.x-N.x),u)._round():B.y<u&&(B=new ie(N.x+(u-N.y)/(B.y-N.y)*(B.x-N.x),u)._round()),N.x>=p&&B.x>=p||(N.x>=p?N=new ie(p,N.y+(p-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x>=p&&(B=new ie(p,N.y+(p-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y>=_&&B.y>=_||(N.y>=_?N=new ie(N.x+(_-N.y)/(B.y-N.y)*(B.x-N.x),_)._round():B.y>=_&&(B=new ie(N.x+(_-N.y)/(B.y-N.y)*(B.x-N.x),_)._round()),k&&N.equals(k[k.length-1])||(k=[N],w.push(k)),k.push(B)))))}}return w}Rt("FeatureIndex",uE,{omit:["rawTileData","sourceLayerCoder"]});class Vc extends ie{constructor(s,u,p,_){super(s,u),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new Vc(this.x,this.y,this.angle,this.segment)}}function fE(c,s,u,p,_){if(s.segment===void 0||u===0)return!0;let w=s,b=s.segment+1,I=0;for(;I>-u/2;){if(b--,b<0)return!1;I-=c[b].dist(w),w=c[b]}I+=c[b].dist(c[b+1]),b++;const k=[];let R=0;for(;I<u/2;){const N=c[b],B=c[b+1];if(!B)return!1;let G=c[b-1].angleTo(N)-N.angleTo(B);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:I,angleDelta:G}),R+=G;I-k[0].distance>p;)R-=k.shift().angleDelta;if(R>_)return!1;b++,I+=N.dist(B)}return!0}function pE(c){let s=0;for(let u=0;u<c.length-1;u++)s+=c[u].dist(c[u+1]);return s}function mE(c,s,u){return c?.6*s*u:0}function gE(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function _N(c,s,u,p,_,w){const b=mE(u,_,w),I=gE(u,p)*w;let k=0;const R=pE(c)/2;for(let N=0;N<c.length-1;N++){const B=c[N],G=c[N+1],X=B.dist(G);if(k+X>R){const Y=(R-k)/X,te=Hr.number(B.x,G.x,Y),he=Hr.number(B.y,G.y,Y),we=new Vc(te,he,G.angleTo(B),N);return we._round(),!b||fE(c,we,I,b,s)?we:void 0}k+=X}}function yN(c,s,u,p,_,w,b,I,k){const R=mE(p,w,b),N=gE(p,_),B=N*b,G=c[0].x===0||c[0].x===k||c[0].y===0||c[0].y===k;return s-B<s/4&&(s=B+s/4),_E(c,G?s/2*I%s:(N/2+2*w)*b*I%s,s,R,u,B,G,!1,k)}function _E(c,s,u,p,_,w,b,I,k){const R=w/2,N=pE(c);let B=0,G=s-u,X=[];for(let Y=0;Y<c.length-1;Y++){const te=c[Y],he=c[Y+1],we=te.dist(he),Ne=he.angleTo(te);for(;G+u<B+we;){G+=u;const Se=(G-B)/we,K=Hr.number(te.x,he.x,Se),ae=Hr.number(te.y,he.y,Se);if(K>=0&&K<k&&ae>=0&&ae<k&&G-R>=0&&G+R<=N){const Ie=new Vc(K,ae,Ne,Y);Ie._round(),p&&!fE(c,Ie,w,p,_)||X.push(Ie)}}B+=we}return I||X.length||b||(X=_E(c,B/2,u,p,_,w,b,!0,k)),X}Rt("Anchor",Vc);const ym=fo;function yE(c,s,u,p){const _=[],w=c.image,b=w.pixelRatio,I=w.paddedRect.w-2*ym,k=w.paddedRect.h-2*ym;let R={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const N=w.stretchX||[[0,I]],B=w.stretchY||[[0,k]],G=(ot,Nt)=>ot+Nt[1]-Nt[0],X=N.reduce(G,0),Y=B.reduce(G,0),te=I-X,he=k-Y;let we=0,Ne=X,Se=0,K=Y,ae=0,Ie=te,We=0,ct=he;if(w.content&&p){const ot=w.content,Nt=ot[2]-ot[0],Gt=ot[3]-ot[1];(w.textFitWidth||w.textFitHeight)&&(R=qS(c)),we=B_(N,0,ot[0]),Se=B_(B,0,ot[1]),Ne=B_(N,ot[0],ot[2]),K=B_(B,ot[1],ot[3]),ae=ot[0]-we,We=ot[1]-Se,Ie=Nt-Ne,ct=Gt-K}const Xe=R.x1,it=R.y1,gt=R.x2-Xe,dt=R.y2-it,_t=(ot,Nt,Gt,Ht)=>{const Ot=V_(ot.stretch-we,Ne,gt,Xe),Rn=j_(ot.fixed-ae,Ie,ot.stretch,X),Gi=V_(Nt.stretch-Se,K,dt,it),wr=j_(Nt.fixed-We,ct,Nt.stretch,Y),os=V_(Gt.stretch-we,Ne,gt,Xe),ua=j_(Gt.fixed-ae,Ie,Gt.stretch,X),po=V_(Ht.stretch-Se,K,dt,it),Wr=j_(Ht.fixed-We,ct,Ht.stretch,Y),Vi=new ie(Ot,Gi),Mr=new ie(os,Gi),Kr=new ie(os,po),Xr=new ie(Ot,po),Gs=new ie(Rn/b,wr/b),ca=new ie(ua/b,Wr/b),Rr=s*Math.PI/180;if(Rr){const Lr=Math.sin(Rr),Dr=Math.cos(Rr),mr=[Dr,-Lr,Lr,Dr];Vi._matMult(mr),Mr._matMult(mr),Xr._matMult(mr),Kr._matMult(mr)}const mo=ot.stretch+ot.fixed,br=Nt.stretch+Nt.fixed;return{tl:Vi,tr:Mr,bl:Xr,br:Kr,tex:{x:w.paddedRect.x+ym+mo,y:w.paddedRect.y+ym+br,w:Gt.stretch+Gt.fixed-mo,h:Ht.stretch+Ht.fixed-br},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gs,pixelOffsetBR:ca,minFontScaleX:Ie/b/gt,minFontScaleY:ct/b/dt,isSDF:u}};if(p&&(w.stretchX||w.stretchY)){const ot=vE(N,te,X),Nt=vE(B,he,Y);for(let Gt=0;Gt<ot.length-1;Gt++){const Ht=ot[Gt],Ot=ot[Gt+1];for(let Rn=0;Rn<Nt.length-1;Rn++)_.push(_t(Ht,Nt[Rn],Ot,Nt[Rn+1]))}}else _.push(_t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:k+1}));return _}function B_(c,s,u){let p=0;for(const _ of c)p+=Math.max(s,Math.min(u,_[1]))-Math.max(s,Math.min(u,_[0]));return p}function vE(c,s,u){const p=[{fixed:-1,stretch:0}];for(const[_,w]of c){const b=p[p.length-1];p.push({fixed:_-b.stretch,stretch:b.stretch}),p.push({fixed:_-b.stretch,stretch:b.stretch+(w-_)})}return p.push({fixed:s+ym,stretch:u}),p}function V_(c,s,u,p){return c/s*u+p}function j_(c,s,u,p){return c-s*u/p}class U_{constructor(s,u,p,_,w,b,I,k,R,N){var B;if(this.boxStartIndex=s.length,R){let G=b.top,X=b.bottom;const Y=b.collisionPadding;Y&&(G-=Y[1],X+=Y[3]);let te=X-G;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{const G=!((B=b.image)===null||B===void 0)&&B.content&&(b.image.textFitWidth||b.image.textFitHeight)?qS(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};G.y1=G.y1*I-k[0],G.y2=G.y2*I+k[2],G.x1=G.x1*I-k[3],G.x2=G.x2*I+k[1];const X=b.collisionPadding;if(X&&(G.x1-=X[0]*I,G.y1-=X[1]*I,G.x2+=X[2]*I,G.y2+=X[3]*I),N){const Y=new ie(G.x1,G.y1),te=new ie(G.x2,G.y1),he=new ie(G.x1,G.y2),we=new ie(G.x2,G.y2),Ne=N*Math.PI/180;Y._rotate(Ne),te._rotate(Ne),he._rotate(Ne),we._rotate(Ne),G.x1=Math.min(Y.x,te.x,he.x,we.x),G.x2=Math.max(Y.x,te.x,he.x,we.x),G.y1=Math.min(Y.y,te.y,he.y,we.y),G.y2=Math.max(Y.y,te.y,he.y,we.y)}s.emplaceBack(u.x,u.y,G.x1,G.y1,G.x2,G.y2,p,_,w)}this.boxEndIndex=s.length}}class vN{constructor(s=[],u=(p,_)=>p<_?-1:p>_?1:0){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:p}=this,_=u[s];for(;s>0;){const w=s-1>>1,b=u[w];if(p(_,b)>=0)break;u[s]=b,s=w}u[s]=_}_down(s){const{data:u,compare:p}=this,_=this.length>>1,w=u[s];for(;s<_;){let b=1+(s<<1);const I=b+1;if(I<this.length&&p(u[I],u[b])<0&&(b=I),p(u[b],w)>=0)break;u[s]=u[b],s=b}u[s]=w}}function xN(c,s=1,u=!1){let p=1/0,_=1/0,w=-1/0,b=-1/0;const I=c[0];for(let X=0;X<I.length;X++){const Y=I[X];(!X||Y.x<p)&&(p=Y.x),(!X||Y.y<_)&&(_=Y.y),(!X||Y.x>w)&&(w=Y.x),(!X||Y.y>b)&&(b=Y.y)}const k=Math.min(w-p,b-_);let R=k/2;const N=new vN([],wN);if(k===0)return new ie(p,_);for(let X=p;X<w;X+=k)for(let Y=_;Y<b;Y+=k)N.push(new pf(X+R,Y+R,R,c));let B=function(X){let Y=0,te=0,he=0;const we=X[0];for(let Ne=0,Se=we.length,K=Se-1;Ne<Se;K=Ne++){const ae=we[Ne],Ie=we[K],We=ae.x*Ie.y-Ie.x*ae.y;te+=(ae.x+Ie.x)*We,he+=(ae.y+Ie.y)*We,Y+=3*We}return new pf(te/Y,he/Y,0,X)}(c),G=N.length;for(;N.length;){const X=N.pop();(X.d>B.d||!B.d)&&(B=X,u&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,G)),X.max-B.d<=s||(R=X.h/2,N.push(new pf(X.p.x-R,X.p.y-R,R,c)),N.push(new pf(X.p.x+R,X.p.y-R,R,c)),N.push(new pf(X.p.x-R,X.p.y+R,R,c)),N.push(new pf(X.p.x+R,X.p.y+R,R,c)),G+=4)}return u&&(console.log(`num probes: ${G}`),console.log(`best distance: ${B.d}`)),B.p}function wN(c,s){return s.max-c.max}function pf(c,s,u,p){this.p=new ie(c,s),this.h=u,this.d=function(_,w){let b=!1,I=1/0;for(let k=0;k<w.length;k++){const R=w[k];for(let N=0,B=R.length,G=B-1;N<B;G=N++){const X=R[N],Y=R[G];X.y>_.y!=Y.y>_.y&&_.x<(Y.x-X.x)*(_.y-X.y)/(Y.y-X.y)+X.x&&(b=!b),I=Math.min(I,J2(_,X,Y))}}return(b?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var ss;f.av=void 0,(ss=f.av||(f.av={}))[ss.center=1]="center",ss[ss.left=2]="left",ss[ss.right=3]="right",ss[ss.top=4]="top",ss[ss.bottom=5]="bottom",ss[ss["top-left"]=6]="top-left",ss[ss["top-right"]=7]="top-right",ss[ss["bottom-left"]=8]="bottom-left",ss[ss["bottom-right"]=9]="bottom-right";const jc=7,Rx=Number.POSITIVE_INFINITY;function xE(c,s){return s[1]!==Rx?function(u,p,_){let w=0,b=0;switch(p=Math.abs(p),_=Math.abs(_),u){case"top-right":case"top-left":case"top":b=_-jc;break;case"bottom-right":case"bottom-left":case"bottom":b=-_+jc}switch(u){case"top-right":case"bottom-right":case"right":w=-p;break;case"top-left":case"bottom-left":case"left":w=p}return[w,b]}(c,s[0],s[1]):function(u,p){let _=0,w=0;p<0&&(p=0);const b=p/Math.SQRT2;switch(u){case"top-right":case"top-left":w=b-jc;break;case"bottom-right":case"bottom-left":w=-b+jc;break;case"bottom":w=-p+jc;break;case"top":w=p-jc}switch(u){case"top-right":case"bottom-right":_=-b;break;case"top-left":case"bottom-left":_=b;break;case"left":_=p;break;case"right":_=-p}return[_,w]}(c,s[0])}function wE(c,s,u){var p;const _=c.layout,w=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(s,{},u);if(w){const I=w.values,k=[];for(let R=0;R<I.length;R+=2){const N=k[R]=I[R],B=I[R+1].map(G=>G*xr);N.startsWith("top")?B[1]-=jc:N.startsWith("bottom")&&(B[1]+=jc),k[R+1]=B}return new Xi(k)}const b=_.get("text-variable-anchor");if(b){let I;I=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(s,{},u)*xr,Rx]:_.get("text-offset").evaluate(s,{},u).map(R=>R*xr);const k=[];for(const R of b)k.push(R,xE(R,I));return new Xi(k)}return null}function Lx(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bN(c,s,u,p,_,w,b,I,k,R,N,B){let G=w.textMaxSize.evaluate(s,{});G===void 0&&(G=b);const X=c.layers[0].layout,Y=X.get("icon-offset").evaluate(s,{},N),te=TE(u.horizontal),he=b/24,we=c.tilePixelRatio*he,Ne=c.tilePixelRatio*G/24,Se=c.tilePixelRatio*I,K=c.tilePixelRatio*X.get("symbol-spacing"),ae=X.get("text-padding")*c.tilePixelRatio,Ie=function(Gt,Ht,Ot,Rn=1){const Gi=Gt.get("icon-padding").evaluate(Ht,{},Ot),wr=Gi&&Gi.values;return[wr[0]*Rn,wr[1]*Rn,wr[2]*Rn,wr[3]*Rn]}(X,s,N,c.tilePixelRatio),We=X.get("text-max-angle")/180*Math.PI,ct=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",Xe=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",it=X.get("symbol-placement"),gt=K/2,dt=X.get("icon-text-fit");let _t;p&&dt!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(_t=HS(p,u.vertical,dt,X.get("icon-text-fit-padding"),Y,he)),te&&(p=HS(p,te,dt,X.get("icon-text-fit-padding"),Y,he)));const ot=N?B.line.getGranularityForZoomLevel(N.z):1,Nt=(Gt,Ht)=>{Ht.x<0||Ht.x>=Yt||Ht.y<0||Ht.y>=Yt||function(Ot,Rn,Gi,wr,os,ua,po,Wr,Vi,Mr,Kr,Xr,Gs,ca,Rr,mo,br,Lr,Dr,mr,Pi,bl,mf,Tl,EN){const gf=Ot.addToLineVertexArray(Rn,Gi);let Yh,_f,yf,vf,PE=0,CE=0,AE=0,kE=0,jx=-1,Ux=-1;const Wu={};let ME=fr("");if(Ot.allowVerticalPlacement&&wr.vertical){const Ss=Wr.layout.get("text-rotate").evaluate(Pi,{},Tl)+90;yf=new U_(Vi,Rn,Mr,Kr,Xr,wr.vertical,Gs,ca,Rr,Ss),po&&(vf=new U_(Vi,Rn,Mr,Kr,Xr,po,br,Lr,Rr,Ss))}if(os){const Ss=Wr.layout.get("icon-rotate").evaluate(Pi,{}),ha=Wr.layout.get("icon-text-fit")!=="none",Qh=yE(os,Ss,mf,ha),El=po?yE(po,Ss,mf,ha):void 0;_f=new U_(Vi,Rn,Mr,Kr,Xr,os,br,Lr,!1,Ss),PE=4*Qh.length;const Jh=Ot.iconSizeData;let su=null;Jh.kind==="source"?(su=[ru*Wr.layout.get("icon-size").evaluate(Pi,{})],su[0]>Fc&&ki(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${gm}. Reduce your "icon-size".`)):Jh.kind==="composite"&&(su=[ru*bl.compositeIconSizes[0].evaluate(Pi,{},Tl),ru*bl.compositeIconSizes[1].evaluate(Pi,{},Tl)],(su[0]>Fc||su[1]>Fc)&&ki(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${gm}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,Qh,su,mr,Dr,Pi,f.ai.none,Rn,gf.lineStartIndex,gf.lineLength,-1,Tl),jx=Ot.icon.placedSymbolArray.length-1,El&&(CE=4*El.length,Ot.addSymbols(Ot.icon,El,su,mr,Dr,Pi,f.ai.vertical,Rn,gf.lineStartIndex,gf.lineLength,-1,Tl),Ux=Ot.icon.placedSymbolArray.length-1)}const RE=Object.keys(wr.horizontal);for(const Ss of RE){const ha=wr.horizontal[Ss];if(!Yh){ME=fr(ha.text);const El=Wr.layout.get("text-rotate").evaluate(Pi,{},Tl);Yh=new U_(Vi,Rn,Mr,Kr,Xr,ha,Gs,ca,Rr,El)}const Qh=ha.positionedLines.length===1;if(AE+=bE(Ot,Rn,ha,ua,Wr,Rr,Pi,mo,gf,wr.vertical?f.ai.horizontal:f.ai.horizontalOnly,Qh?RE:[Ss],Wu,jx,bl,Tl),Qh)break}wr.vertical&&(kE+=bE(Ot,Rn,wr.vertical,ua,Wr,Rr,Pi,mo,gf,f.ai.vertical,["vertical"],Wu,Ux,bl,Tl));const IN=Yh?Yh.boxStartIndex:Ot.collisionBoxArray.length,PN=Yh?Yh.boxEndIndex:Ot.collisionBoxArray.length,CN=yf?yf.boxStartIndex:Ot.collisionBoxArray.length,AN=yf?yf.boxEndIndex:Ot.collisionBoxArray.length,kN=_f?_f.boxStartIndex:Ot.collisionBoxArray.length,MN=_f?_f.boxEndIndex:Ot.collisionBoxArray.length,RN=vf?vf.boxStartIndex:Ot.collisionBoxArray.length,LN=vf?vf.boxEndIndex:Ot.collisionBoxArray.length;let Sl=-1;const q_=(Ss,ha)=>Ss&&Ss.circleDiameter?Math.max(Ss.circleDiameter,ha):ha;Sl=q_(Yh,Sl),Sl=q_(yf,Sl),Sl=q_(_f,Sl),Sl=q_(vf,Sl);const LE=Sl>-1?1:0;LE&&(Sl*=EN/xr),Ot.glyphOffsetArray.length>=df.MAX_GLYPHS&&ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,Pi.sortKey);const DN=wE(Wr,Pi,Tl),[zN,NN]=function(Ss,ha){const Qh=Ss.length,El=ha==null?void 0:ha.values;if((El==null?void 0:El.length)>0)for(let Jh=0;Jh<El.length;Jh+=2){const su=El[Jh+1];Ss.emplaceBack(f.av[El[Jh]],su[0],su[1])}return[Qh,Ss.length]}(Ot.textAnchorOffsets,DN);Ot.symbolInstances.emplaceBack(Rn.x,Rn.y,Wu.right>=0?Wu.right:-1,Wu.center>=0?Wu.center:-1,Wu.left>=0?Wu.left:-1,Wu.vertical||-1,jx,Ux,ME,IN,PN,CN,AN,kN,MN,RN,LN,Mr,AE,kE,PE,CE,LE,0,Gs,Sl,zN,NN)}(c,Ht,Gt,u,p,_,_t,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,we,[ae,ae,ae,ae],ct,k,Se,Ie,Xe,Y,s,w,R,N,b)};if(it==="line")for(const Gt of dE(s.geometry,0,0,Yt,Yt)){const Ht=Xh(Gt,ot),Ot=yN(Ht,K,We,u.vertical||te,p,24,Ne,c.overscaling,Yt);for(const Rn of Ot)te&&TN(c,te.text,gt,Rn)||Nt(Ht,Rn)}else if(it==="line-center"){for(const Gt of s.geometry)if(Gt.length>1){const Ht=Xh(Gt,ot),Ot=_N(Ht,We,u.vertical||te,p,24,Ne);Ot&&Nt(Ht,Ot)}}else if(s.type==="Polygon")for(const Gt of qn(s.geometry,0)){const Ht=xN(Gt,16);Nt(Xh(Gt[0],ot,!0),new Vc(Ht.x,Ht.y,0))}else if(s.type==="LineString")for(const Gt of s.geometry){const Ht=Xh(Gt,ot);Nt(Ht,new Vc(Ht[0].x,Ht[0].y,0))}else if(s.type==="Point")for(const Gt of s.geometry)for(const Ht of Gt)Nt([Ht],new Vc(Ht.x,Ht.y,0))}function bE(c,s,u,p,_,w,b,I,k,R,N,B,G,X,Y){const te=function(Ne,Se,K,ae,Ie,We,ct,Xe){const it=ae.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,gt=[];for(const dt of Se.positionedLines)for(const _t of dt.positionedGlyphs){if(!_t.rect)continue;const ot=_t.rect||{};let Nt=Y5+1,Gt=!0,Ht=1,Ot=0;const Rn=(Ie||Xe)&&_t.vertical,Gi=_t.metrics.advance*_t.scale/2;if(Xe&&Se.verticalizable&&(Ot=dt.lineOffset/2-(_t.imageName?-(xr-_t.metrics.width*_t.scale)/2:(_t.scale-1)*xr)),_t.imageName){const Lr=ct[_t.imageName];Gt=Lr.sdf,Ht=Lr.pixelRatio,Nt=fo/Ht}const wr=Ie?[_t.x+Gi,_t.y]:[0,0];let os=Ie?[0,0]:[_t.x+Gi+K[0],_t.y+K[1]-Ot],ua=[0,0];Rn&&(ua=os,os=[0,0]);const po=_t.metrics.isDoubleResolution?2:1,Wr=(_t.metrics.left-Nt)*_t.scale-Gi+os[0],Vi=(-_t.metrics.top-Nt)*_t.scale+os[1],Mr=Wr+ot.w/po*_t.scale/Ht,Kr=Vi+ot.h/po*_t.scale/Ht,Xr=new ie(Wr,Vi),Gs=new ie(Mr,Vi),ca=new ie(Wr,Kr),Rr=new ie(Mr,Kr);if(Rn){const Lr=new ie(-Gi,Gi-D_),Dr=-Math.PI/2,mr=xr/2-Gi,Pi=new ie(5-D_-mr,-(_t.imageName?mr:0)),bl=new ie(...ua);Xr._rotateAround(Dr,Lr)._add(Pi)._add(bl),Gs._rotateAround(Dr,Lr)._add(Pi)._add(bl),ca._rotateAround(Dr,Lr)._add(Pi)._add(bl),Rr._rotateAround(Dr,Lr)._add(Pi)._add(bl)}if(it){const Lr=Math.sin(it),Dr=Math.cos(it),mr=[Dr,-Lr,Lr,Dr];Xr._matMult(mr),Gs._matMult(mr),ca._matMult(mr),Rr._matMult(mr)}const mo=new ie(0,0),br=new ie(0,0);gt.push({tl:Xr,tr:Gs,bl:ca,br:Rr,tex:ot,writingMode:Se.writingMode,glyphOffset:wr,sectionIndex:_t.sectionIndex,isSDF:Gt,pixelOffsetTL:mo,pixelOffsetBR:br,minFontScaleX:0,minFontScaleY:0})}return gt}(0,u,I,_,w,b,p,c.allowVerticalPlacement),he=c.textSizeData;let we=null;he.kind==="source"?(we=[ru*_.layout.get("text-size").evaluate(b,{})],we[0]>Fc&&ki(`${c.layerIds[0]}: Value for "text-size" is >= ${gm}. Reduce your "text-size".`)):he.kind==="composite"&&(we=[ru*X.compositeTextSizes[0].evaluate(b,{},Y),ru*X.compositeTextSizes[1].evaluate(b,{},Y)],(we[0]>Fc||we[1]>Fc)&&ki(`${c.layerIds[0]}: Value for "text-size" is >= ${gm}. Reduce your "text-size".`)),c.addSymbols(c.text,te,we,I,w,b,R,s,k.lineStartIndex,k.lineLength,G,Y);for(const Ne of N)B[Ne]=c.text.placedSymbolArray.length-1;return 4*te.length}function TE(c){for(const s in c)return c[s];return null}function TN(c,s,u,p){const _=c.compareText;if(s in _){const w=_[s];for(let b=w.length-1;b>=0;b--)if(p.dist(w[b])<u)return!0}else _[s]=[];return _[s].push(p),!1}const SE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dx{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,p]=new Uint8Array(s,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=SE[15&p];if(!w)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(s,2,1),[I]=new Uint32Array(s,4,1);return new Dx(I,b,w,s)}constructor(s,u=64,p=Float64Array,_){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=p,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const w=SE.indexOf(this.ArrayType),b=2*s*this.ArrayType.BYTES_PER_ELEMENT,I=s*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-I%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+I+k,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+b+I+k),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+I+k,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=s)}add(s,u){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=s,this.coords[this._pos++]=u,p}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return zx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,u,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:b,nodeSize:I}=this,k=[0,w.length-1,0],R=[];for(;k.length;){const N=k.pop()||0,B=k.pop()||0,G=k.pop()||0;if(B-G<=I){for(let he=G;he<=B;he++){const we=b[2*he],Ne=b[2*he+1];we>=s&&we<=p&&Ne>=u&&Ne<=_&&R.push(w[he])}continue}const X=G+B>>1,Y=b[2*X],te=b[2*X+1];Y>=s&&Y<=p&&te>=u&&te<=_&&R.push(w[X]),(N===0?s<=Y:u<=te)&&(k.push(G),k.push(X-1),k.push(1-N)),(N===0?p>=Y:_>=te)&&(k.push(X+1),k.push(B),k.push(1-N))}return R}within(s,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:b}=this,I=[0,_.length-1,0],k=[],R=p*p;for(;I.length;){const N=I.pop()||0,B=I.pop()||0,G=I.pop()||0;if(B-G<=b){for(let he=G;he<=B;he++)IE(w[2*he],w[2*he+1],s,u)<=R&&k.push(_[he]);continue}const X=G+B>>1,Y=w[2*X],te=w[2*X+1];IE(Y,te,s,u)<=R&&k.push(_[X]),(N===0?s-p<=Y:u-p<=te)&&(I.push(G),I.push(X-1),I.push(1-N)),(N===0?s+p>=Y:u+p>=te)&&(I.push(X+1),I.push(B),I.push(1-N))}return k}}function zx(c,s,u,p,_,w){if(_-p<=u)return;const b=p+_>>1;EE(c,s,b,p,_,w),zx(c,s,u,p,b-1,1-w),zx(c,s,u,b+1,_,1-w)}function EE(c,s,u,p,_,w){for(;_>p;){if(_-p>600){const R=_-p+1,N=u-p+1,B=Math.log(R),G=.5*Math.exp(2*B/3),X=.5*Math.sqrt(B*G*(R-G)/R)*(N-R/2<0?-1:1);EE(c,s,u,Math.max(p,Math.floor(u-N*G/R+X)),Math.min(_,Math.floor(u+(R-N)*G/R+X)),w)}const b=s[2*u+w];let I=p,k=_;for(vm(c,s,p,u),s[2*_+w]>b&&vm(c,s,p,_);I<k;){for(vm(c,s,I,k),I++,k--;s[2*I+w]<b;)I++;for(;s[2*k+w]>b;)k--}s[2*p+w]===b?vm(c,s,p,k):(k++,vm(c,s,k,_)),k<=u&&(p=k+1),u<=k&&(_=k-1)}}function vm(c,s,u,p){Nx(c,u,p),Nx(s,2*u,2*p),Nx(s,2*u+1,2*p+1)}function Nx(c,s,u){const p=c[s];c[s]=c[u],c[u]=p}function IE(c,s,u,p){const _=c-u,w=s-p;return _*_+w*w}var Ox;f.ce=void 0,(Ox=f.ce||(f.ce={})).create="create",Ox.load="load",Ox.fullLoad="fullLoad";let $_=null,xm=[];const Fx=1e3/60,Bx="loadTime",Vx="fullLoadTime",SN={mark(c){performance.mark(c)},frame(c){const s=c;$_!=null&&xm.push(s-$_),$_=s},clearMetrics(){$_=null,xm=[],performance.clearMeasures(Bx),performance.clearMeasures(Vx);for(const c in f.ce)performance.clearMarks(f.ce[c])},getPerformanceMetrics(){performance.measure(Bx,f.ce.create,f.ce.load),performance.measure(Vx,f.ce.create,f.ce.fullLoad);const c=performance.getEntriesByName(Bx)[0].duration,s=performance.getEntriesByName(Vx)[0].duration,u=xm.length,p=1/(xm.reduce((w,b)=>w+b,0)/u/1e3),_=xm.filter(w=>w>Fx).reduce((w,b)=>w+(b-Fx)/Fx,0);return{loadTime:c,fullLoadTime:s,fps:p,percentDroppedFrames:_/(u+_)*100,totalFrames:u}}};f.$=Oe,f.A=fe,f.B=Fh,f.C=function(c){if(wi==null){const s=c.navigator?c.navigator.userAgent:null;wi=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return wi},f.D=Vt,f.E=fs,f.F=class{constructor(c,s){this.target=c,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new mN(()=>this.process()),this.subscription=function(u,p,_,w){return u.addEventListener(p,_,!1),{unsubscribe:()=>{u.removeEventListener(p,_,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=Fr(self)?c:window}registerMessageHandler(c,s){this.messageHandlers[c]=s}sendAsync(c,s){return new Promise((u,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:u,reject:p},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const I={id:_,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const w=[],b=Object.assign(Object.assign({},c),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Bh(c.data,w)});this.target.postMessage(b,{transfer:w})})}receive(c){const s=c.data,u=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[u];const p=this.abortControllers[u];return delete this.abortControllers[u],void(p&&p.abort())}if(Fr(self)||s.mustQueue)return this.tasks[u]=s,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,s)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){return l(this,void 0,void 0,function*(){if(s.type==="<response>"){const _=this.resolveRejects[c];return delete this.resolveRejects[c],_?void(s.error?_.reject(tu(s.error)):_.resolve(tu(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=tu(s.data),p=new AbortController;this.abortControllers[c]=p;try{const _=yield this.messageHandlers[s.type](s.sourceMapId,u,p);this.completeTask(c,null,_)}catch(_){this.completeTask(c,_)}})}completeTask(c,s,u){const p=[];delete this.abortControllers[c];const _={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Bh(s):null,data:Bh(u,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.G=To,f.H=function(){var c=new fe(16);return fe!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},f.I=wx,f.J=function(c,s,u){var p,_,w,b,I,k,R,N,B,G,X,Y,te=u[0],he=u[1],we=u[2];return s===c?(c[12]=s[0]*te+s[4]*he+s[8]*we+s[12],c[13]=s[1]*te+s[5]*he+s[9]*we+s[13],c[14]=s[2]*te+s[6]*he+s[10]*we+s[14],c[15]=s[3]*te+s[7]*he+s[11]*we+s[15]):(_=s[1],w=s[2],b=s[3],I=s[4],k=s[5],R=s[6],N=s[7],B=s[8],G=s[9],X=s[10],Y=s[11],c[0]=p=s[0],c[1]=_,c[2]=w,c[3]=b,c[4]=I,c[5]=k,c[6]=R,c[7]=N,c[8]=B,c[9]=G,c[10]=X,c[11]=Y,c[12]=p*te+I*he+B*we+s[12],c[13]=_*te+k*he+G*we+s[13],c[14]=w*te+R*he+X*we+s[14],c[15]=b*te+N*he+Y*we+s[15]),c},f.K=function(c,s,u){var p=u[0],_=u[1],w=u[2];return c[0]=s[0]*p,c[1]=s[1]*p,c[2]=s[2]*p,c[3]=s[3]*p,c[4]=s[4]*_,c[5]=s[5]*_,c[6]=s[6]*_,c[7]=s[7]*_,c[8]=s[8]*w,c[9]=s[9]*w,c[10]=s[10]*w,c[11]=s[11]*w,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},f.L=function(c,s,u){var p=s[0],_=s[1],w=s[2],b=s[3],I=s[4],k=s[5],R=s[6],N=s[7],B=s[8],G=s[9],X=s[10],Y=s[11],te=s[12],he=s[13],we=s[14],Ne=s[15],Se=u[0],K=u[1],ae=u[2],Ie=u[3];return c[0]=Se*p+K*I+ae*B+Ie*te,c[1]=Se*_+K*k+ae*G+Ie*he,c[2]=Se*w+K*R+ae*X+Ie*we,c[3]=Se*b+K*N+ae*Y+Ie*Ne,c[4]=(Se=u[4])*p+(K=u[5])*I+(ae=u[6])*B+(Ie=u[7])*te,c[5]=Se*_+K*k+ae*G+Ie*he,c[6]=Se*w+K*R+ae*X+Ie*we,c[7]=Se*b+K*N+ae*Y+Ie*Ne,c[8]=(Se=u[8])*p+(K=u[9])*I+(ae=u[10])*B+(Ie=u[11])*te,c[9]=Se*_+K*k+ae*G+Ie*he,c[10]=Se*w+K*R+ae*X+Ie*we,c[11]=Se*b+K*N+ae*Y+Ie*Ne,c[12]=(Se=u[12])*p+(K=u[13])*I+(ae=u[14])*B+(Ie=u[15])*te,c[13]=Se*_+K*k+ae*G+Ie*he,c[14]=Se*w+K*R+ae*X+Ie*we,c[15]=Se*b+K*N+ae*Y+Ie*Ne,c},f.M=function(c,s){const u={};for(let p=0;p<s.length;p++){const _=s[p];_ in c&&(u[_]=c[_])}return u},f.N=Bc,f.O=eE,f.P=ie,f.Q=tE,f.R=aa,f.S=la,f.T=Up,f.U=ge,f.V=je,f.W=Br,f.X=Yt,f.Y=_m,f.Z=Mx,f._=l,f.a=ds,f.a$=function(){return new Float64Array(16)},f.a0=c=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(u=>{s.onloadstart=()=>{u(s)};for(const p of c){const _=window.document.createElement("source");So(p)||(s.crossOrigin="Anonymous"),_.src=p,s.appendChild(_)}})},f.a1=function(){return on++},f.a2=x,f.a3=df,f.a4=Bu,f.a5=Zu,f.a6=lE,f.a7=function(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,p,_,w)=>{const b=_||w;return s[p]=!b||b.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s},f.a8=function(c){return Math.log(c)/Math.LN2},f.a9=function(c){var s=c[0],u=c[1];return s*s+u*u},f.aA=rr,f.aB=M_,f.aC=_e,f.aD=It,f.aE=tt,f.aF=85.051129,f.aG=function(c){return Math.pow(2,c)},f.aH=nE,f.aI=vn,f.aJ=hr,f.aK=iE,f.aL=function(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c[2]=s[2]*u,c},f.aM=function(c,s,u){return c[0]=s[0]+u[0],c[1]=s[1]+u[1],c[2]=s[2]+u[2],c},f.aN=function(c){var s=new fe(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s},f.aO=function(c,s,u){return c[0]=s[0]*u[0],c[1]=s[1]*u[1],c[2]=s[2]*u[2],c[3]=s[3]*u[3],c},f.aP=function(c,s,u){return c[0]=s[0]-u[0],c[1]=s[1]-u[1],c[2]=s[2]-u[2],c},f.aQ=function(c,s){var u=s[0],p=s[1],_=s[2],w=u*u+p*p+_*_;return w>0&&(w=1/Math.sqrt(w)),c[0]=s[0]*w,c[1]=s[1]*w,c[2]=s[2]*w,c},f.aR=function(c,s,u){var p=s[0],_=s[1],w=s[2],b=u[0],I=u[1],k=u[2];return c[0]=_*k-w*I,c[1]=w*b-p*k,c[2]=p*I-_*b,c},f.aS=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]},f.aT=sE,f.aU=ff,f.aV=function(c,s,u,p,_){var w,b=1/Math.tan(s/2);return c[0]=b/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=b,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0?(c[10]=(_+p)*(w=1/(p-_)),c[14]=2*_*p*w):(c[10]=-1,c[14]=-2*p),c},f.aW=function(c){var s=new fe(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},f.aX=function(c,s,u){var p=Math.sin(u),_=Math.cos(u),w=s[0],b=s[1],I=s[2],k=s[3],R=s[4],N=s[5],B=s[6],G=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=w*_+R*p,c[1]=b*_+N*p,c[2]=I*_+B*p,c[3]=k*_+G*p,c[4]=R*_-w*p,c[5]=N*_-b*p,c[6]=B*_-I*p,c[7]=G*_-k*p,c},f.aY=function(c,s,u){var p=Math.sin(u),_=Math.cos(u),w=s[4],b=s[5],I=s[6],k=s[7],R=s[8],N=s[9],B=s[10],G=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=w*_+R*p,c[5]=b*_+N*p,c[6]=I*_+B*p,c[7]=k*_+G*p,c[8]=R*_-w*p,c[9]=N*_-b*p,c[10]=B*_-I*p,c[11]=G*_-k*p,c},f.aZ=function(){const c=new Float32Array(16);return ue(c),c},f.a_=function(){const c=new Float64Array(16);return ue(c),c},f.aa=function(c){return c*Math.PI/180},f.ab=cn,f.ac=function(c,s){const u=[];for(const p in c)p in s||u.push(p);return u},f.ad=Xt,f.ae=function(c){return Math.hypot(c[0],c[1])},f.af=function(c){return c[0]=0,c[1]=0,c},f.ag=function(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c},f.ah=function(c,s){let u=0,p=0;if(c.kind==="constant")p=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:b}=c,I=_?cn(wn.interpolationFactor(_,s,w,b),0,1):0;c.kind==="camera"?p=Hr.number(c.minSize,c.maxSize,I):u=I}return{uSizeT:u,uSize:p}},f.aj=function(c,{uSize:s,uSizeT:u},{lowerSize:p,upperSize:_}){return c.kind==="source"?p/ru:c.kind==="composite"?Hr.number(p/ru,_/ru,u):s},f.ak=Ex,f.al=Ve,f.am=function(c,s,u,p){const _=s.y-c.y,w=s.x-c.x,b=p.y-u.y,I=p.x-u.x,k=b*w-I*_;if(k===0)return null;const R=(I*(c.y-u.y)-b*(c.x-u.x))/k;return new ie(c.x+R*w,c.y+R*_)},f.an=function(c,s){var u=s[0],p=s[1],_=s[2],w=s[3],b=s[4],I=s[5],k=s[6],R=s[7],N=s[8],B=s[9],G=s[10],X=s[11],Y=s[12],te=s[13],he=s[14],we=s[15],Ne=u*I-p*b,Se=u*k-_*b,K=u*R-w*b,ae=p*k-_*I,Ie=p*R-w*I,We=_*R-w*k,ct=N*te-B*Y,Xe=N*he-G*Y,it=N*we-X*Y,gt=B*he-G*te,dt=B*we-X*te,_t=G*we-X*he,ot=Ne*_t-Se*dt+K*gt+ae*it-Ie*Xe+We*ct;return ot?(c[0]=(I*_t-k*dt+R*gt)*(ot=1/ot),c[1]=(_*dt-p*_t-w*gt)*ot,c[2]=(te*We-he*Ie+we*ae)*ot,c[3]=(G*Ie-B*We-X*ae)*ot,c[4]=(k*it-b*_t-R*Xe)*ot,c[5]=(u*_t-_*it+w*Xe)*ot,c[6]=(he*K-Y*We-we*Se)*ot,c[7]=(N*We-G*K+X*Se)*ot,c[8]=(b*dt-I*it+R*ct)*ot,c[9]=(p*it-u*dt-w*ct)*ot,c[10]=(Y*Ie-te*K+we*Ne)*ot,c[11]=(B*K-N*Ie-X*Ne)*ot,c[12]=(I*Xe-b*gt-k*ct)*ot,c[13]=(u*gt-p*Xe+_*ct)*ot,c[14]=(te*Se-Y*ae-he*Ne)*ot,c[15]=(N*ae-B*Se+G*Ne)*ot,c):null},f.ao=dE,f.ap=Jp,f.aq=ue,f.ar=function(c){let s=1/0,u=1/0,p=-1/0,_=-1/0;for(const w of c)s=Math.min(s,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),_=Math.max(_,w.y);return[s,u,p,_]},f.as=xr,f.at=vi,f.au=function(c,s,u,p,_=!1){if(!u[0]&&!u[1])return[0,0];const w=_?p==="map"?-c.bearingInRadians:0:p==="viewport"?c.bearingInRadians:0;if(w){const b=Math.sin(w),I=Math.cos(w);u=[u[0]*I-u[1]*b,u[0]*b+u[1]*I]}return[_?u[0]:vi(s,u[0],c.zoom),_?u[1]:vi(s,u[1],c.zoom)]},f.aw=Sx,f.ax=Lx,f.ay=Tx,f.az=Dx,f.b=Ds,f.b$=c=>c.type==="line",f.b0=function(c,s,u){const p=new Float64Array(4);return function(_,w,b,I){var k=.5*Math.PI/180;w*=k,b*=k,I*=k;var R=Math.sin(w),N=Math.cos(w),B=Math.sin(b),G=Math.cos(b),X=Math.sin(I),Y=Math.cos(I);_[0]=R*G*Y-N*B*X,_[1]=N*B*Y+R*G*X,_[2]=N*G*X-R*B*Y,_[3]=N*G*Y+R*B*X}(p,c,s-90,u),p},f.b1=function(c,s,u,p){var _,w,b,I,k,R=s[0],N=s[1],B=s[2],G=s[3],X=u[0],Y=u[1],te=u[2],he=u[3];return(w=R*X+N*Y+B*te+G*he)<0&&(w=-w,X=-X,Y=-Y,te=-te,he=-he),1-w>qe?(_=Math.acos(w),b=Math.sin(_),I=Math.sin((1-p)*_)/b,k=Math.sin(p*_)/b):(I=1-p,k=p),c[0]=I*R+k*X,c[1]=I*N+k*Y,c[2]=I*B+k*te,c[3]=I*G+k*he,c},f.b2=function(c){const s=new Float64Array(9);var u,p,_,w,b,I,k,R,N,B,G,X,Y,te,he,we,Ne,Se;B=(_=(p=c)[0])*(k=_+_),G=(w=p[1])*k,Y=(b=p[2])*k,te=b*(R=w+w),we=(I=p[3])*k,Ne=I*R,Se=I*(N=b+b),(u=s)[0]=1-(X=w*R)-(he=b*N),u[3]=G-Se,u[6]=Y+Ne,u[1]=G+Se,u[4]=1-B-he,u[7]=te-we,u[2]=Y-Ne,u[5]=te+we,u[8]=1-B-X;const K=hr(-Math.asin(cn(s[2],-1,1)));let ae,Ie;return Math.hypot(s[5],s[8])<.001?(ae=0,Ie=-hr(Math.atan2(s[3],s[4]))):(ae=hr(s[5]===0&&s[8]===0?0:Math.atan2(s[5],s[8])),Ie=hr(s[1]===0&&s[0]===0?0:Math.atan2(s[1],s[0]))),{roll:ae,pitch:K+90,bearing:Ie}},f.b3=function(c,s){return c.roll==s.roll&&c.pitch==s.pitch&&c.bearing==s.bearing},f.b4=ln,f.b5=wl,f.b6=cf,f.b7=um,f.b8=uf,f.b9=Qt,f.bA=xi,f.bB=Ir,f.bC=class extends uo{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},f.bD=class extends uo{constructor(c,s){super(c,s),this.current=Nc}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},f.bE=Zh,f.bF=Wh,f.bG=class extends uo{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},f.bH=class extends uo{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},f.bI=Q,f.bJ=function(c,s){var u=Math.sin(s),p=Math.cos(s);return c[0]=p,c[1]=u,c[2]=0,c[3]=-u,c[4]=p,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},f.bK=function(c,s,u){var p=s[0],_=s[1],w=s[2];return c[0]=p*u[0]+_*u[3]+w*u[6],c[1]=p*u[1]+_*u[4]+w*u[7],c[2]=p*u[2]+_*u[5]+w*u[8],c},f.bL=function(c,s,u,p,_,w,b){var I=1/(s-u),k=1/(p-_),R=1/(w-b);return c[0]=-2*I,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*k,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*R,c[11]=0,c[12]=(s+u)*I,c[13]=(_+p)*k,c[14]=(b+w)*R,c[15]=1,c},f.bM=class extends Wp{},f.bN=H5,f.bO=class extends nu{},f.bP=sx,f.bQ=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},f.bR=aS,f.bS=function(c,s,u){var p=s[0],_=s[1],w=s[2],b=u[3]*p+u[7]*_+u[11]*w+u[15];return c[0]=(u[0]*p+u[4]*_+u[8]*w+u[12])/(b=b||1),c[1]=(u[1]*p+u[5]*_+u[9]*w+u[13])/b,c[2]=(u[2]*p+u[6]*_+u[10]*w+u[14])/b,c},f.bT=class extends Hp{},f.bU=class extends a{},f.bV=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]&&c[4]===s[4]&&c[5]===s[5]&&c[6]===s[6]&&c[7]===s[7]&&c[8]===s[8]&&c[9]===s[9]&&c[10]===s[10]&&c[11]===s[11]&&c[12]===s[12]&&c[13]===s[13]&&c[14]===s[14]&&c[15]===s[15]},f.bW=function(c,s){var u=c[0],p=c[1],_=c[2],w=c[3],b=c[4],I=c[5],k=c[6],R=c[7],N=c[8],B=c[9],G=c[10],X=c[11],Y=c[12],te=c[13],he=c[14],we=c[15],Ne=s[0],Se=s[1],K=s[2],ae=s[3],Ie=s[4],We=s[5],ct=s[6],Xe=s[7],it=s[8],gt=s[9],dt=s[10],_t=s[11],ot=s[12],Nt=s[13],Gt=s[14],Ht=s[15];return Math.abs(u-Ne)<=qe*Math.max(1,Math.abs(u),Math.abs(Ne))&&Math.abs(p-Se)<=qe*Math.max(1,Math.abs(p),Math.abs(Se))&&Math.abs(_-K)<=qe*Math.max(1,Math.abs(_),Math.abs(K))&&Math.abs(w-ae)<=qe*Math.max(1,Math.abs(w),Math.abs(ae))&&Math.abs(b-Ie)<=qe*Math.max(1,Math.abs(b),Math.abs(Ie))&&Math.abs(I-We)<=qe*Math.max(1,Math.abs(I),Math.abs(We))&&Math.abs(k-ct)<=qe*Math.max(1,Math.abs(k),Math.abs(ct))&&Math.abs(R-Xe)<=qe*Math.max(1,Math.abs(R),Math.abs(Xe))&&Math.abs(N-it)<=qe*Math.max(1,Math.abs(N),Math.abs(it))&&Math.abs(B-gt)<=qe*Math.max(1,Math.abs(B),Math.abs(gt))&&Math.abs(G-dt)<=qe*Math.max(1,Math.abs(G),Math.abs(dt))&&Math.abs(X-_t)<=qe*Math.max(1,Math.abs(X),Math.abs(_t))&&Math.abs(Y-ot)<=qe*Math.max(1,Math.abs(Y),Math.abs(ot))&&Math.abs(te-Nt)<=qe*Math.max(1,Math.abs(te),Math.abs(Nt))&&Math.abs(he-Gt)<=qe*Math.max(1,Math.abs(he),Math.abs(Gt))&&Math.abs(we-Ht)<=qe*Math.max(1,Math.abs(we),Math.abs(Ht))},f.bX=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},f.bY=c=>c.type==="symbol",f.bZ=c=>c.type==="circle",f.b_=c=>c.type==="heatmap",f.ba=Tt,f.bb=qi,f.bc=function(c,s,u,p,_){return Qt(p,_,cn((c-s)/(u-s),0,1))},f.bd=lt,f.be=function(){return new Float64Array(4)},f.bf=function(){return new Float64Array(3)},f.bg=function(c,s,u,p){var _=[],w=[];return _[0]=s[0]-u[0],_[1]=s[1]-u[1],_[2]=s[2]-u[2],w[0]=_[0]*Math.cos(p)-_[1]*Math.sin(p),w[1]=_[0]*Math.sin(p)+_[1]*Math.cos(p),w[2]=_[2],c[0]=w[0]+u[0],c[1]=w[1]+u[1],c[2]=w[2]+u[2],c},f.bh=function(c,s,u,p){var _=[],w=[];return _[0]=s[0]-u[0],_[1]=s[1]-u[1],_[2]=s[2]-u[2],w[0]=_[0],w[1]=_[1]*Math.cos(p)-_[2]*Math.sin(p),w[2]=_[1]*Math.sin(p)+_[2]*Math.cos(p),c[0]=w[0]+u[0],c[1]=w[1]+u[1],c[2]=w[2]+u[2],c},f.bi=function(c,s,u,p){var _=[],w=[];return _[0]=s[0]-u[0],_[1]=s[1]-u[1],_[2]=s[2]-u[2],w[0]=_[2]*Math.sin(p)+_[0]*Math.cos(p),w[1]=_[1],w[2]=_[2]*Math.cos(p)-_[0]*Math.sin(p),c[0]=w[0]+u[0],c[1]=w[1]+u[1],c[2]=w[2]+u[2],c},f.bj=function(c,s,u){var p=Math.sin(u),_=Math.cos(u),w=s[0],b=s[1],I=s[2],k=s[3],R=s[8],N=s[9],B=s[10],G=s[11];return s!==c&&(c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=w*_-R*p,c[1]=b*_-N*p,c[2]=I*_-B*p,c[3]=k*_-G*p,c[8]=w*p+R*_,c[9]=b*p+N*_,c[10]=I*p+B*_,c[11]=k*p+G*_,c},f.bk=function(c,s){const u=lt(c,360),p=lt(s,360),_=p-u,w=p>u?_-360:_+360;return Math.abs(_)<Math.abs(w)?_:w},f.bl=function(c){return c[0]=0,c[1]=0,c[2]=0,c},f.bm=function(c,s,u,p){const _=Math.sqrt(c*c+s*s),w=Math.sqrt(u*u+p*p);c/=_,s/=_,u/=w,p/=w;const b=Math.acos(c*u+s*p);return-s*u+c*p>0?b:-b},f.bn=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]},f.bo=Ax,f.bp=function(c,s){const u=lt(c,2*Math.PI),p=lt(s,2*Math.PI);return Math.min(Math.abs(u-p),Math.abs(u-p+2*Math.PI),Math.abs(u-p-2*Math.PI))},f.bq=function(c){return Math.hypot(c[0],c[1],c[2])},f.br=function(){const c={},s=pe.$version;for(const u in pe.$root){const p=pe.$root[u];if(p.required){let _=null;_=u==="version"?s:p.type==="array"?[]:{},_!=null&&(c[u]=_)}}return c},f.bs=f_,f.bt=Ti,f.bu=function(c){c=c.slice();const s=Object.create(null);for(let u=0;u<c.length;u++)s[c[u].id]=c[u];for(let u=0;u<c.length;u++)"ref"in c[u]&&(c[u]=re(c[u],s[c[u].ref]));return c},f.bv=function(c){if(c.type==="custom")return new pN(c);switch(c.type){case"background":return new hN(c);case"circle":return new o5(c);case"fill":return new E5(c);case"fill-extrusion":return new L5(c);case"heatmap":return new l5(c);case"hillshade":return new c5(c);case"line":return new j5(c);case"raster":return new fN(c);case"symbol":return new F_(c)}},f.bw=Pr,f.bx=function(c,s){if(!c)return[{command:"setStyle",args:[s]}];let u=[];try{if(!oe(c.version,s.version))return[{command:"setStyle",args:[s]}];oe(c.center,s.center)||u.push({command:"setCenter",args:[s.center]}),oe(c.centerAltitude,s.centerAltitude)||u.push({command:"setCenterAltitude",args:[s.centerAltitude]}),oe(c.zoom,s.zoom)||u.push({command:"setZoom",args:[s.zoom]}),oe(c.bearing,s.bearing)||u.push({command:"setBearing",args:[s.bearing]}),oe(c.pitch,s.pitch)||u.push({command:"setPitch",args:[s.pitch]}),oe(c.roll,s.roll)||u.push({command:"setRoll",args:[s.roll]}),oe(c.sprite,s.sprite)||u.push({command:"setSprite",args:[s.sprite]}),oe(c.glyphs,s.glyphs)||u.push({command:"setGlyphs",args:[s.glyphs]}),oe(c.transition,s.transition)||u.push({command:"setTransition",args:[s.transition]}),oe(c.light,s.light)||u.push({command:"setLight",args:[s.light]}),oe(c.terrain,s.terrain)||u.push({command:"setTerrain",args:[s.terrain]}),oe(c.sky,s.sky)||u.push({command:"setSky",args:[s.sky]}),oe(c.projection,s.projection)||u.push({command:"setProjection",args:[s.projection]});const p={},_=[];(function(b,I,k,R){let N;for(N in I=I||{},b=b||{})Object.prototype.hasOwnProperty.call(b,N)&&(Object.prototype.hasOwnProperty.call(I,N)||Be(N,k,R));for(N in I)Object.prototype.hasOwnProperty.call(I,N)&&(Object.prototype.hasOwnProperty.call(b,N)?oe(b[N],I[N])||(b[N].type==="geojson"&&I[N].type==="geojson"&&Fe(b,I,N)?Te(k,{command:"setGeoJSONSourceData",args:[N,I[N].data]}):He(N,I,k,R)):Le(N,I,k))})(c.sources,s.sources,_,p);const w=[];c.layers&&c.layers.forEach(b=>{"source"in b&&p[b.source]?u.push({command:"removeLayer",args:[b.id]}):w.push(b)}),u=u.concat(_),function(b,I,k){I=I||[];const R=(b=b||[]).map(Ye),N=I.map(Ye),B=b.reduce(Ue,{}),G=I.reduce(Ue,{}),X=R.slice(),Y=Object.create(null);let te,he,we,Ne,Se;for(let K=0,ae=0;K<R.length;K++)te=R[K],Object.prototype.hasOwnProperty.call(G,te)?ae++:(Te(k,{command:"removeLayer",args:[te]}),X.splice(X.indexOf(te,ae),1));for(let K=0,ae=0;K<N.length;K++)te=N[N.length-1-K],X[X.length-1-K]!==te&&(Object.prototype.hasOwnProperty.call(B,te)?(Te(k,{command:"removeLayer",args:[te]}),X.splice(X.lastIndexOf(te,X.length-ae),1)):ae++,Ne=X[X.length-K],Te(k,{command:"addLayer",args:[G[te],Ne]}),X.splice(X.length-K,0,te),Y[te]=!0);for(let K=0;K<N.length;K++)if(te=N[K],he=B[te],we=G[te],!Y[te]&&!oe(he,we))if(oe(he.source,we.source)&&oe(he["source-layer"],we["source-layer"])&&oe(he.type,we.type)){for(Se in Qe(he.layout,we.layout,k,te,null,"setLayoutProperty"),Qe(he.paint,we.paint,k,te,null,"setPaintProperty"),oe(he.filter,we.filter)||Te(k,{command:"setFilter",args:[te,we.filter]}),oe(he.minzoom,we.minzoom)&&oe(he.maxzoom,we.maxzoom)||Te(k,{command:"setLayerZoomRange",args:[te,we.minzoom,we.maxzoom]}),he)Object.prototype.hasOwnProperty.call(he,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Qe(he[Se],we[Se],k,te,Se.slice(6),"setPaintProperty"):oe(he[Se],we[Se])||Te(k,{command:"setLayerProperty",args:[te,Se,we[Se]]}));for(Se in we)Object.prototype.hasOwnProperty.call(we,Se)&&!Object.prototype.hasOwnProperty.call(he,Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?Qe(he[Se],we[Se],k,te,Se.slice(6),"setPaintProperty"):oe(he[Se],we[Se])||Te(k,{command:"setLayerProperty",args:[te,Se,we[Se]]}))}else Te(k,{command:"removeLayer",args:[te]}),Ne=X[X.lastIndexOf(te)+1],Te(k,{command:"addLayer",args:[we,Ne]})}(w,s.layers,u)}catch(p){console.warn("Unable to compute style diff:",p),u=[{command:"setStyle",args:[s]}]}return u},f.by=function(c){const s=[],u=c.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},f.bz=function c(s,u){if(Array.isArray(s)){if(!Array.isArray(u)||s.length!==u.length)return!1;for(let p=0;p<s.length;p++)if(!c(s[p],u[p]))return!1;return!0}if(typeof s=="object"&&s!==null&&u!==null){if(typeof u!="object"||Object.keys(s).length!==Object.keys(u).length)return!1;for(const p in s)if(!c(s[p],u[p]))return!1;return!0}return s===u},f.c=bo,f.c0=c=>c.type==="fill",f.c1=c=>c.type==="fill-extrusion",f.c2=c=>c.type==="hillshade",f.c3=c=>c.type==="raster",f.c4=c=>c.type==="background",f.c5=c=>c.type==="custom",f.c6=nn,f.c7=function(c,s,u){const p=tr(s.x-u.x,s.y-u.y),_=tr(c.x-u.x,c.y-u.y);var w,b;return hr(Math.atan2(p[0]*_[1]-p[1]*_[0],(w=p)[0]*(b=_)[0]+w[1]*b[1]))},f.c8=rn,f.c9=function(c,s,u){var p=s[0],_=s[1];return c[0]=u[0]*p+u[4]*_+u[12],c[1]=u[1]*p+u[5]*_+u[13],c},f.cA=NS,f.cB=Ic,f.cC=yl,f.ca=function(c,s){const{x:u,y:p}=_m.fromLngLat(s);return!(c<0||c>25||p<0||p>=1||u<0||u>=1)},f.cb=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},f.cc=class extends $h{},f.cd=SN,f.cf=function(c){return c.message===zs},f.cg=ni,f.ch=function(c,s){ds.REGISTERED_PROTOCOLS[c]=s},f.ci=function(c){delete ds.REGISTERED_PROTOCOLS[c]},f.cj=function(c,s){const u={};for(let _=0;_<c.length;_++){const w=s&&s[c[_].id]||P(c[_]);s&&(s[c[_].id]=w);let b=u[w];b||(b=u[w]=[]),b.push(c[_])}const p=[];for(const _ in u)p.push(u[_]);return p},f.ck=Rt,f.cl=aE,f.cm=uE,f.cn=FS,f.co=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Yt/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0],u=s.layout,p=s._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new zi(c.bucket.zoom+1),c.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new zi(c.bucket.zoom+1),c.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new zi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:N}=c.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new zi(R),c.canonical),p["text-size"].possiblyEvaluate(new zi(N),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:N}=c.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new zi(R),c.canonical),p["icon-size"].possiblyEvaluate(new zi(N),c.canonical)]}const w=u.get("text-line-height")*xr,b=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",I=u.get("text-keep-upright"),k=u.get("text-size");for(const R of c.bucket.features){const N=u.get("text-font").evaluate(R,{},c.canonical).join(","),B=k.evaluate(R,{},c.canonical),G=_.layoutTextSize.evaluate(R,{},c.canonical),X=_.layoutIconSize.evaluate(R,{},c.canonical),Y={horizontal:{},vertical:void 0},te=R.text;let he,we=[0,0];if(te){const K=te.toString(),ae=u.get("text-letter-spacing").evaluate(R,{},c.canonical)*xr,Ie=p_(K)?ae:0,We=u.get("text-anchor").evaluate(R,{},c.canonical),ct=wE(s,R,c.canonical);if(!ct){const dt=u.get("text-radial-offset").evaluate(R,{},c.canonical);we=dt?xE(We,[dt*xr,Rx]):u.get("text-offset").evaluate(R,{},c.canonical).map(_t=>_t*xr)}let Xe=b?"center":u.get("text-justify").evaluate(R,{},c.canonical);const it=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(R,{},c.canonical)*xr:1/0,gt=()=>{c.bucket.allowVerticalPlacement&&Rc(K)&&(Y.vertical=z_(te,c.glyphMap,c.glyphPositions,c.imagePositions,N,it,w,We,"left",Ie,we,f.ai.vertical,!0,G,B))};if(!b&&ct){const dt=new Set;if(Xe==="auto")for(let ot=0;ot<ct.values.length;ot+=2)dt.add(Lx(ct.values[ot]));else dt.add(Xe);let _t=!1;for(const ot of dt)if(!Y.horizontal[ot])if(_t)Y.horizontal[ot]=Y.horizontal[0];else{const Nt=z_(te,c.glyphMap,c.glyphPositions,c.imagePositions,N,it,w,"center",ot,Ie,we,f.ai.horizontal,!1,G,B);Nt&&(Y.horizontal[ot]=Nt,_t=Nt.positionedLines.length===1)}gt()}else{Xe==="auto"&&(Xe=Lx(We));const dt=z_(te,c.glyphMap,c.glyphPositions,c.imagePositions,N,it,w,We,Xe,Ie,we,f.ai.horizontal,!1,G,B);dt&&(Y.horizontal[Xe]=dt),gt(),Rc(K)&&b&&I&&(Y.vertical=z_(te,c.glyphMap,c.glyphPositions,c.imagePositions,N,it,w,We,Xe,Ie,we,f.ai.vertical,!1,G,B))}}let Ne=!1;if(R.icon&&R.icon.name){const K=c.imageMap[R.icon.name];K&&(he=oN(c.imagePositions[R.icon.name],u.get("icon-offset").evaluate(R,{},c.canonical),u.get("icon-anchor").evaluate(R,{},c.canonical)),Ne=!!K.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ne:c.bucket.sdfIcons!==Ne&&ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(K.pixelRatio!==c.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Se=TE(Y.horizontal)||Y.vertical;c.bucket.iconsInText=!!Se&&Se.iconsInText,(Se||he)&&bN(c.bucket,R,Y,he,c.imageMap,_,G,X,we,Ne,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},f.cp=gx,f.cq=cx,f.cr=mx,f.cs=hm,f.ct=vx,f.cu=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},f.cv=function(c,s,u,p,_){return l(this,void 0,void 0,function*(){if(je())try{return yield Br(c,s,u,p,_)}catch{}return function(w,b,I,k,R){const N=w.width,B=w.height;hs&&no||(hs=new OffscreenCanvas(N,B),no=hs.getContext("2d",{willReadFrequently:!0})),hs.width=N,hs.height=B,no.drawImage(w,0,0,N,B);const G=no.getImageData(b,I,k,R);return no.clearRect(0,0,N,B),G.data}(c,s,u,p,_)})},f.cw=oE,f.cx=S,f.cy=U,f.cz=SS,f.d=c=>l(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(s)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=Jt,f.f=c=>new Promise((s,u)=>{const p=new Image;p.onload=()=>{s(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=to})},p.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(c)],{type:"image/png"});p.src=c.byteLength?URL.createObjectURL(_):to}),f.g=Xo,f.h=(c,s)=>Vr(Jt(c,{type:"json"}),s),f.i=Fr,f.j=Qo,f.k=Os,f.l=(c,s)=>Vr(Jt(c,{type:"arrayBuffer"}),s),f.m=Vr,f.n=function(c){return new vx(c).readFields(W5,[])},f.o=rm,f.p=OS,f.q=qs,f.r=Q0,f.s=So,f.t=c_,f.u=Mc,f.v=pe,f.w=ki,f.x=function([c,s,u]){return s+=90,s*=Math.PI/180,u*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(u),y:c*Math.sin(s)*Math.sin(u),z:c*Math.cos(u)}},f.y=Hr,f.z=zi}),o("worker",["./shared"],function(f){class l{constructor(ee){this.keyCache={},ee&&this.replace(ee)}replace(ee){this._layerConfigs={},this._layers={},this.update(ee,[])}update(ee,re){for(const Te of ee){this._layerConfigs[Te.id]=Te;const Le=this._layers[Te.id]=f.bv(Te);Le._featureFilter=f.a4(Le.filter),this.keyCache[Te.id]&&delete this.keyCache[Te.id]}for(const Te of re)delete this.keyCache[Te],delete this._layerConfigs[Te],delete this._layers[Te];this.familiesBySource={};const oe=f.cj(Object.values(this._layerConfigs),this.keyCache);for(const Te of oe){const Le=Te.map(Ue=>this._layers[Ue.id]),Be=Le[0];if(Be.visibility==="none")continue;const He=Be.source||"";let Fe=this.familiesBySource[He];Fe||(Fe=this.familiesBySource[He]={});const Qe=Be.sourceLayer||"_geojsonTileLayer";let Ye=Fe[Qe];Ye||(Ye=Fe[Qe]=[]),Ye.push(Le)}}}class S{constructor(ee){const re={},oe=[];for(const He in ee){const Fe=ee[He],Qe=re[He]={};for(const Ye in Fe){const Ue=Fe[+Ye];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Oe={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};oe.push(Oe),Qe[Ye]={rect:Oe,metrics:Ue.metrics}}}const{w:Te,h:Le}=f.p(oe),Be=new f.o({width:Te||1,height:Le||1});for(const He in ee){const Fe=ee[He];for(const Qe in Fe){const Ye=Fe[+Qe];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Ue=re[He][Qe].rect;f.o.copy(Ye.bitmap,Be,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},Ye.bitmap)}}this.image=Be,this.positions=re}}f.ck("GlyphAtlas",S);class A{constructor(ee){this.tileID=new f.S(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId,this.inFlightDependencies=[]}parse(ee,re,oe,Te,Le){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=ee,this.collisionBoxArray=new f.a2;const Be=new f.cl(Object.keys(ee.layers).sort()),He=new f.cm(this.tileID,this.promoteId);He.bucketLayerIDs=[];const Fe={},Qe={featureIndex:He,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe,subdivisionGranularity:Le},Ye=re.familiesBySource[this.source];for(const qt in Ye){const kt=ee.layers[qt];if(!kt)continue;kt.version===1&&f.w(`Vector tile source "${this.source}" layer "${qt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qn=Be.encode(qt),ps=[];for(let Si=0;Si<kt.length;Si++){const Zn=kt.feature(Si),zn=He.getId(Zn,qt);ps.push({feature:Zn,id:zn,index:Si,sourceLayerIndex:Qn})}for(const Si of Ye[qt]){const Zn=Si[0];Zn.source!==this.source&&f.w(`layer.source = ${Zn.source} does not equal this.source = ${this.source}`),Zn.minzoom&&this.zoom<Math.floor(Zn.minzoom)||Zn.maxzoom&&this.zoom>=Zn.maxzoom||Zn.visibility!=="none"&&(O(Si,this.zoom,oe),(Fe[Zn.id]=Zn.createBucket({index:He.bucketLayerIDs.length,layers:Si,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qn,sourceID:this.source})).populate(ps,Qe,this.tileID.canonical),He.bucketLayerIDs.push(Si.map(zn=>zn.id)))}}const Ue=f.bA(Qe.glyphDependencies,qt=>Object.keys(qt).map(Number));this.inFlightDependencies.forEach(qt=>qt==null?void 0:qt.abort()),this.inFlightDependencies=[];let Oe=Promise.resolve({});if(Object.keys(Ue).length){const qt=new AbortController;this.inFlightDependencies.push(qt),Oe=Te.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},qt)}const yt=Object.keys(Qe.iconDependencies);let vt=Promise.resolve({});if(yt.length){const qt=new AbortController;this.inFlightDependencies.push(qt),vt=Te.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"icons"}},qt)}const zt=Object.keys(Qe.patternDependencies);let tn=Promise.resolve({});if(zt.length){const qt=new AbortController;this.inFlightDependencies.push(qt),tn=Te.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},qt)}const[nt,wt,Ct]=yield Promise.all([Oe,vt,tn]),xt=new S(nt),hn=new f.cn(wt,Ct);for(const qt in Fe){const kt=Fe[qt];kt instanceof f.a3?(O(kt.layers,this.zoom,oe),f.co({bucket:kt,glyphMap:nt,glyphPositions:xt.positions,imageMap:wt,imagePositions:hn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Qe.subdivisionGranularity})):kt.hasPattern&&(kt instanceof f.cp||kt instanceof f.cq||kt instanceof f.cr)&&(O(kt.layers,this.zoom,oe),kt.addFeatures(Qe,this.tileID.canonical,hn.patternPositions))}return this.status="done",{buckets:Object.values(Fe).filter(qt=>!qt.isEmpty()),featureIndex:He,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xt.image,imageAtlas:hn,glyphMap:this.returnDependencies?nt:null,iconMap:this.returnDependencies?wt:null,glyphPositions:this.returnDependencies?xt.positions:null}})}}function O(pe,ee,re){const oe=new f.z(ee);for(const Te of pe)Te.recalculate(oe,re)}class U{constructor(ee,re,oe){this.actor=ee,this.layerIndex=re,this.availableImages=oe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ee,re){return f._(this,void 0,void 0,function*(){const oe=yield f.l(ee.request,re);try{return{vectorTile:new f.cs.VectorTile(new f.ct(oe.data)),rawData:oe.data,cacheControl:oe.cacheControl,expires:oe.expires}}catch(Te){const Le=new Uint8Array(oe.data);let Be=`Unable to parse the tile at ${ee.request.url}, `;throw Be+=Le[0]===31&&Le[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Te.message}`,new Error(Be)}})}loadTile(ee){return f._(this,void 0,void 0,function*(){const re=ee.uid,oe=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new f.cu(ee.request),Te=new A(ee);this.loading[re]=Te;const Le=new AbortController;Te.abort=Le;try{const Be=yield this.loadVectorTile(ee,Le);if(delete this.loading[re],!Be)return null;const He=Be.rawData,Fe={};Be.expires&&(Fe.expires=Be.expires),Be.cacheControl&&(Fe.cacheControl=Be.cacheControl);const Qe={};if(oe){const Ue=oe.finish();Ue&&(Qe.resourceTiming=JSON.parse(JSON.stringify(Ue)))}Te.vectorTile=Be.vectorTile;const Ye=Te.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity);this.loaded[re]=Te,this.fetching[re]={rawTileData:He,cacheControl:Fe,resourceTiming:Qe};try{const Ue=yield Ye;return f.e({rawTileData:He.slice(0)},Ue,Fe,Qe)}finally{delete this.fetching[re]}}catch(Be){throw delete this.loading[re],Te.status="done",this.loaded[re]=Te,Be}})}reloadTile(ee){return f._(this,void 0,void 0,function*(){const re=ee.uid;if(!this.loaded||!this.loaded[re])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const oe=this.loaded[re];if(oe.showCollisionBoxes=ee.showCollisionBoxes,oe.status==="parsing"){const Te=yield oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity);let Le;if(this.fetching[re]){const{rawTileData:Be,cacheControl:He,resourceTiming:Fe}=this.fetching[re];delete this.fetching[re],Le=f.e({rawTileData:Be.slice(0)},Te,He,Fe)}else Le=Te;return Le}if(oe.status==="done"&&oe.vectorTile)return oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,ee.subdivisionGranularity)})}abortTile(ee){return f._(this,void 0,void 0,function*(){const re=this.loading,oe=ee.uid;re&&re[oe]&&re[oe].abort&&(re[oe].abort.abort(),delete re[oe])})}removeTile(ee){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ee.uid]&&delete this.loaded[ee.uid]})}}class H{constructor(){this.loaded={}}loadTile(ee){return f._(this,void 0,void 0,function*(){const{uid:re,encoding:oe,rawImageData:Te,redFactor:Le,greenFactor:Be,blueFactor:He,baseShift:Fe}=ee,Qe=Te.width+2,Ye=Te.height+2,Ue=f.b(Te)?new f.R({width:Qe,height:Ye},yield f.cv(Te,-1,-1,Qe,Ye)):Te,Oe=new f.cw(re,Ue,oe,Le,Be,He,Fe);return this.loaded=this.loaded||{},this.loaded[re]=Oe,Oe})}removeTile(ee){const re=this.loaded,oe=ee.uid;re&&re[oe]&&delete re[oe]}}var $,ie,me=function(){if(ie)return $;function pe(re,oe){if(re.length!==0){ee(re[0],oe);for(var Te=1;Te<re.length;Te++)ee(re[Te],!oe)}}function ee(re,oe){for(var Te=0,Le=0,Be=0,He=re.length,Fe=He-1;Be<He;Fe=Be++){var Qe=(re[Be][0]-re[Fe][0])*(re[Fe][1]+re[Be][1]),Ye=Te+Qe;Le+=Math.abs(Te)>=Math.abs(Qe)?Te-Ye+Qe:Qe-Ye+Te,Te=Ye}Te+Le>=0!=!!oe&&re.reverse()}return ie=1,$=function re(oe,Te){var Le,Be=oe&&oe.type;if(Be==="FeatureCollection")for(Le=0;Le<oe.features.length;Le++)re(oe.features[Le],Te);else if(Be==="GeometryCollection")for(Le=0;Le<oe.geometries.length;Le++)re(oe.geometries[Le],Te);else if(Be==="Feature")re(oe.geometry,Te);else if(Be==="Polygon")pe(oe.coordinates,Te);else if(Be==="MultiPolygon")for(Le=0;Le<oe.coordinates.length;Le++)pe(oe.coordinates[Le],Te);return oe}}(),Me=f.cx(me);const ce=f.cs.VectorTileFeature.prototype.toGeoJSON;class le{constructor(ee){this._feature=ee,this.extent=f.X,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const re of this._feature.geometry)ee.push([new f.P(re[0],re[1])]);return ee}{const ee=[];for(const re of this._feature.geometry){const oe=[];for(const Te of re)oe.push(new f.P(Te[0],Te[1]));ee.push(oe)}return ee}}toGeoJSON(ee,re,oe){return ce.call(this,ee,re,oe)}}class ge{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.X,this.length=ee.length,this._features=ee}feature(ee){return new le(this._features[ee])}}var je,rt,qe,fe={exports:{}},Q=function(){if(qe)return fe.exports;qe=1;var pe=f.cA(),ee=function(){if(rt)return je;rt=1;var Ye=f.cy(),Ue=f.cz().VectorTileFeature;function Oe(vt,zt){this.options=zt||{},this.features=vt,this.length=vt.length}function yt(vt,zt){this.id=typeof vt.id=="number"?vt.id:void 0,this.type=vt.type,this.rawGeometry=vt.type===1?[vt.geometry]:vt.geometry,this.properties=vt.tags,this.extent=zt||4096}return je=Oe,Oe.prototype.feature=function(vt){return new yt(this.features[vt],this.options.extent)},yt.prototype.loadGeometry=function(){var vt=this.rawGeometry;this.geometry=[];for(var zt=0;zt<vt.length;zt++){for(var tn=vt[zt],nt=[],wt=0;wt<tn.length;wt++)nt.push(new Ye(tn[wt][0],tn[wt][1]));this.geometry.push(nt)}return this.geometry},yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var vt=this.geometry,zt=1/0,tn=-1/0,nt=1/0,wt=-1/0,Ct=0;Ct<vt.length;Ct++)for(var xt=vt[Ct],hn=0;hn<xt.length;hn++){var qt=xt[hn];zt=Math.min(zt,qt.x),tn=Math.max(tn,qt.x),nt=Math.min(nt,qt.y),wt=Math.max(wt,qt.y)}return[zt,nt,tn,wt]},yt.prototype.toGeoJSON=Ue.prototype.toGeoJSON,je}();function re(Ye){var Ue=new pe;return function(Oe,yt){for(var vt in Oe.layers)yt.writeMessage(3,oe,Oe.layers[vt])}(Ye,Ue),Ue.finish()}function oe(Ye,Ue){var Oe;Ue.writeVarintField(15,Ye.version||1),Ue.writeStringField(1,Ye.name||""),Ue.writeVarintField(5,Ye.extent||4096);var yt={keys:[],values:[],keycache:{},valuecache:{}};for(Oe=0;Oe<Ye.length;Oe++)yt.feature=Ye.feature(Oe),Ue.writeMessage(2,Te,yt);var vt=yt.keys;for(Oe=0;Oe<vt.length;Oe++)Ue.writeStringField(3,vt[Oe]);var zt=yt.values;for(Oe=0;Oe<zt.length;Oe++)Ue.writeMessage(4,Qe,zt[Oe])}function Te(Ye,Ue){var Oe=Ye.feature;Oe.id!==void 0&&Ue.writeVarintField(1,Oe.id),Ue.writeMessage(2,Le,Ye),Ue.writeVarintField(3,Oe.type),Ue.writeMessage(4,Fe,Oe)}function Le(Ye,Ue){var Oe=Ye.feature,yt=Ye.keys,vt=Ye.values,zt=Ye.keycache,tn=Ye.valuecache;for(var nt in Oe.properties){var wt=Oe.properties[nt],Ct=zt[nt];if(wt!==null){Ct===void 0&&(yt.push(nt),zt[nt]=Ct=yt.length-1),Ue.writeVarint(Ct);var xt=typeof wt;xt!=="string"&&xt!=="boolean"&&xt!=="number"&&(wt=JSON.stringify(wt));var hn=xt+":"+wt,qt=tn[hn];qt===void 0&&(vt.push(wt),tn[hn]=qt=vt.length-1),Ue.writeVarint(qt)}}}function Be(Ye,Ue){return(Ue<<3)+(7&Ye)}function He(Ye){return Ye<<1^Ye>>31}function Fe(Ye,Ue){for(var Oe=Ye.loadGeometry(),yt=Ye.type,vt=0,zt=0,tn=Oe.length,nt=0;nt<tn;nt++){var wt=Oe[nt],Ct=1;yt===1&&(Ct=wt.length),Ue.writeVarint(Be(1,Ct));for(var xt=yt===3?wt.length-1:wt.length,hn=0;hn<xt;hn++){hn===1&&yt!==1&&Ue.writeVarint(Be(2,xt-1));var qt=wt[hn].x-vt,kt=wt[hn].y-zt;Ue.writeVarint(He(qt)),Ue.writeVarint(He(kt)),vt+=qt,zt+=kt}yt===3&&Ue.writeVarint(Be(7,1))}}function Qe(Ye,Ue){var Oe=typeof Ye;Oe==="string"?Ue.writeStringField(1,Ye):Oe==="boolean"?Ue.writeBooleanField(7,Ye):Oe==="number"&&(Ye%1!=0?Ue.writeDoubleField(3,Ye):Ye<0?Ue.writeSVarintField(6,Ye):Ue.writeVarintField(5,Ye))}return fe.exports=re,fe.exports.fromVectorTileJs=re,fe.exports.fromGeojsonVt=function(Ye,Ue){Ue=Ue||{};var Oe={};for(var yt in Ye)Oe[yt]=new ee(Ye[yt].features,Ue),Oe[yt].name=yt,Oe[yt].version=Ue.version,Oe[yt].extent=Ue.extent;return re({layers:Oe})},fe.exports.GeoJSONWrapper=ee,fe.exports}(),ue=f.cx(Q);const ve={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pe=>pe},Pe=Math.fround||(Ve=new Float32Array(1),pe=>(Ve[0]=+pe,Ve[0]));var Ve;const Ee=3,Xt=5,tr=6;class Yt{constructor(ee){this.options=Object.assign(Object.create(ve),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:re,minZoom:oe,maxZoom:Te}=this.options;re&&console.time("total time");const Le=`prepare ${ee.length} points`;re&&console.time(Le),this.points=ee;const Be=[];for(let Fe=0;Fe<ee.length;Fe++){const Qe=ee[Fe];if(!Qe.geometry)continue;const[Ye,Ue]=Qe.geometry.coordinates,Oe=Pe(Qt(Ye)),yt=Pe(Tt(Ue));Be.push(Oe,yt,1/0,Fe,-1,1),this.options.reduce&&Be.push(0)}let He=this.trees[Te+1]=this._createTree(Be);re&&console.timeEnd(Le);for(let Fe=Te;Fe>=oe;Fe--){const Qe=+Date.now();He=this.trees[Fe]=this._createTree(this._cluster(He,Fe)),re&&console.log("z%d: %d clusters in %dms",Fe,He.numItems,+Date.now()-Qe)}return re&&console.timeEnd("total time"),this}getClusters(ee,re){let oe=((ee[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,ee[1]));let Le=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)oe=-180,Le=180;else if(oe>Le){const Ue=this.getClusters([oe,Te,180,Be],re),Oe=this.getClusters([-180,Te,Le,Be],re);return Ue.concat(Oe)}const He=this.trees[this._limitZoom(re)],Fe=He.range(Qt(oe),Tt(Be),Qt(Le),Tt(Te)),Qe=He.data,Ye=[];for(const Ue of Fe){const Oe=this.stride*Ue;Ye.push(Qe[Oe+Xt]>1?vi(Qe,Oe,this.clusterProps):this.points[Qe[Oe+Ee]])}return Ye}getChildren(ee){const re=this._getOriginId(ee),oe=this._getOriginZoom(ee),Te="No cluster with the specified id.",Le=this.trees[oe];if(!Le)throw new Error(Te);const Be=Le.data;if(re*this.stride>=Be.length)throw new Error(Te);const He=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Fe=Le.within(Be[re*this.stride],Be[re*this.stride+1],He),Qe=[];for(const Ye of Fe){const Ue=Ye*this.stride;Be[Ue+4]===ee&&Qe.push(Be[Ue+Xt]>1?vi(Be,Ue,this.clusterProps):this.points[Be[Ue+Ee]])}if(Qe.length===0)throw new Error(Te);return Qe}getLeaves(ee,re,oe){const Te=[];return this._appendLeaves(Te,ee,re=re||10,oe=oe||0,0),Te}getTile(ee,re,oe){const Te=this.trees[this._limitZoom(ee)],Le=Math.pow(2,ee),{extent:Be,radius:He}=this.options,Fe=He/Be,Qe=(oe-Fe)/Le,Ye=(oe+1+Fe)/Le,Ue={features:[]};return this._addTileFeatures(Te.range((re-Fe)/Le,Qe,(re+1+Fe)/Le,Ye),Te.data,re,oe,Le,Ue),re===0&&this._addTileFeatures(Te.range(1-Fe/Le,Qe,1,Ye),Te.data,Le,oe,Le,Ue),re===Le-1&&this._addTileFeatures(Te.range(0,Qe,Fe/Le,Ye),Te.data,-1,oe,Le,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(ee){let re=this._getOriginZoom(ee)-1;for(;re<=this.options.maxZoom;){const oe=this.getChildren(ee);if(re++,oe.length!==1)break;ee=oe[0].properties.cluster_id}return re}_appendLeaves(ee,re,oe,Te,Le){const Be=this.getChildren(re);for(const He of Be){const Fe=He.properties;if(Fe&&Fe.cluster?Le+Fe.point_count<=Te?Le+=Fe.point_count:Le=this._appendLeaves(ee,Fe.cluster_id,oe,Te,Le):Le<Te?Le++:ee.push(He),ee.length===oe)break}return Le}_createTree(ee){const re=new f.az(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<ee.length;oe+=this.stride)re.add(ee[oe],ee[oe+1]);return re.finish(),re.data=ee,re}_addTileFeatures(ee,re,oe,Te,Le,Be){for(const He of ee){const Fe=He*this.stride,Qe=re[Fe+Xt]>1;let Ye,Ue,Oe;if(Qe)Ye=lt(re,Fe,this.clusterProps),Ue=re[Fe],Oe=re[Fe+1];else{const zt=this.points[re[Fe+Ee]];Ye=zt.properties;const[tn,nt]=zt.geometry.coordinates;Ue=Qt(tn),Oe=Tt(nt)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Ue*Le-oe)),Math.round(this.options.extent*(Oe*Le-Te))]],tags:Ye};let vt;vt=Qe||this.options.generateId?re[Fe+Ee]:this.points[re[Fe+Ee]].id,vt!==void 0&&(yt.id=vt),Be.features.push(yt)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,re){const{radius:oe,extent:Te,reduce:Le,minPoints:Be}=this.options,He=oe/(Te*Math.pow(2,re)),Fe=ee.data,Qe=[],Ye=this.stride;for(let Ue=0;Ue<Fe.length;Ue+=Ye){if(Fe[Ue+2]<=re)continue;Fe[Ue+2]=re;const Oe=Fe[Ue],yt=Fe[Ue+1],vt=ee.within(Fe[Ue],Fe[Ue+1],He),zt=Fe[Ue+Xt];let tn=zt;for(const nt of vt){const wt=nt*Ye;Fe[wt+2]>re&&(tn+=Fe[wt+Xt])}if(tn>zt&&tn>=Be){let nt,wt=Oe*zt,Ct=yt*zt,xt=-1;const hn=((Ue/Ye|0)<<5)+(re+1)+this.points.length;for(const qt of vt){const kt=qt*Ye;if(Fe[kt+2]<=re)continue;Fe[kt+2]=re;const Qn=Fe[kt+Xt];wt+=Fe[kt]*Qn,Ct+=Fe[kt+1]*Qn,Fe[kt+4]=hn,Le&&(nt||(nt=this._map(Fe,Ue,!0),xt=this.clusterProps.length,this.clusterProps.push(nt)),Le(nt,this._map(Fe,kt)))}Fe[Ue+4]=hn,Qe.push(wt/tn,Ct/tn,1/0,hn,-1,tn),Le&&Qe.push(xt)}else{for(let nt=0;nt<Ye;nt++)Qe.push(Fe[Ue+nt]);if(tn>1)for(const nt of vt){const wt=nt*Ye;if(!(Fe[wt+2]<=re)){Fe[wt+2]=re;for(let Ct=0;Ct<Ye;Ct++)Qe.push(Fe[wt+Ct])}}}}return Qe}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,re,oe){if(ee[re+Xt]>1){const Be=this.clusterProps[ee[re+tr]];return oe?Object.assign({},Be):Be}const Te=this.points[ee[re+Ee]].properties,Le=this.options.map(Te);return oe&&Le===Te?Object.assign({},Le):Le}}function vi(pe,ee,re){return{type:"Feature",id:pe[ee+Ee],properties:lt(pe,ee,re),geometry:{type:"Point",coordinates:[(oe=pe[ee],360*(oe-.5)),nn(pe[ee+1])]}};var oe}function lt(pe,ee,re){const oe=pe[ee+Xt],Te=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,Le=pe[ee+tr],Be=Le===-1?{}:Object.assign({},re[Le]);return Object.assign(Be,{cluster:!0,cluster_id:pe[ee+Ee],point_count:oe,point_count_abbreviated:Te})}function Qt(pe){return pe/360+.5}function Tt(pe){const ee=Math.sin(pe*Math.PI/180),re=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return re<0?0:re>1?1:re}function nn(pe){const ee=(180-360*pe)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function rn(pe,ee,re,oe){let Te=oe;const Le=ee+(re-ee>>1);let Be,He=re-ee;const Fe=pe[ee],Qe=pe[ee+1],Ye=pe[re],Ue=pe[re+1];for(let Oe=ee+3;Oe<re;Oe+=3){const yt=cn(pe[Oe],pe[Oe+1],Fe,Qe,Ye,Ue);if(yt>Te)Be=Oe,Te=yt;else if(yt===Te){const vt=Math.abs(Oe-Le);vt<He&&(Be=Oe,He=vt)}}Te>oe&&(Be-ee>3&&rn(pe,ee,Be,oe),pe[Be+2]=Te,re-Be>3&&rn(pe,Be,re,oe))}function cn(pe,ee,re,oe,Te,Le){let Be=Te-re,He=Le-oe;if(Be!==0||He!==0){const Fe=((pe-re)*Be+(ee-oe)*He)/(Be*Be+He*He);Fe>1?(re=Te,oe=Le):Fe>0&&(re+=Be*Fe,oe+=He*Fe)}return Be=pe-re,He=ee-oe,Be*Be+He*He}function vn(pe,ee,re,oe){const Te={id:pe??null,type:ee,geometry:re,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Jt(Te,re);else if(ee==="Polygon")Jt(Te,re[0]);else if(ee==="MultiLineString")for(const Le of re)Jt(Te,Le);else if(ee==="MultiPolygon")for(const Le of re)Jt(Te,Le[0]);return Te}function Jt(pe,ee){for(let re=0;re<ee.length;re+=3)pe.minX=Math.min(pe.minX,ee[re]),pe.minY=Math.min(pe.minY,ee[re+1]),pe.maxX=Math.max(pe.maxX,ee[re]),pe.maxY=Math.max(pe.maxY,ee[re+1])}function on(pe,ee,re,oe){if(!ee.geometry)return;const Te=ee.geometry.coordinates;if(Te&&Te.length===0)return;const Le=ee.geometry.type,Be=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let He=[],Fe=ee.id;if(re.promoteId?Fe=ee.properties[re.promoteId]:re.generateId&&(Fe=oe||0),Le==="Point")xi(Te,He);else if(Le==="MultiPoint")for(const Qe of Te)xi(Qe,He);else if(Le==="LineString")Ir(Te,He,Be,!1);else if(Le==="MultiLineString"){if(re.lineMetrics){for(const Qe of Te)He=[],Ir(Qe,He,Be,!1),pe.push(vn(Fe,"LineString",He,ee.properties));return}Pr(Te,He,Be,!1)}else if(Le==="Polygon")Pr(Te,He,Be,!0);else{if(Le!=="MultiPolygon"){if(Le==="GeometryCollection"){for(const Qe of ee.geometry.geometries)on(pe,{id:Fe,geometry:Qe,properties:ee.properties},re,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Te){const Ye=[];Pr(Qe,Ye,Be,!0),He.push(Ye)}}pe.push(vn(Fe,Le,He,ee.properties))}function xi(pe,ee){ee.push(Ls(pe[0]),ki(pe[1]),0)}function Ir(pe,ee,re,oe){let Te,Le,Be=0;for(let Fe=0;Fe<pe.length;Fe++){const Qe=Ls(pe[Fe][0]),Ye=ki(pe[Fe][1]);ee.push(Qe,Ye,0),Fe>0&&(Be+=oe?(Te*Ye-Qe*Le)/2:Math.sqrt(Math.pow(Qe-Te,2)+Math.pow(Ye-Le,2))),Te=Qe,Le=Ye}const He=ee.length-3;ee[2]=1,rn(ee,0,He,re),ee[He+2]=1,ee.size=Math.abs(Be),ee.start=0,ee.end=ee.size}function Pr(pe,ee,re,oe){for(let Te=0;Te<pe.length;Te++){const Le=[];Ir(pe[Te],Le,re,oe),ee.push(Le)}}function Ls(pe){return pe/360+.5}function ki(pe){const ee=Math.sin(pe*Math.PI/180),re=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return re<0?0:re>1?1:re}function ui(pe,ee,re,oe,Te,Le,Be,He){if(oe/=ee,Le>=(re/=ee)&&Be<oe)return pe;if(Be<re||Le>=oe)return null;const Fe=[];for(const Qe of pe){const Ye=Qe.geometry;let Ue=Qe.type;const Oe=Te===0?Qe.minX:Qe.minY,yt=Te===0?Qe.maxX:Qe.maxY;if(Oe>=re&&yt<oe){Fe.push(Qe);continue}if(yt<re||Oe>=oe)continue;let vt=[];if(Ue==="Point"||Ue==="MultiPoint")Fr(Ye,vt,re,oe,Te);else if(Ue==="LineString")wi(Ye,vt,re,oe,Te,!1,He.lineMetrics);else if(Ue==="MultiLineString")to(Ye,vt,re,oe,Te,!1);else if(Ue==="Polygon")to(Ye,vt,re,oe,Te,!0);else if(Ue==="MultiPolygon")for(const zt of Ye){const tn=[];to(zt,tn,re,oe,Te,!0),tn.length&&vt.push(tn)}if(vt.length){if(He.lineMetrics&&Ue==="LineString"){for(const zt of vt)Fe.push(vn(Qe.id,Ue,zt,Qe.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(vt.length===1?(Ue="LineString",vt=vt[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=vt.length===3?"Point":"MultiPoint"),Fe.push(vn(Qe.id,Ue,vt,Qe.tags))}}return Fe.length?Fe:null}function Fr(pe,ee,re,oe,Te){for(let Le=0;Le<pe.length;Le+=3){const Be=pe[Le+Te];Be>=re&&Be<=oe&&Br(ee,pe[Le],pe[Le+1],pe[Le+2])}}function wi(pe,ee,re,oe,Te,Le,Be){let He=Ds(pe);const Fe=Te===0?hs:no;let Qe,Ye,Ue=pe.start;for(let tn=0;tn<pe.length-3;tn+=3){const nt=pe[tn],wt=pe[tn+1],Ct=pe[tn+2],xt=pe[tn+3],hn=pe[tn+4],qt=Te===0?nt:wt,kt=Te===0?xt:hn;let Qn=!1;Be&&(Qe=Math.sqrt(Math.pow(nt-xt,2)+Math.pow(wt-hn,2))),qt<re?kt>re&&(Ye=Fe(He,nt,wt,xt,hn,re),Be&&(He.start=Ue+Qe*Ye)):qt>oe?kt<oe&&(Ye=Fe(He,nt,wt,xt,hn,oe),Be&&(He.start=Ue+Qe*Ye)):Br(He,nt,wt,Ct),kt<re&&qt>=re&&(Ye=Fe(He,nt,wt,xt,hn,re),Qn=!0),kt>oe&&qt<=oe&&(Ye=Fe(He,nt,wt,xt,hn,oe),Qn=!0),!Le&&Qn&&(Be&&(He.end=Ue+Qe*Ye),ee.push(He),He=Ds(pe)),Be&&(Ue+=Qe)}let Oe=pe.length-3;const yt=pe[Oe],vt=pe[Oe+1],zt=Te===0?yt:vt;zt>=re&&zt<=oe&&Br(He,yt,vt,pe[Oe+2]),Oe=He.length-3,Le&&Oe>=3&&(He[Oe]!==He[0]||He[Oe+1]!==He[1])&&Br(He,He[0],He[1],He[2]),He.length&&ee.push(He)}function Ds(pe){const ee=[];return ee.size=pe.size,ee.start=pe.start,ee.end=pe.end,ee}function to(pe,ee,re,oe,Te,Le){for(const Be of pe)wi(Be,ee,re,oe,Te,Le,!1)}function Br(pe,ee,re,oe){pe.push(ee,re,oe)}function hs(pe,ee,re,oe,Te,Le){const Be=(Le-ee)/(oe-ee);return Br(pe,Le,re+(Te-re)*Be,1),Be}function no(pe,ee,re,oe,Te,Le){const Be=(Le-re)/(Te-re);return Br(pe,ee+(oe-ee)*Be,Le,1),Be}function hr(pe,ee){const re=[];for(let oe=0;oe<pe.length;oe++){const Te=pe[oe],Le=Te.type;let Be;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")Be=zs(Te.geometry,ee);else if(Le==="MultiLineString"||Le==="Polygon"){Be=[];for(const He of Te.geometry)Be.push(zs(He,ee))}else if(Le==="MultiPolygon"){Be=[];for(const He of Te.geometry){const Fe=[];for(const Qe of He)Fe.push(zs(Qe,ee));Be.push(Fe)}}re.push(vn(Te.id,Le,Be,Te.tags))}return re}function zs(pe,ee){const re=[];re.size=pe.size,pe.start!==void 0&&(re.start=pe.start,re.end=pe.end);for(let oe=0;oe<pe.length;oe+=3)re.push(pe[oe]+ee,pe[oe+1],pe[oe+2]);return re}function bo(pe,ee){if(pe.transformed)return pe;const re=1<<pe.z,oe=pe.x,Te=pe.y;for(const Le of pe.features){const Be=Le.geometry,He=Le.type;if(Le.geometry=[],He===1)for(let Fe=0;Fe<Be.length;Fe+=2)Le.geometry.push(ds(Be[Fe],Be[Fe+1],ee,re,oe,Te));else for(let Fe=0;Fe<Be.length;Fe++){const Qe=[];for(let Ye=0;Ye<Be[Fe].length;Ye+=2)Qe.push(ds(Be[Fe][Ye],Be[Fe][Ye+1],ee,re,oe,Te));Le.geometry.push(Qe)}}return pe.transformed=!0,pe}function ds(pe,ee,re,oe,Te,Le){return[Math.round(re*(pe*oe-Te)),Math.round(re*(ee*oe-Le))]}function Xo(pe,ee,re,oe,Te){const Le=ee===Te.maxZoom?0:Te.tolerance/((1<<ee)*Te.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:pe.length,source:null,x:re,y:oe,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const He of pe)To(Be,He,Le,Te);return Be}function To(pe,ee,re,oe){const Te=ee.geometry,Le=ee.type,Be=[];if(pe.minX=Math.min(pe.minX,ee.minX),pe.minY=Math.min(pe.minY,ee.minY),pe.maxX=Math.max(pe.maxX,ee.maxX),pe.maxY=Math.max(pe.maxY,ee.maxY),Le==="Point"||Le==="MultiPoint")for(let He=0;He<Te.length;He+=3)Be.push(Te[He],Te[He+1]),pe.numPoints++,pe.numSimplified++;else if(Le==="LineString")ni(Be,Te,pe,re,!1,!1);else if(Le==="MultiLineString"||Le==="Polygon")for(let He=0;He<Te.length;He++)ni(Be,Te[He],pe,re,Le==="Polygon",He===0);else if(Le==="MultiPolygon")for(let He=0;He<Te.length;He++){const Fe=Te[He];for(let Qe=0;Qe<Fe.length;Qe++)ni(Be,Fe[Qe],pe,re,!0,Qe===0)}if(Be.length){let He=ee.tags||null;if(Le==="LineString"&&oe.lineMetrics){He={};for(const Qe in ee.tags)He[Qe]=ee.tags[Qe];He.mapbox_clip_start=Te.start/Te.size,He.mapbox_clip_end=Te.end/Te.size}const Fe={geometry:Be,type:Le==="Polygon"||Le==="MultiPolygon"?3:Le==="LineString"||Le==="MultiLineString"?2:1,tags:He};ee.id!==null&&(Fe.id=ee.id),pe.features.push(Fe)}}function ni(pe,ee,re,oe,Te,Le){const Be=oe*oe;if(oe>0&&ee.size<(Te?Be:oe))return void(re.numPoints+=ee.length/3);const He=[];for(let Fe=0;Fe<ee.length;Fe+=3)(oe===0||ee[Fe+2]>Be)&&(re.numSimplified++,He.push(ee[Fe],ee[Fe+1])),re.numPoints++;Te&&function(Fe,Qe){let Ye=0;for(let Ue=0,Oe=Fe.length,yt=Oe-2;Ue<Oe;yt=Ue,Ue+=2)Ye+=(Fe[Ue]-Fe[yt])*(Fe[Ue+1]+Fe[yt+1]);if(Ye>0===Qe)for(let Ue=0,Oe=Fe.length;Ue<Oe/2;Ue+=2){const yt=Fe[Ue],vt=Fe[Ue+1];Fe[Ue]=Fe[Oe-2-Ue],Fe[Ue+1]=Fe[Oe-1-Ue],Fe[Oe-2-Ue]=yt,Fe[Oe-1-Ue]=vt}}(He,Le),pe.push(He)}const Ti={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vr{constructor(ee,re){const oe=(re=this.options=function(Le,Be){for(const He in Be)Le[He]=Be[He];return Le}(Object.create(Ti),re)).debug;if(oe&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(Le,Be){const He=[];if(Le.type==="FeatureCollection")for(let Fe=0;Fe<Le.features.length;Fe++)on(He,Le.features[Fe],Be,Fe);else on(He,Le.type==="Feature"?Le:{geometry:Le},Be);return He}(ee,re);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(Le,Be){const He=Be.buffer/Be.extent;let Fe=Le;const Qe=ui(Le,1,-1-He,He,0,-1,2,Be),Ye=ui(Le,1,1-He,2+He,0,-1,2,Be);return(Qe||Ye)&&(Fe=ui(Le,1,-He,1+He,0,-1,2,Be)||[],Qe&&(Fe=hr(Qe,1).concat(Fe)),Ye&&(Fe=Fe.concat(hr(Ye,-1)))),Fe}(Te,re),Te.length&&this.splitTile(Te,0,0,0),oe&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,re,oe,Te,Le,Be,He){const Fe=[ee,re,oe,Te],Qe=this.options,Ye=Qe.debug;for(;Fe.length;){Te=Fe.pop(),oe=Fe.pop(),re=Fe.pop(),ee=Fe.pop();const Ue=1<<re,Oe=So(re,oe,Te);let yt=this.tiles[Oe];if(!yt&&(Ye>1&&console.time("creation"),yt=this.tiles[Oe]=Xo(ee,re,oe,Te,Qe),this.tileCoords.push({z:re,x:oe,y:Te}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,oe,Te,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));const Qn=`z${re}`;this.stats[Qn]=(this.stats[Qn]||0)+1,this.total++}if(yt.source=ee,Le==null){if(re===Qe.indexMaxZoom||yt.numPoints<=Qe.indexMaxPoints)continue}else{if(re===Qe.maxZoom||re===Le)continue;if(Le!=null){const Qn=Le-re;if(oe!==Be>>Qn||Te!==He>>Qn)continue}}if(yt.source=null,ee.length===0)continue;Ye>1&&console.time("clipping");const vt=.5*Qe.buffer/Qe.extent,zt=.5-vt,tn=.5+vt,nt=1+vt;let wt=null,Ct=null,xt=null,hn=null,qt=ui(ee,Ue,oe-vt,oe+tn,0,yt.minX,yt.maxX,Qe),kt=ui(ee,Ue,oe+zt,oe+nt,0,yt.minX,yt.maxX,Qe);ee=null,qt&&(wt=ui(qt,Ue,Te-vt,Te+tn,1,yt.minY,yt.maxY,Qe),Ct=ui(qt,Ue,Te+zt,Te+nt,1,yt.minY,yt.maxY,Qe),qt=null),kt&&(xt=ui(kt,Ue,Te-vt,Te+tn,1,yt.minY,yt.maxY,Qe),hn=ui(kt,Ue,Te+zt,Te+nt,1,yt.minY,yt.maxY,Qe),kt=null),Ye>1&&console.timeEnd("clipping"),Fe.push(wt||[],re+1,2*oe,2*Te),Fe.push(Ct||[],re+1,2*oe,2*Te+1),Fe.push(xt||[],re+1,2*oe+1,2*Te),Fe.push(hn||[],re+1,2*oe+1,2*Te+1)}}getTile(ee,re,oe){ee=+ee,re=+re,oe=+oe;const Te=this.options,{extent:Le,debug:Be}=Te;if(ee<0||ee>24)return null;const He=1<<ee,Fe=So(ee,re=re+He&He-1,oe);if(this.tiles[Fe])return bo(this.tiles[Fe],Le);Be>1&&console.log("drilling down to z%d-%d-%d",ee,re,oe);let Qe,Ye=ee,Ue=re,Oe=oe;for(;!Qe&&Ye>0;)Ye--,Ue>>=1,Oe>>=1,Qe=this.tiles[So(Ye,Ue,Oe)];return Qe&&Qe.source?(Be>1&&(console.log("found parent tile z%d-%d-%d",Ye,Ue,Oe),console.time("drilling down")),this.splitTile(Qe.source,Ye,Ue,Oe,ee,re,oe),Be>1&&console.timeEnd("drilling down"),this.tiles[Fe]?bo(this.tiles[Fe],Le):null):null}}function So(pe,ee,re){return 32*((1<<pe)*re+ee)+pe}function Ns(pe,ee){return ee?pe.properties[ee]:pe.id}function Yo(pe,ee){if(pe==null)return!0;if(pe.type==="Feature")return Ns(pe,ee)!=null;if(pe.type==="FeatureCollection"){const re=new Set;for(const oe of pe.features){const Te=Ns(oe,ee);if(Te==null||re.has(Te))return!1;re.add(Te)}return!0}return!1}function Os(pe,ee){const re=new Map;if(pe!=null)if(pe.type==="Feature")re.set(Ns(pe,ee),pe);else for(const oe of pe.features)re.set(Ns(oe,ee),oe);return re}class Qo extends U{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ee,re){return f._(this,void 0,void 0,function*(){const oe=ee.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Te=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!Te)return null;const Le=new ge(Te.features);let Be=ue(Le);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:Le,rawData:Be.buffer}})}loadData(ee){return f._(this,void 0,void 0,function*(){var re;(re=this._pendingRequest)===null||re===void 0||re.abort();const oe=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new f.cu(ee.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ee,this._pendingRequest),this._geoJSONIndex=ee.cluster?new Yt(function({superclusterOptions:Be,clusterProperties:He}){if(!He||!Be)return Be;const Fe={},Qe={},Ye={accumulated:null,zoom:0},Ue={properties:null},Oe=Object.keys(He);for(const yt of Oe){const[vt,zt]=He[yt],tn=f.cB(zt),nt=f.cB(typeof vt=="string"?[vt,["accumulated"],["get",yt]]:vt);Fe[yt]=tn.value,Qe[yt]=nt.value}return Be.map=yt=>{Ue.properties=yt;const vt={};for(const zt of Oe)vt[zt]=Fe[zt].evaluate(Ye,Ue);return vt},Be.reduce=(yt,vt)=>{Ue.properties=vt;for(const zt of Oe)Ye.accumulated=yt[zt],yt[zt]=Qe[zt].evaluate(Ye,Ue)},Be}(ee)).load((yield this._pendingData).features):(Te=yield this._pendingData,new Vr(Te,ee.geojsonVtOptions)),this.loaded={};const Le={};if(oe){const Be=oe.finish();Be&&(Le.resourceTiming={},Le.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Be)))}return Le}catch(Le){if(delete this._pendingRequest,f.cf(Le))return{abandoned:!0};throw Le}var Te})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ee){const re=this.loaded;return re&&re[ee.uid]?super.reloadTile(ee):this.loadTile(ee)}loadAndProcessGeoJSON(ee,re){return f._(this,void 0,void 0,function*(){let oe=yield this.loadGeoJSON(ee,re);if(delete this._pendingRequest,typeof oe!="object")throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(Me(oe,!0),ee.filter){const Te=f.cB(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));oe={type:"FeatureCollection",features:oe.features.filter(Be=>Te.value.evaluate({zoom:0},Be))}}return oe})}loadGeoJSON(ee,re){return f._(this,void 0,void 0,function*(){const{promoteId:oe}=ee;if(ee.request){const Te=yield f.h(ee.request,re);return this._dataUpdateable=Yo(Te.data,oe)?Os(Te.data,oe):void 0,Te.data}if(typeof ee.data=="string")try{const Te=JSON.parse(ee.data);return this._dataUpdateable=Yo(Te,oe)?Os(Te,oe):void 0,Te}catch{throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`)}if(!ee.dataDiff)throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ee.source}`);return function(Te,Le,Be){var He,Fe,Qe,Ye;if(Le.removeAll&&Te.clear(),Le.remove)for(const Ue of Le.remove)Te.delete(Ue);if(Le.add)for(const Ue of Le.add){const Oe=Ns(Ue,Be);Oe!=null&&Te.set(Oe,Ue)}if(Le.update)for(const Ue of Le.update){let Oe=Te.get(Ue.id);if(Oe==null)continue;const yt=!Ue.removeAllProperties&&(((He=Ue.removeProperties)===null||He===void 0?void 0:He.length)>0||((Fe=Ue.addOrUpdateProperties)===null||Fe===void 0?void 0:Fe.length)>0);if((Ue.newGeometry||Ue.removeAllProperties||yt)&&(Oe=Object.assign({},Oe),Te.set(Ue.id,Oe),yt&&(Oe.properties=Object.assign({},Oe.properties))),Ue.newGeometry&&(Oe.geometry=Ue.newGeometry),Ue.removeAllProperties)Oe.properties={};else if(((Qe=Ue.removeProperties)===null||Qe===void 0?void 0:Qe.length)>0)for(const vt of Ue.removeProperties)Object.prototype.hasOwnProperty.call(Oe.properties,vt)&&delete Oe.properties[vt];if(((Ye=Ue.addOrUpdateProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const{key:vt,value:zt}of Ue.addOrUpdateProperties)Oe.properties[vt]=zt}}(this._dataUpdateable,ee.dataDiff,oe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ee){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ee){return this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId)}getClusterChildren(ee){return this._geoJSONIndex.getChildren(ee.clusterId)}getClusterLeaves(ee){return this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset)}}class fs{constructor(ee){this.self=ee,this.actor=new f.F(ee),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(re,oe)=>{if(this.externalWorkerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.externalWorkerSourceTypes[re]=oe},this.self.addProtocol=f.ch,this.self.removeProtocol=f.ci,this.self.registerRTLTextPlugin=re=>{f.cC.setMethods(re)},this.actor.registerMessageHandler("LDT",(re,oe)=>this._getDEMWorkerSource(re,oe.source).loadTile(oe)),this.actor.registerMessageHandler("RDT",(re,oe)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(re,oe.source).removeTile(oe)})),this.actor.registerMessageHandler("GCEZ",(re,oe)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(re,oe.type,oe.source).getClusterExpansionZoom(oe)})),this.actor.registerMessageHandler("GCC",(re,oe)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(re,oe.type,oe.source).getClusterChildren(oe)})),this.actor.registerMessageHandler("GCL",(re,oe)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(re,oe.type,oe.source).getClusterLeaves(oe)})),this.actor.registerMessageHandler("LD",(re,oe)=>this._getWorkerSource(re,oe.type,oe.source).loadData(oe)),this.actor.registerMessageHandler("GD",(re,oe)=>this._getWorkerSource(re,oe.type,oe.source).getData()),this.actor.registerMessageHandler("LT",(re,oe)=>this._getWorkerSource(re,oe.type,oe.source).loadTile(oe)),this.actor.registerMessageHandler("RT",(re,oe)=>this._getWorkerSource(re,oe.type,oe.source).reloadTile(oe)),this.actor.registerMessageHandler("AT",(re,oe)=>this._getWorkerSource(re,oe.type,oe.source).abortTile(oe)),this.actor.registerMessageHandler("RMT",(re,oe)=>this._getWorkerSource(re,oe.type,oe.source).removeTile(oe)),this.actor.registerMessageHandler("RS",(re,oe)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[re]||!this.workerSources[re][oe.type]||!this.workerSources[re][oe.type][oe.source])return;const Te=this.workerSources[re][oe.type][oe.source];delete this.workerSources[re][oe.type][oe.source],Te.removeSource!==void 0&&Te.removeSource(oe)})),this.actor.registerMessageHandler("RM",re=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re]})),this.actor.registerMessageHandler("SR",(re,oe)=>f._(this,void 0,void 0,function*(){this.referrer=oe})),this.actor.registerMessageHandler("SRPS",(re,oe)=>this._syncRTLPluginState(re,oe)),this.actor.registerMessageHandler("IS",(re,oe)=>f._(this,void 0,void 0,function*(){this.self.importScripts(oe)})),this.actor.registerMessageHandler("SI",(re,oe)=>this._setImages(re,oe)),this.actor.registerMessageHandler("UL",(re,oe)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(re).update(oe.layers,oe.removedIds)})),this.actor.registerMessageHandler("SL",(re,oe)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(re).replace(oe)}))}_setImages(ee,re){return f._(this,void 0,void 0,function*(){this.availableImages[ee]=re;for(const oe in this.workerSources[ee]){const Te=this.workerSources[ee][oe];for(const Le in Te)Te[Le].availableImages=re}})}_syncRTLPluginState(ee,re){return f._(this,void 0,void 0,function*(){return yield f.cC.syncState(re,this.self.importScripts)})}_getAvailableImages(ee){let re=this.availableImages[ee];return re||(re=[]),re}_getLayerIndex(ee){let re=this.layerIndexes[ee];return re||(re=this.layerIndexes[ee]=new l),re}_getWorkerSource(ee,re,oe){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][re]||(this.workerSources[ee][re]={}),!this.workerSources[ee][re][oe]){const Te={sendAsync:(Le,Be)=>(Le.targetMapId=ee,this.actor.sendAsync(Le,Be))};switch(re){case"vector":this.workerSources[ee][re][oe]=new U(Te,this._getLayerIndex(ee),this._getAvailableImages(ee));break;case"geojson":this.workerSources[ee][re][oe]=new Qo(Te,this._getLayerIndex(ee),this._getAvailableImages(ee));break;default:this.workerSources[ee][re][oe]=new this.externalWorkerSourceTypes[re](Te,this._getLayerIndex(ee),this._getAvailableImages(ee))}}return this.workerSources[ee][re][oe]}_getDEMWorkerSource(ee,re){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][re]||(this.demWorkerSources[ee][re]=new H),this.demWorkerSources[ee][re]}}return f.i(self)&&(self.worker=new fs(self)),fs}),o("index",["exports","./shared"],function(f,l){var S="5.1.0";function A(){var v=new l.A(4);return l.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let O,U;const H={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(v,i,a){const m=requestAnimationFrame(i);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),a(l.c())})},frameAsync(v){return new Promise((i,a)=>{this.frame(v,i,a)})},getImageData(v,i=0){return this.getImageCanvasContext(v).getImageData(-i,-i,v.width+2*i,v.height+2*i)},getImageCanvasContext(v){const i=window.document.createElement("canvas"),a=i.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return i.width=v.width,i.height=v.height,a.drawImage(v,0,0,v.width,v.height),a},resolveURL:v=>(O||(O=document.createElement("a")),O.href=v,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(U==null&&(U=matchMedia("(prefers-reduced-motion: reduce)")),U.matches)}};class ${static testProp(i){if(!$.docStyle)return i[0];for(let a=0;a<i.length;a++)if(i[a]in $.docStyle)return i[a];return i[0]}static create(i,a,m){const g=window.document.createElement(i);return a!==void 0&&(g.className=a),m&&m.appendChild(g),g}static createNS(i,a){return window.document.createElementNS(i,a)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(i,a){i.style[$.transformProp]=a}static addEventListener(i,a,m,g={}){i.addEventListener(a,m,"passive"in g?g:g.capture)}static removeEventListener(i,a,m,g={}){i.removeEventListener(a,m,"passive"in g?g:g.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(i){const a=i.getBoundingClientRect();return{x:a.width/i.offsetWidth||1,y:a.height/i.offsetHeight||1,boundingClientRect:a}}static getPoint(i,a,m){const g=a.boundingClientRect;return new l.P((m.clientX-g.left)/a.x-i.clientLeft,(m.clientY-g.top)/a.y-i.clientTop)}static mousePos(i,a){const m=$.getScale(i);return $.getPoint(i,m,a)}static touchPos(i,a){const m=[],g=$.getScale(i);for(let x=0;x<a.length;x++)m.push($.getPoint(i,g,a[x]));return m}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}static sanitize(i){const a=new DOMParser().parseFromString(i,"text/html").body||document.createElement("body"),m=a.querySelectorAll("script");for(const g of m)g.remove();return $.clean(a),a.innerHTML}static isPossiblyDangerous(i,a){const m=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(i)||!m.includes("javascript:")&&!m.includes("data:"))||!!i.startsWith("on")||void 0}static clean(i){const a=i.children;for(const m of a)$.removeAttributes(m),$.clean(m)}static removeAttributes(i){for(const{name:a,value:m}of i.attributes)$.isPossiblyDangerous(a,m)&&i.removeAttribute(a)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const ie={supported:!1,testSupport:function(v){!ce&&Me&&(le?ge(v):me=v)}};let me,Me,ce=!1,le=!1;function ge(v){const i=v.createTexture();v.bindTexture(v.TEXTURE_2D,i);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Me),v.isContextLost())return;ie.supported=!0}catch{}v.deleteTexture(i),ce=!0}var je;typeof document<"u"&&(Me=document.createElement("img"),Me.onload=()=>{me&&ge(me),me=null,le=!0},Me.onerror=()=>{ce=!0,me=null},Me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let i,a,m,g;v.resetRequestQueue=()=>{i=[],a=0,m=0,g={}},v.addThrottleControl=M=>{const z=m++;return g[z]=M,z},v.removeThrottleControl=M=>{delete g[M],T()},v.getImage=(M,z,V=!0)=>new Promise((q,Z)=>{ie.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),l.e(M,{type:"image"}),i.push({abortController:z,requestParameters:M,supportImageRefresh:V,state:"queued",onError:J=>{Z(J)},onSuccess:J=>{q(J)}}),T()});const x=M=>l._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:z,supportImageRefresh:V,onError:q,onSuccess:Z,abortController:J}=M,ne=V===!1&&!l.i(self)&&!l.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((xe,be)=>xe&&be==="accept",!0));a++;const ye=ne?C(z,J):l.m(z,J);try{const xe=yield ye;delete M.abortController,M.state="completed",xe.data instanceof HTMLImageElement||l.b(xe.data)?Z(xe):xe.data&&Z({data:yield(_e=xe.data,typeof createImageBitmap=="function"?l.d(_e):l.f(_e)),cacheControl:xe.cacheControl,expires:xe.expires})}catch(xe){delete M.abortController,q(xe)}finally{a--,T()}var _e}),T=()=>{const M=(()=>{for(const z of Object.keys(g))if(g[z]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=a;z<M&&i.length>0;z++){const V=i.shift();V.abortController.signal.aborted?z--:x(V)}},C=(M,z)=>new Promise((V,q)=>{const Z=new Image,J=M.url,ne=M.credentials;ne&&ne==="include"?Z.crossOrigin="use-credentials":(ne&&ne==="same-origin"||!l.s(J))&&(Z.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{Z.src="",q(l.c())}),Z.fetchPriority="high",Z.onload=()=>{Z.onerror=Z.onload=null,V({data:Z})},Z.onerror=()=>{Z.onerror=Z.onload=null,z.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Z.src=J})}(je||(je={})),je.resetRequestQueue();class rt{constructor(i){this._transformRequestFn=i}transformRequest(i,a){return this._transformRequestFn&&this._transformRequestFn(i,a)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function qe(v){const i=[];if(typeof v=="string")i.push({id:"default",url:v});else if(v&&v.length>0){const a=[];for(const{id:m,url:g}of v){const x=`${m}${g}`;a.indexOf(x)===-1&&(a.push(x),i.push({id:m,url:g}))}}return i}function fe(v,i,a){try{const m=new URL(v);return m.pathname+=`${i}${a}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class Q{constructor(i,a,m,g){this.context=i,this.format=m,this.texture=i.gl.createTexture(),this.update(a,g)}update(i,a,m){const{width:g,height:x}=i,T=!(this.size&&this.size[0]===g&&this.size[1]===x||m),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),T)this.size=[g,x],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,g,x,0,this.format,M.UNSIGNED_BYTE,i.data);else{const{x:z,y:V}=m||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.b(i)?M.texSubImage2D(M.TEXTURE_2D,0,z,V,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,z,V,g,x,M.RGBA,M.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(i,a,m){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),m!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=x.LINEAR),i!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,m||i),this.filter=i),a!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ue(v){const{userImage:i}=v;return!!(i&&i.render&&i.render())&&(v.data.replace(new Uint8Array(i.data.buffer)),!0)}class ve extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:a,promiseResolve:m}of this.requestors)m(this._getImagesForIds(a));this.requestors=[]}}getImage(i){const a=this.images[i];if(a&&!a.data&&a.spriteData){const m=a.spriteData;a.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),a.spriteData=null}return a}addImage(i,a){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,a)&&(this.images[i]=a)}_validate(i,a){let m=!0;const g=a.data||a.spriteData;return this._validateStretch(a.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(a.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(a.content,a)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,a){if(!i)return!0;let m=0;for(const g of i){if(g[0]<m||g[1]<g[0]||a<g[1])return!1;m=g[1]}return!0}_validateContent(i,a){if(!i)return!0;if(i.length!==4)return!1;const m=a.spriteData,g=m&&m.width||a.data.width,x=m&&m.height||a.data.height;return!(i[0]<0||g<i[0]||i[1]<0||x<i[1]||i[2]<0||g<i[2]||i[3]<0||x<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,a,m=!0){const g=this.getImage(i);if(m&&(g.data.width!==a.data.width||g.data.height!==a.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=g.version+1,this.images[i]=a,this.updatedImages[i]=!0}removeImage(i){const a=this.images[i];delete this.images[i],delete this.patterns[i],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((a,m)=>{let g=!0;if(!this.isLoaded())for(const x of i)this.images[x]||(g=!1);this.isLoaded()||g?a(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:a})})}_getImagesForIds(i){const a={};for(const m of i){let g=this.getImage(m);g||(this.fire(new l.k("styleimagemissing",{id:m})),g=this.getImage(m)),g?a[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:i,height:a}=this.atlasImage;return{width:i,height:a}}getPattern(i){const a=this.patterns[i],m=this.getImage(i);if(!m)return null;if(a&&a.position.version===m.version)return a.position;if(a)a.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new l.I(g,m);this.patterns[i]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const a=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Q(i,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const x in this.patterns)i.push(this.patterns[x].bin);const{w:a,h:m}=l.p(i),g=this.atlasImage;g.resize({width:a||1,height:m||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],C=T.x+1,M=T.y+1,z=this.getImage(x).data,V=z.width,q=z.height;l.R.copy(z,g,{x:0,y:0},{x:C,y:M},{width:V,height:q}),l.R.copy(z,g,{x:0,y:q-1},{x:C,y:M-1},{width:V,height:1}),l.R.copy(z,g,{x:0,y:0},{x:C,y:M+q},{width:V,height:1}),l.R.copy(z,g,{x:V-1,y:0},{x:C-1,y:M},{width:1,height:q}),l.R.copy(z,g,{x:0,y:0},{x:C+V,y:M},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const a of i){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const m=this.getImage(a);m||l.w(`Image with ID: "${a}" was not found`),ue(m)&&this.updateImage(a,m)}}}const Pe=1e20;function Ve(v,i,a,m,g,x,T,C,M){for(let z=i;z<i+m;z++)Ee(v,a*x+z,x,g,T,C,M);for(let z=a;z<a+g;z++)Ee(v,z*x+i,1,m,T,C,M)}function Ee(v,i,a,m,g,x,T){x[0]=0,T[0]=-1e20,T[1]=Pe,g[0]=v[i];for(let C=1,M=0,z=0;C<m;C++){g[C]=v[i+C*a];const V=C*C;do{const q=x[M];z=(g[C]-g[q]+V-q*q)/(C-q)/2}while(z<=T[M]&&--M>-1);M++,x[M]=C,T[M]=z,T[M+1]=Pe}for(let C=0,M=0;C<m;C++){for(;T[M+1]<C;)M++;const z=x[M],V=C-z;v[i+C*a]=g[z]+V*V}}class Xt{constructor(i,a){this.requestManager=i,this.localIdeographFontFamily=a,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return l._(this,void 0,void 0,function*(){const a=[];for(const x in i)for(const T of i[x])a.push(this._getAndCacheGlyphsPromise(x,T));const m=yield Promise.all(a),g={};for(const{stack:x,id:T,glyph:C}of m)g[x]||(g[x]={}),g[x][T]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return g})}_getAndCacheGlyphsPromise(i,a){return l._(this,void 0,void 0,function*(){let m=this.entries[i];m||(m=this.entries[i]={glyphs:{},requests:{},ranges:{}});let g=m.glyphs[a];if(g!==void 0)return{stack:i,id:a,glyph:g};if(g=this._tinySDF(m,i,a),g)return m.glyphs[a]=g,{stack:i,id:a,glyph:g};const x=Math.floor(a/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[x])return{stack:i,id:a,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[x]){const C=Xt.loadGlyphRange(i,x,this.url,this.requestManager);m.requests[x]=C}const T=yield m.requests[x];for(const C in T)this._doesCharSupportLocalGlyph(+C)||(m.glyphs[+C]=T[+C]);return m.ranges[x]=!0,{stack:i,id:a,glyph:T[a]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))}_tinySDF(i,a,m){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(m))return;let x=i.tinySDF;if(!x){let C="400";/bold/i.test(a)?C="900":/medium/i.test(a)?C="500":/light/i.test(a)&&(C="200"),x=i.tinySDF=new Xt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:C})}const T=x.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}Xt.loadGlyphRange=function(v,i,a,m){return l._(this,void 0,void 0,function*(){const g=256*i,x=g+255,T=m.transformRequest(a.replace("{fontstack}",v).replace("{range}",`${g}-${x}`),"Glyphs"),C=yield l.l(T,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${i}, ${g}-${x}`);const M={};for(const z of l.n(C.data))M[z.id]=z;return M})},Xt.TinySDF=class{constructor({fontSize:v=24,buffer:i=3,radius:a=8,cutoff:m=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:T="normal"}={}){this.buffer=i,this.cutoff=m,this.radius=a;const C=this.size=v+4*i,M=this._createCanvas(C),z=this.ctx=M.getContext("2d",{willReadFrequently:!0});z.font=`${T} ${x} ${v}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(v){const i=document.createElement("canvas");return i.width=i.height=v,i}draw(v){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:m,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(v),T=Math.ceil(a),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),M=Math.min(this.size-this.buffer,T+Math.ceil(m)),z=C+2*this.buffer,V=M+2*this.buffer,q=Math.max(z*V,0),Z=new Uint8ClampedArray(q),J={data:Z,width:z,height:V,glyphWidth:C,glyphHeight:M,glyphTop:T,glyphLeft:0,glyphAdvance:i};if(C===0||M===0)return J;const{ctx:ne,buffer:ye,gridInner:_e,gridOuter:xe}=this;ne.clearRect(ye,ye,C,M),ne.fillText(v,ye,ye+T);const be=ne.getImageData(ye,ye,C,M);xe.fill(Pe,0,q),_e.fill(0,0,q);for(let Ce=0;Ce<M;Ce++)for(let ke=0;ke<C;ke++){const Re=be.data[4*(Ce*C+ke)+3]/255;if(Re===0)continue;const ze=(Ce+ye)*z+ke+ye;if(Re===1)xe[ze]=0,_e[ze]=Pe;else{const De=.5-Re;xe[ze]=De>0?De*De:0,_e[ze]=De<0?De*De:0}}Ve(xe,0,0,z,V,z,this.f,this.v,this.z),Ve(_e,ye,ye,C,M,z,this.f,this.v,this.z);for(let Ce=0;Ce<q;Ce++){const ke=Math.sqrt(xe[Ce])-Math.sqrt(_e[Ce]);Z[Ce]=Math.round(255-255*(ke/this.radius+this.cutoff))}return J}};class tr{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,a){return l.x(i.expression.evaluate(a))}interpolate(i,a,m){return{x:l.y.number(i.x,a.x,m),y:l.y.number(i.y,a.y,m),z:l.y.number(i.z,a.z,m)}}}let Yt;class vi extends l.E{constructor(i){super(),Yt=Yt||new l.q({anchor:new l.D(l.v.light.anchor),position:new tr,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Yt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a={}){if(!this._validate(l.r,i,a))for(const m in i){const g=i[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,m){return(!m||m.validate!==!1)&&l.t(this,i.call(l.u,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const lt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class Qt extends l.E{constructor(i){super(),this._transitionable=new l.T(lt),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(i,a={}){if(!this._validate(l.B,i,a)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in i){const g=i[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,m={}){return(m==null?void 0:m.validate)!==!1&&l.t(this,i.call(l.u,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class Tt{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,a){const m=i.join(",")+String(a);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(i,a)),this.dashEntry[m]}getDashRanges(i,a,m){const g=[];let x=i.length%2==1?-i[i.length-1]*m:0,T=i[0]*m,C=!0;g.push({left:x,right:T,isDash:C,zeroLength:i[0]===0});let M=i[0];for(let z=1;z<i.length;z++){C=!C;const V=i[z];x=M*m,M+=V,T=M*m,g.push({left:x,right:T,isDash:C,zeroLength:V===0})}return g}addRoundDash(i,a,m){const g=a/2;for(let x=-m;x<=m;x++){const T=this.width*(this.nextRow+m+x);let C=0,M=i[C];for(let z=0;z<this.width;z++){z/M.right>1&&(M=i[++C]);const V=Math.abs(z-M.left),q=Math.abs(z-M.right),Z=Math.min(V,q);let J;const ne=x/m*(g+1);if(M.isDash){const ye=g-Math.abs(ne);J=Math.sqrt(Z*Z+ye*ye)}else J=g-Math.sqrt(Z*Z+ne*ne);this.data[T+z]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(i){for(let C=i.length-1;C>=0;--C){const M=i[C],z=i[C+1];M.zeroLength?i.splice(C,1):z&&z.isDash===M.isDash&&(z.left=M.left,i.splice(C,1))}const a=i[0],m=i[i.length-1];a.isDash===m.isDash&&(a.left=m.left-this.width,m.right=a.right+this.width);const g=this.width*this.nextRow;let x=0,T=i[x];for(let C=0;C<this.width;C++){C/T.right>1&&(T=i[++x]);const M=Math.abs(C-T.left),z=Math.abs(C-T.right),V=Math.min(M,z);this.data[g+C]=Math.max(0,Math.min(255,(T.isDash?V:-V)+128))}}addDash(i,a){const m=a?7:0,g=2*m+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let x=0;for(let C=0;C<i.length;C++)x+=i[C];if(x!==0){const C=this.width/x,M=this.getDashRanges(i,this.width,C);a?this.addRoundDash(M,C,m):this.addRegularDash(M)}const T={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:x};return this.nextRow+=g,this.dirty=!0,T}bind(i){const a=i.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const nn="maplibre_preloaded_worker_pool";class rn{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<rn.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nn]}numActive(){return Object.keys(this.active).length}}const cn=Math.floor(H.hardwareConcurrency/2);let vn,Jt;function on(){return vn||(vn=new rn),vn}rn.workerCount=l.C(globalThis)?Math.max(Math.min(cn,3),1):1;class xi{constructor(i,a){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=a;const m=this.workerPool.acquire(a);for(let g=0;g<m.length;g++){const x=new l.F(m[g],a);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,a){const m=[];for(const g of this.actors)m.push(g.sendAsync({type:i,data:a}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,a){for(const m of this.actors)m.registerMessageHandler(i,a)}}function Ir(){return Jt||(Jt=new xi(on(),l.G),Jt.registerMessageHandler("GR",(v,i,a)=>l.m(i,a))),Jt}function Pr(v,i){const a=l.H();return l.J(a,a,[1,1,0]),l.K(a,a,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?l.L(a,a,v.calculatePosMatrix(i.toUnwrapped())):a}function Ls(v,i,a,m,g,x){var T;const C=function(q,Z,J){if(q)for(const ne of q){const ye=Z[ne];if(ye&&ye.source===J&&ye.type==="fill-extrusion")return!0}else for(const ne in Z){const ye=Z[ne];if(ye.source===J&&ye.type==="fill-extrusion")return!0}return!1}((T=g==null?void 0:g.layers)!==null&&T!==void 0?T:null,i,v.id),M=x.maxPitchScaleFactor(),z=v.tilesIn(m,M,C);z.sort(ki);const V=[];for(const q of z)V.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(i,a,v._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,g,x,M,Pr(v.transform,q.tileID))});return function(q,Z){for(const J in q)for(const ne of q[J])ui(ne,Z);return q}(function(q){const Z={},J={};for(const ne of q){const ye=ne.queryResults,_e=ne.wrappedTileID,xe=J[_e]=J[_e]||{};for(const be in ye){const Ce=ye[be],ke=xe[be]=xe[be]||{},Re=Z[be]=Z[be]||[];for(const ze of Ce)ke[ze.featureIndex]||(ke[ze.featureIndex]=!0,Re.push(ze))}}return Z}(V),v)}function ki(v,i){const a=v.tileID,m=i.tileID;return a.overscaledZ-m.overscaledZ||a.canonical.y-m.canonical.y||a.wrap-m.wrap||a.canonical.x-m.canonical.x}function ui(v,i){const a=v.feature,m=i.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=m}function Fr(v,i,a){return l._(this,void 0,void 0,function*(){let m=v;if(v.url?m=(yield l.h(i.transformRequest(v.url,"Source"),a)).data:yield H.frameAsync(a),!m)return null;const g=l.M(l.e(m,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(g.vectorLayerIds=m.vector_layers.map(x=>x.id)),g})}class wi{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.N?new l.N(i.lng,i.lat):l.N.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.N?new l.N(i.lng,i.lat):l.N.convert(i),this}extend(i){const a=this._sw,m=this._ne;let g,x;if(i instanceof l.N)g=i,x=i;else{if(!(i instanceof wi))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(wi.convert(i)):this.extend(l.N.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.N.convert(i)):this;if(g=i._sw,x=i._ne,!g||!x)return this}return a||m?(a.lng=Math.min(g.lng,a.lng),a.lat=Math.min(g.lat,a.lat),m.lng=Math.max(x.lng,m.lng),m.lat=Math.max(x.lat,m.lat)):(this._sw=new l.N(g.lng,g.lat),this._ne=new l.N(x.lng,x.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:m}=l.N.convert(i);let g=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&g}static convert(i){return i instanceof wi?i:i&&new wi(i)}static fromLngLat(i,a=0){const m=360*a/40075017,g=m/Math.cos(Math.PI/180*i.lat);return new wi(new l.N(i.lng-g,i.lat-m),new l.N(i.lng+g,i.lat+m))}adjustAntiMeridian(){const i=new l.N(this._sw.lng,this._sw.lat),a=new l.N(this._ne.lng,this._ne.lat);return new wi(i,i.lng>a.lng?new l.N(a.lng+360,a.lat):a)}}class Ds{constructor(i,a,m){this.bounds=wi.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),m=Math.floor(l.O(this.bounds.getWest())*a),g=Math.floor(l.Q(this.bounds.getNorth())*a),x=Math.ceil(l.O(this.bounds.getEast())*a),T=Math.ceil(l.Q(this.bounds.getSouth())*a);return i.x>=m&&i.x<x&&i.y>=g&&i.y<T}}class to extends l.E{constructor(i,a,m,g){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(a,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(l.e(this,i),i.bounds&&(this.tileBounds=new Ds(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new l.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(i){return l._(this,void 0,void 0,function*(){const a=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(a,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};m.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((x,T)=>{i.reloadPromise={resolve:x,reject:T}})}else i.actor=this.dispatcher.getActor(),g="LT";i.abortController=new AbortController;try{const x=yield i.actor.sendAsync({type:g,data:m},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,x)}catch(x){if(delete i.abortController,i.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,a){if(a&&a.resourceTiming&&(i.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&i.setExpiryData(a),i.loadVectorData(a,this.map.painter),i.reloadPromise){const m=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(m.resolve).catch(m.reject)}}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Br extends l.E{constructor(i,a,m,g){super(),this.id=i,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.M(a,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,function*(i=!1){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new Ds(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:i})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load(!0)}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return l._(this,void 0,void 0,function*(){const a=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const m=yield je.getImage(this.map._requestManager.transformRequest(a,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const g=this.map.painter.context,x=g.gl,T=m.data;i.texture=this.map.painter.getTileTexture(T.width),i.texture?i.texture.update(T,{useMipmap:!0}):(i.texture=new Q(g,T,x.RGBA,{useMipmap:!0}),i.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class hs extends Br{constructor(i,a,m,g){super(i,a,m,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(i){return l._(this,void 0,void 0,function*(){const a=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(a,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const g=yield je.getImage(m,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(g&&g.data){const x=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&i.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const T=l.b(x)&&l.U()?x:yield this.readImageNow(x),C={type:this.type,uid:i.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const M=yield i.actor.sendAsync({type:"LDT",data:C});i.dem=M,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(g){if(delete i.abortController,i.aborted)i.state="unloaded";else if(g)throw i.state="errored",g}})}readImageNow(i){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const a=i.width+2,m=i.height+2;try{return new l.R({width:a,height:m},yield l.W(i,-1,-1,a,m))}catch{}}return H.getImageData(i,1)})}_getNeighboringTiles(i){const a=i.canonical,m=Math.pow(2,a.z),g=(a.x-1+m)%m,x=a.x===0?i.wrap-1:i.wrap,T=(a.x+1+m)%m,C=a.x+1===m?i.wrap+1:i.wrap,M={};return M[new l.S(i.overscaledZ,x,a.z,g,a.y).key]={backfilled:!1},M[new l.S(i.overscaledZ,C,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(M[new l.S(i.overscaledZ,x,a.z,g,a.y-1).key]={backfilled:!1},M[new l.S(i.overscaledZ,i.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},M[new l.S(i.overscaledZ,C,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<m&&(M[new l.S(i.overscaledZ,x,a.z,g,a.y+1).key]={backfilled:!1},M[new l.S(i.overscaledZ,i.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},M[new l.S(i.overscaledZ,C,a.z,T,a.y+1).key]={backfilled:!1}),M}unloadTile(i){return l._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class no extends l.E{constructor(i,a,m,g){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(g),this._data=a.data,this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:l.X,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.X,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(i){return i*(l.X/this.tileSize)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return l._(this,void 0,void 0,function*(){const i=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(i.clusterRadius)),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,a,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:a,offset:m}})}_updateWorkerData(i){return l._(this,void 0,void 0,function*(){const a=l.e({type:this.type},this.workerOptions);i?a.dataDiff=i:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(H.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(x,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(i){return l._(this,void 0,void 0,function*(){const a=i.actor?"RT":"LT";i.actor=this.actor;const m={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.abortController=new AbortController;const g=yield this.actor.sendAsync({type:a,data:m},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(g,this.map.painter,a==="RT")})}abortTile(i){return l._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return l._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class hr extends l.E{constructor(i,a,m,g){super(),this.flippedWindingOrder=!1,this.id=i,this.dispatcher=m,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=a}load(i){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield je.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,i&&(this.coordinates=i),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new l.j(a))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const a=i.map(l.Y.fromLngLat);var m;return this.tileID=function(g){let x=1/0,T=1/0,C=-1/0,M=-1/0;for(const Z of g)x=Math.min(x,Z.x),T=Math.min(T,Z.y),C=Math.max(C,Z.x),M=Math.max(M,Z.y);const z=Math.max(C-x,M-T),V=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),q=Math.pow(2,V);return new l.Z(V,Math.floor((x+C)/2*q),Math.floor((T+M)/2*q))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map(g=>this.tileID.getTilePoint(g)._round()),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,a=i.gl;this.texture||(this.texture=new Q(i,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class zs extends hr{constructor(i,a,m,g){super(i,a,m,g),this.roundZoom=!0,this.type="video",this.options=a}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const a of i.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield l.a0(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new l.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const a=this.video.seekable;i<a.start(0)||i>a.end(0)?this.fire(new l.j(new l.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,a=i.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new Q(i,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class bo extends hr{constructor(i,a,m,g){super(i,a,m,g),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(T=>typeof T!="number"))||this.fire(new l.j(new l.$(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.$(`sources.${i}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.j(new l.$(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.$(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.$(`sources.${i}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,m=a.gl;this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Q(a,this.canvas,m.RGBA,{premultiply:!0});let g=!1;for(const x in this.tiles){const T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const ds={},Xo=v=>{switch(v){case"geojson":return no;case"image":return hr;case"raster":return Br;case"raster-dem":return hs;case"vector":return to;case"video":return zs;case"canvas":return bo}return ds[v]},To="RTLPluginLoaded";class ni extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ir()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return l._(this,arguments,void 0,function*(a,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=H.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(To))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ti=null;function Vr(){return Ti||(Ti=new ni),Ti}class So{constructor(i,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a1(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const a=i+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,a,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(g,x){const T={};if(!x)return T;for(const C of g){const M=C.layerIds.map(z=>x.getLayer(z)).filter(Boolean);if(M.length!==0){C.layers=M,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(z=>M.filter(V=>V.id===z)[0]));for(const z of M)T[z.id]=C}}return T}(i.buckets,a==null?void 0:a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a3){if(this.hasSymbolBuckets=!0,!m)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a3&&x.hasRTLText){this.hasRTLText=!0,Vr().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(g).queryRadius(x))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a2}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(i)}const a=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Q(i,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Q(i,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,a,m,g,x,T,C,M,z,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:T,tileSize:this.tileSize,pixelPosMatrix:V,transform:M,params:C,queryPadding:this.queryPadding*z},i,a,m):{}}querySourceFeatures(i,a){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const g=m.loadVTLayers(),x=a&&a.sourceLayer?a.sourceLayer:"",T=g._geojsonTileLayer||g[x];if(!T)return;const C=l.a4(a&&a.filter),{z:M,x:z,y:V}=this.tileID.canonical,q={z:M,x:z,y:V};for(let Z=0;Z<T.length;Z++){const J=T.feature(Z);if(C.needGeometry){const _e=l.a5(J,!0);if(!C.filter(new l.z(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!C.filter(new l.z(this.tileID.overscaledZ),J))continue;const ne=m.getId(J,x),ye=new l.a6(J,M,z,V,ne);ye.tile=q,i.push(ye)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const m=l.a7(i.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const m=Date.now();let g=!1;if(this.expirationTime>m)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const x=this.expirationTime-a;x?this.expirationTime=m+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!a.style.hasLayer(g))continue;const x=this.buckets[g],T=x.layers[0].sourceLayer||"_geojsonTileLayer",C=m[T],M=i[T];if(!C||!M||Object.keys(M).length===0)continue;x.update(M,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=a&&a.style&&a.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<H.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=H.now()+i}setDependencies(i,a){const m={};for(const g of a)m[g]=!0;this.dependencies[i]=m}hasDependency(i,a){for(const m of i){const g=this.dependencies[m];if(g){for(const x of a)if(g[x])return!0}}return!1}}class Ns{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,m){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const x={value:a,timeout:void 0};if(m!==void 0&&(x.timeout=setTimeout(()=>{this.remove(i,x)},m)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const m=i.wrapped().key,g=a===void 0?0:this.data[m].indexOf(a),x=this.data[m][g];return this.data[m].splice(g,1),x.timeout&&clearTimeout(x.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(x.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const m in this.data)for(const g of this.data[m])i(g.value)||a.push(g);for(const m of a)this.remove(m.value.tileID,m)}}class Yo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,m){const g=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},l.e(this.stateChanges[i][g],m),this.deletedStates[i]===null){this.deletedStates[i]={};for(const x in this.state[i])x!==g&&(this.deletedStates[i][x]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const x in this.state[i][g])m[x]||(this.deletedStates[i][g][x]=null)}else for(const x in m)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][x]===null&&delete this.deletedStates[i][g][x]}removeFeatureState(i,a,m){if(this.deletedStates[i]===null)return;const g=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},m&&a!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][m]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(m in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][m]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,a){const m=String(a),g=l.e({},(this.state[i]||{})[m],(this.stateChanges[i]||{})[m]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const x=this.deletedStates[i][a];if(x===null)return{};for(const T in x)delete g[T]}return g}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const m={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const T in this.stateChanges[g])this.state[g][T]||(this.state[g][T]={}),l.e(this.state[g][T],this.stateChanges[g][T]),x[T]=this.state[g][T];m[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const T in this.state[g])x[T]={},this.state[g][T]={};else for(const T in this.deletedStates[g]){if(this.deletedStates[g][T]===null)this.state[g][T]={};else for(const C of Object.keys(this.deletedStates[g][T]))delete this.state[g][T][C];x[T]=this.state[g][T]}m[g]=m[g]||{},l.e(m[g],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const g in i)i[g].setFeatureState(m,a)}}function Os(v,i,a){const m=i.intersectsFrustum(v);if(!a)return m;const g=i.intersectsPlane(a);return m===0||g===0?0:m===2&&g===2?2:1}function Qo(v,i,a,m,g){let x=v;const T=Math.atan(i/a),C=Math.hypot(i,a);return x=v+l.a8(m/C/Math.max(.5,Math.cos(l.aa(g/2)))),x+=1*l.a8(Math.cos(T))/2,x+=l.ab(v-x,-0,0),x}function fs(v,i){const a=(i.roundZoom?Math.round:Math.floor)(v.zoom+l.a8(v.tileSize/i.tileSize));return Math.max(0,a)}function pe(v,i){const a=v.getCameraFrustum(),m=v.getClippingPlane(),g=v.screenPointToMercatorCoordinate(v.getCameraPoint()),x=l.Y.fromLngLat(v.center,v.elevation);g.z=x.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const T=v.getCoveringTilesDetailsProvider(),C=T.allowVariableZoom(v,i),M=fs(v,i),z=i.minzoom||0,V=i.maxzoom!==void 0?i.maxzoom:v.maxZoom,q=Math.min(Math.max(0,M),V),Z=Math.pow(2,q),J=[Z*g.x,Z*g.y,0],ne=[Z*x.x,Z*x.y,0],ye=Math.hypot(x.x-g.x,x.y-g.y),_e=Math.abs(x.z-g.z),xe=Math.hypot(ye,_e),be=Re=>({zoom:0,x:0,y:0,wrap:Re,fullyVisible:!1}),Ce=[],ke=[];if(v.renderWorldCopies&&T.allowWorldCopies())for(let Re=1;Re<=3;Re++)Ce.push(be(-Re)),Ce.push(be(Re));for(Ce.push(be(0));Ce.length>0;){const Re=Ce.pop(),ze=Re.x,De=Re.y;let Ze=Re.fullyVisible;const Ke={x:ze,y:De,z:Re.zoom},st=T.getTileAABB(Ke,Re.wrap,v.elevation,i);if(!Ze){const bt=Os(a,st,m);if(bt===0)continue;Ze=bt===2}const at=T.distanceToTile2d(g.x,g.y,Ke,st);let tt=M;C&&(tt=(i.calculateTileZoom||Qo)(v.zoom+l.a8(v.tileSize/i.tileSize),at,_e,xe,v.fov)),tt=(i.roundZoom?Math.round:Math.floor)(tt),tt=Math.max(0,tt);const St=Math.min(tt,V);if(Re.wrap=T.getWrap(x,Ke,Re.wrap),Re.zoom>=St){if(Re.zoom<z)continue;const bt=q-Re.zoom,ht=J[0]-.5-(ze<<bt),It=J[1]-.5-(De<<bt),pn=i.reparseOverscaled?Math.max(Re.zoom,tt):Re.zoom;ke.push({tileID:new l.S(Re.zoom===V?pn:Re.zoom,Re.wrap,Re.zoom,ze,De),distanceSq:l.a9([ne[0]-.5-ze,ne[1]-.5-De]),tileDistanceToCamera:Math.sqrt(ht*ht+It*It)})}else for(let bt=0;bt<4;bt++)Ce.push({zoom:Re.zoom+1,x:(ze<<1)+bt%2,y:(De<<1)+(bt>>1),wrap:Re.wrap,fullyVisible:Ze})}return ke.sort((Re,ze)=>Re.distanceSq-ze.distanceSq).map(Re=>Re.tileID)}class ee extends l.E{constructor(i,a,m){super(),this.id=i,this.dispatcher=m,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,x,T,C)=>{const M=new(Xo(x.type))(g,x,T,C);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return M})(i,a,m,this),this._tiles={},this._cache=new Ns(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Yo,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const a=this._tiles[i];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,a,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,a,m)}catch(g){i.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const m=this._tiles[a];m.upload(i),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(re).map(i=>i.key)}getRenderableIds(i){const a=[];for(const m in this._tiles)this._isIdRenderable(m,i)&&a.push(this._tiles[m]);return i?a.sort((m,g)=>{const x=m.tileID,T=g.tileID,C=new l.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians),M=new l.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians);return x.overscaledZ-T.overscaledZ||M.y-C.y||M.x-C.x}).map(m=>m.tileID.key):a.map(m=>m.tileID).sort(re).map(m=>m.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())}reload(i){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)(i||this._tiles[a].state!=="errored")&&this._reloadTile(a,"reloading")}}_reloadTile(i,a){return l._(this,void 0,void 0,function*(){const m=this._tiles[i];m&&(m.state!=="loading"&&(m.state=a),yield this._loadTile(m,i,a))})}_tileLoaded(i,a,m){i.timeAdded=H.now(),m==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const x=a[g];if(i.neighboringTiles&&i.neighboringTiles[x]){const T=this.getTileByID(x);m(i,T),m(T,i)}}function m(g,x){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let T=x.tileID.canonical.x-g.tileID.canonical.x;const C=x.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),z=x.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+M)===1?T+=M:Math.abs(T-M)===1&&(T-=M)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,T,C),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,m,g){for(const x in this._tiles){let T=this._tiles[x];if(g[x]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>m)continue;let C=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const z=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[z.key],T&&T.hasData()&&(C=z)}let M=C;for(;M.overscaledZ>a;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]||i[M.canonical.key]){g[C.key]=C;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const m=this._loadedParentTiles[i.key];return m&&m.tileID.overscaledZ>=a?m:null}for(let m=i.overscaledZ-1;m>=a;m--){const g=i.scaledTo(m),x=this._getLoadedTile(g);if(x)return x}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const a=Math.ceil(i.width/this._source.tileSize)+1,m=Math.ceil(i.height/this._source.tileSize)+1,g=Math.floor(a*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(i){const a=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,a){const m={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+a),m[x.tileID.key]=x}this._tiles=m;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}_updateCoveredAndRetainedTiles(i,a,m,g,x,T){const C={},M={},z=Object.keys(i),V=H.now();for(const q of z){const Z=i[q],J=this._tiles[q];if(!J||J.fadeEndTime!==0&&J.fadeEndTime<=V)continue;const ne=this.findLoadedParent(Z,a),ye=this.findLoadedSibling(Z),_e=ne||ye||null;_e&&(this._addTile(_e.tileID),C[_e.tileID.key]=_e.tileID),M[q]=Z}this._retainLoadedChildren(M,g,m,i);for(const q in C)i[q]||(this._coveredTiles[q]=!0,i[q]=C[q]);if(T){const q={},Z={};for(const J of x)this._tiles[J.key].hasData()?q[J.key]=J:Z[J.key]=J;for(const J in Z){const ne=Z[J].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(q[ne[0].key]=i[ne[0].key]=ne[0],q[ne[1].key]=i[ne[1].key]=ne[1],q[ne[2].key]=i[ne[2].key]=ne[2],q[ne[3].key]=i[ne[3].key]=ne[3],delete Z[J])}for(const J in Z){const ne=Z[J],ye=this.findLoadedParent(ne,this._source.minzoom),_e=this.findLoadedSibling(ne),xe=ye||_e||null;if(xe){q[xe.tileID.key]=i[xe.tileID.key]=xe.tileID;for(const be in q)q[be].isChildOf(xe.tileID)&&delete q[be]}}for(const J in this._tiles)q[J]||(this._coveredTiles[J]=!0)}}update(i,a){if(!this._sourceLoaded||this._paused)return;let m;this.transform=i,this.terrain=a,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new l.S(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(m=pe(i,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter(V=>this._source.hasTile(V)))):m=[];const g=fs(i,this._source),x=Math.max(g-ee.maxOverzooming,this._source.minzoom),T=Math.max(g+ee.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const q of m)if(q.canonical.z>this._source.minzoom){const Z=q.scaledTo(q.canonical.z-1);V[Z.key]=Z;const J=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));V[J.key]=J}m=m.concat(Object.values(V))}const C=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(m,g);oe(this._source.type)&&this._updateCoveredAndRetainedTiles(M,x,T,g,m,a);for(const V in M)this._tiles[V].clearFadeHold();const z=l.ac(this._tiles,M);for(const V of z){const q=this._tiles[V];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,a){var m;const g={},x={},T=Math.max(a-ee.maxOverzooming,this._source.minzoom),C=Math.max(a+ee.maxUnderzooming,this._source.minzoom),M={};for(const z of i){const V=this._addTile(z);g[z.key]=z,V.hasData()||a<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,a,C,g);for(const z of i){let V=this._tiles[z.key];if(V.hasData())continue;if(a+1>this._source.maxzoom){const Z=z.children(this._source.maxzoom)[0],J=this.getTile(Z);if(J&&J.hasData()){g[Z.key]=Z;continue}}else{const Z=z.children(this._source.maxzoom);if(g[Z[0].key]&&g[Z[1].key]&&g[Z[2].key]&&g[Z[3].key])continue}let q=V.wasRequested();for(let Z=z.overscaledZ-1;Z>=T;--Z){const J=z.scaledTo(Z);if(x[J.key])break;if(x[J.key]=!0,V=this.getTile(J),!V&&q&&(V=this._addTile(J)),V){const ne=V.hasData();if((ne||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||q)&&(g[J.key]=J),q=V.wasRequested(),ne)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let m,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){m=this._loadedParentTiles[g.key];break}a.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(m=this._getLoadedTile(x),m)break;g=x}for(const x of a)this._loadedParentTiles[x]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const a=this._tiles[i].tileID,m=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=m}}_addTile(i){let a=this._tiles[i.key];if(a)return a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const m=a;return a||(a=new So(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(a,i.key,a.state)),a.uses++,this._tiles[i.key]=a,m||this._source.fire(new l.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const m=a.getExpiryTimeout();m&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},m))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(i){const a=i.sourceDataType;i.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&a==="content"&&(this.reload(i.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,a,m){const g=[],x=this.transform;if(!x)return g;const T=m?x.getCameraQueryGeometry(i):i,C=i.map(ne=>x.screenPointToMercatorCoordinate(ne,this.terrain)),M=T.map(ne=>x.screenPointToMercatorCoordinate(ne,this.terrain)),z=this.getIds();let V=1/0,q=1/0,Z=-1/0,J=-1/0;for(const ne of M)V=Math.min(V,ne.x),q=Math.min(q,ne.y),Z=Math.max(Z,ne.x),J=Math.max(J,ne.y);for(let ne=0;ne<z.length;ne++){const ye=this._tiles[z[ne]];if(ye.holdingForFade())continue;const _e=ye.tileID,xe=Math.pow(2,x.zoom-ye.tileID.overscaledZ),be=a*ye.queryPadding*l.X/ye.tileSize/xe,Ce=[_e.getTilePoint(new l.Y(V,q)),_e.getTilePoint(new l.Y(Z,J))];if(Ce[0].x-be<l.X&&Ce[0].y-be<l.X&&Ce[1].x+be>=0&&Ce[1].y+be>=0){const ke=C.map(ze=>_e.getTilePoint(ze)),Re=M.map(ze=>_e.getTilePoint(ze));g.push({tile:ye,tileID:_e,queryGeometry:ke,cameraQueryGeometry:Re,scale:xe})}}return g}getVisibleCoordinates(i){const a=this.getRenderableIds(i).map(m=>this._tiles[m].tileID);return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(oe(this._source.type)){const i=H.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=i)return!0}return!1}setFeatureState(i,a,m){this._state.updateState(i=i||"_geojsonTileLayer",a,m)}removeFeatureState(i,a,m){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,m)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,m){const g=this._tiles[i];g&&g.setDependencies(a,m)}reloadTilesForDependencies(i,a){for(const m in this._tiles)this._tiles[m].hasDependency(i,a)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(i,a))}}function re(v,i){const a=Math.abs(2*v.wrap)-+(v.wrap<0),m=Math.abs(2*i.wrap)-+(i.wrap<0);return v.overscaledZ-i.overscaledZ||m-a||i.canonical.y-v.canonical.y||i.canonical.x-v.canonical.x}function oe(v){return v==="raster"||v==="image"||v==="video"}ee.maxOverzooming=10,ee.maxUnderzooming=3;class Te{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ab(i,0,1);let a=1,m=this._distances[a];const g=i*this.paddedLength+this.padding;for(;m<g&&a<this._distances.length;)m=this._distances[++a];const x=a-1,T=this._distances[x],C=m-T,M=C>0?(g-T)/C:0;return this.points[x].mult(1-M).add(this.points[a].mult(M))}}function Le(v,i){let a=!0;return v==="always"||v!=="never"&&i!=="never"||(a=!1),a}class Be{constructor(i,a,m){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(a/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,m,g,x){this._forEachCell(a,m,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(i,a,m,g){this._forEachCell(a-g,m-g,a+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(m),this.circles.push(g)}_insertBoxCell(i,a,m,g,x,T){this.boxCells[x].push(T)}_insertCircleCell(i,a,m,g,x,T){this.circleCells[x].push(T)}_query(i,a,m,g,x,T,C){if(m<0||i>this.width||g<0||a>this.height)return[];const M=[];if(i<=0&&a<=0&&this.width<=m&&this.height<=g){if(x)return[{key:null,x1:i,y1:a,x2:m,y2:g}];for(let z=0;z<this.boxKeys.length;z++)M.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const V=this.circles[3*z],q=this.circles[3*z+1],Z=this.circles[3*z+2];M.push({key:this.circleKeys[z],x1:V-Z,y1:q-Z,x2:V+Z,y2:q+Z})}}else this._forEachCell(i,a,m,g,this._queryCell,M,{hitTest:x,overlapMode:T,seenUids:{box:{},circle:{}}},C);return M}query(i,a,m,g){return this._query(i,a,m,g,!1,null)}hitTest(i,a,m,g,x,T){return this._query(i,a,m,g,!0,x,T).length>0}hitTestCircle(i,a,m,g,x){const T=i-m,C=i+m,M=a-m,z=a+m;if(C<0||T>this.width||z<0||M>this.height)return!1;const V=[];return this._forEachCell(T,M,C,z,this._queryCellCircle,V,{hitTest:!0,overlapMode:g,circle:{x:i,y:a,radius:m},seenUids:{box:{},circle:{}}},x),V.length>0}_queryCell(i,a,m,g,x,T,C,M){const{seenUids:z,hitTest:V,overlapMode:q}=C,Z=this.boxCells[x];if(Z!==null){const ne=this.bboxes;for(const ye of Z)if(!z.box[ye]){z.box[ye]=!0;const _e=4*ye,xe=this.boxKeys[ye];if(i<=ne[_e+2]&&a<=ne[_e+3]&&m>=ne[_e+0]&&g>=ne[_e+1]&&(!M||M(xe))&&(!V||!Le(q,xe.overlapMode))&&(T.push({key:xe,x1:ne[_e],y1:ne[_e+1],x2:ne[_e+2],y2:ne[_e+3]}),V))return!0}}const J=this.circleCells[x];if(J!==null){const ne=this.circles;for(const ye of J)if(!z.circle[ye]){z.circle[ye]=!0;const _e=3*ye,xe=this.circleKeys[ye];if(this._circleAndRectCollide(ne[_e],ne[_e+1],ne[_e+2],i,a,m,g)&&(!M||M(xe))&&(!V||!Le(q,xe.overlapMode))){const be=ne[_e],Ce=ne[_e+1],ke=ne[_e+2];if(T.push({key:xe,x1:be-ke,y1:Ce-ke,x2:be+ke,y2:Ce+ke}),V)return!0}}}return!1}_queryCellCircle(i,a,m,g,x,T,C,M){const{circle:z,seenUids:V,overlapMode:q}=C,Z=this.boxCells[x];if(Z!==null){const ne=this.bboxes;for(const ye of Z)if(!V.box[ye]){V.box[ye]=!0;const _e=4*ye,xe=this.boxKeys[ye];if(this._circleAndRectCollide(z.x,z.y,z.radius,ne[_e+0],ne[_e+1],ne[_e+2],ne[_e+3])&&(!M||M(xe))&&!Le(q,xe.overlapMode))return T.push(!0),!0}}const J=this.circleCells[x];if(J!==null){const ne=this.circles;for(const ye of J)if(!V.circle[ye]){V.circle[ye]=!0;const _e=3*ye,xe=this.circleKeys[ye];if(this._circlesCollide(ne[_e],ne[_e+1],ne[_e+2],z.x,z.y,z.radius)&&(!M||M(xe))&&!Le(q,xe.overlapMode))return T.push(!0),!0}}}_forEachCell(i,a,m,g,x,T,C,M){const z=this._convertToXCellCoord(i),V=this._convertToYCellCoord(a),q=this._convertToXCellCoord(m),Z=this._convertToYCellCoord(g);for(let J=z;J<=q;J++)for(let ne=V;ne<=Z;ne++)if(x.call(this,i,a,m,g,this.xCellCount*ne+J,T,C,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,m,g,x,T){const C=g-i,M=x-a,z=m+T;return z*z>C*C+M*M}_circleAndRectCollide(i,a,m,g,x,T,C){const M=(T-g)/2,z=Math.abs(i-(g+M));if(z>M+m)return!1;const V=(C-x)/2,q=Math.abs(a-(x+V));if(q>V+m)return!1;if(z<=M||q<=V)return!0;const Z=z-M,J=q-V;return Z*Z+J*J<=m*m}}function He(v,i,a){const m=l.H();if(!v){const{vecSouth:q,vecEast:Z}=Qe(i),J=A();J[0]=Z[0],J[1]=Z[1],J[2]=q[0],J[3]=q[1],g=J,(V=(T=(x=J)[0])*(z=x[3])-(M=x[2])*(C=x[1]))&&(g[0]=z*(V=1/V),g[1]=-C*V,g[2]=-M*V,g[3]=T*V),m[0]=J[0],m[1]=J[1],m[4]=J[2],m[5]=J[3]}var g,x,T,C,M,z,V;return l.K(m,m,[1/a,1/a,1]),m}function Fe(v,i,a,m){if(v){const g=l.H();if(!i){const{vecSouth:x,vecEast:T}=Qe(a);g[0]=T[0],g[1]=T[1],g[4]=x[0],g[5]=x[1]}return l.K(g,g,[m,m,1]),g}return a.pixelsToClipSpaceMatrix}function Qe(v){const i=Math.cos(v.rollInRadians),a=Math.sin(v.rollInRadians),m=Math.cos(v.pitchInRadians),g=Math.cos(v.bearingInRadians),x=Math.sin(v.bearingInRadians),T=l.ad();T[0]=-g*m*a-x*i,T[1]=-x*m*a+g*i;const C=l.ae(T);C<1e-9?l.af(T):l.ag(T,T,1/C);const M=l.ad();M[0]=g*m*i-x*a,M[1]=x*m*i+g*a;const z=l.ae(M);return z<1e-9?l.af(M):l.ag(M,M,1/z),{vecEast:M,vecSouth:T}}function Ye(v,i,a,m){let g;m?(g=[v,i,m(v,i),1],l.al(g,g,a)):(g=[v,i,0,1],Zn(g,g,a));const x=g[3];return{point:new l.P(g[0]/x,g[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function Ue(v,i){return .5+v/i*.5}function Oe(v,i){return v.x>=-i[0]&&v.x<=i[0]&&v.y>=-i[1]&&v.y<=i[1]}function yt(v,i,a,m,g,x,T,C,M,z,V,q,Z){const J=a?v.textSizeData:v.iconSizeData,ne=l.ah(J,i.transform.zoom),ye=[256/i.width*2+1,256/i.height*2+1],_e=a?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;_e.clear();const xe=v.lineVertexArray,be=a?v.text.placedSymbolArray:v.icon.placedSymbolArray,Ce=i.transform.width/i.transform.height;let ke=!1;for(let Re=0;Re<be.length;Re++){const ze=be.get(Re);if(ze.hidden||ze.writingMode===l.ai.vertical&&!ke){Si(ze.numGlyphs,_e);continue}ke=!1;const De=new l.P(ze.anchorX,ze.anchorY),Ze={getElevation:Z,pitchedLabelPlaneMatrix:m,lineVertexArray:xe,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:De,unwrappedTileID:M,width:z,height:V,translation:q},Ke=hn(ze.anchorX,ze.anchorY,Ze);if(!Oe(Ke.point,ye)){Si(ze.numGlyphs,_e);continue}const st=Ue(i.transform.cameraToCenterDistance,Ke.signedDistanceFromCamera),at=l.aj(J,ne,ze),tt=x?at*i.transform.getPitchedTextCorrection(ze.anchorX,ze.anchorY,M)/st:at*st,St=tn({projectionContext:Ze,pitchedLabelPlaneMatrixInverse:g,symbol:ze,fontSize:tt,flip:!1,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:_e,aspectRatio:Ce,rotateToLine:C});ke=St.useVertical,(St.notEnoughRoom||ke||St.needsFlipping&&tn({projectionContext:Ze,pitchedLabelPlaneMatrixInverse:g,symbol:ze,fontSize:tt,flip:!0,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:_e,aspectRatio:Ce,rotateToLine:C}).notEnoughRoom)&&Si(ze.numGlyphs,_e)}a?v.text.dynamicLayoutVertexBuffer.updateData(_e):v.icon.dynamicLayoutVertexBuffer.updateData(_e)}function vt(v,i,a,m,g,x,T,C){const M=x.glyphStartIndex+x.numGlyphs,z=x.lineStartIndex,V=x.lineStartIndex+x.lineLength,q=i.getoffsetX(x.glyphStartIndex),Z=i.getoffsetX(M-1),J=Qn(v*q,a,m,g,x.segment,z,V,C,T);if(!J)return null;const ne=Qn(v*Z,a,m,g,x.segment,z,V,C,T);return ne?C.projectionCache.anyProjectionOccluded?null:{first:J,last:ne}:null}function zt(v,i,a,m){return v===l.ai.horizontal&&Math.abs(a.y-i.y)>Math.abs(a.x-i.x)*m?{useVertical:!0}:(v===l.ai.vertical?i.y<a.y:i.x>a.x)?{needsFlipping:!0}:null}function tn(v){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:a,symbol:m,fontSize:g,flip:x,keepUpright:T,glyphOffsetArray:C,dynamicLayoutVertexArray:M,aspectRatio:z,rotateToLine:V}=v,q=g/24,Z=m.lineOffsetX*q,J=m.lineOffsetY*q;let ne;if(m.numGlyphs>1){const ye=m.glyphStartIndex+m.numGlyphs,_e=m.lineStartIndex,xe=m.lineStartIndex+m.lineLength,be=vt(q,C,Z,J,x,m,V,i);if(!be)return{notEnoughRoom:!0};const Ce=xt(be.first.point.x,be.first.point.y,i,a),ke=xt(be.last.point.x,be.last.point.y,i,a);if(T&&!x){const Re=zt(m.writingMode,Ce,ke,z);if(Re)return Re}ne=[be.first];for(let Re=m.glyphStartIndex+1;Re<ye-1;Re++)ne.push(Qn(q*C.getoffsetX(Re),Z,J,x,m.segment,_e,xe,i,V));ne.push(be.last)}else{if(T&&!x){const _e=Ct(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,xe=m.lineStartIndex+m.segment+1,be=new l.P(i.lineVertexArray.getx(xe),i.lineVertexArray.gety(xe)),Ce=Ct(be.x,be.y,i),ke=Ce.signedDistanceFromCamera>0?Ce.point:nt(i.tileAnchorPoint,be,_e,1,i),Re=xt(_e.x,_e.y,i,a),ze=xt(ke.x,ke.y,i,a),De=zt(m.writingMode,Re,ze,z);if(De)return De}const ye=Qn(q*C.getoffsetX(m.glyphStartIndex),Z,J,x,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,i,V);if(!ye||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ne=[ye]}for(const ye of ne)l.ak(M,ye.point,ye.angle);return{}}function nt(v,i,a,m,g){const x=v.add(v.sub(i)._unit()),T=Ct(x.x,x.y,g).point,C=a.sub(T);return a.add(C._mult(m/C.mag()))}function wt(v,i,a){const m=i.projectionCache;if(m.projections[v])return m.projections[v];const g=new l.P(i.lineVertexArray.getx(v),i.lineVertexArray.gety(v)),x=Ct(g.x,g.y,i);if(x.signedDistanceFromCamera>0)return m.projections[v]=x.point,m.anyProjectionOccluded=m.anyProjectionOccluded||x.isOccluded,x.point;const T=v-a.direction;return nt(a.distanceFromAnchor===0?i.tileAnchorPoint:new l.P(i.lineVertexArray.getx(T),i.lineVertexArray.gety(T)),g,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,i)}function Ct(v,i,a){const m=v+a.translation[0],g=i+a.translation[1];let x;return a.pitchWithMap?(x=Ye(m,g,a.pitchedLabelPlaneMatrix,a.getElevation),x.isOccluded=!1):(x=a.transform.projectTileCoordinates(m,g,a.unwrappedTileID,a.getElevation),x.point.x=(.5*x.point.x+.5)*a.width,x.point.y=(.5*-x.point.y+.5)*a.height),x}function xt(v,i,a,m){if(a.pitchWithMap){const g=[v,i,0,1];return l.al(g,g,m),a.transform.projectTileCoordinates(g[0]/g[3],g[1]/g[3],a.unwrappedTileID,a.getElevation).point}return{x:v/a.width*2-1,y:i/a.height*2-1}}function hn(v,i,a){return a.transform.projectTileCoordinates(v,i,a.unwrappedTileID,a.getElevation)}function qt(v,i,a){return v._unit()._perp()._mult(i*a)}function kt(v,i,a,m,g,x,T,C,M){if(C.projectionCache.offsets[v])return C.projectionCache.offsets[v];const z=a.add(i);if(v+M.direction<m||v+M.direction>=g)return C.projectionCache.offsets[v]=z,z;const V=wt(v+M.direction,C,M),q=qt(V.sub(a),T,M.direction),Z=a.add(q),J=V.add(q);return C.projectionCache.offsets[v]=l.am(x,z,Z,J)||z,C.projectionCache.offsets[v]}function Qn(v,i,a,m,g,x,T,C,M){const z=m?v-i:v+i;let V=z>0?1:-1,q=0;m&&(V*=-1,q=Math.PI),V<0&&(q+=Math.PI);let Z,J=V>0?x+g:x+g+1;C.projectionCache.cachedAnchorPoint?Z=C.projectionCache.cachedAnchorPoint:(Z=Ct(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=Z);let ne,ye,_e=Z,xe=Z,be=0,Ce=0;const ke=Math.abs(z),Re=[];let ze;for(;be+Ce<=ke;){if(J+=V,J<x||J>=T)return null;be+=Ce,xe=_e,ye=ne;const Ke={absOffsetX:ke,direction:V,distanceFromAnchor:be,previousVertex:xe};if(_e=wt(J,C,Ke),a===0)Re.push(xe),ze=_e.sub(xe);else{let st;const at=_e.sub(xe);st=at.mag()===0?qt(wt(J+V,C,Ke).sub(_e),a,V):qt(at,a,V),ye||(ye=xe.add(st)),ne=kt(J,st,_e,x,T,ye,a,C,Ke),Re.push(ye),ze=ne.sub(ye)}Ce=ze.mag()}const De=ze._mult((ke-be)/Ce)._add(ye||xe),Ze=q+Math.atan2(_e.y-xe.y,_e.x-xe.x);return Re.push(De),{point:De,angle:M?Ze:0,path:Re}}const ps=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Si(v,i){for(let a=0;a<v;a++){const m=i.length;i.resize(m+4),i.float32.set(ps,3*m)}}function Zn(v,i,a){const m=i[0],g=i[1];return v[0]=a[0]*m+a[4]*g+a[12],v[1]=a[1]*m+a[5]*g+a[13],v[3]=a[3]*m+a[7]*g+a[15],v}const zn=100;class Cr{constructor(i,a=new Be(i.width+200,i.height+200,25),m=new Be(i.width+200,i.height+200,25)){this.transform=i,this.grid=a,this.ignoredGrid=m,this.pitchFactor=Math.cos(i.pitch*Math.PI/180)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+zn,this.screenBottomBoundary=i.height+zn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,a,m,g,x,T,C,M,z,V,q,Z){const J=this.projectAndGetPerspectiveRatio(i.anchorPointX+M[0],i.anchorPointY+M[1],x,V,Z),ne=m*J.perspectiveRatio;let ye;if(T||C)ye=this._projectCollisionBox(i,ne,g,x,T,C,M,J,V,q,Z);else{const ze=J.x+(q?q.x*ne:0),De=J.y+(q?q.y*ne:0);ye={allPointsOccluded:!1,box:[ze+i.x1*ne,De+i.y1*ne,ze+i.x2*ne,De+i.y2*ne]}}const[_e,xe,be,Ce]=ye.box,ke=T?ye.allPointsOccluded:J.isOccluded;let Re=ke;return Re||(Re=J.perspectiveRatio<this.perspectiveRatioCutoff),Re||(Re=!this.isInsideGrid(_e,xe,be,Ce)),Re||a!=="always"&&this.grid.hitTest(_e,xe,be,Ce,a,z)?{box:[_e,xe,be,Ce],placeable:!1,offscreen:!1,occluded:ke}:{box:[_e,xe,be,Ce],placeable:!0,offscreen:this.isOffscreen(_e,xe,be,Ce),occluded:ke}}placeCollisionCircles(i,a,m,g,x,T,C,M,z,V,q,Z,J,ne){const ye=[],_e=new l.P(a.anchorX,a.anchorY),xe=this.getPerspectiveRatio(_e.x,_e.y,T,ne),be=(z?x*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,T)/xe:x*xe)/l.as,Ce={getElevation:ne,pitchedLabelPlaneMatrix:C,lineVertexArray:m,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:_e,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:J},ke=vt(be,g,a.lineOffsetX*be,a.lineOffsetY*be,!1,a,!1,Ce);let Re=!1,ze=!1,De=!0;if(ke){const Ze=.5*q*xe+Z,Ke=new l.P(-100,-100),st=new l.P(this.screenRightBoundary,this.screenBottomBoundary),at=new Te,tt=ke.first,St=ke.last;let bt=[];for(let pn=tt.path.length-1;pn>=1;pn--)bt.push(tt.path[pn]);for(let pn=1;pn<St.path.length;pn++)bt.push(St.path[pn]);const ht=2.5*Ze;if(z){const pn=this.projectPathToScreenSpace(bt,Ce);bt=pn.some(Fn=>Fn.signedDistanceFromCamera<=0)?[]:pn.map(Fn=>Fn.point)}let It=[];if(bt.length>0){const pn=bt[0].clone(),Fn=bt[0].clone();for(let Ni=1;Ni<bt.length;Ni++)pn.x=Math.min(pn.x,bt[Ni].x),pn.y=Math.min(pn.y,bt[Ni].y),Fn.x=Math.max(Fn.x,bt[Ni].x),Fn.y=Math.max(Fn.y,bt[Ni].y);It=pn.x>=Ke.x&&Fn.x<=st.x&&pn.y>=Ke.y&&Fn.y<=st.y?[bt]:Fn.x<Ke.x||pn.x>st.x||Fn.y<Ke.y||pn.y>st.y?[]:l.ao([bt],Ke.x,Ke.y,st.x,st.y)}for(const pn of It){at.reset(pn,.25*Ze);let Fn=0;Fn=at.length<=.5*Ze?1:Math.ceil(at.paddedLength/ht)+1;for(let Ni=0;Ni<Fn;Ni++){const hi=Ni/Math.max(Fn-1,1),Oi=at.lerp(hi),di=Oi.x+zn,ai=Oi.y+zn;ye.push(di,ai,Ze,0);const fi=di-Ze,Zr=ai-Ze,fr=di+Ze,pr=ai+Ze;if(De=De&&this.isOffscreen(fi,Zr,fr,pr),ze=ze||this.isInsideGrid(fi,Zr,fr,pr),i!=="always"&&this.grid.hitTestCircle(di,ai,Ze,i,V)&&(Re=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Re}}}}return{circles:!M&&Re||!ze||xe<this.perspectiveRatioCutoff?[]:ye,offscreen:De,collisionDetected:Re}}projectPathToScreenSpace(i,a){const m=function(g,x){const T=l.H();return l.an(T,x.pitchedLabelPlaneMatrix),g.map(C=>{const M=Ye(C.x,C.y,T,x.getElevation),z=x.transform.projectTileCoordinates(M.point.x,M.point.y,x.unwrappedTileID,x.getElevation);return z.point.x=(.5*z.point.x+.5)*x.width,z.point.y=(.5*-z.point.y+.5)*x.height,z})}(i,a);return function(g){let x=0,T=0,C=0,M=0;for(let z=0;z<g.length;z++)g[z].isOccluded?(C=z+1,M=0):(M++,M>T&&(T=M,x=C));return g.slice(x,x+T)}(m)}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let m=1/0,g=1/0,x=-1/0,T=-1/0;for(const V of i){const q=new l.P(V.x+zn,V.y+zn);m=Math.min(m,q.x),g=Math.min(g,q.y),x=Math.max(x,q.x),T=Math.max(T,q.y),a.push(q)}const C=this.grid.query(m,g,x,T).concat(this.ignoredGrid.query(m,g,x,T)),M={},z={};for(const V of C){const q=V.key;if(M[q.bucketInstanceId]===void 0&&(M[q.bucketInstanceId]={}),M[q.bucketInstanceId][q.featureIndex])continue;const Z=[new l.P(V.x1,V.y1),new l.P(V.x2,V.y1),new l.P(V.x2,V.y2),new l.P(V.x1,V.y2)];l.ap(a,Z)&&(M[q.bucketInstanceId][q.featureIndex]=!0,z[q.bucketInstanceId]===void 0&&(z[q.bucketInstanceId]=[]),z[q.bucketInstanceId].push(q.featureIndex))}return z}insertCollisionBox(i,a,m,g,x,T){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:T,overlapMode:a},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,m,g,x,T){const C=m?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:x,collisionGroupID:T,overlapMode:a};for(let z=0;z<i.length;z+=4)C.insertCircle(M,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,a,m,g,x){if(x){let T;g?(T=[i,a,g(i,a),1],l.al(T,T,x)):(T=[i,a,0,1],Zn(T,T,x));const C=T[3];return{x:(T[0]/C+1)/2*this.transform.width+zn,y:(-T[1]/C+1)/2*this.transform.height+zn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const T=this.transform.projectTileCoordinates(i,a,m,g);return{x:(T.point.x+1)/2*this.transform.width+zn,y:(1-T.point.y)/2*this.transform.height+zn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5,isOccluded:T.isOccluded,signedDistanceFromCamera:T.signedDistanceFromCamera}}}getPerspectiveRatio(i,a,m,g){const x=this.transform.projectTileCoordinates(i,a,m,g);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(i,a,m,g){return m<zn||i>=this.screenRightBoundary||g<zn||a>this.screenBottomBoundary}isInsideGrid(i,a,m,g){return m>=0&&i<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=l.aq([]);return l.J(i,i,[-100,-100,0]),i}_projectCollisionBox(i,a,m,g,x,T,C,M,z,V,q){let Z=1,J=0,ne=0,ye=1;const _e=i.anchorPointX+C[0],xe=i.anchorPointY+C[1];if(T&&!x){const bt=this.projectAndGetPerspectiveRatio(_e+1,xe,g,z,q),ht=bt.x-M.x,It=Math.atan((bt.y-M.y)/ht)+(ht<0?Math.PI:0),pn=Math.sin(It),Fn=Math.cos(It);Z=Fn,J=pn,ne=-pn,ye=Fn}else if(!T&&x){const bt=Qe(this.transform);Z=bt.vecEast[0],J=bt.vecEast[1],ne=bt.vecSouth[0],ye=bt.vecSouth[1]}let be=M.x,Ce=M.y,ke=a;x&&(be=_e,Ce=xe,ke=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),ke*=this.transform.getPitchedTextCorrection(_e,xe,g),V||(ke*=l.ab(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),V&&(be+=Z*V.x*ke+ne*V.y*ke,Ce+=J*V.x*ke+ye*V.y*ke);const Re=i.x1*ke,ze=i.x2*ke,De=(Re+ze)/2,Ze=i.y1*ke,Ke=i.y2*ke,st=(Ze+Ke)/2,at=[{offsetX:Re,offsetY:Ze},{offsetX:De,offsetY:Ze},{offsetX:ze,offsetY:Ze},{offsetX:ze,offsetY:st},{offsetX:ze,offsetY:Ke},{offsetX:De,offsetY:Ke},{offsetX:Re,offsetY:Ke},{offsetX:Re,offsetY:st}];let tt=[];for(const{offsetX:bt,offsetY:ht}of at)tt.push(new l.P(be+Z*bt+ne*ht,Ce+J*bt+ye*ht));let St=!1;if(x){const bt=tt.map(ht=>this.projectAndGetPerspectiveRatio(ht.x,ht.y,g,z,q));St=bt.some(ht=>!ht.isOccluded),tt=bt.map(ht=>new l.P(ht.x,ht.y))}else St=!0;return{box:l.ar(tt),allPointsOccluded:!St}}}class ii{constructor(i,a,m,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Jo{constructor(i,a,m,g,x){this.text=new ii(i?i.text:null,a,m,x),this.icon=new ii(i?i.icon:null,a,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Eo{constructor(i,a,m){this.text=i,this.icon=a,this.skipFade=m}}class Qa{constructor(i,a,m,g,x){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=x}}class Io{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:m=>m.collisionGroupID===a}}return this.collisionGroups[i]}}function Fs(v,i,a,m,g){const{horizontalAlign:x,verticalAlign:T}=l.ay(v);return new l.P(-(x-.5)*i+m[0]*g,-(T-.5)*a+m[1]*g)}class Ja{constructor(i,a,m,g,x){this.transform=i.clone(),this.terrain=a,this.collisionIndex=new Cr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Io(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const a=this.terrain;return a?(m,g)=>a.getElevation(i,m,g):null}getBucketParts(i,a,m,g){const x=m.getBucket(a),T=m.latestFeatureIndex;if(!x||!T||a.id!==x.layerIds[0])return;const C=m.collisionBoxArray,M=x.layers[0].layout,z=x.layers[0].paint,V=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),q=m.tileSize/l.X,Z=m.tileID.toUnwrapped(),J=M.get("text-rotation-alignment")==="map",ne=l.at(m,1,this.transform.zoom),ye=l.au(this.collisionIndex.transform,m,z.get("text-translate"),z.get("text-translate-anchor")),_e=l.au(this.collisionIndex.transform,m,z.get("icon-translate"),z.get("icon-translate-anchor")),xe=He(J,this.transform,ne);this.retainedQueryData[x.bucketInstanceId]=new Qa(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,m.tileID);const be={bucket:x,layout:M,translationText:ye,translationIcon:_e,unwrappedTileID:Z,pitchedLabelPlaneMatrix:xe,scale:V,textPixelRatio:q,holdingForFade:m.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.ah(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const Ce of x.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:Re,symbolInstanceEnd:ze}=Ce;i.push({sortKey:ke,symbolInstanceStart:Re,symbolInstanceEnd:ze,parameters:be})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:be})}attemptAnchorPlacement(i,a,m,g,x,T,C,M,z,V,q,Z,J,ne,ye,_e,xe,be,Ce,ke){const Re=l.av[i.textAnchor],ze=[i.textOffset0,i.textOffset1],De=Fs(Re,m,g,ze,x),Ze=this.collisionIndex.placeCollisionBox(a,Z,M,z,V,C,T,_e,q.predicate,Ce,De,ke);if((!be||this.collisionIndex.placeCollisionBox(be,Z,M,z,V,C,T,xe,q.predicate,Ce,De,ke).placeable)&&Ze.placeable){let Ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:ze,width:m,height:g,anchor:Re,textBoxScale:x,prevAnchor:Ke},this.markUsedJustification(ne,Re,J,ye),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,ye,J),this.placedOrientations[J.crossTileID]=ye),{shift:De,placedGlyphBoxes:Ze}}}placeLayerBucketPart(i,a,m){const{bucket:g,layout:x,translationText:T,translationIcon:C,unwrappedTileID:M,pitchedLabelPlaneMatrix:z,textPixelRatio:V,holdingForFade:q,collisionBoxArray:Z,partiallyEvaluatedTextSize:J,collisionGroup:ne}=i.parameters,ye=x.get("text-optional"),_e=x.get("icon-optional"),xe=l.aw(x,"text-overlap","text-allow-overlap"),be=xe==="always",Ce=l.aw(x,"icon-overlap","icon-allow-overlap"),ke=Ce==="always",Re=x.get("text-rotation-alignment")==="map",ze=x.get("text-pitch-alignment")==="map",De=x.get("icon-text-fit")!=="none",Ze=x.get("symbol-z-order")==="viewport-y",Ke=be&&(ke||!g.hasIconData()||_e),st=ke&&(be||!g.hasTextData()||ye);!g.collisionArrays&&Z&&g.deserializeCollisionBoxes(Z);const at=this.retainedQueryData[g.bucketInstanceId].tileID,tt=this._getTerrainElevationFunc(at),St=this.transform.getFastPathSimpleProjectionMatrix(at),bt=(ht,It,pn)=>{var Fn,Ni;if(a[ht.crossTileID])return;if(q)return void(this.placements[ht.crossTileID]=new Eo(!1,!1,!1));let hi=!1,Oi=!1,di=!0,ai=null,fi={box:null,placeable:!1,offscreen:null,occluded:!1},Zr={box:null,placeable:!1,offscreen:null},fr=null,pr=null,Ts=null,xl=0,Oa=0,uo=0;It.textFeatureIndex?xl=It.textFeatureIndex:ht.useRuntimeCollisionCircles&&(xl=ht.featureIndex),It.verticalTextFeatureIndex&&(Oa=It.verticalTextFeatureIndex);const wl=It.textBox;if(wl){const Hs=pi=>{let Fi=l.ai.horizontal;if(g.allowVerticalPlacement&&!pi&&this.prevPlacement){const ho=this.prevPlacement.placedOrientations[ht.crossTileID];ho&&(this.placedOrientations[ht.crossTileID]=ho,Fi=ho,this.markUsedOrientation(g,Fi,ht))}return Fi},Vo=(pi,Fi)=>{if(g.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&It.verticalTextBox){for(const ho of g.writingModes)if(ho===l.ai.vertical?(fi=Fi(),Zr=fi):fi=pi(),fi&&fi.placeable)break}else fi=pi()},jo=ht.textAnchorOffsetStartIndex,co=ht.textAnchorOffsetEndIndex;if(co===jo){const pi=(Fi,ho)=>{const Bi=this.collisionIndex.placeCollisionBox(Fi,xe,V,at,M,ze,Re,T,ne.predicate,tt,void 0,St);return Bi&&Bi.placeable&&(this.markUsedOrientation(g,ho,ht),this.placedOrientations[ht.crossTileID]=ho),Bi};Vo(()=>pi(wl,l.ai.horizontal),()=>{const Fi=It.verticalTextBox;return g.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&Fi?pi(Fi,l.ai.vertical):{box:null,offscreen:null}}),Hs(fi&&fi.placeable)}else{let pi=l.av[(Ni=(Fn=this.prevPlacement)===null||Fn===void 0?void 0:Fn.variableOffsets[ht.crossTileID])===null||Ni===void 0?void 0:Ni.anchor];const Fi=(Bi,ex,S_)=>{const Qp=Bi.x2-Bi.x1,E_=Bi.y2-Bi.y1,Gu=ht.textBoxScale,Zu=De&&Ce==="never"?ex:null;let iu=null,I_=xe==="never"?1:2,of="never";pi&&I_++;for(let Jp=0;Jp<I_;Jp++){for(let em=jo;em<co;em++){const tm=g.textAnchorOffsets.get(em);if(pi&&tm.textAnchor!==pi)continue;const nm=this.attemptAnchorPlacement(tm,Bi,Qp,E_,Gu,Re,ze,V,at,M,ne,of,ht,g,S_,T,C,Zu,tt);if(nm&&(iu=nm.placedGlyphBoxes,iu&&iu.placeable))return hi=!0,ai=nm.shift,iu}pi?pi=null:of=xe}return m&&!iu&&(iu={box:this.collisionIndex.placeCollisionBox(wl,"always",V,at,M,ze,Re,T,ne.predicate,tt,void 0,St).box,offscreen:!1,placeable:!1,occluded:!1}),iu};Vo(()=>Fi(wl,It.iconBox,l.ai.horizontal),()=>{const Bi=It.verticalTextBox;return g.allowVerticalPlacement&&(!fi||!fi.placeable)&&ht.numVerticalGlyphVertices>0&&Bi?Fi(Bi,It.verticalIconBox,l.ai.vertical):{box:null,occluded:!0,offscreen:null}}),fi&&(hi=fi.placeable,di=fi.offscreen);const ho=Hs(fi&&fi.placeable);if(!hi&&this.prevPlacement){const Bi=this.prevPlacement.variableOffsets[ht.crossTileID];Bi&&(this.variableOffsets[ht.crossTileID]=Bi,this.markUsedJustification(g,Bi.anchor,ht,ho))}}}if(fr=fi,hi=fr&&fr.placeable,di=fr&&fr.offscreen,ht.useRuntimeCollisionCircles){const Hs=g.text.placedSymbolArray.get(ht.centerJustifiedTextSymbolIndex),Vo=l.aj(g.textSizeData,J,Hs),jo=x.get("text-padding");pr=this.collisionIndex.placeCollisionCircles(xe,Hs,g.lineVertexArray,g.glyphOffsetArray,Vo,M,z,m,ze,ne.predicate,ht.collisionCircleDiameter,jo,T,tt),pr.circles.length&&pr.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),hi=be||pr.circles.length>0&&!pr.collisionDetected,di=di&&pr.offscreen}if(It.iconFeatureIndex&&(uo=It.iconFeatureIndex),It.iconBox){const Hs=Vo=>this.collisionIndex.placeCollisionBox(Vo,Ce,V,at,M,ze,Re,C,ne.predicate,tt,De&&ai?ai:void 0,St);Zr&&Zr.placeable&&It.verticalIconBox?(Ts=Hs(It.verticalIconBox),Oi=Ts.placeable):(Ts=Hs(It.iconBox),Oi=Ts.placeable),di=di&&Ts.offscreen}const Zh=ye||ht.numHorizontalGlyphVertices===0&&ht.numVerticalGlyphVertices===0,Wh=_e||ht.numIconVertices===0;Zh||Wh?Wh?Zh||(Oi=Oi&&hi):hi=Oi&&hi:Oi=hi=Oi&&hi;const Nc=Oi&&Ts.placeable;if(hi&&fr.placeable&&this.collisionIndex.insertCollisionBox(fr.box,xe,x.get("text-ignore-placement"),g.bucketInstanceId,Zr&&Zr.placeable&&Oa?Oa:xl,ne.ID),Nc&&this.collisionIndex.insertCollisionBox(Ts.box,Ce,x.get("icon-ignore-placement"),g.bucketInstanceId,uo,ne.ID),pr&&hi&&this.collisionIndex.insertCollisionCircles(pr.circles,xe,x.get("text-ignore-placement"),g.bucketInstanceId,xl,ne.ID),m&&this.storeCollisionData(g.bucketInstanceId,pn,It,fr,Ts,pr),ht.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ht.crossTileID]=new Eo((hi||Ke)&&!(fr!=null&&fr.occluded),(Oi||st)&&!(Ts!=null&&Ts.occluded),di||g.justReloaded),a[ht.crossTileID]=!0};if(Ze){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ht=g.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let It=ht.length-1;It>=0;--It){const pn=ht[It];bt(g.symbolInstances.get(pn),g.collisionArrays[pn],pn)}}else for(let ht=i.symbolInstanceStart;ht<i.symbolInstanceEnd;ht++)bt(g.symbolInstances.get(ht),g.collisionArrays[ht],ht);g.justReloaded=!1}storeCollisionData(i,a,m,g,x,T){if(m.textBox||m.iconBox){let C,M;this.collisionBoxArrays.has(i)?C=this.collisionBoxArrays.get(i):(C=new Map,this.collisionBoxArrays.set(i,C)),C.has(a)?M=C.get(a):(M={text:null,icon:null},C.set(a,M)),m.textBox&&(M.text=g.box),m.iconBox&&(M.icon=x.box)}if(T){let C=this.collisionCircleArrays[i];C===void 0&&(C=this.collisionCircleArrays[i]=[]);for(let M=0;M<T.circles.length;M+=4)C.push(T.circles[M+0]-zn),C.push(T.circles[M+1]-zn),C.push(T.circles[M+2]),C.push(T.collisionDetected?1:0)}}markUsedJustification(i,a,m,g){let x;x=g===l.ai.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.ax(a)];const T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:m.crossTileID)}markUsedOrientation(i,a,m){const g=a===l.ai.horizontal||a===l.ai.horizontalOnly?a:0,x=a===l.ai.vertical?a:0,T=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const C of T)i.text.placedSymbolArray.get(C).placedOrientation=g;m.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let m=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(i):1,x=a?a.opacities:{},T=a?a.variableOffsets:{},C=a?a.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],V=x[M];V?(this.opacities[M]=new Jo(V,g,z.text,z.icon),m=m||z.text!==V.text.placed||z.icon!==V.icon.placed):(this.opacities[M]=new Jo(null,g,z.text,z.icon,z.skipFade),m=m||z.text||z.icon)}for(const M in x){const z=x[M];if(!this.opacities[M]){const V=new Jo(z,g,!1,!1);V.isHidden()||(this.opacities[M]=V,m=m||z.text.placed||z.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in C)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=C[M]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a){const m={};for(const g of a){const x=g.getBucket(i);x&&g.latestFeatureIndex&&i.id===x.layerIds[0]&&this.updateBucketOpacities(x,g.tileID,m,g.collisionBoxArray)}}updateBucketOpacities(i,a,m,g){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const x=i.layers[0],T=x.layout,C=new Jo(null,0,!1,!1,!0),M=T.get("text-allow-overlap"),z=T.get("icon-allow-overlap"),V=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=T.get("text-rotation-alignment")==="map",Z=T.get("text-pitch-alignment")==="map",J=T.get("icon-text-fit")!=="none",ne=new Jo(null,0,M&&(z||!i.hasIconData()||T.get("icon-optional")),z&&(M||!i.hasTextData()||T.get("text-optional")),!0);!i.collisionArrays&&g&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(g);const ye=(xe,be,Ce)=>{for(let ke=0;ke<be/4;ke++)xe.opacityVertexArray.emplaceBack(Ce);xe.hasVisibleVertices=xe.hasVisibleVertices||Ce!==gn},_e=this.collisionBoxArrays.get(i.bucketInstanceId);for(let xe=0;xe<i.symbolInstances.length;xe++){const be=i.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:ke,crossTileID:Re}=be;let ze=this.opacities[Re];m[Re]?ze=C:ze||(ze=ne,this.opacities[Re]=ze),m[Re]=!0;const De=be.numIconVertices>0,Ze=this.placedOrientations[be.crossTileID],Ke=Ze===l.ai.vertical,st=Ze===l.ai.horizontal||Ze===l.ai.horizontalOnly;if(Ce>0||ke>0){const tt=Co(ze.text);ye(i.text,Ce,Ke?gn:tt),ye(i.text,ke,st?gn:tt);const St=ze.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach(It=>{It>=0&&(i.text.placedSymbolArray.get(It).hidden=St||Ke?1:0)}),be.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=St||st?1:0);const bt=this.variableOffsets[be.crossTileID];bt&&this.markUsedJustification(i,bt.anchor,be,Ze);const ht=this.placedOrientations[be.crossTileID];ht&&(this.markUsedJustification(i,"left",be,ht),this.markUsedOrientation(i,ht,be))}if(De){const tt=Co(ze.icon),St=!(J&&be.verticalPlacedIconSymbolIndex&&Ke);be.placedIconSymbolIndex>=0&&(ye(i.icon,be.numIconVertices,St?tt:gn),i.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=ze.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(ye(i.icon,be.numVerticalIconVertices,St?gn:tt),i.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=ze.icon.isHidden())}const at=_e&&_e.has(xe)?_e.get(xe):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const tt=i.collisionArrays[xe];if(tt){let St=new l.P(0,0);if(tt.textBox||tt.verticalTextBox){let bt=!0;if(V){const ht=this.variableOffsets[Re];ht?(St=Fs(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale),q&&St._rotate(Z?-this.transform.bearingInRadians:this.transform.bearingInRadians)):bt=!1}if(tt.textBox||tt.verticalTextBox){let ht;tt.textBox&&(ht=Ke),tt.verticalTextBox&&(ht=st),jl(i.textCollisionBox.collisionVertexArray,ze.text.placed,!bt||ht,at.text,St.x,St.y)}}if(tt.iconBox||tt.verticalIconBox){const bt=!!(!st&&tt.verticalIconBox);let ht;tt.iconBox&&(ht=bt),tt.verticalIconBox&&(ht=!bt),jl(i.iconCollisionBox.collisionVertexArray,ze.icon.placed,ht,at.icon,J?St.x:0,J?St.y:0)}}}}if(i.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);i.bucketInstanceId in this.collisionCircleArrays&&(i.collisionCircleArray=this.collisionCircleArrays[i.bucketInstanceId],delete this.collisionCircleArrays[i.bucketInstanceId])}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const m=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function jl(v,i,a,m,g,x){m&&m.length!==0||(m=[0,0,0,0]);const T=m[0]-zn,C=m[1]-zn,M=m[2]-zn,z=m[3]-zn;v.emplaceBack(i?1:0,a?1:0,g||0,x||0,T,C),v.emplaceBack(i?1:0,a?1:0,g||0,x||0,M,C),v.emplaceBack(i?1:0,a?1:0,g||0,x||0,M,z),v.emplaceBack(i?1:0,a?1:0,g||0,x||0,T,z)}const Ul=Math.pow(2,25),Bs=Math.pow(2,24),Po=Math.pow(2,17),el=Math.pow(2,16),tl=Math.pow(2,9),Cu=Math.pow(2,8),$l=Math.pow(2,1);function Co(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const i=v.placed?1:0,a=Math.floor(127*v.opacity);return a*Ul+i*Bs+a*Po+i*el+a*tl+i*Cu+a*$l+i}const gn=0;class Jn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,a,m,g,x){const T=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(T,g,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,M)=>C.sortKey-M.sortKey));this._currentPartIndex<T.length;)if(a.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,x())return!0;return!1}}class ba{constructor(i,a,m,g,x,T,C,M){this.placement=new Ja(i,a,T,C,M),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,a,m){const g=H.now(),x=()=>!this._forceFullPlacement&&H.now()-g>2;for(;this._currentPlacementIndex>=0;){const T=a[i[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Jn(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const jr=512/l.X/2;class Ao{constructor(i,a,m){this.tileID=i,this.bucketInstanceId=m,this._symbolsByKey={};const g=new Map;for(let x=0;x<a.length;x++){const T=a.get(x),C=T.key,M=g.get(C);M?M.push(T):g.set(C,[T])}for(const[x,T]of g){const C={positions:T.map(M=>({x:Math.floor(M.anchorX*jr),y:Math.floor(M.anchorY*jr)})),crossTileIDs:T.map(M=>M.crossTileID)};if(C.positions.length>128){const M=new l.az(C.positions.length,16,Uint16Array);for(const{x:z,y:V}of C.positions)M.add(z,V);M.finish(),delete C.positions,C.index=M}this._symbolsByKey[x]=C}}getScaledCoordinates(i,a){const{x:m,y:g,z:x}=this.tileID.canonical,{x:T,y:C,z:M}=a.canonical,z=jr/Math.pow(2,M-x),V=(C*l.X+i.anchorY)*z,q=g*l.X*jr;return{x:Math.floor((T*l.X+i.anchorX)*z-m*l.X*jr),y:Math.floor(V-q)}}findMatches(i,a,m){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let x=0;x<i.length;x++){const T=i.get(x);if(T.crossTileID)continue;const C=this._symbolsByKey[T.key];if(!C)continue;const M=this.getScaledCoordinates(T,a);if(C.index){const z=C.index.range(M.x-g,M.y-g,M.x+g,M.y+g).sort();for(const V of z){const q=C.crossTileIDs[V];if(!m[q]){m[q]=!0,T.crossTileID=q;break}}}else if(C.positions)for(let z=0;z<C.positions.length;z++){const V=C.positions[z],q=C.crossTileIDs[z];if(Math.abs(V.x-M.x)<=g&&Math.abs(V.y-M.y)<=g&&!m[q]){m[q]=!0,T.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Ta{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const m in this.indexes){const g=this.indexes[m],x={};for(const T in g){const C=g[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+a),x[C.tileID.key]=C}this.indexes[m]=x}this.lng=i}addBucket(i,a,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let x=0;x<a.symbolInstances.length;x++)a.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const g=this.usedCrossTileIDs[i.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>i.overscaledZ)for(const C in T){const M=T[C];M.tileID.isChildOf(i)&&M.findMatches(a.symbolInstances,i,g)}else{const C=T[i.scaledTo(Number(x)).key];C&&C.findMatches(a.symbolInstances,i,g)}}for(let x=0;x<a.symbolInstances.length;x++){const T=a.symbolInstances.get(x);T.crossTileID||(T.crossTileID=m.generate(),g[T.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ao(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const m of a.getCrossTileIDsLists())for(const g of m)delete this.usedCrossTileIDs[i][g]}removeStaleBuckets(i){let a=!1;for(const m in this.indexes){const g=this.indexes[m];for(const x in g)i[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[x]),delete g[x],a=!0)}return a}}class Wn{constructor(){this.layerIndexes={},this.crossTileIDs=new Ta,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,m){let g=this.layerIndexes[i.id];g===void 0&&(g=this.layerIndexes[i.id]=new dn);let x=!1;const T={};g.handleWrapJump(m);for(const C of a){const M=C.getBucket(i);M&&i.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,M,this.crossTileIDs)&&(x=!0),T[M.bucketInstanceId]=!0)}return g.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(i){const a={};i.forEach(m=>{a[m]=!0});for(const m in this.layerIndexes)a[m]||delete this.layerIndexes[m]}}var nl="void main() {fragColor=vec4(1.0);}";const $i={prelude:Bt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Bt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Bt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Bt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Bt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Bt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Bt(nl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Bt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Bt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Bt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Bt(nl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Bt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Bt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Bt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Bt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Bt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Bt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Bt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Bt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Bt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Bt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Bt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Bt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Bt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Bt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Bt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Bt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Bt(v,i){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/in ([\w]+) ([\w]+)/g),g=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=x?x.concat(g):g,C={};return{fragmentSource:v=v.replace(a,(M,z,V,q,Z)=>(C[Z]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${V} ${q} ${Z};
#else
uniform ${V} ${q} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${V} ${q} ${Z} = u_${Z};
#endif
`)),vertexSource:i=i.replace(a,(M,z,V,q,Z)=>{const J=q==="float"?"vec2":"vec4",ne=Z.match(/color/)?"color":J;return C[Z]?z==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${V} ${J} a_${Z};
out ${V} ${q} ${Z};
#else
uniform ${V} ${q} u_${Z};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${V} ${q} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${ne}(a_${Z}, u_${Z}_t);
#else
    ${V} ${q} ${Z} = u_${Z};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${V} ${J} a_${Z};
#else
uniform ${V} ${q} u_${Z};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${V} ${q} ${Z} = a_${Z};
#else
    ${V} ${q} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${V} ${q} ${Z} = unpack_mix_${ne}(a_${Z}, u_${Z}_t);
#else
    ${V} ${q} ${Z} = u_${Z};
#endif
`}),staticAttributes:m,staticUniforms:T}}class Ur{constructor(i,a,m){this.vertexBuffer=i,this.indexBuffer=a,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ln=l.aA([{name:"a_pos",type:"Int16",components:2}]);const ms="#define PROJECTION_MERCATOR",un="mercator";class Ar{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return un}get shaderDefine(){return ms}get shaderPreludeCode(){return $i.projectionMercator}get vertexShaderPreludeCode(){return $i.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(i){}getMeshFromTileID(i,a,m,g,x){if(this._cachedMesh)return this._cachedMesh;const T=new l.aC;T.emplaceBack(0,0),T.emplaceBack(l.X,0),T.emplaceBack(0,l.X),T.emplaceBack(l.X,l.X);const C=i.createVertexBuffer(T,ln.members),M=l.aD.simpleSegment(0,0,4,2),z=new l.aE;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const V=i.createIndexBuffer(z);return this._cachedMesh=new Ur(C,V,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(i){}}function Vn(v,i){const a=l.ab(i.lat,-85.051129,l.aF);return new l.P(l.O(i.lng)*v,l.Q(a)*v)}function ei(v,i){return new l.Y(i.x/v,i.y/v).toLngLat()}function ri(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(l.aa(90-v.pitch)),Math.tan(l.aa(89.25-v.pitch)))}function ko(v,i){const a=v.canonical,m=i/l.aG(a.z),g=a.x+Math.pow(2,a.z)*v.wrap,x=l.aq(new Float64Array(16));return l.J(x,x,[g*m,a.y*m,0]),l.K(x,x,[m/l.X,m/l.X,1]),x}function Xi(v,i,a,m,g){const x=l.Y.fromLngLat(v,i),T=g*l.aH(1,v.lat),C=T*Math.cos(l.aa(a)),M=Math.sqrt(T*T-C*C),z=M*Math.sin(l.aa(-m)),V=M*Math.cos(l.aa(-m));return new l.Y(x.x+z,x.y+V,x.z+C)}class Yi{constructor(i=0,a=0,m=0,g=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=m,this.right=g}interpolate(i,a,m){return a.top!=null&&i.top!=null&&(this.top=l.y.number(i.top,a.top,m)),a.bottom!=null&&i.bottom!=null&&(this.bottom=l.y.number(i.bottom,a.bottom,m)),a.left!=null&&i.left!=null&&(this.left=l.y.number(i.left,a.left,m)),a.right!=null&&i.right!=null&&(this.right=l.y.number(i.right,a.right,m)),this}getCenter(i,a){const m=l.ab((this.left+i-this.right)/2,0,i),g=l.ab((this.top+a-this.bottom)/2,0,a);return new l.P(m,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Yi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qi(v,i){if(!v.renderWorldCopies||v.lngRange)return;const a=i.lng-v.center.lng;i.lng+=a>180?-360:a<-180?360:0}function il(v){return Math.max(0,Math.floor(v))}class $r{constructor(i,a,m,g,x,T){this._callbacks=i,this._tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=a||0,this._maxZoom=m||22,this._minPitch=g??0,this._maxPitch=x??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=il(this._zoom),this._scale=l.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Yi,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(i,a,m){this._latRange=i.latRange,this._lngRange=i.lngRange,this._width=i.width,this._height=i.height,this._center=i.center,this._elevation=i.elevation,this._minElevationForCurrentTile=i.minElevationForCurrentTile,this._zoom=i.zoom,this._tileZoom=il(this._zoom),this._scale=l.aG(this._zoom),this._bearingInRadians=i.bearingInRadians,this._fovInRadians=i.fovInRadians,this._pitchInRadians=i.pitchInRadians,this._rollInRadians=i.rollInRadians,this._unmodified=i.unmodified,this._edgeInsets=new Yi(i.padding.top,i.padding.bottom,i.padding.left,i.padding.right),this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._minPitch=i.minPitch,this._maxPitch=i.maxPitch,this._renderWorldCopies=i.renderWorldCopies,this._cameraToCenterDistance=i.cameraToCenterDistance,this._nearZ=i.nearZ,this._farZ=i.farZ,this._autoCalculateNearFarZ=!m&&i.autoCalculateNearFarZ,a&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(i){this._minElevationForCurrentTile=i}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(i){this._minZoom!==i&&(this._minZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(i){this._minPitch!==i&&(this._minPitch=i,this.setPitch(Math.max(this.pitch,i)))}get maxPitch(){return this._maxPitch}setMaxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.setPitch(Math.min(this.pitch,i)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(i){const a=l.aI(i,-180,180)*Math.PI/180;var m,g,x,T,C,M,z,V,q;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=A(),m=this._rotationMatrix,x=-this._bearingInRadians,T=(g=this._rotationMatrix)[0],C=g[1],M=g[2],z=g[3],V=Math.sin(x),q=Math.cos(x),m[0]=T*q+M*V,m[1]=C*q+z*V,m[2]=T*-V+M*q,m[3]=C*-V+z*q)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(i){const a=l.ab(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(i){const a=i/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aJ(this._fovInRadians)}setFov(i){i=l.ab(i,.1,150),this.fov!==i&&(this._unmodified=!1,this._fovInRadians=l.aa(i),this._calcMatrices())}get zoom(){return this._zoom}setZoom(i){const a=this.getConstrained(this._center,i).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=l.aG(a),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(i,a){this._autoCalculateNearFarZ=!1,this._nearZ=i,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,m){this._unmodified=!1,this._edgeInsets.interpolate(i,a,m),this._constrain(),this._calcMatrices()}resize(i,a,m=!0){this._width=i,this._height=a,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new wi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(i){i?(this._lngRange=[i.getWest(),i.getEast()],this._latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,l.aF])}getConstrained(i,a){return this._callbacks.getConstrained(i,a)}getCameraQueryGeometry(i,a){if(a.length===1)return[a[0],i];{let m=i.x,g=i.y,x=i.x,T=i.y;for(const C of a)m=Math.min(m,C.x),g=Math.min(g,C.y),x=Math.max(x,C.x),T=Math.max(T,C.y);return[new l.P(m,g),new l.P(x,g),new l.P(x,T),new l.P(m,T),new l.P(m,g)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:a,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(a),this.setZoom(m),this._unmodified=i,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let i=l.aq(new Float64Array(16));l.K(i,i,[this._width/2,-this._height/2,1]),l.J(i,i,[1,-1,0]),this._clipSpaceToPixelsMatrix=i,i=l.aq(new Float64Array(16)),l.K(i,i,[1,-1,1]),l.J(i,i,[-1,-1,0]),l.K(i,i,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=i,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(i,a,m,g){const x=m!==void 0?m:this.bearing,T=g=g!==void 0?g:this.pitch,C=l.Y.fromLngLat(i,a),M=-Math.cos(l.aa(T)),z=Math.sin(l.aa(T)),V=z*Math.sin(l.aa(x)),q=-z*Math.cos(l.aa(x));let Z=this.elevation;const J=a-Z;let ne;M*J>=0||Math.abs(M)<.1?(ne=1e4,Z=a+ne*M):ne=-J/M;let ye,_e,xe=l.aK(1,C.y),be=0;do{if(be+=1,be>10)break;_e=ne/xe,ye=new l.Y(C.x+V*_e,C.y+q*_e),xe=1/ye.meterInMercatorCoordinateUnits()}while(Math.abs(ne-_e*xe)>1e-12);return{center:ye.toLngLat(),elevation:Z,zoom:l.a8(this.height/2/Math.tan(this.fovInRadians/2)/_e/this.tileSize)}}recalculateZoomAndCenter(i){if(this.elevation-i==0)return;const a=l.aH(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/a,g=l.Y.fromLngLat(this.center,this.elevation),x=Xi(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=i;const T=this.calculateCenterFromCameraLngLatAlt(x.toLngLat(),l.aK(x.z,g.y),this.bearing,this.pitch);this._elevation=T.elevation,this._center=T.center,this.setZoom(T.zoom)}getCameraPoint(){const i=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(i*Math.sin(this.rollInRadians),i*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const i=l.aH(1,this.center.lat)*this.worldSize;return Xi(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/i).toLngLat()}getMercatorTileCoordinates(i){if(!i)return[0,0,1,1];const a=i.canonical.z>=0?1<<i.canonical.z:Math.pow(2,i.canonical.z);return[i.canonical.x/a,i.canonical.y/a,1/a/l.X,1/a/l.X]}}class En{constructor(i,a){this.min=i,this.max=a,this.center=l.aL([],l.aM([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],m=l.aN(this.min),g=l.aN(this.max);for(let x=0;x<a.length;x++)m[x]=a[x]?this.min[x]:this.center[x],g[x]=a[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new En(m,g)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersectsFrustum(i){let a=!0;for(let m=0;m<i.planes.length;m++){const g=this.intersectsPlane(i.planes[m]);if(g===0)return 0;g===1&&(a=!1)}return a?2:i.aabb.min[0]>this.max[0]||i.aabb.min[1]>this.max[1]||i.aabb.min[2]>this.max[2]||i.aabb.max[0]<this.min[0]||i.aabb.max[1]<this.min[1]||i.aabb.max[2]<this.min[2]?0:1}intersectsPlane(i){let a=i[3],m=i[3];for(let g=0;g<3;g++)i[g]>0?(a+=i[g]*this.min[g],m+=i[g]*this.max[g]):(m+=i[g]*this.min[g],a+=i[g]*this.max[g]);return a>=0?2:m<0?0:1}}class ea{distanceToTile2d(i,a,m,g){const x=g.distanceX([i,a]),T=g.distanceY([i,a]);return Math.hypot(x,T)}getWrap(i,a,m){return m}getTileAABB(i,a,m,g){var x,T;let C=m,M=m;if(g.terrain){const V=new l.S(i.z,a,i.z,i.x,i.y),q=g.terrain.getMinMaxElevation(V);C=(x=q.minElevation)!==null&&x!==void 0?x:m,M=(T=q.maxElevation)!==null&&T!==void 0?T:m}const z=1<<i.z;return new En([a+i.x/z,i.y/z,C],[a+(i.x+1)/z,(i.y+1)/z,M])}allowVariableZoom(i,a){const m=i.fov*(Math.abs(Math.cos(i.rollInRadians))*i.height+Math.abs(Math.sin(i.rollInRadians))*i.width)/i.height,g=l.ab(78.5-m/2,0,60);return!!a.terrain||i.pitch>g||i.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class qr{constructor(i,a,m){this.points=i,this.planes=a,this.aabb=m}static fromInvProjectionMatrix(i,a=1,m=0){const g=Math.pow(2,m),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(z=>{const V=1/(z=l.al([],z,i))[3]/a*g;return l.aO(z,z,[V,V,1/z[3],V])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(z=>{const V=l.aP([],x[z[0]],x[z[1]]),q=l.aP([],x[z[2]],x[z[1]]),Z=l.aQ([],l.aR([],V,q)),J=-l.aS(Z,x[z[1]]);return Z.concat(J)}),C=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],M=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const z of x)for(let V=0;V<3;V++)C[V]=Math.min(C[V],z[V]),M[V]=Math.max(M[V],z[V]);return new qr(x,T,new En(C,M))}}class Vs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,a,m){return this._helper.interpolatePadding(i,a,m)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,a,m=!0){this._helper.resize(i,a,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,a){this._helper.overrideNearFarZ(i,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i,a){}constructor(i,a,m,g,x){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new $r({calcMatrices:()=>{this._calcMatrices()},getConstrained:(T,C)=>this.getConstrained(T,C)},i,a,m,g,x),this._coveringTilesDetailsProvider=new ea}clone(){const i=new Vs;return i.apply(this),i}apply(i,a,m){this._helper.apply(i,a,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(i){const a=[new l.aT(0,i)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new l.P(0,0)),g=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),T=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),C=Math.floor(Math.min(m.x,g.x,x.x,T.x)),M=Math.floor(Math.max(m.x,g.x,x.x,T.x)),z=1;for(let V=C-z;V<=M+z;V++)V!==0&&a.push(new l.aT(V,i))}return a}getCameraFrustum(){return qr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){const a=this.screenPointToLocation(this.centerPoint,i),m=i?i.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(i,a){const m=l.aH(this.elevation,this.center.lat),g=this.screenPointToMercatorCoordinateAtZ(a,m),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),T=l.Y.fromLngLat(i),C=new l.Y(T.x-(g.x-x.x),T.y-(g.y-x.y));this.setCenter(C==null?void 0:C.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(i,a){return a?this.coordinatePoint(l.Y.fromLngLat(i),a.getElevationForLngLatZoom(i,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.Y.fromLngLat(i))}screenPointToLocation(i,a){var m;return(m=this.screenPointToMercatorCoordinate(i,a))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(i,a){if(a){const m=a.pointCoordinate(i);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(i)}screenPointToMercatorCoordinateAtZ(i,a){const m=a||0,g=[i.x,i.y,0,1],x=[i.x,i.y,1,1];l.al(g,g,this._pixelMatrixInverse),l.al(x,x,this._pixelMatrixInverse);const T=g[3],C=x[3],M=g[1]/T,z=x[1]/C,V=g[2]/T,q=x[2]/C,Z=V===q?0:(m-V)/(q-V);return new l.Y(l.y.number(g[0]/T,x[0]/C,Z)/this.worldSize,l.y.number(M,z,Z)/this.worldSize,m)}coordinatePoint(i,a=0,m=this._pixelMatrix){const g=[i.x*this.worldSize,i.y*this.worldSize,a,1];return l.al(g,g,m),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const i=Math.max(0,this._helper._height/2-ri(this));return new wi().extend(this.screenPointToLocation(new l.P(0,i))).extend(this.screenPointToLocation(new l.P(this._helper._width,i))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(i,a){return a?a.pointCoordinate(i)!=null:i.y>this.height/2-ri(this)}calculatePosMatrix(i,a=!1,m){var g;const x=(g=i.key)!==null&&g!==void 0?g:l.aU(i.wrap,i.canonical.z,i.canonical.z,i.canonical.x,i.canonical.y),T=a?this._alignedPosMatrixCache:this._posMatrixCache;if(T.has(x)){const z=T.get(x);return m?z.f32:z.f64}const C=ko(i,this.worldSize);l.L(C,a?this._alignedProjMatrix:this._viewProjMatrix,C);const M={f64:C,f32:new Float32Array(C)};return T.set(x,M),m?M.f32:M.f64}calculateFogMatrix(i){const a=i.key,m=this._fogMatrixCacheF32;if(m.has(a))return m.get(a);const g=ko(i,this.worldSize);return l.L(g,this._fogMatrix,g),m.set(a,new Float32Array(g)),m.get(a)}getConstrained(i,a){a=l.ab(+a,this.minZoom,this.maxZoom);const m={center:new l.N(i.lng,i.lat),zoom:a};let g=this._helper._lngRange;this._helper._renderWorldCopies||g!==null||(g=[-179.9999999999,180-1e-10]);const x=this.tileSize*l.aG(m.zoom);let T=0,C=x,M=0,z=x,V=0,q=0;const{x:Z,y:J}=this.size;if(this._helper._latRange){const Ce=this._helper._latRange;T=l.Q(Ce[1])*x,C=l.Q(Ce[0])*x,C-T<J&&(V=J/(C-T))}g&&(M=l.aI(l.O(g[0])*x,0,x),z=l.aI(l.O(g[1])*x,0,x),z<M&&(z+=x),z-M<Z&&(q=Z/(z-M)));const{x:ne,y:ye}=Vn(x,i);let _e,xe;const be=Math.max(q||0,V||0);if(be){const Ce=new l.P(q?(z+M)/2:ne,V?(C+T)/2:ye);return m.center=ei(x,Ce).wrap(),m.zoom+=l.a8(be),m}if(this._helper._latRange){const Ce=J/2;ye-Ce<T&&(xe=T+Ce),ye+Ce>C&&(xe=C-Ce)}if(g){const Ce=(M+z)/2;let ke=ne;this._helper._renderWorldCopies&&(ke=l.aI(ne,Ce-x/2,Ce+x/2));const Re=Z/2;ke-Re<M&&(_e=M+Re),ke+Re>z&&(_e=z-Re)}if(_e!==void 0||xe!==void 0){const Ce=new l.P(_e??ne,xe??ye);m.center=ei(x,Ce).wrap()}return m}calculateCenterFromCameraLngLatAlt(i,a,m,g){return this._helper.calculateCenterFromCameraLngLatAlt(i,a,m,g)}_calculateNearFarZIfNeeded(i,a,m){if(!this._helper.autoCalculateNearFarZ)return;const g=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=i-g*this._helper._pixelPerMeter/Math.cos(a),T=g<0?x:i,C=Math.PI/2+this.pitchInRadians,M=l.aa(this.fov)*(Math.abs(Math.cos(l.aa(this.roll)))*this.height+Math.abs(Math.sin(l.aa(this.roll)))*this.width)/this.height*(.5+m.y/this.height),z=Math.sin(M)*T/Math.sin(l.ab(Math.PI-C-M,.01,Math.PI-.01)),V=ri(this),q=Math.atan(V/this._helper.cameraToCenterDistance),Z=l.aa(.75),J=q>Z?2*q*(.5+m.y/(2*V)):Z,ne=Math.sin(J)*T/Math.sin(l.ab(Math.PI-C-J,.01,Math.PI-.01)),ye=Math.min(z,ne);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*ye+T),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const i=this.centerOffset,a=Vn(this.worldSize,this.center),m=a.x,g=a.y;this._helper._pixelPerMeter=l.aH(1,this.center.lat)*this.worldSize;const x=l.aa(Math.min(this.pitch,89.25)),T=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let C;this._calculateNearFarZIfNeeded(T,x,i),C=new Float64Array(16),l.aV(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.an(this._invProjMatrix,C),C[8]=2*-i.x/this._helper._width,C[9]=2*i.y/this._helper._height,this._projectionMatrix=l.aW(C),l.K(C,C,[1,-1,1]),l.J(C,C,[0,0,-this._helper.cameraToCenterDistance]),l.aX(C,C,-this.rollInRadians),l.aY(C,C,this.pitchInRadians),l.aX(C,C,-this.bearingInRadians),l.J(C,C,[-m,-g,0]),this._mercatorMatrix=l.K([],C,[this.worldSize,this.worldSize,this.worldSize]),l.K(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),l.J(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=l.an([],C);const M=[0,0,-1,1];l.al(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),l.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,T,this._helper._farZ),this._fogMatrix[8]=2*-i.x/this.width,this._fogMatrix[9]=2*i.y/this.height,l.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.J(this._fogMatrix,this._fogMatrix,[-m,-g,0]),l.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const z=this._helper._width%2/2,V=this._helper._height%2/2,q=Math.cos(this.bearingInRadians),Z=Math.sin(-this.bearingInRadians),J=m-Math.round(m)+q*z+Z*V,ne=g-Math.round(g)+q*V+Z*z,ye=new Float64Array(C);if(l.J(ye,ye,[J>.5?J-1:J,ne>.5?ne-1:ne,0]),this._alignedProjMatrix=ye,C=l.an(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const i=this.screenPointToMercatorCoordinate(new l.P(0,0)),a=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.al(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const i=l.aH(1,this.center.lat)*this.worldSize;return Xi(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/i).toLngLat()}lngLatToCameraDepth(i,a){const m=l.Y.fromLngLat(i),g=[m.x*this.worldSize,m.y*this.worldSize,a,1];return l.al(g,g,this._viewProjMatrix),g[2]/g[3]}getProjectionData(i){const{overscaledTileID:a,aligned:m,applyTerrainMatrix:g}=i,x=this._helper.getMercatorTileCoordinates(a),T=a?this.calculatePosMatrix(a,m,!0):null;let C;return C=a&&a.terrainRttPosMatrix32f&&g?a.terrainRttPosMatrix32f:T||l.aZ(),{mainMatrix:C,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(i){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(i,a,m){return 1}transformLightDirection(i){return l.aN(i)}getRayDirectionFromPixel(i){throw new Error("Not implemented.")}projectTileCoordinates(i,a,m,g){const x=this.calculatePosMatrix(m);let T;g?(T=[i,a,g(i,a),1],l.al(T,T,x)):(T=[i,a,0,1],Zn(T,T,x));const C=T[3];return{point:new l.P(T[0]/C,T[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(i){for(const a of i)this.calculatePosMatrix(a)}getMatrixForModel(i,a){const m=l.Y.fromLngLat(i,a),g=m.meterInMercatorCoordinateUnits(),x=l.a_();return l.J(x,x,[m.x,m.y,m.z]),l.aX(x,x,Math.PI),l.aY(x,x,Math.PI/2),l.K(x,x,[-g,g,g]),x}getProjectionDataForCustomLayer(i=!0){const a=new l.S(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:i}),g=ko(a,this.worldSize);l.L(g,this._viewProjMatrix,g),m.tileMercatorCoords=[0,0,1,1];const x=[l.X,l.X,this.worldSize/this._helper.pixelsPerMeter],T=l.a$();return l.K(T,g,x),m.fallbackMatrix=T,m.mainMatrix=T,m}getFastPathSimpleProjectionMatrix(i){return this.calculatePosMatrix(i)}}function $t(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function is(v){if(v.useSlerp)if(v.k<1){const i=l.b0(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),a=l.b0(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),m=new Float64Array(4);l.b1(m,i,a,v.k);const g=l.b2(m);v.tr.setRoll(g.roll),v.tr.setPitch(g.pitch),v.tr.setBearing(g.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(l.y.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(l.y.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(l.y.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function Ln(v,i,a,m,g){const x=g.padding,T=Vn(g.worldSize,a.getNorthWest()),C=Vn(g.worldSize,a.getNorthEast()),M=Vn(g.worldSize,a.getSouthEast()),z=Vn(g.worldSize,a.getSouthWest()),V=l.aa(-m),q=T.rotate(V),Z=C.rotate(V),J=M.rotate(V),ne=z.rotate(V),ye=new l.P(Math.max(q.x,Z.x,ne.x,J.x),Math.max(q.y,Z.y,ne.y,J.y)),_e=new l.P(Math.min(q.x,Z.x,ne.x,J.x),Math.min(q.y,Z.y,ne.y,J.y)),xe=ye.sub(_e),be=(g.width-(x.left+x.right+i.left+i.right))/xe.x,Ce=(g.height-(x.top+x.bottom+i.top+i.bottom))/xe.y;if(Ce<0||be<0)return void $t();const ke=Math.min(l.a8(g.scale*Math.min(be,Ce)),v.maxZoom),Re=l.P.convert(v.offset),ze=new l.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(l.aa(m)),De=Re.add(ze).mult(g.scale/l.aG(ke));return{center:ei(g.worldSize,T.add(M).div(2).sub(De)),zoom:ke,bearing:m}}class rl{get useGlobeControls(){return!1}handlePanInertia(i,a){return{easingOffset:i,easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(i,a){i.bearingDelta&&a.setBearing(a.bearing+i.bearingDelta),i.pitchDelta&&a.setPitch(a.pitch+i.pitchDelta),i.rollDelta&&a.setRoll(a.roll+i.rollDelta),i.zoomDelta&&a.setZoom(a.zoom+i.zoomDelta)}handleMapControlsPan(i,a,m){i.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(m,i.around)}cameraForBoxAndBearing(i,a,m,g,x){return Ln(i,a,m,g,x)}handleJumpToCenterZoom(i,a){i.zoom!==(a.zoom!==void 0?+a.zoom:i.zoom)&&i.setZoom(+a.zoom),a.center!==void 0&&i.setCenter(l.N.convert(a.center))}handleEaseTo(i,a){const m=i.zoom,g=i.padding,x={roll:i.roll,pitch:i.pitch,bearing:i.bearing},T={roll:a.roll===void 0?i.roll:a.roll,pitch:a.pitch===void 0?i.pitch:a.pitch,bearing:a.bearing===void 0?i.bearing:a.bearing},C=a.zoom!==void 0,M=!i.isPaddingEqual(a.padding);let z=!1;const V=C?+a.zoom:i.zoom;let q=i.centerPoint.add(a.offsetAsPoint);const Z=i.screenPointToLocation(q),{center:J,zoom:ne}=i.getConstrained(l.N.convert(a.center||Z),V??m);qi(i,J);const ye=Vn(i.worldSize,Z),_e=Vn(i.worldSize,J).sub(ye),xe=l.aG(ne-m);return z=ne!==m,{easeFunc:be=>{if(z&&i.setZoom(l.y.number(m,ne,be)),l.b3(x,T)||is({startEulerAngles:x,endEulerAngles:T,tr:i,k:be,useSlerp:x.roll!=T.roll}),M&&(i.interpolatePadding(g,a.padding,be),q=i.centerPoint.add(a.offsetAsPoint)),a.around)i.setLocationAtPoint(a.around,a.aroundPoint);else{const Ce=l.aG(i.zoom-m),ke=ne>m?Math.min(2,xe):Math.max(.5,xe),Re=Math.pow(ke,1-be),ze=ei(i.worldSize,ye.add(_e.mult(be*Re)).mult(Ce));i.setLocationAtPoint(i.renderWorldCopies?ze.wrap():ze,q)}},isZooming:z,elevationCenter:J}}handleFlyTo(i,a){const m=a.zoom!==void 0,g=i.zoom,x=i.getConstrained(l.N.convert(a.center||a.locationAtOffset),m?+a.zoom:g),T=x.center,C=x.zoom;qi(i,T);const M=Vn(i.worldSize,a.locationAtOffset),z=Vn(i.worldSize,T).sub(M),V=z.mag(),q=l.aG(C-g);let Z;if(a.minZoom!==void 0){const J=Math.min(+a.minZoom,g,C),ne=i.getConstrained(T,J).zoom;Z=l.aG(ne-g)}return{easeFunc:(J,ne,ye,_e)=>{i.setZoom(J===1?C:g+l.a8(ne));const xe=J===1?T:ei(i.worldSize,M.add(z.mult(ye)).mult(ne));i.setLocationAtPoint(i.renderWorldCopies?xe.wrap():xe,_e)},scaleOfZoom:q,targetCenter:T,scaleOfMinZoom:Z,pixelPathLength:V}}}class Mn{constructor(i,a,m){this.blendFunction=i,this.blendColor=a,this.mask=m}}Mn.Replace=[1,0],Mn.disabled=new Mn(Mn.Replace,l.b4.transparent,[!1,!1,!1,!1]),Mn.unblended=new Mn(Mn.Replace,l.b4.transparent,[!0,!0,!0,!0]),Mn.alphaBlended=new Mn([1,771],l.b4.transparent,[!0,!0,!0,!0]);const Mo=2305;class xn{constructor(i,a,m){this.enable=i,this.mode=a,this.frontFace=m}}xn.disabled=new xn(!1,1029,Mo),xn.backCCW=new xn(!0,1029,Mo),xn.frontCCW=new xn(!0,1028,Mo);class Wt{constructor(i,a,m){this.func=i,this.mask=a,this.range=m}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const js=7680;class fn{constructor(i,a,m,g,x,T){this.test=i,this.ref=a,this.mask=m,this.fail=g,this.depthFail=x,this.pass=T}}fn.disabled=new fn({func:519,mask:0},0,0,js,js,js);const si=new WeakMap;function Mi(v){var i;if(si.has(v))return si.get(v);{const a=(i=v.getParameter(v.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return si.set(v,a),a}}class ta{get awaitingQuery(){return!!this._readbackQueue}constructor(i){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=i;const a=i.context,m=a.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const g=new l.aC;g.emplaceBack(-1,-1),g.emplaceBack(2,-1),g.emplaceBack(-1,2);const x=new l.aE;x.emplaceBack(0,1,2),this._fullscreenTriangle=new Ur(a.createVertexBuffer(g,ln.members),a.createIndexBuffer(x),l.aD.simpleSegment(0,0,g.length,x.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(m.TEXTURE1);const T=m.createTexture();m.bindTexture(m.TEXTURE_2D,T),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(T),Mi(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const i=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),i.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(i,a){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(i,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const i=this._cachedRenderContext.context,a=i.gl;i.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),i.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(i,a){const m=this._cachedRenderContext.context,g=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:l.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,g.TRIANGLES,Wt.disabled,fn.disabled,Mn.unblended,xn.disabled,((x,T)=>({u_input:x,u_output_expected:T}))(i,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Mi(g)){g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.readBuffer(g.COLOR_ATTACHMENT0),g.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null);const x=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);g.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const i=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Mi(i)){const a=i.clientWaitSync(this._readbackQueue.sync,0,0);if(a===i.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===i.TIMEOUT_EXPIRED)return;i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),i.bindBuffer(i.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ta._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(i){let a=0;return a+=i[0]/256,a+=i[1]/65536,a+=i[2]/16777216,i[3]<127&&(a=-a),a/128}}const Ro=l.X/128;function oi(v,i){const a=v.granularity!==void 0?Math.max(v.granularity,1):1,m=a+(v.generateBorders?2:0),g=a+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),x=m+1,T=g+1,C=v.generateBorders?-1:0,M=v.generateBorders||v.extendToNorthPole?-1:0,z=a+(v.generateBorders?1:0),V=a+(v.generateBorders||v.extendToSouthPole?1:0),q=x*T,Z=m*g*6,J=x*T>65536;if(J&&i==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ne=J||i==="32bit",ye=new Int16Array(2*q);let _e=0;for(let Ce=M;Ce<=V;Ce++)for(let ke=C;ke<=z;ke++){let Re=ke/a*l.X;ke===-1&&(Re=-64),ke===a+1&&(Re=l.X+Ro);let ze=Ce/a*l.X;Ce===-1&&(ze=v.extendToNorthPole?l.b6:-64),Ce===a+1&&(ze=v.extendToSouthPole?l.b7:l.X+Ro),ye[_e++]=Re,ye[_e++]=ze}const xe=ne?new Uint32Array(Z):new Uint16Array(Z);let be=0;for(let Ce=0;Ce<g;Ce++)for(let ke=0;ke<m;ke++){const Re=ke+1+Ce*x,ze=ke+(Ce+1)*x,De=ke+1+(Ce+1)*x;xe[be++]=ke+Ce*x,xe[be++]=ze,xe[be++]=Re,xe[be++]=Re,xe[be++]=ze,xe[be++]=De}return{vertices:ye.buffer.slice(0),indices:xe.buffer.slice(0),uses32bitIndices:ne}}const Lo=new l.aB({fill:new l.b8(128,2),line:new l.b8(512,0),tile:new l.b8(128,32),stencil:new l.b8(128,1),circle:3});class ql{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return $i.projectionGlobe}get vertexShaderPreludeCode(){return $i.projectionMercator.vertexSource}get subdivisionGranularity(){return Lo}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(i){this._errorMeasurement||(this._errorMeasurement=new ta(i));const a=l.Q(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,g=this._errorMeasurement.updateErrorLoop(a,m),x=H.now();g!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=g,this._errorMeasurementLastChangeTime=x);const T=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.ba(T))}_getMeshKey(i){return`${i.granularity.toString(36)}_${i.generateBorders?"b":""}${i.extendToNorthPole?"n":""}${i.extendToSouthPole?"s":""}`}getMeshFromTileID(i,a,m,g,x){const T=(x==="stencil"?Lo.stencil:Lo.tile).getGranularityForZoomLevel(a.z);return this._getMesh(i,{granularity:T,generateBorders:m,extendToNorthPole:a.y===0&&g,extendToSouthPole:a.y===(1<<a.z)-1&&g})}_getMesh(i,a){const m=this._getMeshKey(a);if(m in this._tileMeshCache)return this._tileMeshCache[m];const g=function(x,T){const C=oi(T,"16bit"),M=l.aC.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),z=l.aE.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new Ur(x.createVertexBuffer(M,ln.members),x.createIndexBuffer(z),l.aD.simpleSegment(0,0,M.length,z.length))}(i,a);return this._tileMeshCache[m]=g,g}recalculate(i){}hasTransition(){const i=H.now();let a=!1;return a=a||(i-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(i){this._errorQueryLatitudeDegrees=i}}const Hl=new l.q({type:new l.D(l.v.projection.type)});class sl extends l.E{constructor(i){super(),this._transitionable=new l.T(Hl),this.setProjection(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0)),this._mercatorProjection=new Ar,this._verticalPerspectiveProjection=new ql}get transitionState(){const i=this.properties.get("type");if(typeof i=="string"&&i==="mercator")return 0;if(typeof i=="string"&&i==="vertical-perspective")return 1;if(i instanceof l.bb){if(i.from==="vertical-perspective"&&i.to==="mercator")return 1-i.transition;if(i.from==="mercator"&&i.to==="vertical-perspective")return i.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(i){this._mercatorProjection.updateGPUdependent(i),this._verticalPerspectiveProjection.updateGPUdependent(i)}getMeshFromTileID(i,a,m,g,x){return this.currentProjection.getMeshFromTileID(i,a,m,g,x)}setProjection(i){this._transitionable.setValue("type",(i==null?void 0:i.type)||"mercator")}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}setErrorQueryLatitudeDegrees(i){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(i),this._mercatorProjection.setErrorQueryLatitudeDegrees(i)}}function In(v){const i=Qi(v.worldSize,v.center.lat);return 2*Math.PI*i}function Do(v,i,a,m,g){const x=1/(1<<g),T=i/l.X*x+m*x,C=l.bd((v/l.X*x+a*x)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI,z=Math.cos(M),V=new Float64Array(3);return V[0]=Math.sin(C)*z,V[1]=Math.sin(M),V[2]=Math.cos(C)*z,V}function wn(v){return function(i,a){const m=Math.cos(a),g=new Float64Array(3);return g[0]=Math.sin(i)*m,g[1]=Math.sin(a),g[2]=Math.cos(i)*m,g}(v.lng*Math.PI/180,v.lat*Math.PI/180)}function Qi(v,i){return v/(2*Math.PI)/Math.cos(i*Math.PI/180)}function Hr(v){const i=Math.asin(v[1])/Math.PI*180,a=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(a>1e-6){const m=v[0]/a,g=Math.acos(v[2]/a),x=(m>0?g:-g)/Math.PI*180;return new l.N(l.aI(x,-180,180),i)}return new l.N(0,i)}function na(v){return Math.cos(v*Math.PI/180)}function ci(v,i){const a=na(v),m=na(i);return l.a8(m/a)}function Gl(v,i){const a=v.rotate(i.bearingInRadians),m=i.zoom+ci(i.center.lat,0),g=l.b9(1/na(i.center.lat),1/na(Math.min(Math.abs(i.center.lat),60)),l.bc(m,7,3,0,1)),x=360/In({worldSize:i.worldSize,center:{lat:i.center.lat}});return new l.N(i.center.lng-a.x*x*g,l.ab(i.center.lat+a.y*x,-85.051129,l.aF))}function gs(v){const i=.5*v,a=Math.sin(i),m=Math.cos(i);return Math.log(a+m)-Math.log(m-a)}function ol(v,i,a,m){const g=v.lat+a*m;if(Math.abs(a)>1){const x=(Math.sign(v.lat+a)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,T=Math.abs(v.lat+a)*Math.PI/180,C=gs(x+m*(T-x)),M=gs(x),z=gs(T);return new l.N(v.lng+i*((C-M)/(z-M)),g)}return new l.N(v.lng+i*m,g)}class xc{constructor(i){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=i}recalculateCache(){if(!this._hadAnyChanges)return;const i=this._cachePrevious;this._cachePrevious=this._cache,this._cache=i,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(i,a,m,g){const x=`${i.z}_${i.x}_${i.y}`,T=this._cache.get(x);if(T)return T;const C=this._cachePrevious.get(x);if(C)return this._cache.set(x,C),C;const M=this._aabbFactory(i,a,m,g);return this._cache.set(x,M),this._hadAnyChanges=!0,M}}function io(v,i,a){const m=v-i;return m<0?-m:Math.max(0,m-a)}function Au(v,i,a,m,g){const x=v-a;let T;return T=x<0?Math.min(-x,1+x-g):x>1?Math.min(Math.max(x-g,0),1-x):0,Math.max(T,io(i,m,g))}class _s{constructor(){this._aabbCache=new xc(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(i,a,m,g){const x=1<<m.z,T=1/x,C=m.x/x,M=m.y/x;let z=2;return z=Math.min(z,Au(i,a,C,M,T)),z=Math.min(z,Au(i,a,C+.5,-M-T,T)),z=Math.min(z,Au(i,a,C+.5,2-M-T,T)),z}getWrap(i,a,m){const g=1<<a.z,x=1/g,T=a.x/g,C=io(i.x,T,x),M=io(i.x,T-1,x),z=io(i.x,T+1,x),V=Math.min(C,M,z);return V===z?1:V===M?-1:0}allowVariableZoom(i,a){return fs(i,a)>4}allowWorldCopies(){return!1}getTileAABB(i,a,m,g){return this._aabbCache.getTileAABB(i,a,m,g)}_computeTileAABB(i,a,m,g){if(i.z<=0)return new En([-1,-1,-1],[1,1,1]);if(i.z===1)return new En([i.x===0?-1:0,i.y===0?0:-1,-1],[i.x===0?0:1,i.y===0?1:0,1]);{const x=[Do(0,0,i.x,i.y,i.z),Do(l.X,0,i.x,i.y,i.z),Do(l.X,l.X,i.x,i.y,i.z),Do(0,l.X,i.x,i.y,i.z)],T=[1,1,1],C=[-1,-1,-1];for(const M of x)for(let z=0;z<3;z++)T[z]=Math.min(T[z],M[z]),C[z]=Math.max(C[z],M[z]);if(i.y===0||i.y===(1<<i.z)-1){const M=[0,i.y===0?1:-1,0];for(let z=0;z<3;z++)T[z]=Math.min(T[z],M[z]),C[z]=Math.max(C[z],M[z])}return new En(T,C)}}}class zo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,a,m){return this._helper.interpolatePadding(i,a,m)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,a){this._helper.resize(i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,a){this._helper.overrideNearFarZ(i,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i){}constructor(){this._cachedClippingPlane=l.be(),this._projectionMatrix=l.a_(),this._globeViewProjMatrix32f=l.aZ(),this._globeViewProjMatrixNoCorrection=l.a_(),this._globeViewProjMatrixNoCorrectionInverted=l.a_(),this._globeProjMatrixInverted=l.a_(),this._cameraPosition=l.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new $r({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,a)=>this.getConstrained(i,a)}),this._coveringTilesDetailsProvider=new _s}clone(){const i=new zo;return i.apply(this),i}apply(i,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(i)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const i=l.bf();return i[0]=this._cameraPosition[0],i[1]=this._cameraPosition[1],i[2]=this._cameraPosition[2],i}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(i){const{overscaledTileID:a,applyGlobeMatrix:m}=i,g=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:g,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(i){const a=this.pitchInRadians,m=this.cameraToCenterDistance/i,g=Math.sin(a)*m,x=Math.cos(a)*m+1,T=1/Math.sqrt(g*g+x*x)*1;let C=-g,M=x;const z=Math.sqrt(C*C+M*M);C/=z,M/=z;const V=[0,C,M];return l.bg(V,V,[0,0,0],-this.bearingInRadians),l.bh(V,V,[0,0,0],-1*this.center.lat*Math.PI/180),l.bi(V,V,[0,0,0],this.center.lng*Math.PI/180),l.aL(V,V,.25),[...V,.25*-T]}isLocationOccluded(i){return!this.isSurfacePointVisible(wn(i))}transformLightDirection(i){const a=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,g=Math.cos(m),x=[Math.sin(a)*g,Math.sin(m),Math.cos(a)*g],T=[x[2],0,-x[0]],C=[0,0,0];l.aR(C,T,x),l.aQ(T,T),l.aQ(C,C);const M=[0,0,0];return l.aQ(M,[T[0]*i[0]+C[0]*i[1]+x[0]*i[2],T[1]*i[0]+C[1]*i[1]+x[1]*i[2],T[2]*i[0]+C[2]*i[1]+x[2]*i[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(i,a,m){const g=function(C,M,z){const V=1/(1<<z.z);return new l.Y(C/l.X*V+z.x*V,M/l.X*V+z.y*V)}(i,a,m.canonical),x=(T=g.y,[l.bd(g.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI]);var T;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(i,a,m,g){const x=m.canonical,T=Do(i,a,x.x,x.y,x.z),C=1+(g?g(i,a):0)/l.bo,M=[T[0]*C,T[1]*C,T[2]*C,1];l.al(M,M,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,V=z[0]*T[0]+z[1]*T[1]+z[2]*T[2]+z[3]<0;return{point:new l.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:V}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const i=Qi(this.worldSize,this.center.lat),a=l.a$(),m=l.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*i),l.aV(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const g=this.centerOffset;a[8]=2*-g.x/this._helper._width,a[9]=2*g.y/this._helper._height,this._projectionMatrix=l.aW(a),this._globeProjMatrixInverted=l.a$(),l.an(this._globeProjMatrixInverted,a),l.J(a,a,[0,0,-this.cameraToCenterDistance]),l.aX(a,a,this.rollInRadians),l.aY(a,a,-this.pitchInRadians),l.aX(a,a,this.bearingInRadians),l.J(a,a,[0,0,-i]);const x=l.bf();x[0]=i,x[1]=i,x[2]=i,l.aY(m,a,this.center.lat*Math.PI/180),l.bj(m,m,-this.center.lng*Math.PI/180),l.K(m,m,x),this._globeViewProjMatrixNoCorrection=m,l.aY(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bj(a,a,-this.center.lng*Math.PI/180),l.K(a,a,x),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=l.a$(),l.an(this._globeViewProjMatrixNoCorrectionInverted,m);const T=l.bf();this._cameraPosition=l.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/i,l.bg(this._cameraPosition,this._cameraPosition,T,-this.rollInRadians),l.bh(this._cameraPosition,this._cameraPosition,T,this.pitchInRadians),l.bg(this._cameraPosition,this._cameraPosition,T,-this.bearingInRadians),l.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bh(this._cameraPosition,this._cameraPosition,T,-this.center.lat*Math.PI/180),l.bi(this._cameraPosition,this._cameraPosition,T,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(i);const C=l.aW(this._globeViewProjMatrixNoCorrectionInverted);l.K(C,C,[1,1,-1]),this._cachedFrustum=qr.fromInvProjectionMatrix(C)}calculateFogMatrix(i){l.w("calculateFogMatrix is not supported on globe projection.");const a=l.a$();return l.aq(a),a}getVisibleUnwrappedCoordinates(i){return[new l.aT(0,i)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){i&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=wn(i);l.aL(m,m,1+a/l.bo);const g=l.be();return l.al(g,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),g[2]/g[3]}populateCache(i){}getBounds(){const i=.5*this.width,a=.5*this.height,m=[new l.P(0,0),new l.P(i,0),new l.P(this.width,0),new l.P(this.width,a),new l.P(this.width,this.height),new l.P(i,this.height),new l.P(0,this.height),new l.P(0,a)],g=[];for(const q of m)g.push(this.unprojectScreenPoint(q));let x=0,T=0,C=0,M=0;const z=this.center;for(const q of g){const Z=l.bk(z.lng,q.lng),J=l.bk(z.lat,q.lat);Z<T&&(T=Z),Z>x&&(x=Z),J<M&&(M=J),J>C&&(C=J)}const V=[z.lng+T,z.lat+M,z.lng+x,z.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(V[3]=90,V[0]=-180,V[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(V[1]=-90,V[0]=-180,V[2]=180),new wi(V)}getConstrained(i,a){const m=l.ab(i.lat,-85.051129,l.aF),g=l.ab(+a,this.minZoom+ci(0,m),this.maxZoom);return{center:new l.N(i.lng,m),zoom:g}}calculateCenterFromCameraLngLatAlt(i,a,m,g){return this._helper.calculateCenterFromCameraLngLatAlt(i,a,m,g)}setLocationAtPoint(i,a){const m=wn(this.unprojectScreenPoint(a)),g=wn(i),x=l.bf();l.bl(x);const T=l.bf();l.bi(T,m,x,-this.center.lng*Math.PI/180),l.bh(T,T,x,this.center.lat*Math.PI/180);const C=g[0]*g[0]+g[2]*g[2],M=T[0]*T[0];if(C<M)return;const z=Math.sqrt(C-M),V=-z,q=l.bm(g[0],g[2],T[0],z),Z=l.bm(g[0],g[2],T[0],V),J=l.bf();l.bi(J,g,x,-q);const ne=l.bm(J[1],J[2],T[1],T[2]),ye=l.bf();l.bi(ye,g,x,-Z);const _e=l.bm(ye[1],ye[2],T[1],T[2]),xe=.5*Math.PI,be=ne>=-xe&&ne<=xe,Ce=_e>=-xe&&_e<=xe;let ke,Re;if(be&&Ce){const Ke=this.center.lng*Math.PI/180,st=this.center.lat*Math.PI/180;l.bp(q,Ke)+l.bp(ne,st)<l.bp(Z,Ke)+l.bp(_e,st)?(ke=q,Re=ne):(ke=Z,Re=_e)}else if(be)ke=q,Re=ne;else{if(!Ce)return;ke=Z,Re=_e}const ze=ke/Math.PI*180,De=Re/Math.PI*180,Ze=this.center.lat;this.setCenter(new l.N(ze,l.ab(De,-90,90))),this.setZoom(this.zoom+ci(Ze,this.center.lat))}locationToScreenPoint(i,a){const m=wn(i);if(a){const g=a.getElevationForLngLatZoom(i,this._helper._tileZoom);l.aL(m,m,1+g/l.bo)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(i){const a=l.be();return l.al(a,[...i,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new l.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(i,a){if(a){const m=a.pointCoordinate(i);if(m)return m}return l.Y.fromLngLat(this.unprojectScreenPoint(i))}screenPointToLocation(i,a){var m;return(m=this.screenPointToMercatorCoordinate(i,a))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(i,a){const m=this._cameraPosition,g=this.getRayDirectionFromPixel(i);return!!this.rayPlanetIntersection(m,g)}getRayDirectionFromPixel(i){const a=l.be();a[0]=i.x/this.width*2-1,a[1]=-1*(i.y/this.height*2-1),a[2]=1,a[3]=1,l.al(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const m=l.bf();m[0]=a[0]-this._cameraPosition[0],m[1]=a[1]-this._cameraPosition[1],m[2]=a[2]-this._cameraPosition[2];const g=l.bf();return l.aQ(g,m),g}isSurfacePointVisible(i){const a=this._cachedClippingPlane;return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]+a[3]>=0}isSurfacePointOnScreen(i){if(!this.isSurfacePointVisible(i))return!1;const a=l.be();return l.al(a,[...i,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(i,a){const m=l.aS(i,a),g=l.bf(),x=l.bf();l.aL(x,a,m),l.aP(g,i,x);const T=1-l.aS(g,g);if(T<0)return null;const C=l.aS(i,i)-1,M=-m+(m<0?1:-1)*Math.sqrt(T),z=C/M,V=M;return{tMin:Math.min(z,V),tMax:Math.max(z,V)}}unprojectScreenPoint(i){const a=this._cameraPosition,m=this.getRayDirectionFromPixel(i),g=this.rayPlanetIntersection(a,m);if(g){const z=l.bf();l.aM(z,a,[m[0]*g.tMin,m[1]*g.tMin,m[2]*g.tMin]);const V=l.bf();return l.aQ(V,z),Hr(V)}const x=this._cachedClippingPlane[0]*m[0]+this._cachedClippingPlane[1]*m[1]+this._cachedClippingPlane[2]*m[2],T=-l.bn(this._cachedClippingPlane,a)/x,C=l.bf();if(T>0)l.aM(C,a,[m[0]*T,m[1]*T,m[2]*T]);else{const z=l.bf();l.aM(z,a,[2*m[0],2*m[1],2*m[2]]);const V=l.bn(this._cachedClippingPlane,z);l.aP(C,z,[this._cachedClippingPlane[0]*V,this._cachedClippingPlane[1]*V,this._cachedClippingPlane[2]*V])}const M=l.bf();return l.aQ(M,C),Hr(M)}getMatrixForModel(i,a){const m=l.N.convert(i),g=1/l.bo,x=l.a_();return l.bj(x,x,m.lng/180*Math.PI),l.aY(x,x,-m.lat/180*Math.PI),l.J(x,x,[0,0,1+a/l.bo]),l.aY(x,x,.5*Math.PI),l.K(x,x,[g,g,g]),x}getProjectionDataForCustomLayer(i=!0){const a=this.getProjectionData({overscaledTileID:new l.S(0,0,0,0,0),applyGlobeMatrix:i});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(i){}}class ro{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,a,m){return this._helper.interpolatePadding(i,a,m)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,a,m=!0){this._helper.resize(i,a,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,a){this._helper.overrideNearFarZ(i,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(i,a){this._globeness=i,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new $r({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,a)=>this.getConstrained(i,a)}),this._globeness=1,this._mercatorTransform=new Vs,this._verticalPerspectiveTransform=new zo}clone(){const i=new ro;return i._globeness=this._globeness,i._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,i.apply(this),i}apply(i){this._helper.apply(i),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(i){const a=this._mercatorTransform.getProjectionData(i),m=this._verticalPerspectiveTransform.getProjectionData(i);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:a.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:i.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(i){return this.currentTransform.isLocationOccluded(i)}transformLightDirection(i){return this.currentTransform.transformLightDirection(i)}getPixelScale(){return l.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(i,a,m){const g=this._mercatorTransform.getPitchedTextCorrection(i,a,m),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(i,a,m);return l.b9(g,x,this._globeness)}projectTileCoordinates(i,a,m,g){return this.currentTransform.projectTileCoordinates(i,a,m,g)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(i){return this.currentTransform.calculateFogMatrix(i)}getVisibleUnwrappedCoordinates(i){return this.currentTransform.getVisibleUnwrappedCoordinates(i)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(i){this._mercatorTransform.recalculateZoomAndCenter(i),this._verticalPerspectiveTransform.recalculateZoomAndCenter(i)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,a){return this.currentTransform.lngLatToCameraDepth(i,a)}populateCache(i){this._mercatorTransform.populateCache(i),this._verticalPerspectiveTransform.populateCache(i)}getBounds(){return this.currentTransform.getBounds()}getConstrained(i,a){return this.currentTransform.getConstrained(i,a)}calculateCenterFromCameraLngLatAlt(i,a,m,g){return this._helper.calculateCenterFromCameraLngLatAlt(i,a,m,g)}setLocationAtPoint(i,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(i,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(i,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(i,a){return this.currentTransform.locationToScreenPoint(i,a)}screenPointToMercatorCoordinate(i,a){return this.currentTransform.screenPointToMercatorCoordinate(i,a)}screenPointToLocation(i,a){return this.currentTransform.screenPointToLocation(i,a)}isPointOnMapSurface(i,a){return this.currentTransform.isPointOnMapSurface(i,a)}getRayDirectionFromPixel(i){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(i)}getMatrixForModel(i,a){return this.currentTransform.getMatrixForModel(i,a)}getProjectionDataForCustomLayer(i=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(i);if(!this.isGlobeRendering)return a;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(i);return m.fallbackMatrix=a.mainMatrix,m}getFastPathSimpleProjectionMatrix(i){return this.currentTransform.getFastPathSimpleProjectionMatrix(i)}}class Ri{get useGlobeControls(){return!0}handlePanInertia(i,a){const m=Gl(i,a);return Math.abs(m.lng-a.center.lng)>180&&(m.lng=a.center.lng+179.5*Math.sign(m.lng-a.center.lng)),{easingCenter:m,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(i,a){const m=i.around,g=a.screenPointToLocation(m);i.bearingDelta&&a.setBearing(a.bearing+i.bearingDelta),i.pitchDelta&&a.setPitch(a.pitch+i.pitchDelta),i.rollDelta&&a.setRoll(a.roll+i.rollDelta);const x=a.zoom;i.zoomDelta&&a.setZoom(a.zoom+i.zoomDelta);const T=a.zoom-x;if(T===0)return;const C=l.bk(a.center.lng,g.lng),M=C/(Math.abs(C/180)+1),z=l.bk(a.center.lat,g.lat),V=a.getRayDirectionFromPixel(m),q=a.cameraPosition,Z=-1*l.aS(q,V),J=l.bf();l.aM(J,q,[V[0]*Z,V[1]*Z,V[2]*Z]);const ne=l.bq(J)-1,ye=Math.exp(.5*-Math.max(ne-.3,0)),_e=Qi(a.worldSize,a.center.lat)/Math.min(a.width,a.height),xe=l.bc(_e,.9,.5,1,.25),be=(1-l.aG(-T))*Math.min(ye,xe),Ce=a.center.lat,ke=a.zoom,Re=new l.N(a.center.lng+M*be,l.ab(a.center.lat+z*be,-85.051129,l.aF));a.setLocationAtPoint(g,m);const ze=a.center,De=l.bc(Math.abs(C),45,85,0,1),Ze=l.bc(_e,.75,.35,0,1),Ke=Math.pow(Math.max(De,Ze),.25),st=l.bk(ze.lng,Re.lng),at=l.bk(ze.lat,Re.lat);a.setCenter(new l.N(ze.lng+st*Ke,ze.lat+at*Ke).wrap()),a.setZoom(ke+ci(Ce,a.center.lat))}handleMapControlsPan(i,a,m){if(!i.panDelta)return;const g=a.center.lat,x=a.zoom;a.setCenter(Gl(i.panDelta,a).wrap()),a.setZoom(x+ci(g,a.center.lat))}cameraForBoxAndBearing(i,a,m,g,x){const T=Ln(i,a,m,g,x),C=a.left/x.width*2-1,M=(x.width-a.right)/x.width*2-1,z=a.top/x.height*-2+1,V=(x.height-a.bottom)/x.height*-2+1,q=l.bk(m.getWest(),m.getEast())<0,Z=q?m.getEast():m.getWest(),J=q?m.getWest():m.getEast(),ne=Math.max(m.getNorth(),m.getSouth()),ye=Math.min(m.getNorth(),m.getSouth()),_e=Z+.5*l.bk(Z,J),xe=ne+.5*l.bk(ne,ye),be=x.clone();be.setCenter(T.center),be.setBearing(T.bearing),be.setPitch(0),be.setRoll(0),be.setZoom(T.zoom);const Ce=be.modelViewProjectionMatrix,ke=[wn(m.getNorthWest()),wn(m.getNorthEast()),wn(m.getSouthWest()),wn(m.getSouthEast()),wn(new l.N(J,xe)),wn(new l.N(Z,xe)),wn(new l.N(_e,ne)),wn(new l.N(_e,ye))],Re=wn(T.center);let ze=Number.POSITIVE_INFINITY;for(const De of ke)C<0&&(ze=Ri.getLesserNonNegativeNonNull(ze,Ri.solveVectorScale(De,Re,Ce,"x",C))),M>0&&(ze=Ri.getLesserNonNegativeNonNull(ze,Ri.solveVectorScale(De,Re,Ce,"x",M))),z>0&&(ze=Ri.getLesserNonNegativeNonNull(ze,Ri.solveVectorScale(De,Re,Ce,"y",z))),V<0&&(ze=Ri.getLesserNonNegativeNonNull(ze,Ri.solveVectorScale(De,Re,Ce,"y",V)));if(Number.isFinite(ze)&&ze!==0)return T.zoom=be.zoom+l.a8(ze),T;$t()}handleJumpToCenterZoom(i,a){const m=i.center.lat,g=i.getConstrained(a.center?l.N.convert(a.center):i.center,i.zoom).center;i.setCenter(g.wrap());const x=a.zoom!==void 0?+a.zoom:i.zoom+ci(m,g.lat);i.zoom!==x&&i.setZoom(x)}handleEaseTo(i,a){const m=i.zoom,g=i.center,x=i.padding,T={roll:i.roll,pitch:i.pitch,bearing:i.bearing},C={roll:a.roll===void 0?i.roll:a.roll,pitch:a.pitch===void 0?i.pitch:a.pitch,bearing:a.bearing===void 0?i.bearing:a.bearing},M=a.zoom!==void 0,z=!i.isPaddingEqual(a.padding);let V=!1;const q=a.center?l.N.convert(a.center):g,Z=i.getConstrained(q,m).center;qi(i,Z);const J=i.clone();J.setCenter(Z),J.setZoom(M?+a.zoom:m+ci(g.lat,q.lat)),J.setBearing(a.bearing);const ne=new l.P(l.ab(i.centerPoint.x+a.offsetAsPoint.x,0,i.width),l.ab(i.centerPoint.y+a.offsetAsPoint.y,0,i.height));J.setLocationAtPoint(Z,ne);const ye=(a.offset&&a.offsetAsPoint.mag())>0?J.center:Z,_e=M?+a.zoom:m+ci(g.lat,ye.lat),xe=m+ci(g.lat,0),be=_e+ci(ye.lat,0),Ce=l.bk(g.lng,ye.lng),ke=l.bk(g.lat,ye.lat),Re=l.aG(be-xe);return V=_e!==m,{easeFunc:ze=>{if(l.b3(T,C)||is({startEulerAngles:T,endEulerAngles:C,tr:i,k:ze,useSlerp:T.roll!=C.roll}),z&&i.interpolatePadding(x,a.padding,ze),a.around)l.w("Easing around a point is not supported under globe projection."),i.setLocationAtPoint(a.around,a.aroundPoint);else{const De=be>xe?Math.min(2,Re):Math.max(.5,Re),Ze=Math.pow(De,1-ze),Ke=ol(g,Ce,ke,ze*Ze);i.setCenter(Ke.wrap())}if(V){const De=l.y.number(xe,be,ze)+ci(0,i.center.lat);i.setZoom(De)}},isZooming:V,elevationCenter:ye}}handleFlyTo(i,a){const m=a.zoom!==void 0,g=i.center,x=i.zoom,T=!i.isPaddingEqual(a.padding),C=i.getConstrained(l.N.convert(a.center||a.locationAtOffset),x).center,M=m?+a.zoom:i.zoom+ci(i.center.lat,C.lat),z=i.clone();z.setCenter(C),T&&z.setPadding(a.padding),z.setZoom(M),z.setBearing(a.bearing);const V=new l.P(l.ab(i.centerPoint.x+a.offsetAsPoint.x,0,i.width),l.ab(i.centerPoint.y+a.offsetAsPoint.y,0,i.height));z.setLocationAtPoint(C,V);const q=z.center;qi(i,q);const Z=function(Ce,ke,Re){const ze=wn(ke),De=wn(Re),Ze=l.aS(ze,De),Ke=Math.acos(Ze),st=In(Ce);return Ke/(2*Math.PI)*st}(i,g,q),J=x+ci(g.lat,0),ne=M+ci(q.lat,0),ye=l.aG(ne-J);let _e;if(typeof a.minZoom=="number"){const Ce=+a.minZoom+ci(q.lat,0),ke=Math.min(Ce,J,ne)+ci(0,q.lat),Re=i.getConstrained(q,ke).zoom+ci(q.lat,0);_e=l.aG(Re-J)}const xe=l.bk(g.lng,q.lng),be=l.bk(g.lat,q.lat);return{easeFunc:(Ce,ke,Re,ze)=>{const De=ol(g,xe,be,Re),Ze=Ce===1?q:De;i.setCenter(Ze.wrap());const Ke=J+l.a8(ke);i.setZoom(Ce===1?M:Ke+ci(0,Ze.lat))},scaleOfZoom:ye,targetCenter:q,scaleOfMinZoom:_e,pixelPathLength:Z}}static solveVectorScale(i,a,m,g,x){const T=g==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],C=[m[3],m[7],m[11],m[15]],M=i[0]*T[0]+i[1]*T[1]+i[2]*T[2],z=i[0]*C[0]+i[1]*C[1]+i[2]*C[2],V=a[0]*T[0]+a[1]*T[1]+a[2]*T[2],q=a[0]*C[0]+a[1]*C[1]+a[2]*C[2];return V+x*z===M+x*q||C[3]*(M-V)+T[3]*(q-z)+M*q==V*z?null:(V+T[3]-x*q-x*C[3])/(V-M-x*q+x*z)}static getLesserNonNegativeNonNull(i,a){return a!==null&&a>=0&&a<i?a:i}}class No{constructor(i){this._globe=i,this._mercatorCameraHelper=new rl,this._verticalPerspectiveCameraHelper=new Ri}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(i,a){return this.currentHelper.handlePanInertia(i,a)}handleMapControlsRollPitchBearingZoom(i,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(i,a)}handleMapControlsPan(i,a,m){this.currentHelper.handleMapControlsPan(i,a,m)}cameraForBoxAndBearing(i,a,m,g,x){return this.currentHelper.cameraForBoxAndBearing(i,a,m,g,x)}handleJumpToCenterZoom(i,a){this.currentHelper.handleJumpToCenterZoom(i,a)}handleEaseTo(i,a){return this.currentHelper.handleEaseTo(i,a)}handleFlyTo(i,a){return this.currentHelper.handleFlyTo(i,a)}}const so=(v,i)=>l.t(v,i&&i.filter(a=>a.identifier!=="source.canvas")),Sa=l.br();class vr extends l.E{constructor(i,a={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const g=this.sourceCaches[m].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[m].reload()}},this.map=i,this.dispatcher=new xi(on(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,g)=>this.getGlyphs(m,g)),this.dispatcher.registerMessageHandler("GI",(m,g)=>this.getImages(m,g)),this.imageManager=new ve,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(i._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Tt(256,512),this.crossTileSymbolIndex=new Wn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.bt()),Vr().on(To,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.sourceCaches[m.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}loadURL(i,a={},m){this.fire(new l.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const g=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;l.h(g,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,a,m)}).catch(T=>{this._loadStyleRequest=null,T&&!x.signal.aborted&&this.fire(new l.j(T))})}loadJSON(i,a={},m){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,H.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(i,a,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Sa,{validate:!1})}_load(i,a,m){var g,x;const T=a.transformStyle?a.transformStyle(m,i):i;if(!a.validate||!so(this,l.u(T))){this._loaded=!0,this.stylesheet=T;for(const C in T.sources)this.addSource(C,T.sources[C],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new vi(this.stylesheet.light),this._setProjectionInternal(((g=this.stylesheet.projection)===null||g===void 0?void 0:g.type)||"mercator"),this.sky=new Qt(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of i){const m=l.bv(a);m.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=m}}_loadSprite(i,a=!1,m=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(x,T,C,M){return l._(this,void 0,void 0,function*(){const z=qe(x),V=C>1?"@2x":"",q={},Z={};for(const{id:J,url:ne}of z){const ye=T.transformRequest(fe(ne,V,".json"),"SpriteJSON");q[J]=l.h(ye,M);const _e=T.transformRequest(fe(ne,V,".png"),"SpriteImage");Z[J]=je.getImage(_e,M)}return yield Promise.all([...Object.values(q),...Object.values(Z)]),function(J,ne){return l._(this,void 0,void 0,function*(){const ye={};for(const _e in J){ye[_e]={};const xe=H.getImageCanvasContext((yield ne[_e]).data),be=(yield J[_e]).data;for(const Ce in be){const{width:ke,height:Re,x:ze,y:De,sdf:Ze,pixelRatio:Ke,stretchX:st,stretchY:at,content:tt,textFitWidth:St,textFitHeight:bt}=be[Ce];ye[_e][Ce]={data:null,pixelRatio:Ke,sdf:Ze,stretchX:st,stretchY:at,content:tt,textFitWidth:St,textFitHeight:bt,spriteData:{width:ke,height:Re,x:ze,y:De,context:xe}}}}return ye})}(q,Z)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(x=>{if(this._spriteRequest=null,x)for(const T in x){this._spritesImagesIds[T]=[];const C=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(M=>!(M in x)):[];for(const M of C)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in x[T]){const z=T==="default"?M:`${T}:${M}`;this._spritesImagesIds[T].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,x[T][M],!1):this.imageManager.addImage(z,x[T][M]),a&&(this._changedImages[z]=!0)}}}).catch(x=>{this._spriteRequest=null,g=x,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(g)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const a=this.sourceCaches[i.source];if(!a)return;const m=i.sourceLayer;if(!m)return;const g=a.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${g.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,a=!1){const m=this._serializedAllLayers();if(!i||i.length===0)return Object.values(a?l.bw(m):m);const g=[];for(const x of i)if(m[x]){const T=a?l.bw(m[x]):m[x];g.push(T)}return g}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const a=Object.keys(this._layers);for(const m of a){const g=this._layers[m];g.type!=="custom"&&(i[m]=g.serialize())}return i}hasTransitions(){var i,a,m;if(!((i=this.light)===null||i===void 0)&&i.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const a=this._changed;if(a){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const T in this._updatedSources){const C=this._updatedSources[T];if(C==="reload")this._reloadSource(T);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const m={};for(const g in this.sourceCaches){const x=this.sourceCaches[g];m[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(i,this._availableImages),!x.isHidden(i.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const g in m){const x=this.sourceCaches[g];!!m[g]!=!!x.used&&x.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(i),this.sky.recalculate(i),this.projection.recalculate(i),this.z=i.zoom,a&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,a={}){var m;this._checkLoaded();const g=this.serialize();if(i=a.transformStyle?a.transformStyle(g,i):i,((m=a.validate)===null||m===void 0||m)&&so(this,l.u(i)))return!1;(i=l.bw(i)).layers=l.bu(i.layers);const x=l.bx(g,i),T=this._getOperationsToPerform(x);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const C of T.operations)C();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const a=[],m=[];for(const g of i)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":a.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":a.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setSky":a.push(()=>this.setSky.apply(this,g.args));break;case"setProjection":this.setProjection.apply(this,g.args);break;case"setTransition":a.push(()=>{});break;default:m.push(g.command)}return{operations:a,unimplemented:m}}addImage(i,a){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,a),this._afterImageUpdated(i)}updateImage(i,a){this.imageManager.updateImage(i,a)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,a,m={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.u.source,`sources.${i}`,a,null,m))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=this.sourceCaches[i]=new ee(i,a,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:i})),g.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${m}" is using it.`)));const a=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],a.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,a){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const m=this.sourceCaches[i].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(a),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,a,m={}){this._checkLoaded();const g=i.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let x;if(i.type==="custom"){if(so(this,l.by(i)))return;x=l.bv(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(g,i.source),i=l.bw(i),i=l.e(i,{source:g})),this._validate(l.u.layer,`layers.${g}`,i,{arrayIndex:-1},m))return;x=l.bv(i),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}})}const T=a?this._order.indexOf(a):this._order.length;if(a&&T===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${a}".`)));else{if(this._order.splice(T,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&x.type!=="custom"){const C=this._removedLayers[g];delete this._removedLayers[g],C.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(i,a){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===a)return;const m=this._order.indexOf(i);this._order.splice(m,1);const g=a?this._order.indexOf(a):this._order.length;a&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${a}".`))):(this._order.splice(g,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const a=this._layers[i];if(!a)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));a.setEventedParent(null);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=a,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],a.onRemove&&a.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,a,m){this._checkLoaded();const g=this.getLayer(i);g?g.minzoom===a&&g.maxzoom===m||(a!=null&&(g.minzoom=a),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,a,m={}){this._checkLoaded();const g=this.getLayer(i);if(g){if(!l.bz(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.u.filter,`layers.${g.id}.filter`,a,null,m)||(g.filter=l.bw(a),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.bw(this.getLayer(i).filter)}setLayoutProperty(i,a,m,g={}){this._checkLoaded();const x=this.getLayer(i);x?l.bz(x.getLayoutProperty(a),m)||(x.setLayoutProperty(a,m,g),this._updateLayer(x)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,a){const m=this.getLayer(i);if(m)return m.getLayoutProperty(a);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,a,m,g={}){this._checkLoaded();const x=this.getLayer(i);x?l.bz(x.getPaintProperty(a),m)||(x.setPaintProperty(a,m,g)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,a){return this.getLayer(i).getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();const m=i.source,g=i.sourceLayer,x=this.sourceCaches[m];if(x===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const T=x.getSource().type;T==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||g?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,i.id,a)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,a){this._checkLoaded();const m=i.source,g=this.sourceCaches[m];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const x=g.getSource().type,T=x==="vector"?i.sourceLayer:void 0;x!=="vector"||T?a&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(T,i.id,a):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const a=i.source,m=i.sourceLayer,g=this.sourceCaches[a];if(g!==void 0)return g.getSource().type!=="vector"||m?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(m,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.bA(this.sourceCaches,x=>x.serialize()),a=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,g=this.stylesheet;return l.bB({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,projection:g.projection,sources:i,layers:a,terrain:m},x=>x!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const a=T=>this._layers[T].type==="fill-extrusion",m={},g=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(a(C)){m[C]=T;for(const M of i){const z=M[C];if(z)for(const V of z)g.push(V)}}}g.sort((T,C)=>C.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(a(C))for(let M=g.length-1;M>=0;M--){const z=g[M].feature;if(m[z.layer.id]<T)break;x.push(z),g.pop()}else for(const M of i){const z=M[C];if(z)for(const V of z)x.push(V.feature)}}return x}queryRenderedFeatures(i,a,m){a&&a.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",a.filter,null,a);const g={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new l.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of a.layers){const V=this._layers[z];if(!V)return this.fire(new l.j(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];g[V.source]=!0}}const x=[];a.availableImages=this._availableImages;const T=this._serializedAllLayers(),C=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,M=Object.assign(Object.assign({},a),{layers:C});for(const z in this.sourceCaches)a.layers&&!g[z]||x.push(Ls(this.sourceCaches[z],this._layers,T,i,M,m));return this.placement&&x.push(function(z,V,q,Z,J,ne,ye){const _e={},xe=ne.queryRenderedSymbols(Z),be=[];for(const Ce of Object.keys(xe).map(Number))be.push(ye[Ce]);be.sort(ki);for(const Ce of be){const ke=Ce.featureIndex.lookupSymbolFeatures(xe[Ce.bucketInstanceId],V,Ce.bucketIndex,Ce.sourceLayerIndex,J.filter,J.layers,J.availableImages,z);for(const Re in ke){const ze=_e[Re]=_e[Re]||[],De=ke[Re];De.sort((Ze,Ke)=>{const st=Ce.featureSortOrder;if(st){const at=st.indexOf(Ze.featureIndex);return st.indexOf(Ke.featureIndex)-at}return Ke.featureIndex-Ze.featureIndex});for(const Ze of De)ze.push(Ze)}}return function(Ce,ke,Re){for(const ze in Ce)for(const De of Ce[ze])ui(De,Re[ke[ze].source]);return Ce}(_e,z,q)}(this._layers,T,this.sourceCaches,i,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(i,a){a&&a.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",a.filter,null,a);const m=this.sourceCaches[i];return m?function(g,x){const T=g.getRenderableIds().map(z=>g.getTileByID(z)),C=[],M={};for(let z=0;z<T.length;z++){const V=T[z],q=V.tileID.canonical.key;M[q]||(M[q]=!0,V.querySourceFeatures(C,x))}return C}(m,a):[]}getLight(){return this.light.getLight()}setLight(i,a={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const T in i)if(!l.bz(i[T],m[T])){g=!0;break}if(!g)return;const x={now:H.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,a),this.light.updateTransitions(x)}getProjection(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.projection}setProjection(i){if(this._checkLoaded(),this.projection){if(this.projection.name===i.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=i,this._setProjectionInternal(i.type)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,a={}){this._checkLoaded();const m=this.getSky();let g=!1;if(!i&&!m)return;if(i&&!m)g=!0;else if(!i&&m)g=!0;else for(const T in i)if(!l.bz(i[T],m[T])){g=!0;break}if(!g)return;const x={now:H.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,a),this.sky.updateTransitions(x)}_setProjectionInternal(i){const a=function(m){if(Array.isArray(m)){const g=new sl({type:m});return{projection:g,transform:new ro,cameraHelper:new No(g)}}switch(m){case"mercator":return{projection:new Ar,transform:new Vs,cameraHelper:new rl};case"globe":{const g=new sl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:g,transform:new ro,cameraHelper:new No(g)}}case"vertical-perspective":return{projection:new ql,transform:new zo,cameraHelper:new Ri};default:return l.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new Ar,transform:new Vs,cameraHelper:new rl}}}(i);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(i,a,m,g,x={}){return(!x||x.validate!==!1)&&so(this,i.call(l.u,l.e({key:a,style:this.serialize(),value:m,styleSpec:l.v},g)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Vr().off(To,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const m=this.sourceCaches[a];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const a in this.sourceCaches)this.sourceCaches[a].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,a,m,g,x=!1){let T=!1,C=!1;const M={};for(const z of this._order){const V=this._layers[z];if(V.type!=="symbol")continue;if(!M[V.source]){const Z=this.sourceCaches[V.source];M[V.source]=Z.getRenderableIds(!0).map(J=>Z.getTileByID(J)).sort((J,ne)=>ne.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ne.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,M[V.source],i.center.lng);T=T||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(H.now(),i.zoom))&&(this.pauseablePlacement=new ba(i,this.map.terrain,this._order,x,a,m,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(H.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const z of this._order){const V=this._layers[z];V.type==="symbol"&&this.placement.updateLayerOpacities(V,M[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(H.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,a){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[a.source];return g&&g.setDependencies(a.tileID.key,a.type,a.icons),m})}getGlyphs(i,a){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(a.stacks),g=this.sourceCaches[a.source];return g&&g.setDependencies(a.tileID.key,a.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,a={}){this._checkLoaded(),i&&this._validate(l.u.glyphs,"glyphs",i,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,a,m={},g){this._checkLoaded();const x=[{id:i,url:a}],T=[...qe(this.stylesheet.sprite),...x];this._validate(l.u.sprite,"sprite",T,null,m)||(this.stylesheet.sprite=T,this._loadSprite(x,!0,g))}removeSprite(i){this._checkLoaded();const a=qe(this.stylesheet.sprite);if(a.find(m=>m.id===i)){if(this._spritesImagesIds[i])for(const m of this._spritesImagesIds[i])this.imageManager.removeImage(m),this._changedImages[m]=!0;a.splice(a.findIndex(m=>m.id===i),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return qe(this.stylesheet.sprite)}setSprite(i,a={},m){this._checkLoaded(),i&&this._validate(l.u.sprite,"sprite",i,null,a)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,m):(this._unloadSprite(),m&&m(null)))}}var ku=l.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class al{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,a,m,g,x,T,C,M,z){this.context=i;let V=this.boundPaintVertexBuffers.length!==g.length;for(let q=0;!V&&q<g.length;q++)this.boundPaintVertexBuffers[q]!==g[q]&&(V=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==m||V||this.boundIndexBuffer!==x||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==z?this.freshBind(a,m,g,x,T,C,M,z):(i.bindVertexArray.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),M&&M.bind(),z&&z.bind())}freshBind(i,a,m,g,x,T,C,M){const z=i.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=M,a.enableAttributes(q,i);for(const Z of m)Z.enableAttributes(q,i);T&&T.enableAttributes(q,i),C&&C.enableAttributes(q,i),M&&M.enableAttributes(q,i),a.bind(),a.setVertexAttribPointers(q,i,x);for(const Z of m)Z.bind(),Z.setVertexAttribPointers(q,i,x);T&&(T.bind(),T.setVertexAttribPointers(q,i,x)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(q,i,x)),M&&(M.bind(),M.setVertexAttribPointers(q,i,x)),V.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ys=(v,i,a,m,g)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:i,u_fog_color:a?a.properties.get("fog-color"):l.b4.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?0:a?a.calculateFogBlendOpacity(m):0,u_horizon_color:a?a.properties.get("horizon-color"):l.b4.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:g?1:0}),Ea={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ia(v){const i=[];for(let a=0;a<v.length;a++){if(v[a]===null)continue;const m=v[a].split(" ");i.push(m.pop())}return i}class ll{constructor(i,a,m,g,x,T,C,M){const z=i.gl;this.program=z.createProgram();const V=ia(a.staticAttributes),q=m?m.getBinderAttributes():[],Z=V.concat(q),J=$i.prelude.staticUniforms?ia($i.prelude.staticUniforms):[],ne=C.staticUniforms?ia(C.staticUniforms):[],ye=a.staticUniforms?ia(a.staticUniforms):[],_e=m?m.getBinderUniforms():[],xe=J.concat(ne).concat(ye).concat(_e),be=[];for(const Ke of xe)be.indexOf(Ke)<0&&be.push(Ke);const Ce=m?m.defines():[];Mi(z)&&Ce.unshift("#version 300 es"),x&&Ce.push("#define OVERDRAW_INSPECTOR;"),T&&Ce.push("#define TERRAIN3D;"),M&&Ce.push(M);let ke=Ce.concat($i.prelude.fragmentSource,C.fragmentSource,a.fragmentSource).join(`
`),Re=Ce.concat($i.prelude.vertexSource,C.vertexSource,a.vertexSource).join(`
`);Mi(z)||(ke=function(Ke){return Ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ke),Re=function(Ke){return Ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Re));const ze=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ze,ke),z.compileShader(ze),!z.getShaderParameter(ze,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ze)}`);z.attachShader(this.program,ze);const De=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(De,Re),z.compileShader(De),!z.getShaderParameter(De,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(De)}`);z.attachShader(this.program,De),this.attributes={};const Ze={};this.numAttributes=Z.length;for(let Ke=0;Ke<this.numAttributes;Ke++)Z[Ke]&&(z.bindAttribLocation(this.program,Ke,Z[Ke]),this.attributes[Z[Ke]]=Ke);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(De),z.deleteShader(ze);for(let Ke=0;Ke<be.length;Ke++){const st=be[Ke];if(st&&!Ze[st]){const at=z.getUniformLocation(this.program,st);at&&(Ze[st]=at)}}this.fixedUniforms=g(i,Ze),this.terrainUniforms=((Ke,st)=>({u_depth:new l.bC(Ke,st.u_depth),u_terrain:new l.bC(Ke,st.u_terrain),u_terrain_dim:new l.b5(Ke,st.u_terrain_dim),u_terrain_matrix:new l.bD(Ke,st.u_terrain_matrix),u_terrain_unpack:new l.bE(Ke,st.u_terrain_unpack),u_terrain_exaggeration:new l.b5(Ke,st.u_terrain_exaggeration)}))(i,Ze),this.projectionUniforms=((Ke,st)=>({u_projection_matrix:new l.bD(Ke,st.u_projection_matrix),u_projection_tile_mercator_coords:new l.bE(Ke,st.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bE(Ke,st.u_projection_clipping_plane),u_projection_transition:new l.b5(Ke,st.u_projection_transition),u_projection_fallback_matrix:new l.bD(Ke,st.u_projection_fallback_matrix)}))(i,Ze),this.binderUniforms=m?m.getUniforms(i,Ze):[]}draw(i,a,m,g,x,T,C,M,z,V,q,Z,J,ne,ye,_e,xe,be,Ce){const ke=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(g),i.setColorMode(x),i.setCullFace(T),M){i.activeTexture.set(ke.TEXTURE2),ke.bindTexture(ke.TEXTURE_2D,M.depthTexture),i.activeTexture.set(ke.TEXTURE3),ke.bindTexture(ke.TEXTURE_2D,M.texture);for(const ze in this.terrainUniforms)this.terrainUniforms[ze].set(M[ze])}if(z)for(const ze in z)this.projectionUniforms[Ea[ze]].set(z[ze]);if(C)for(const ze in this.fixedUniforms)this.fixedUniforms[ze].set(C[ze]);_e&&_e.setUniforms(i,this.binderUniforms,ne,{zoom:ye});let Re=0;switch(a){case ke.LINES:Re=2;break;case ke.TRIANGLES:Re=3;break;case ke.LINE_STRIP:Re=1}for(const ze of J.get()){const De=ze.vaos||(ze.vaos={});(De[V]||(De[V]=new al)).bind(i,this,q,_e?_e.getPaintVertexBuffers():[],Z,ze.vertexOffset,xe,be,Ce),ke.drawElements(a,ze.primitiveLength*Re,ke.UNSIGNED_SHORT,ze.primitiveOffset*Re*2)}}}function Zl(v,i,a){const m=1/l.at(a,1,i.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),x=a.tileSize*Math.pow(2,i.transform.tileZoom)/g,T=x*(a.tileID.canonical.x+a.tileID.wrap*g),C=x*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[m,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const vs=(v,i,a,m)=>{const g=v.style.light,x=g.properties.get("position"),T=[x.x,x.y,x.z],C=l.bI();g.properties.get("anchor")==="viewport"&&l.bJ(C,v.transform.bearingInRadians),l.bK(T,T,C);const M=v.transform.transformLightDirection(T),z=g.properties.get("color");return{u_lightpos:T,u_lightpos_globe:M,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+i,u_opacity:a,u_fill_translate:m}},dr=(v,i,a,m,g,x,T)=>l.e(vs(v,i,a,m),Zl(x,v,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8}),Us=(v,i,a,m)=>l.e(Zl(i,v,a),{u_fill_translate:m}),wc=(v,i)=>({u_world:v,u_fill_translate:i}),xs=(v,i,a,m,g)=>l.e(Us(v,i,a,g),{u_world:m}),E=(v,i,a,m,g)=>{const x=v.transform;let T,C,M=0;if(a.paint.get("circle-pitch-alignment")==="map"){const z=l.at(i,1,x.zoom);T=!0,C=[z,z],M=z/(l.X*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*g}else T=!1,C=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+T,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:M,u_translate:m}},F=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),W=v=>({u_viewport_size:[v.width,v.height]}),de=(v,i=1)=>({u_color:v,u_overlay:0,u_overlay_scale:i}),$e=(v,i,a,m)=>{const g=l.at(v,1,i)/(l.X*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:l.at(v,1,i),u_intensity:a,u_globe_extrude_scale:g}},Je=(v,i,a,m)=>{const g=l.H();l.bL(g,0,v.width,v.height,0,0,1);const x=v.context.gl;return{u_matrix:g,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:a,u_color_ramp:m,u_opacity:i.paint.get("heatmap-opacity")}},At=(v,i,a)=>{const m=a.paint.get("hillshade-shadow-color"),g=a.paint.get("hillshade-highlight-color"),x=a.paint.get("hillshade-accent-color");let T=a.paint.get("hillshade-illumination-direction")*(Math.PI/180);return a.paint.get("hillshade-illumination-anchor")==="viewport"&&(T+=v.transform.bearingInRadians),{u_image:0,u_latrange:Ei(0,i.tileID),u_light:[a.paint.get("hillshade-exaggeration"),T],u_shadow:m,u_highlight:g,u_accent:x}},Kn=(v,i)=>{const a=i.stride,m=l.H();return l.bL(m,0,l.X,-8192,0,0,1),l.J(m,m,[0,-8192,0]),{u_matrix:m,u_image:1,u_dimension:[a,a],u_zoom:v.overscaledZ,u_unpack:i.getUnpackVector()}};function Ei(v,i){const a=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new l.Y(0,m/a).toLngLat().lat,new l.Y(0,(m+1)/a).toLngLat().lat]}const Dn=(v,i,a,m)=>{const g=v.transform;return{u_translation:Pa(v,i,a),u_ratio:m/l.at(i,1,g.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},qn=(v,i,a,m,g)=>l.e(Dn(v,i,a,m),{u_image:0,u_image_height:g}),Li=(v,i,a,m,g)=>{const x=v.transform,T=Di(i,x);return{u_translation:Pa(v,i,a),u_texsize:i.imageAtlasTexture.size,u_ratio:m/l.at(i,1,x.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[T,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Ia=(v,i,a,m,g,x)=>{const T=v.lineAtlas,C=Di(i,v.transform),M=a.layout.get("line-cap")==="round",z=T.getDash(g.from,M),V=T.getDash(g.to,M),q=z.width*x.fromScale,Z=V.width*x.toScale;return l.e(Dn(v,i,a,m),{u_patternscale_a:[C/q,-z.height/2],u_patternscale_b:[C/Z,-V.height/2],u_sdfgamma:T.width/(256*Math.min(q,Z)*v.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:V.y,u_mix:x.t})};function Di(v,i){return 1/l.at(v,1,i.tileZoom)}function Pa(v,i,a){return l.au(v.transform,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const oo=(v,i,a,m,g)=>{return{u_tl_parent:v,u_scale_parent:i,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(T=m.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(x=m.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Ch(m.paint.get("raster-hue-rotate")),u_coords_top:[g[0].x,g[0].y,g[1].x,g[1].y],u_coords_bottom:[g[3].x,g[3].y,g[2].x,g[2].y]};var x,T};function Ch(v){v*=Math.PI/180;const i=Math.sin(v),a=Math.cos(v);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const ul=(v,i,a,m,g,x,T,C,M,z,V,q,Z)=>{const J=T.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_pitch:J.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:J.width/J.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+V,u_pitch_with_map:+m,u_is_along_line:g,u_is_variable_anchor:x,u_texsize:q,u_texture:0,u_translation:z,u_pitched_scale:Z}},Wl=(v,i,a,m,g,x,T,C,M,z,V,q,Z,J)=>{const ne=T.transform;return l.e(ul(v,i,a,m,g,x,T,C,M,z,V,q,J),{u_gamma_scale:m?Math.cos(ne.pitch*Math.PI/180)*ne.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},$s=(v,i,a,m,g,x,T,C,M,z,V,q,Z)=>l.e(Wl(v,i,a,m,g,x,T,C,M,z,!0,V,0,Z),{u_texsize_icon:q,u_texture_icon:1}),Ah=(v,i)=>({u_opacity:v,u_color:i}),Oo=(v,i,a,m,g)=>l.e(function(x,T,C,M){const z=C.imageManager.getPattern(x.from.toString()),V=C.imageManager.getPattern(x.to.toString()),{width:q,height:Z}=C.imageManager.getPixelSize(),J=Math.pow(2,M.tileID.overscaledZ),ne=M.tileSize*Math.pow(2,C.transform.tileZoom)/J,ye=ne*(M.tileID.canonical.x+M.tileID.wrap*J),_e=ne*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[q,Z],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/l.at(M,1,C.transform.tileZoom),u_pixel_coord_upper:[ye>>16,_e>>16],u_pixel_coord_lower:[65535&ye,65535&_e]}}(a,g,i,m),{u_opacity:v}),cl=(v,i)=>{},Ud={fillExtrusion:(v,i)=>({u_lightpos:new l.bG(v,i.u_lightpos),u_lightpos_globe:new l.bG(v,i.u_lightpos_globe),u_lightintensity:new l.b5(v,i.u_lightintensity),u_lightcolor:new l.bG(v,i.u_lightcolor),u_vertical_gradient:new l.b5(v,i.u_vertical_gradient),u_opacity:new l.b5(v,i.u_opacity),u_fill_translate:new l.bH(v,i.u_fill_translate)}),fillExtrusionPattern:(v,i)=>({u_lightpos:new l.bG(v,i.u_lightpos),u_lightpos_globe:new l.bG(v,i.u_lightpos_globe),u_lightintensity:new l.b5(v,i.u_lightintensity),u_lightcolor:new l.bG(v,i.u_lightcolor),u_vertical_gradient:new l.b5(v,i.u_vertical_gradient),u_height_factor:new l.b5(v,i.u_height_factor),u_opacity:new l.b5(v,i.u_opacity),u_fill_translate:new l.bH(v,i.u_fill_translate),u_image:new l.bC(v,i.u_image),u_texsize:new l.bH(v,i.u_texsize),u_pixel_coord_upper:new l.bH(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.bH(v,i.u_pixel_coord_lower),u_scale:new l.bG(v,i.u_scale),u_fade:new l.b5(v,i.u_fade)}),fill:(v,i)=>({u_fill_translate:new l.bH(v,i.u_fill_translate)}),fillPattern:(v,i)=>({u_image:new l.bC(v,i.u_image),u_texsize:new l.bH(v,i.u_texsize),u_pixel_coord_upper:new l.bH(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.bH(v,i.u_pixel_coord_lower),u_scale:new l.bG(v,i.u_scale),u_fade:new l.b5(v,i.u_fade),u_fill_translate:new l.bH(v,i.u_fill_translate)}),fillOutline:(v,i)=>({u_world:new l.bH(v,i.u_world),u_fill_translate:new l.bH(v,i.u_fill_translate)}),fillOutlinePattern:(v,i)=>({u_world:new l.bH(v,i.u_world),u_image:new l.bC(v,i.u_image),u_texsize:new l.bH(v,i.u_texsize),u_pixel_coord_upper:new l.bH(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.bH(v,i.u_pixel_coord_lower),u_scale:new l.bG(v,i.u_scale),u_fade:new l.b5(v,i.u_fade),u_fill_translate:new l.bH(v,i.u_fill_translate)}),circle:(v,i)=>({u_camera_to_center_distance:new l.b5(v,i.u_camera_to_center_distance),u_scale_with_map:new l.bC(v,i.u_scale_with_map),u_pitch_with_map:new l.bC(v,i.u_pitch_with_map),u_extrude_scale:new l.bH(v,i.u_extrude_scale),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_globe_extrude_scale:new l.b5(v,i.u_globe_extrude_scale),u_translate:new l.bH(v,i.u_translate)}),collisionBox:(v,i)=>({u_pixel_extrude_scale:new l.bH(v,i.u_pixel_extrude_scale)}),collisionCircle:(v,i)=>({u_viewport_size:new l.bH(v,i.u_viewport_size)}),debug:(v,i)=>({u_color:new l.bF(v,i.u_color),u_overlay:new l.bC(v,i.u_overlay),u_overlay_scale:new l.b5(v,i.u_overlay_scale)}),depth:cl,clippingMask:cl,heatmap:(v,i)=>({u_extrude_scale:new l.b5(v,i.u_extrude_scale),u_intensity:new l.b5(v,i.u_intensity),u_globe_extrude_scale:new l.b5(v,i.u_globe_extrude_scale)}),heatmapTexture:(v,i)=>({u_matrix:new l.bD(v,i.u_matrix),u_world:new l.bH(v,i.u_world),u_image:new l.bC(v,i.u_image),u_color_ramp:new l.bC(v,i.u_color_ramp),u_opacity:new l.b5(v,i.u_opacity)}),hillshade:(v,i)=>({u_image:new l.bC(v,i.u_image),u_latrange:new l.bH(v,i.u_latrange),u_light:new l.bH(v,i.u_light),u_shadow:new l.bF(v,i.u_shadow),u_highlight:new l.bF(v,i.u_highlight),u_accent:new l.bF(v,i.u_accent)}),hillshadePrepare:(v,i)=>({u_matrix:new l.bD(v,i.u_matrix),u_image:new l.bC(v,i.u_image),u_dimension:new l.bH(v,i.u_dimension),u_zoom:new l.b5(v,i.u_zoom),u_unpack:new l.bE(v,i.u_unpack)}),line:(v,i)=>({u_translation:new l.bH(v,i.u_translation),u_ratio:new l.b5(v,i.u_ratio),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_units_to_pixels:new l.bH(v,i.u_units_to_pixels)}),lineGradient:(v,i)=>({u_translation:new l.bH(v,i.u_translation),u_ratio:new l.b5(v,i.u_ratio),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_units_to_pixels:new l.bH(v,i.u_units_to_pixels),u_image:new l.bC(v,i.u_image),u_image_height:new l.b5(v,i.u_image_height)}),linePattern:(v,i)=>({u_translation:new l.bH(v,i.u_translation),u_texsize:new l.bH(v,i.u_texsize),u_ratio:new l.b5(v,i.u_ratio),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_image:new l.bC(v,i.u_image),u_units_to_pixels:new l.bH(v,i.u_units_to_pixels),u_scale:new l.bG(v,i.u_scale),u_fade:new l.b5(v,i.u_fade)}),lineSDF:(v,i)=>({u_translation:new l.bH(v,i.u_translation),u_ratio:new l.b5(v,i.u_ratio),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_units_to_pixels:new l.bH(v,i.u_units_to_pixels),u_patternscale_a:new l.bH(v,i.u_patternscale_a),u_patternscale_b:new l.bH(v,i.u_patternscale_b),u_sdfgamma:new l.b5(v,i.u_sdfgamma),u_image:new l.bC(v,i.u_image),u_tex_y_a:new l.b5(v,i.u_tex_y_a),u_tex_y_b:new l.b5(v,i.u_tex_y_b),u_mix:new l.b5(v,i.u_mix)}),raster:(v,i)=>({u_tl_parent:new l.bH(v,i.u_tl_parent),u_scale_parent:new l.b5(v,i.u_scale_parent),u_buffer_scale:new l.b5(v,i.u_buffer_scale),u_fade_t:new l.b5(v,i.u_fade_t),u_opacity:new l.b5(v,i.u_opacity),u_image0:new l.bC(v,i.u_image0),u_image1:new l.bC(v,i.u_image1),u_brightness_low:new l.b5(v,i.u_brightness_low),u_brightness_high:new l.b5(v,i.u_brightness_high),u_saturation_factor:new l.b5(v,i.u_saturation_factor),u_contrast_factor:new l.b5(v,i.u_contrast_factor),u_spin_weights:new l.bG(v,i.u_spin_weights),u_coords_top:new l.bE(v,i.u_coords_top),u_coords_bottom:new l.bE(v,i.u_coords_bottom)}),symbolIcon:(v,i)=>({u_is_size_zoom_constant:new l.bC(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bC(v,i.u_is_size_feature_constant),u_size_t:new l.b5(v,i.u_size_t),u_size:new l.b5(v,i.u_size),u_camera_to_center_distance:new l.b5(v,i.u_camera_to_center_distance),u_pitch:new l.b5(v,i.u_pitch),u_rotate_symbol:new l.bC(v,i.u_rotate_symbol),u_aspect_ratio:new l.b5(v,i.u_aspect_ratio),u_fade_change:new l.b5(v,i.u_fade_change),u_label_plane_matrix:new l.bD(v,i.u_label_plane_matrix),u_coord_matrix:new l.bD(v,i.u_coord_matrix),u_is_text:new l.bC(v,i.u_is_text),u_pitch_with_map:new l.bC(v,i.u_pitch_with_map),u_is_along_line:new l.bC(v,i.u_is_along_line),u_is_variable_anchor:new l.bC(v,i.u_is_variable_anchor),u_texsize:new l.bH(v,i.u_texsize),u_texture:new l.bC(v,i.u_texture),u_translation:new l.bH(v,i.u_translation),u_pitched_scale:new l.b5(v,i.u_pitched_scale)}),symbolSDF:(v,i)=>({u_is_size_zoom_constant:new l.bC(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bC(v,i.u_is_size_feature_constant),u_size_t:new l.b5(v,i.u_size_t),u_size:new l.b5(v,i.u_size),u_camera_to_center_distance:new l.b5(v,i.u_camera_to_center_distance),u_pitch:new l.b5(v,i.u_pitch),u_rotate_symbol:new l.bC(v,i.u_rotate_symbol),u_aspect_ratio:new l.b5(v,i.u_aspect_ratio),u_fade_change:new l.b5(v,i.u_fade_change),u_label_plane_matrix:new l.bD(v,i.u_label_plane_matrix),u_coord_matrix:new l.bD(v,i.u_coord_matrix),u_is_text:new l.bC(v,i.u_is_text),u_pitch_with_map:new l.bC(v,i.u_pitch_with_map),u_is_along_line:new l.bC(v,i.u_is_along_line),u_is_variable_anchor:new l.bC(v,i.u_is_variable_anchor),u_texsize:new l.bH(v,i.u_texsize),u_texture:new l.bC(v,i.u_texture),u_gamma_scale:new l.b5(v,i.u_gamma_scale),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_is_halo:new l.bC(v,i.u_is_halo),u_translation:new l.bH(v,i.u_translation),u_pitched_scale:new l.b5(v,i.u_pitched_scale)}),symbolTextAndIcon:(v,i)=>({u_is_size_zoom_constant:new l.bC(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bC(v,i.u_is_size_feature_constant),u_size_t:new l.b5(v,i.u_size_t),u_size:new l.b5(v,i.u_size),u_camera_to_center_distance:new l.b5(v,i.u_camera_to_center_distance),u_pitch:new l.b5(v,i.u_pitch),u_rotate_symbol:new l.bC(v,i.u_rotate_symbol),u_aspect_ratio:new l.b5(v,i.u_aspect_ratio),u_fade_change:new l.b5(v,i.u_fade_change),u_label_plane_matrix:new l.bD(v,i.u_label_plane_matrix),u_coord_matrix:new l.bD(v,i.u_coord_matrix),u_is_text:new l.bC(v,i.u_is_text),u_pitch_with_map:new l.bC(v,i.u_pitch_with_map),u_is_along_line:new l.bC(v,i.u_is_along_line),u_is_variable_anchor:new l.bC(v,i.u_is_variable_anchor),u_texsize:new l.bH(v,i.u_texsize),u_texsize_icon:new l.bH(v,i.u_texsize_icon),u_texture:new l.bC(v,i.u_texture),u_texture_icon:new l.bC(v,i.u_texture_icon),u_gamma_scale:new l.b5(v,i.u_gamma_scale),u_device_pixel_ratio:new l.b5(v,i.u_device_pixel_ratio),u_is_halo:new l.bC(v,i.u_is_halo),u_translation:new l.bH(v,i.u_translation),u_pitched_scale:new l.b5(v,i.u_pitched_scale)}),background:(v,i)=>({u_opacity:new l.b5(v,i.u_opacity),u_color:new l.bF(v,i.u_color)}),backgroundPattern:(v,i)=>({u_opacity:new l.b5(v,i.u_opacity),u_image:new l.bC(v,i.u_image),u_pattern_tl_a:new l.bH(v,i.u_pattern_tl_a),u_pattern_br_a:new l.bH(v,i.u_pattern_br_a),u_pattern_tl_b:new l.bH(v,i.u_pattern_tl_b),u_pattern_br_b:new l.bH(v,i.u_pattern_br_b),u_texsize:new l.bH(v,i.u_texsize),u_mix:new l.b5(v,i.u_mix),u_pattern_size_a:new l.bH(v,i.u_pattern_size_a),u_pattern_size_b:new l.bH(v,i.u_pattern_size_b),u_scale_a:new l.b5(v,i.u_scale_a),u_scale_b:new l.b5(v,i.u_scale_b),u_pixel_coord_upper:new l.bH(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.bH(v,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.b5(v,i.u_tile_units_to_pixels)}),terrain:(v,i)=>({u_texture:new l.bC(v,i.u_texture),u_ele_delta:new l.b5(v,i.u_ele_delta),u_fog_matrix:new l.bD(v,i.u_fog_matrix),u_fog_color:new l.bF(v,i.u_fog_color),u_fog_ground_blend:new l.b5(v,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.b5(v,i.u_fog_ground_blend_opacity),u_horizon_color:new l.bF(v,i.u_horizon_color),u_horizon_fog_blend:new l.b5(v,i.u_horizon_fog_blend),u_is_globe_mode:new l.b5(v,i.u_is_globe_mode)}),terrainDepth:(v,i)=>({u_ele_delta:new l.b5(v,i.u_ele_delta)}),terrainCoords:(v,i)=>({u_texture:new l.bC(v,i.u_texture),u_terrain_coords_id:new l.b5(v,i.u_terrain_coords_id),u_ele_delta:new l.b5(v,i.u_ele_delta)}),projectionErrorMeasurement:(v,i)=>({u_input:new l.b5(v,i.u_input),u_output_expected:new l.b5(v,i.u_output_expected)}),atmosphere:(v,i)=>({u_sun_pos:new l.bG(v,i.u_sun_pos),u_atmosphere_blend:new l.b5(v,i.u_atmosphere_blend),u_globe_position:new l.bG(v,i.u_globe_position),u_globe_radius:new l.b5(v,i.u_globe_radius),u_inv_proj_matrix:new l.bD(v,i.u_inv_proj_matrix)}),sky:(v,i)=>({u_sky_color:new l.bF(v,i.u_sky_color),u_horizon_color:new l.bF(v,i.u_horizon_color),u_horizon:new l.bH(v,i.u_horizon),u_horizon_normal:new l.bH(v,i.u_horizon_normal),u_sky_horizon_blend:new l.b5(v,i.u_sky_horizon_blend),u_sky_blend:new l.b5(v,i.u_sky_blend)})};class Mu{constructor(i,a,m){this.context=i;const g=i.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ao{constructor(i,a,m,g){this.length=a.length,this.attributes=m,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.context=i;const x=i.gl;this.buffer=x.createBuffer(),i.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let m=0;m<this.attributes.length;m++){const g=a.attributes[this.attributes[m].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,a,m){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],T=a.attributes[x.name];T!==void 0&&i.vertexAttribPointer(T,x.components,i[hl[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kl extends jn{getDefault(){return l.b4.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Fp extends jn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class ra extends jn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Ru extends jn{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class $d extends jn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class bc extends jn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class dl extends jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Xl extends jn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class fl extends jn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class Ca extends jn{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Fo extends jn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class Aa extends jn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class ws extends jn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class qd extends jn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Lu extends jn{getDefault(){return l.b4.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class kh extends jn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ka extends jn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class Tc extends jn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Du extends jn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class zu extends jn{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class bs extends jn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Nu extends jn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Yl extends jn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class sa extends jn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Hd extends jn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Sc extends jn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Nn extends jn{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ma extends jn{getDefault(){return null}set(i){var a;if(i===this.current&&!this.dirty)return;const m=this.gl;Mi(m)?m.bindVertexArray(i):(a=m.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Bp extends jn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class pl extends jn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ql extends jn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ec extends jn{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class Vp extends Ec{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Bo extends Ec{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Gd extends Ec{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}const Ou="Framebuffer is not complete";class Ra{constructor(i,a,m,g,x){this.context=i,this.width=a,this.height=m;const T=i.gl,C=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Vp(i,C),g)this.depthAttachment=x?new Gd(i,C):new Bo(i,C);else if(x)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error(Ou)}destroy(){const i=this.context.gl,a=this.colorAttachment.get();if(a&&i.deleteTexture(a),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class Ic{constructor(i){var a,m;if(this.gl=i,this.clearColor=new Kl(this),this.clearDepth=new Fp(this),this.clearStencil=new ra(this),this.colorMask=new Ru(this),this.depthMask=new $d(this),this.stencilMask=new bc(this),this.stencilFunc=new dl(this),this.stencilOp=new Xl(this),this.stencilTest=new fl(this),this.depthRange=new Ca(this),this.depthTest=new Fo(this),this.depthFunc=new Aa(this),this.blend=new ws(this),this.blendFunc=new qd(this),this.blendColor=new Lu(this),this.blendEquation=new kh(this),this.cullFace=new ka(this),this.cullFaceSide=new Tc(this),this.frontFace=new Du(this),this.program=new zu(this),this.activeTexture=new bs(this),this.viewport=new Nu(this),this.bindFramebuffer=new Yl(this),this.bindRenderbuffer=new sa(this),this.bindTexture=new Hd(this),this.bindVertexBuffer=new Sc(this),this.bindElementBuffer=new Nn(this),this.bindVertexArray=new Ma(this),this.pixelStoreUnpack=new Bp(this),this.pixelStoreUnpackPremultiplyAlpha=new pl(this),this.pixelStoreUnpackFlipY=new Ql(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Mi(i)){this.HALF_FLOAT=i.HALF_FLOAT;const g=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=i.RGBA16F)!==null&&a!==void 0?a:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(m=i.RGB16F)!==null&&m!==void 0?m:g==null?void 0:g.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const g=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a){return new Mu(this,i,a)}createVertexBuffer(i,a,m){return new ao(this,i,a,m)}createRenderbuffer(i,a,m){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,i,a,m),this.bindRenderbuffer.set(null),x}createFramebuffer(i,a,m,g){return new Ra(this,i,a,m,g)}clear({color:i,depth:a,stencil:m}){const g=this.gl;let x=0;i&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),m!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(x)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.bz(i.blendFunction,Mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Mi(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var a;return Mi(this.gl)?this.gl.deleteVertexArray(i):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}let oa;function La(v,i,a,m,g){const x=v.context,T=v.transform,C=x.gl,M=v.useProgram("collisionBox"),z=[];let V=0,q=0;for(let xe=0;xe<m.length;xe++){const be=m[xe],Ce=i.getTile(be).getBucket(a);if(!Ce)continue;const ke=g?Ce.textCollisionBox:Ce.iconCollisionBox,Re=Ce.collisionCircleArray;Re.length>0&&(z.push({circleArray:Re,circleOffset:q,coord:be}),V+=Re.length/4,q=V),ke&&M.draw(x,C.LINES,Wt.disabled,fn.disabled,v.colorModeForRenderPass(),xn.disabled,F(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(be),T.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,v.transform.zoom,null,null,ke.collisionVertexBuffer)}if(!g||!z.length)return;const Z=v.useProgram("collisionCircle"),J=new l.bM;J.resize(4*V),J._trim();let ne=0;for(const xe of z)for(let be=0;be<xe.circleArray.length/4;be++){const Ce=4*be,ke=xe.circleArray[Ce+0],Re=xe.circleArray[Ce+1],ze=xe.circleArray[Ce+2],De=xe.circleArray[Ce+3];J.emplace(ne++,ke,Re,ze,De,0),J.emplace(ne++,ke,Re,ze,De,1),J.emplace(ne++,ke,Re,ze,De,2),J.emplace(ne++,ke,Re,ze,De,3)}(!oa||oa.length<2*V)&&(oa=function(xe){const be=2*xe,Ce=new l.bO;Ce.resize(be),Ce._trim();for(let ke=0;ke<be;ke++){const Re=6*ke;Ce.uint16[Re+0]=4*ke+0,Ce.uint16[Re+1]=4*ke+1,Ce.uint16[Re+2]=4*ke+2,Ce.uint16[Re+3]=4*ke+2,Ce.uint16[Re+4]=4*ke+3,Ce.uint16[Re+5]=4*ke+0}return Ce}(V));const ye=x.createIndexBuffer(oa,!0),_e=x.createVertexBuffer(J,l.bN.members,!0);for(const xe of z){const be=W(v.transform);Z.draw(x,C.TRIANGLES,Wt.disabled,fn.disabled,v.colorModeForRenderPass(),xn.disabled,be,v.style.map.terrain&&v.style.map.terrain.getTerrainData(xe.coord),null,a.id,_e,ye,l.aD.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,v.transform.zoom,null,null,null)}_e.destroy(),ye.destroy()}const Mh=l.aq(new Float32Array(16));function Fu(v,i,a,m,g,x){const{horizontalAlign:T,verticalAlign:C}=l.ay(v);return new l.P((-(T-.5)*i/g+m[0])*x,(-(C-.5)*a/g+m[1])*x)}function Pc(v,i,a,m,g,x){const T=i.tileAnchorPoint.add(new l.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let C=m.mult(x);a||(C=C.rotate(-g));const M=T.add(C);return Ye(M.x,M.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(a){const C=Ct(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(v),M=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return v.add(m.rotate(M))}return v.add(m)}function Cc(v,i,a,m,g,x,T,C,M,z,V,q){const Z=v.text.placedSymbolArray,J=v.text.dynamicLayoutVertexArray,ne=v.icon.dynamicLayoutVertexArray,ye={};J.clear();for(let _e=0;_e<Z.length;_e++){const xe=Z.get(_e),be=xe.hidden||!xe.crossTileID||v.allowVerticalPlacement&&!xe.placedOrientation?null:m[xe.crossTileID];if(be){const Ce=new l.P(xe.anchorX,xe.anchorY),ke={getElevation:q,width:g.width,height:g.height,pitchedLabelPlaneMatrix:x,lineVertexArray:null,pitchWithMap:a,transform:g,projectionCache:null,tileAnchorPoint:Ce,translation:z,unwrappedTileID:V},Re=a?hn(Ce.x,Ce.y,ke):Ct(Ce.x,Ce.y,ke),ze=Ue(g.cameraToCenterDistance,Re.signedDistanceFromCamera);let De=l.aj(v.textSizeData,C,xe)*ze/l.as;a&&(De*=v.tilePixelRatio/T);const{width:Ze,height:Ke,anchor:st,textOffset:at,textBoxScale:tt}=be,St=Fu(st,Ze,Ke,at,tt,De),bt=g.getPitchedTextCorrection(Ce.x+z[0],Ce.y+z[1],V),ht=Pc(Re.point,ke,i,St,-g.bearingInRadians,bt),It=v.allowVerticalPlacement&&xe.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let pn=0;pn<xe.numGlyphs;pn++)l.ak(J,ht,It);M&&xe.associatedIconIndex>=0&&(ye[xe.associatedIconIndex]={shiftedAnchor:ht,angle:It})}else Si(xe.numGlyphs,J)}if(M){ne.clear();const _e=v.icon.placedSymbolArray;for(let xe=0;xe<_e.length;xe++){const be=_e.get(xe);if(be.hidden)Si(be.numGlyphs,ne);else{const Ce=ye[xe];if(Ce)for(let ke=0;ke<be.numGlyphs;ke++)l.ak(ne,Ce.shiftedAnchor,Ce.angle);else Si(be.numGlyphs,ne)}}v.icon.dynamicLayoutVertexBuffer.updateData(ne)}v.text.dynamicLayoutVertexBuffer.updateData(J)}function Zd(v,i,a){return a.iconsInText&&i?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Bu(v,i,a,m,g,x,T,C,M,z,V,q,Z){const J=v.context,ne=J.gl,ye=v.transform,_e=C==="map",xe=M==="map",be=C!=="viewport"&&a.layout.get("symbol-placement")!=="point",Ce=_e&&!xe&&!be,ke=!a.layout.get("symbol-sort-key").isConstant();let Re=!1;const ze=v.getDepthModeForSublayer(0,Wt.ReadOnly),De=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ze=[],Ke=ye.getCircleRadiusCorrection();for(const st of m){const at=i.getTile(st),tt=at.getBucket(a);if(!tt)continue;const St=g?tt.text:tt.icon;if(!St||!St.segments.get().length||!St.hasVisibleVertices)continue;const bt=St.programConfigurations.get(a.id),ht=g||tt.sdfIcons,It=g?tt.textSizeData:tt.iconSizeData,pn=xe||ye.pitch!==0,Fn=v.useProgram(Zd(ht,g,tt),bt),Ni=l.ah(It,ye.zoom),hi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(st);let Oi,di,ai,fi,Zr=[0,0],fr=null;if(g)di=at.glyphAtlasTexture,ai=ne.LINEAR,Oi=at.glyphAtlasTexture.size,tt.iconsInText&&(Zr=at.imageAtlasTexture.size,fr=at.imageAtlasTexture,fi=pn||v.options.rotating||v.options.zooming||It.kind==="composite"||It.kind==="camera"?ne.LINEAR:ne.NEAREST);else{const pi=a.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;di=at.imageAtlasTexture,ai=ht||v.options.rotating||v.options.zooming||pi||pn?ne.LINEAR:ne.NEAREST,Oi=at.imageAtlasTexture.size}const pr=l.at(at,1,v.transform.zoom),Ts=He(_e,v.transform,pr),xl=l.H();l.an(xl,Ts);const Oa=Fe(xe,_e,v.transform,pr),uo=l.au(ye,at,x,T),wl=ye.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Zh=De&&tt.hasTextData(),Wh=a.layout.get("icon-text-fit")!=="none"&&Zh&&tt.hasIconData();if(be){const pi=v.style.map.terrain?(ho,Bi)=>v.style.map.terrain.getElevation(st,ho,Bi):null,Fi=a.layout.get("text-rotation-alignment")==="map";yt(tt,v,g,Ts,xl,xe,z,Fi,st.toUnwrapped(),ye.width,ye.height,uo,pi)}const Nc=g&&De||Wh,Hs=be||Nc?Mh:xe?Ts:v.transform.clipSpaceToPixelsMatrix,Vo=ht&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jo;jo=ht?tt.iconsInText?$s(It.kind,Ni,Ce,xe,be,Nc,v,Hs,Oa,uo,Oi,Zr,Ke):Wl(It.kind,Ni,Ce,xe,be,Nc,v,Hs,Oa,uo,g,Oi,0,Ke):ul(It.kind,Ni,Ce,xe,be,Nc,v,Hs,Oa,uo,g,Oi,Ke);const co={program:Fn,buffers:St,uniformValues:jo,projectionData:wl,atlasTexture:di,atlasTextureIcon:fr,atlasInterpolation:ai,atlasInterpolationIcon:fi,isSDF:ht,hasHalo:Vo};if(ke&&tt.canOverlap){Re=!0;const pi=St.segments.get();for(const Fi of pi)Ze.push({segments:new l.aD([Fi]),sortKey:Fi.sortKey,state:co,terrainData:hi})}else Ze.push({segments:St.segments,sortKey:0,state:co,terrainData:hi})}Re&&Ze.sort((st,at)=>st.sortKey-at.sortKey);for(const st of Ze){const at=st.state;if(J.activeTexture.set(ne.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,ne.CLAMP_TO_EDGE),at.atlasTextureIcon&&(J.activeTexture.set(ne.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),at.isSDF){const tt=at.uniformValues;at.hasHalo&&(tt.u_is_halo=1,Rh(at.buffers,st.segments,a,v,at.program,ze,V,q,tt,at.projectionData,st.terrainData)),tt.u_is_halo=0}Rh(at.buffers,st.segments,a,v,at.program,ze,V,q,at.uniformValues,at.projectionData,st.terrainData)}}function Rh(v,i,a,m,g,x,T,C,M,z,V){const q=m.context;g.draw(q,q.gl.TRIANGLES,x,T,C,xn.backCCW,M,V,z,a.id,v.layoutVertexBuffer,v.indexBuffer,i,a.paint,m.transform.zoom,v.programConfigurations.get(a.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Lh(v,i,a,m,g){const x=v.context,T=x.gl,C=fn.disabled,M=new Mn([T.ONE,T.ONE],l.b4.transparent,[!0,!0,!0,!0]),z=i.getBucket(a);if(!z)return;const V=m.key;let q=a.heatmapFbos.get(V);q||(q=Vu(x,i.tileSize,i.tileSize),a.heatmapFbos.set(V,q)),x.bindFramebuffer.set(q.framebuffer),x.viewport.set([0,0,i.tileSize,i.tileSize]),x.clear({color:l.b4.transparent});const Z=z.programConfigurations.get(a.id),J=v.useProgram("heatmap",Z,!g),ne=v.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ye=v.style.map.terrain.getTerrainData(m);J.draw(x,T.TRIANGLES,Wt.disabled,C,M,xn.disabled,$e(i,v.transform.zoom,a.paint.get("heatmap-intensity"),1),ye,ne,a.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,a.paint,v.transform.zoom,Z)}function Ac(v,i,a,m,g){const x=v.context,T=x.gl,C=v.transform;x.setColorMode(v.colorModeForRenderPass());const M=kc(x,i),z=a.key,V=i.heatmapFbos.get(z);if(!V)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,V.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1),M.bind(T.LINEAR,T.CLAMP_TO_EDGE);const q=C.getProjectionData({overscaledTileID:a,applyTerrainMatrix:g,applyGlobeMatrix:!m});v.useProgram("heatmapTexture").draw(x,T.TRIANGLES,Wt.disabled,fn.disabled,v.colorModeForRenderPass(),xn.disabled,Je(v,i,0,1),null,q,i.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,i.paint,C.zoom),V.destroy(),i.heatmapFbos.delete(z)}function Vu(v,i,a){var m,g;const x=v.gl,T=x.createTexture();x.bindTexture(x.TEXTURE_2D,T),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const C=(m=v.HALF_FLOAT)!==null&&m!==void 0?m:x.UNSIGNED_BYTE,M=(g=v.RGBA16F)!==null&&g!==void 0?g:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,M,i,a,0,x.RGBA,C,null);const z=v.createFramebuffer(i,a,!1,!1);return z.colorAttachment.set(T),z}function kc(v,i){return i.colorRampTexture||(i.colorRampTexture=new Q(v,i.colorRamp,v.gl.RGBA)),i.colorRampTexture}function Dh(v,i,a,m,g){if(!a||!m||!m.imageAtlas)return;const x=m.imageAtlas.patternPositions;let T=x[a.to.toString()],C=x[a.from.toString()];if(!T&&C&&(T=C),!C&&T&&(C=T),!T||!C){const M=g.getPaintProperty(i);T=x[M],C=x[M]}T&&C&&v.setConstantPatternPositions(T,C)}function d(v,i,a,m,g,x,T,C){const M=v.context.gl,z="fill-pattern",V=a.paint.get(z),q=V&&V.constantOr(1),Z=a.getCrossfadeParameters();let J,ne,ye,_e,xe;const be=v.transform,Ce=a.paint.get("fill-translate"),ke=a.paint.get("fill-translate-anchor");T?(ne=q&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=M.LINES):(ne=q?"fillPattern":"fill",J=M.TRIANGLES);const Re=V.constantOr(null);for(const ze of m){const De=i.getTile(ze);if(q&&!De.patternsLoaded())continue;const Ze=De.getBucket(a);if(!Ze)continue;const Ke=Ze.programConfigurations.get(a.id),st=v.useProgram(ne,Ke),at=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ze);q&&(v.context.activeTexture.set(M.TEXTURE0),De.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ke.updatePaintBuffers(Z)),Dh(Ke,z,Re,De,a);const tt=be.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),St=l.au(be,De,Ce,ke);if(T){_e=Ze.indexBuffer2,xe=Ze.segments2;const ht=[M.drawingBufferWidth,M.drawingBufferHeight];ye=ne==="fillOutlinePattern"&&q?xs(v,Z,De,ht,St):wc(ht,St)}else _e=Ze.indexBuffer,xe=Ze.segments,ye=q?Us(v,Z,De,St):{u_fill_translate:St};let bt;if(v.renderPass==="translucent"&&C){const[ht]=v.getStencilConfigForOverlapAndUpdateStencilID(m);bt=ht[ze.overscaledZ]}else bt=v.stencilModeForClipping(ze);st.draw(v.context,J,g,bt,x,xn.backCCW,ye,at,tt,a.id,Ze.layoutVertexBuffer,_e,xe,a.paint,v.transform.zoom,Ke)}}function y(v,i,a,m,g,x,T,C){const M=v.context,z=M.gl,V="fill-extrusion-pattern",q=a.paint.get(V),Z=q.constantOr(1),J=a.getCrossfadeParameters(),ne=a.paint.get("fill-extrusion-opacity"),ye=q.constantOr(null),_e=v.transform;for(const xe of m){const be=i.getTile(xe),Ce=be.getBucket(a);if(!Ce)continue;const ke=v.style.map.terrain&&v.style.map.terrain.getTerrainData(xe),Re=Ce.programConfigurations.get(a.id),ze=v.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",Re);Z&&(v.context.activeTexture.set(z.TEXTURE0),be.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Re.updatePaintBuffers(J));const De=_e.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!C,applyTerrainMatrix:!0});Dh(Re,V,ye,be,a);const Ze=l.au(_e,be,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ke=a.paint.get("fill-extrusion-vertical-gradient"),st=Z?dr(v,Ke,ne,Ze,xe,J,be):vs(v,Ke,ne,Ze);ze.draw(M,M.gl.TRIANGLES,g,x,T,xn.backCCW,st,ke,De,a.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,a.paint,v.transform.zoom,Re,v.style.map.terrain&&Ce.centroidVertexBuffer)}}function P(v,i,a,m,g,x,T,C,M){var z;const V=v.style.projection,q=v.context,Z=v.transform,J=q.gl,ne=v.useProgram("hillshade"),ye=!v.options.moving;for(const _e of m){const xe=i.getTile(_e),be=xe.fbo;if(!be)continue;const Ce=V.getMeshFromTileID(q,_e.canonical,C,!0,"raster"),ke=(z=v.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(_e);q.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,be.colorAttachment.get());const Re=Z.getProjectionData({overscaledTileID:_e,aligned:ye,applyGlobeMatrix:!M,applyTerrainMatrix:!0});ne.draw(q,J.TRIANGLES,x,g[_e.overscaledZ],T,xn.backCCW,At(v,xe,a),ke,Re,a.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}const D=[new l.P(0,0),new l.P(l.X,0),new l.P(l.X,l.X),new l.P(0,l.X)];function j(v,i,a,m,g,x,T,C,M=!1,z=!1){const V=m[m.length-1].overscaledZ,q=v.context,Z=q.gl,J=v.useProgram("raster"),ne=v.transform,ye=v.style.projection,_e=v.colorModeForRenderPass(),xe=!v.options.moving;for(const be of m){const Ce=v.getDepthModeForSublayer(be.overscaledZ-V,a.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,Z.LESS),ke=i.getTile(be);ke.registerFadeDuration(a.paint.get("raster-fade-duration"));const Re=i.findLoadedParent(be,0),ze=i.findLoadedSibling(be),De=se(ke,Re||ze||null,i,a,v.transform,v.style.map.terrain);let Ze,Ke;const st=a.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;q.activeTexture.set(Z.TEXTURE0),ke.texture.bind(st,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(Z.TEXTURE1),Re?(Re.texture.bind(st,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),Ze=Math.pow(2,Re.tileID.overscaledZ-ke.tileID.overscaledZ),Ke=[ke.tileID.canonical.x*Ze%1,ke.tileID.canonical.y*Ze%1]):ke.texture.bind(st,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),ke.texture.useMipmap&&q.extTextureFilterAnisotropic&&v.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const at=v.style.map.terrain&&v.style.map.terrain.getTerrainData(be),tt=ne.getProjectionData({overscaledTileID:be,aligned:xe,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),St=oo(Ke||[0,0],Ze||1,De,a,C),bt=ye.getMeshFromTileID(q,be.canonical,x,T,"raster");J.draw(q,Z.TRIANGLES,Ce,g?g[be.overscaledZ]:fn.disabled,_e,M?xn.frontCCW:xn.backCCW,St,at,tt,a.id,bt.vertexBuffer,bt.indexBuffer,bt.segments)}}function se(v,i,a,m,g,x){const T=m.paint.get("raster-fade-duration");if(!x&&T>0){const C=H.now(),M=(C-v.timeAdded)/T,z=i?(C-i.timeAdded)/T:-1,V=a.getSource(),q=fs(g,{tileSize:V.tileSize,roundZoom:V.roundZoom}),Z=!i||Math.abs(i.tileID.overscaledZ-q)>Math.abs(v.tileID.overscaledZ-q),J=Z&&v.refreshedUponExpiration?1:l.ab(Z?M:1-z,0,1);return v.refreshedUponExpiration&&M>=1&&(v.refreshedUponExpiration=!1),i?{opacity:1,mix:1-J}:{opacity:J,mix:0}}return{opacity:1,mix:0}}const Ae=new l.b4(1,0,0,1),Ge=new l.b4(0,1,0,1),et=new l.b4(0,0,1,1),pt=new l.b4(1,0,1,1),Dt=new l.b4(0,1,1,1);function en(v,i,a,m){nr(v,0,i+a/2,v.transform.width,a,m)}function bn(v,i,a,m){nr(v,i-a/2,0,a,v.transform.height,m)}function nr(v,i,a,m,g,x){const T=v.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(i*v.pixelRatio,a*v.pixelRatio,m*v.pixelRatio,g*v.pixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}function ir(v,i,a){const m=v.context,g=m.gl,x=v.useProgram("debug"),T=Wt.disabled,C=fn.disabled,M=v.colorModeForRenderPass(),z="$debug",V=v.style.map.terrain&&v.style.map.terrain.getTerrainData(a);m.activeTexture.set(g.TEXTURE0);const q=i.getTileByID(a.key).latestRawTileData,Z=Math.floor((q&&q.byteLength||0)/1024),J=i.getTile(a).tileSize,ne=512/Math.min(J,512)*(a.overscaledZ/v.transform.zoom)*.5;let ye=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ye+=` => ${a.overscaledZ}`),function(xe,be){xe.initDebugOverlayCanvas();const Ce=xe.debugOverlayCanvas,ke=xe.context.gl,Re=xe.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ce.width,Ce.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(be,5,5),Re.strokeText(be,5,5),xe.debugOverlayTexture.update(Ce),xe.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}(v,`${ye} ${Z}kB`);const _e=v.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(m,g.TRIANGLES,T,C,Mn.alphaBlended,xn.disabled,de(l.b4.transparent,ne),null,_e,z,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),x.draw(m,g.LINE_STRIP,T,C,M,xn.disabled,de(l.b4.red),V,_e,z,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function rs(v,i,a,m){const{isRenderingGlobe:g}=m,x=v.context,T=x.gl,C=v.transform,M=v.colorModeForRenderPass(),z=v.getDepthModeFor3D(),V=v.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,v.width,v.height]);for(const q of a){const Z=i.getTerrainMesh(q.tileID),J=v.renderToTexture.getTexture(q),ne=i.getTerrainData(q.tileID);x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,J.texture);const ye=i.getMeshFrameDelta(C.zoom),_e=C.calculateFogMatrix(q.tileID.toUnwrapped()),xe=ys(ye,_e,v.style.sky,C.pitch,g),be=C.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});V.draw(x,T.TRIANGLES,z,fn.disabled,M,xn.backCCW,xe,ne,be,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}function kr(v,i){if(!i.mesh){const a=new l.aC;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const m=new l.aE;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),i.mesh=new Ur(v.createVertexBuffer(a,ln.members),v.createIndexBuffer(m),l.aD.simpleSegment(0,0,a.length,m.length))}return i.mesh}class ml{constructor(i,a){this.context=new Ic(i),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ee.maxUnderzooming+ee.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wn}resize(i,a,m){if(this.width=Math.floor(i*m),this.height=Math.floor(a*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const i=this.context,a=new l.aC;a.emplaceBack(0,0),a.emplaceBack(l.X,0),a.emplaceBack(0,l.X),a.emplaceBack(l.X,l.X),this.tileExtentBuffer=i.createVertexBuffer(a,ln.members),this.tileExtentSegments=l.aD.simpleSegment(0,0,4,2);const m=new l.aC;m.emplaceBack(0,0),m.emplaceBack(l.X,0),m.emplaceBack(0,l.X),m.emplaceBack(l.X,l.X),this.debugBuffer=i.createVertexBuffer(m,ln.members),this.debugSegments=l.aD.simpleSegment(0,0,4,5);const g=new l.bT;g.emplaceBack(0,0,0,0),g.emplaceBack(l.X,0,l.X,0),g.emplaceBack(0,l.X,0,l.X),g.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=i.createVertexBuffer(g,ku.members),this.rasterBoundsSegments=l.aD.simpleSegment(0,0,4,2);const x=new l.aC;x.emplaceBack(0,0),x.emplaceBack(l.X,0),x.emplaceBack(0,l.X),x.emplaceBack(l.X,l.X),this.rasterBoundsBufferPosOnly=i.createVertexBuffer(x,ln.members),this.rasterBoundsSegmentsPosOnly=l.aD.simpleSegment(0,0,4,5);const T=new l.aC;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(T,ln.members),this.viewportSegments=l.aD.simpleSegment(0,0,4,2);const C=new l.bU;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(C);const M=new l.aE;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(M);const z=this.context.gl;this.stencilClearMode=new fn({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new Ur(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const i=this.context,a=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.H();l.bL(m,0,this.width,this.height,0,0,1),l.K(m,m,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const g={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(i,a.TRIANGLES,Wt.disabled,this.stencilClearMode,Mn.disabled,xn.disabled,null,null,g,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,a,m){if(this.currentStencilSource===i.source||!i.isTileClipped()||!a||!a.length)return;this.currentStencilSource=i.source,this.nextStencilID+a.length>256&&this.clearStencil();const g=this.context;g.setColorMode(Mn.disabled),g.setDepthMode(Wt.disabled);const x={};for(const T of a)x[T.key]=this.nextStencilID++;this._renderTileMasks(x,a,m,!0),this._renderTileMasks(x,a,m,!1),this._tileClippingMaskIDs=x}_renderTileMasks(i,a,m,g){const x=this.context,T=x.gl,C=this.style.projection,M=this.transform,z=this.useProgram("clippingMask");for(const V of a){const q=i[V.key],Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(V),J=C.getMeshFromTileID(this.context,V.canonical,g,!0,"stencil"),ne=M.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!0,applyTerrainMatrix:!0});z.draw(x,T.TRIANGLES,Wt.disabled,new fn({func:T.ALWAYS,mask:0},q,255,T.KEEP,T.KEEP,T.REPLACE),Mn.disabled,m?xn.disabled:xn.backCCW,null,Z,ne,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}_renderTilesDepthBuffer(){const i=this.context,a=i.gl,m=this.style.projection,g=this.transform,x=this.useProgram("depth"),T=this.getDepthModeFor3D(),C=pe(g,{tileSize:g.tileSize});for(const M of C){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),V=m.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),q=g.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(i,a.TRIANGLES,T,fn.disabled,Mn.disabled,xn.backCCW,null,z,q,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new fn({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){const a=this.context.gl;return new fn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(i){const a=this.context.gl,m=i.sort((T,C)=>C.overscaledZ-T.overscaledZ),g=m[m.length-1].overscaledZ,x=m[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+g]=new fn({func:a.GEQUAL,mask:255},C+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=x,[T,m]}return[{[g]:fn.disabled},m]}stencilConfigForOverlapTwoPass(i){const a=this.context.gl,m=i.sort((T,C)=>C.overscaledZ-T.overscaledZ),g=m[m.length-1].overscaledZ,x=m[0].overscaledZ-g+1;if(this.clearStencil(),x>1){const T={},C={};for(let M=0;M<x;M++)T[M+g]=new fn({func:a.GREATER,mask:255},x+1+M,255,a.KEEP,a.KEEP,a.REPLACE),C[M+g]=new fn({func:a.GREATER,mask:255},1+M,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*x+1,[T,C,m]}return this.nextStencilID=3,[{[g]:new fn({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[g]:new fn({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Mn([i.CONSTANT_COLOR,i.ONE],new l.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mn.unblended:Mn.alphaBlended}getDepthModeForSublayer(i,a,m){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Wt(m||this.context.gl.LEQUAL,a,[g,g])}getDepthModeFor3D(){return new Wt(this.context.gl.LEQUAL,Wt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,a){var m,g;this.style=i,this.options=a,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(H.now()),this.imageManager.beginFrame();const x=this.style._order,T=this.style.sourceCaches,C={},M={},z={},V={isRenderingToTexture:!1,isRenderingGlobe:((m=i.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const Z in T){const J=T[Z];J.used&&J.prepare(this.context),C[Z]=J.getVisibleCoordinates(!1),M[Z]=C[Z].slice().reverse(),z[Z]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<x.length;Z++)if(this.style._layers[x[Z]].is3D()){this.opaquePassCutoff=Z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Z of x){const J=this.style._layers[Z];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ne=M[J.source];(J.type==="custom"||ne.length)&&this.renderLayer(this,T[J.source],J,ne,V)}if((g=this.style.projection)===null||g===void 0||g.updateGPUdependent({context:this.context,useProgram:Z=>this.useProgram(Z)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.b4.black:l.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(Z,J){const ne=Z.context,ye=ne.gl,_e=((ze,De,Ze)=>{const Ke=Math.cos(De.rollInRadians),st=Math.sin(De.rollInRadians),at=ri(De),tt=De.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ze.properties.get("sky-color"),u_horizon_color:ze.properties.get("horizon-color"),u_horizon:[(De.width/2-at*st)*Ze,(De.height/2+at*Ke)*Ze],u_horizon_normal:[-st,Ke],u_sky_horizon_blend:ze.properties.get("sky-horizon-blend")*De.height/2*Ze,u_sky_blend:tt}})(J,Z.style.map.transform,Z.pixelRatio),xe=new Wt(ye.LEQUAL,Wt.ReadWrite,[0,1]),be=fn.disabled,Ce=Z.colorModeForRenderPass(),ke=Z.useProgram("sky"),Re=kr(ne,J);ke.draw(ne,ye.TRIANGLES,xe,be,Ce,xn.disabled,_e,null,void 0,"sky",Re.vertexBuffer,Re.indexBuffer,Re.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[x[this.currentLayer]],J=T[Z.source],ne=C[Z.source];this._renderTileClippingMasks(Z,ne,!1),this.renderLayer(this,J,Z,ne,V)}this.renderPass="translucent";let q=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const Z=this.style._layers[x[this.currentLayer]],J=T[Z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Z,V))continue;this.opaquePassEnabledForLayer()||q||(q=!0,V.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ne=(Z.type==="symbol"?z:M)[Z.source];this._renderTileClippingMasks(Z,C[Z.source],!1),this.renderLayer(this,J,Z,ne,V)}if(V.isRenderingGlobe&&function(Z,J,ne){const ye=Z.context,_e=ye.gl,xe=Z.useProgram("atmosphere"),be=new Wt(_e.LEQUAL,Wt.ReadOnly,[0,1]),Ce=Z.transform,ke=function(tt,St){const bt=tt.properties.get("position"),ht=[-bt.x,-bt.y,-bt.z],It=l.aq(new Float64Array(16));return tt.properties.get("anchor")==="map"&&(l.aX(It,It,St.rollInRadians),l.aY(It,It,-St.pitchInRadians),l.aX(It,It,St.bearingInRadians),l.aY(It,It,St.center.lat*Math.PI/180),l.bj(It,It,-St.center.lng*Math.PI/180)),l.bS(ht,ht,It),ht}(ne,Z.transform),Re=Ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ze=J.properties.get("atmosphere-blend")*Re.projectionTransition;if(ze===0)return;const De=Qi(Ce.worldSize,Ce.center.lat),Ze=Ce.inverseProjectionMatrix,Ke=new Float64Array(4);Ke[3]=1,l.al(Ke,Ke,Ce.modelViewProjectionMatrix),Ke[0]/=Ke[3],Ke[1]/=Ke[3],Ke[2]/=Ke[3],Ke[3]=1,l.al(Ke,Ke,Ze),Ke[0]/=Ke[3],Ke[1]/=Ke[3],Ke[2]/=Ke[3],Ke[3]=1;const st=((tt,St,bt,ht,It)=>({u_sun_pos:tt,u_atmosphere_blend:St,u_globe_position:bt,u_globe_radius:ht,u_inv_proj_matrix:It}))(ke,ze,[Ke[0],Ke[1],Ke[2]],De,Ze),at=kr(ye,J);xe.draw(ye,_e.TRIANGLES,be,fn.disabled,Mn.alphaBlended,xn.disabled,st,null,null,"atmosphere",at.vertexBuffer,at.indexBuffer,at.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const Z=function(J,ne){let ye=null;const _e=Object.values(J._layers).flatMap(ke=>ke.source&&!ke.isHidden(ne)?[J.sourceCaches[ke.source]]:[]),xe=_e.filter(ke=>ke.getSource().type==="vector"),be=_e.filter(ke=>ke.getSource().type!=="vector"),Ce=ke=>{(!ye||ye.getSource().maxzoom<ke.getSource().maxzoom)&&(ye=ke)};return xe.forEach(ke=>Ce(ke)),ye||be.forEach(ke=>Ce(ke)),ye}(this.style,this.transform.zoom);Z&&function(J,ne,ye){for(let _e=0;_e<ye.length;_e++)ir(J,ne,ye[_e])}(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&function(Z){const J=Z.transform.padding;en(Z,Z.transform.height-(J.top||0),3,Ae),en(Z,J.bottom||0,3,Ge),bn(Z,J.left||0,3,et),bn(Z,Z.transform.width-(J.right||0),3,pt);const ne=Z.transform.centerPoint;(function(ye,_e,xe,be){nr(ye,_e-1,xe-10,2,20,be),nr(ye,_e-10,xe-1,20,2,be)})(Z,ne.x,Z.transform.height-ne.y,Dt)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=i?!l.bV(a,m):!l.bW(a,m)),g||(g=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),g&&(l.bX(a,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,T){const C=x.context,M=C.gl,z=x.transform,V=Mn.unblended,q=new Wt(M.LEQUAL,Wt.ReadWrite,[0,1]),Z=T.sourceCache.getRenderableTiles(),J=x.useProgram("terrainDepth");C.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.b4.transparent,depth:1});for(const ne of Z){const ye=T.getTerrainMesh(ne.tileID),_e=T.getTerrainData(ne.tileID),xe=z.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),be={u_ele_delta:T.getMeshFrameDelta(z.zoom)};J.draw(C,M.TRIANGLES,q,fn.disabled,V,xn.backCCW,be,_e,xe,"terrain",ye.vertexBuffer,ye.indexBuffer,ye.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,T){const C=x.context,M=C.gl,z=x.transform,V=Mn.unblended,q=new Wt(M.LEQUAL,Wt.ReadWrite,[0,1]),Z=T.getCoordsTexture(),J=T.sourceCache.getRenderableTiles(),ne=x.useProgram("terrainCoords");C.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.b4.transparent,depth:1}),T.coordsIndex=[];for(const ye of J){const _e=T.getTerrainMesh(ye.tileID),xe=T.getTerrainData(ye.tileID);C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,Z.texture);const be={u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(z.zoom)},Ce=z.getProjectionData({overscaledTileID:ye.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ne.draw(C,M.TRIANGLES,q,fn.disabled,V,xn.backCCW,be,xe,Ce,"terrain",_e.vertexBuffer,_e.indexBuffer,_e.segments),T.coordsIndex.push(ye.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(i,a,m,g,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(g||[]).length)&&(this.id=m.id,l.bY(m)?function(T,C,M,z,V,q){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=q,J=fn.disabled,ne=T.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ye,_e,xe,be,Ce,ke,Re,ze,De){const Ze=_e.transform,Ke=_e.style.map.terrain,st=Ce==="map",at=ke==="map";for(const tt of ye){const St=be.getTile(tt),bt=St.getBucket(xe);if(!bt||!bt.text||!bt.text.segments.get().length)continue;const ht=l.ah(bt.textSizeData,Ze.zoom),It=l.at(St,1,_e.transform.zoom),pn=He(st,_e.transform,It),Fn=xe.layout.get("icon-text-fit")!=="none"&&bt.hasIconData();{const Ni=Math.pow(2,Ze.zoom-St.tileID.overscaledZ),hi=Ke?(Oi,di)=>Ke.getElevation(tt,Oi,di):null;Cc(bt,st,at,De,Ze,pn,Ni,ht,Fn,l.au(Ze,St,Re,ze),tt.toUnwrapped(),hi)}}}(z,T,M,C,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),V),M.paint.get("icon-opacity").constantOr(1)!==0&&Bu(T,C,M,z,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),J,ne,Z),M.paint.get("text-opacity").constantOr(1)!==0&&Bu(T,C,M,z,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),J,ne,Z),C.map.showCollisionBoxes&&(La(T,C,M,z,!0),La(T,C,M,z,!1))}(i,a,m,g,this.style.placement.variableOffsets,x):l.bZ(m)?function(T,C,M,z,V){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:q}=V,Z=M.paint.get("circle-opacity"),J=M.paint.get("circle-stroke-width"),ne=M.paint.get("circle-stroke-opacity"),ye=!M.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(J.constantOr(1)===0||ne.constantOr(1)===0))return;const _e=T.context,xe=_e.gl,be=T.transform,Ce=T.getDepthModeForSublayer(0,Wt.ReadOnly),ke=fn.disabled,Re=T.colorModeForRenderPass(),ze=[],De=be.getCircleRadiusCorrection();for(let Ze=0;Ze<z.length;Ze++){const Ke=z[Ze],st=C.getTile(Ke),at=st.getBucket(M);if(!at)continue;const tt=M.paint.get("circle-translate"),St=M.paint.get("circle-translate-anchor"),bt=l.au(be,st,tt,St),ht=at.programConfigurations.get(M.id),It=T.useProgram("circle",ht),pn=at.layoutVertexBuffer,Fn=at.indexBuffer,Ni=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ke),hi={programConfiguration:ht,program:It,layoutVertexBuffer:pn,indexBuffer:Fn,uniformValues:E(T,st,M,bt,De),terrainData:Ni,projectionData:be.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!q,applyTerrainMatrix:!0})};if(ye){const Oi=at.segments.get();for(const di of Oi)ze.push({segments:new l.aD([di]),sortKey:di.sortKey,state:hi})}else ze.push({segments:at.segments,sortKey:0,state:hi})}ye&&ze.sort((Ze,Ke)=>Ze.sortKey-Ke.sortKey);for(const Ze of ze){const{programConfiguration:Ke,program:st,layoutVertexBuffer:at,indexBuffer:tt,uniformValues:St,terrainData:bt,projectionData:ht}=Ze.state;st.draw(_e,xe.TRIANGLES,Ce,ke,Re,xn.backCCW,St,bt,ht,M.id,at,tt,Ze.segments,M.paint,T.transform.zoom,Ke)}}(i,a,m,g,x):l.b_(m)?function(T,C,M,z,V){if(M.paint.get("heatmap-opacity")===0)return;const q=T.context,{isRenderingToTexture:Z,isRenderingGlobe:J}=V;if(T.style.map.terrain){for(const ne of z){const ye=C.getTile(ne);C.hasRenderableParent(ne)||(T.renderPass==="offscreen"?Lh(T,ye,M,ne,J):T.renderPass==="translucent"&&Ac(T,M,ne,Z,J))}q.viewport.set([0,0,T.width,T.height])}else T.renderPass==="offscreen"?function(ne,ye,_e,xe){const be=ne.context,Ce=be.gl,ke=ne.transform,Re=fn.disabled,ze=new Mn([Ce.ONE,Ce.ONE],l.b4.transparent,[!0,!0,!0,!0]);(function(De,Ze,Ke){const st=De.gl;De.activeTexture.set(st.TEXTURE1),De.viewport.set([0,0,Ze.width/4,Ze.height/4]);let at=Ke.heatmapFbos.get(l.bP);at?(st.bindTexture(st.TEXTURE_2D,at.colorAttachment.get()),De.bindFramebuffer.set(at.framebuffer)):(at=Vu(De,Ze.width/4,Ze.height/4),Ke.heatmapFbos.set(l.bP,at))})(be,ne,_e),be.clear({color:l.b4.transparent});for(let De=0;De<xe.length;De++){const Ze=xe[De];if(ye.hasRenderableParent(Ze))continue;const Ke=ye.getTile(Ze),st=Ke.getBucket(_e);if(!st)continue;const at=st.programConfigurations.get(_e.id),tt=ne.useProgram("heatmap",at),St=ke.getProjectionData({overscaledTileID:Ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),bt=ke.getCircleRadiusCorrection();tt.draw(be,Ce.TRIANGLES,Wt.disabled,Re,ze,xn.backCCW,$e(Ke,ke.zoom,_e.paint.get("heatmap-intensity"),bt),null,St,_e.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,_e.paint,ke.zoom,at)}be.viewport.set([0,0,ne.width,ne.height])}(T,C,M,z):T.renderPass==="translucent"&&function(ne,ye){const _e=ne.context,xe=_e.gl;_e.setColorMode(ne.colorModeForRenderPass());const be=ye.heatmapFbos.get(l.bP);be&&(_e.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,be.colorAttachment.get()),_e.activeTexture.set(xe.TEXTURE1),kc(_e,ye).bind(xe.LINEAR,xe.CLAMP_TO_EDGE),ne.useProgram("heatmapTexture").draw(_e,xe.TRIANGLES,Wt.disabled,fn.disabled,ne.colorModeForRenderPass(),xn.disabled,Je(ne,ye,0,1),null,null,ye.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments,ye.paint,ne.transform.zoom))}(T,M)}(i,a,m,g,x):l.b$(m)?function(T,C,M,z,V){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:q}=V,Z=M.paint.get("line-opacity"),J=M.paint.get("line-width");if(Z.constantOr(1)===0||J.constantOr(1)===0)return;const ne=T.getDepthModeForSublayer(0,Wt.ReadOnly),ye=T.colorModeForRenderPass(),_e=M.paint.get("line-dasharray"),xe=M.paint.get("line-pattern"),be=xe.constantOr(1),Ce=M.paint.get("line-gradient"),ke=M.getCrossfadeParameters(),Re=be?"linePattern":_e?"lineSDF":Ce?"lineGradient":"line",ze=T.context,De=ze.gl,Ze=T.transform;let Ke=!0;for(const st of z){const at=C.getTile(st);if(be&&!at.patternsLoaded())continue;const tt=at.getBucket(M);if(!tt)continue;const St=tt.programConfigurations.get(M.id),bt=T.context.program.get(),ht=T.useProgram(Re,St),It=Ke||ht.program!==bt,pn=T.style.map.terrain&&T.style.map.terrain.getTerrainData(st),Fn=xe.constantOr(null);if(Fn&&at.imageAtlas){const ai=at.imageAtlas,fi=ai.patternPositions[Fn.to.toString()],Zr=ai.patternPositions[Fn.from.toString()];fi&&Zr&&St.setConstantPatternPositions(fi,Zr)}const Ni=Ze.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),hi=Ze.getPixelScale(),Oi=be?Li(T,at,M,hi,ke):_e?Ia(T,at,M,hi,_e,ke):Ce?qn(T,at,M,hi,tt.lineClipsArray.length):Dn(T,at,M,hi);if(be)ze.activeTexture.set(De.TEXTURE0),at.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),St.updatePaintBuffers(ke);else if(_e&&(It||T.lineAtlas.dirty))ze.activeTexture.set(De.TEXTURE0),T.lineAtlas.bind(ze);else if(Ce){const ai=tt.gradients[M.id];let fi=ai.texture;if(M.gradientVersion!==ai.version){let Zr=256;if(M.stepInterpolant){const fr=C.getSource().maxzoom,pr=st.canonical.z===fr?Math.ceil(1<<T.transform.maxZoom-st.canonical.z):1;Zr=l.ab(l.bQ(tt.maxLineLength/l.X*1024*pr),256,ze.maxTextureSize)}ai.gradient=l.bR({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Zr,image:ai.gradient||void 0,clips:tt.lineClipsArray}),ai.texture?ai.texture.update(ai.gradient):ai.texture=new Q(ze,ai.gradient,De.RGBA),ai.version=M.gradientVersion,fi=ai.texture}ze.activeTexture.set(De.TEXTURE0),fi.bind(M.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}let di;if(q){const[ai]=T.getStencilConfigForOverlapAndUpdateStencilID(z);di=ai[st.overscaledZ]}else di=T.stencilModeForClipping(st);ht.draw(ze,De.TRIANGLES,ne,di,ye,xn.disabled,Oi,pn,Ni,M.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,M.paint,T.transform.zoom,St,tt.layoutVertexBuffer2),Ke=!1}}(i,a,m,g,x):l.c0(m)?function(T,C,M,z,V){const q=M.paint.get("fill-color"),Z=M.paint.get("fill-opacity");if(Z.constantOr(1)===0)return;const{isRenderingToTexture:J}=V,ne=T.colorModeForRenderPass(),ye=M.paint.get("fill-pattern"),_e=T.opaquePassEnabledForLayer()&&!ye.constantOr(1)&&q.constantOr(l.b4.transparent).a===1&&Z.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===_e){const xe=T.getDepthModeForSublayer(1,T.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);d(T,C,M,z,xe,ne,!1,J)}if(T.renderPass==="translucent"&&M.paint.get("fill-antialias")){const xe=T.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);d(T,C,M,z,xe,ne,!0,J)}}(i,a,m,g,x):l.c1(m)?function(T,C,M,z,V){const q=M.paint.get("fill-extrusion-opacity");if(q===0)return;const{isRenderingToTexture:Z}=V;if(T.renderPass==="translucent"){const J=new Wt(T.context.gl.LEQUAL,Wt.ReadWrite,T.depthRangeFor3D);if(q!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))y(T,C,M,z,J,fn.disabled,Mn.disabled,Z),y(T,C,M,z,J,T.stencilModeFor3D(),T.colorModeForRenderPass(),Z);else{const ne=T.colorModeForRenderPass();y(T,C,M,z,J,fn.disabled,ne,Z)}}}(i,a,m,g,x):l.c2(m)?function(T,C,M,z,V){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const{isRenderingToTexture:q}=V,Z=T.context,J=T.style.projection.useSubdivision,ne=T.getDepthModeForSublayer(0,Wt.ReadOnly),ye=T.colorModeForRenderPass();if(T.renderPass==="offscreen")(function(_e,xe,be,Ce,ke,Re,ze){const De=_e.context,Ze=De.gl;for(const Ke of be){const st=xe.getTile(Ke),at=st.dem;if(!at||!at.data||!st.needsHillshadePrepare)continue;const tt=at.dim,St=at.stride,bt=at.getPixels();if(De.activeTexture.set(Ze.TEXTURE1),De.pixelStoreUnpackPremultiplyAlpha.set(!1),st.demTexture=st.demTexture||_e.getTileTexture(St),st.demTexture){const It=st.demTexture;It.update(bt,{premultiply:!1}),It.bind(Ze.NEAREST,Ze.CLAMP_TO_EDGE)}else st.demTexture=new Q(De,bt,Ze.RGBA,{premultiply:!1}),st.demTexture.bind(Ze.NEAREST,Ze.CLAMP_TO_EDGE);De.activeTexture.set(Ze.TEXTURE0);let ht=st.fbo;if(!ht){const It=new Q(De,{width:tt,height:tt,data:null},Ze.RGBA);It.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),ht=st.fbo=De.createFramebuffer(tt,tt,!0,!1),ht.colorAttachment.set(It.texture)}De.bindFramebuffer.set(ht.framebuffer),De.viewport.set([0,0,tt,tt]),_e.useProgram("hillshadePrepare").draw(De,Ze.TRIANGLES,ke,Re,ze,xn.disabled,Kn(st.tileID,at),null,null,Ce.id,_e.rasterBoundsBuffer,_e.quadTriangleIndexBuffer,_e.rasterBoundsSegments),st.needsHillshadePrepare=!1}})(T,C,z,M,ne,fn.disabled,ye),Z.viewport.set([0,0,T.width,T.height]);else if(T.renderPass==="translucent")if(J){const[_e,xe,be]=T.stencilConfigForOverlapTwoPass(z);P(T,C,M,be,_e,ne,ye,!1,q),P(T,C,M,be,xe,ne,ye,!0,q)}else{const[_e,xe]=T.getStencilConfigForOverlapAndUpdateStencilID(z);P(T,C,M,xe,_e,ne,ye,!1,q)}}(i,a,m,g,x):l.c3(m)?function(T,C,M,z,V){if(T.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:q}=V,Z=C.getSource(),J=T.style.projection.useSubdivision;if(Z instanceof hr)j(T,C,M,z,null,!1,!1,Z.tileCoords,Z.flippedWindingOrder,q);else if(J){const[ne,ye,_e]=T.stencilConfigForOverlapTwoPass(z);j(T,C,M,_e,ne,!1,!0,D,!1,q),j(T,C,M,_e,ye,!0,!0,D,!1,q)}else{const[ne,ye]=T.getStencilConfigForOverlapAndUpdateStencilID(z);j(T,C,M,ye,ne,!1,!0,D,!1,q)}}(i,a,m,g,x):l.c4(m)?function(T,C,M,z,V){const q=M.paint.get("background-color"),Z=M.paint.get("background-opacity");if(Z===0)return;const{isRenderingToTexture:J}=V,ne=T.context,ye=ne.gl,_e=T.style.projection,xe=T.transform,be=xe.tileSize,Ce=M.paint.get("background-pattern");if(T.isPatternMissing(Ce))return;const ke=!Ce&&q.a===1&&Z===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==ke)return;const Re=fn.disabled,ze=T.getDepthModeForSublayer(0,ke==="opaque"?Wt.ReadWrite:Wt.ReadOnly),De=T.colorModeForRenderPass(),Ze=T.useProgram(Ce?"backgroundPattern":"background"),Ke=z||pe(xe,{tileSize:be,terrain:T.style.map.terrain});Ce&&(ne.activeTexture.set(ye.TEXTURE0),T.imageManager.bind(T.context));const st=M.getCrossfadeParameters();for(const at of Ke){const tt=xe.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),St=Ce?Oo(Z,T,Ce,{tileID:at,tileSize:be},st):Ah(Z,q),bt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(at),ht=_e.getMeshFromTileID(ne,at.canonical,!1,!0,"raster");Ze.draw(ne,ye.TRIANGLES,ze,Re,De,xn.backCCW,St,bt,tt,M.id,ht.vertexBuffer,ht.indexBuffer,ht.segments)}}(i,0,m,g,x):l.c5(m)&&function(T,C,M,z){const{isRenderingGlobe:V}=z,q=T.context,Z=M.implementation,J=T.style.projection,ne=T.transform,ye=ne.getProjectionDataForCustomLayer(V),_e={farZ:ne.farZ,nearZ:ne.nearZ,fov:ne.fov*Math.PI/180,modelViewProjectionMatrix:ne.modelViewProjectionMatrix,projectionMatrix:ne.projectionMatrix,shaderData:{variantName:J.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${J.shaderPreludeCode.vertexSource}`,define:J.shaderDefine},defaultProjectionData:ye},xe=Z.renderingMode?Z.renderingMode:"2d";if(T.renderPass==="offscreen"){const be=Z.prerender;be&&(T.setCustomLayerDefaults(),q.setColorMode(T.colorModeForRenderPass()),be.call(Z,q.gl,_e),q.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),q.setColorMode(T.colorModeForRenderPass()),q.setStencilMode(fn.disabled);const be=xe==="3d"?T.getDepthModeFor3D():T.getDepthModeForSublayer(0,Wt.ReadOnly);q.setDepthMode(be),Z.render(q.gl,_e),q.setDirty(),T.setBaseState(),q.bindFramebuffer.set(null)}}(i,0,m,x))}saveTileTexture(i){const a=this._tileTextures[i.size[0]];a?a.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const a=this.imageManager.getPattern(i.from.toString()),m=this.imageManager.getPattern(i.to.toString());return!a||!m}useProgram(i,a,m=!1){this.cache=this.cache||{};const g=!!this.style.map.terrain,x=this.style.projection,T=i+(a?a.cacheKey:"")+`/${m?un:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"");return this.cache[T]||(this.cache[T]=new ll(this.context,$i[i],a,Ud[i],this._showOverdrawInspector,g,m?$i.projectionMercator:x.shaderPreludeCode,m?ms:x.shaderDefine)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Q(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:a}=this.context.gl;return this.width!==i||this.height!==a}}function Da(v,i){let a,m=!1,g=null,x=null;const T=()=>{g=null,m&&(v.apply(x,a),g=setTimeout(T,i),m=!1)};return(...C)=>(m=!0,x=this,a=C,g||T(),g)}class zh{constructor(i){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let m;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(m=g)}),(m&&m[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:m,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const m=a.join("/");let g=m;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${m}`);let x=window.location.hash.replace(g,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let T=window.location.href.replace(/(#.+)?$/,x);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=Da(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const a=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),T=Math.round(a.lng*x)/x,C=Math.round(a.lat*x)/x,M=this._map.getBearing(),z=this._map.getPitch();let V="";if(V+=i?`/${T}/${C}/${m}`:`${m}/${C}/${T}`,(M||z)&&(V+="/"+Math.round(10*M)/10),z&&(V+=`/${Math.round(z)}`),this._hashName){const q=this._hashName;let Z=!1;const J=window.location.hash.slice(1).split("&").map(ne=>{const ye=ne.split("=")[0];return ye===q?(Z=!0,`${ye}=${V}`):ne}).filter(ne=>ne);return Z||J.push(`${q}=${V}`),`#${J.join("&")}`}return`#${V}`}_isValidHash(i){if(i.length<3||i.some(isNaN))return!1;try{new l.N(+i[2],+i[1])}catch{return!1}const a=+i[0],m=+(i[3]||0),g=+(i[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&m>=0&&m<=180&&g>=this._map.getMinPitch()&&g<=this._map.getMaxPitch()}}const Jl={linearity:.3,easing:l.c6(0,0,.3,1)},Nh=l.e({deceleration:2500,maxSpeed:1400},Jl),Wd=l.e({deceleration:20,maxSpeed:1400},Jl),Oh=l.e({deceleration:1e3,maxSpeed:360},Jl),Hi=l.e({deceleration:1e3,maxSpeed:90},Jl),ju=l.e({deceleration:1e3,maxSpeed:360},Jl);class Uu{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:H.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=H.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)a.zoom+=x.zoomDelta||0,a.bearing+=x.bearingDelta||0,a.pitch+=x.pitchDelta||0,a.roll+=x.rollDelta||0,x.panDelta&&a.pan._add(x.panDelta),x.around&&(a.around=x.around),x.pinchAround&&(a.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const x=Gr(a.pan.mag(),m,l.e({},Nh,i||{})),T=a.pan.mult(x.amount/a.pan.mag()),C=this._map.cameraHelper.handlePanInertia(T,this._map.transform);g.center=C.easingCenter,g.offset=C.easingOffset,eu(g,x)}if(a.zoom){const x=Gr(a.zoom,m,Wd);g.zoom=this._map.transform.zoom+x.amount,eu(g,x)}if(a.bearing){const x=Gr(a.bearing,m,Oh);g.bearing=this._map.transform.bearing+l.ab(x.amount,-179,179),eu(g,x)}if(a.pitch){const x=Gr(a.pitch,m,Hi);g.pitch=this._map.transform.pitch+x.amount,eu(g,x)}if(a.roll){const x=Gr(a.roll,m,ju);g.roll=this._map.transform.roll+l.ab(x.amount,-179,179),eu(g,x)}if(g.zoom||g.bearing){const x=a.pinchAround===void 0?a.around:a.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function eu(v,i){(!v.duration||v.duration<i.duration)&&(v.duration=i.duration,v.easing=i.easing)}function Gr(v,i,a){const{maxSpeed:m,linearity:g,deceleration:x}=a,T=l.ab(v*g/(i/1e3),-m,m),C=Math.abs(T)/(x*g);return{easing:a.easing,duration:1e3*C,amount:T*(C/2)}}class Ii extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,m,g={}){const x=$.mousePos(a.getCanvas(),m),T=a.unproject(x);super(i,l.e({point:x,lngLat:T,originalEvent:m},g)),this._defaultPrevented=!1,this.target=a}}class gl extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,m){const g=i==="touchend"?m.changedTouches:m.touches,x=$.touchPos(a.getCanvasContainer(),g),T=x.map(M=>a.unproject(M)),C=x.reduce((M,z,V,q)=>M.add(z.div(q.length)),new l.P(0,0));super(i,{points:x,point:C,lngLats:T,lngLat:a.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class lo extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Mc{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new lo(i.type,this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new Ii(i.type,this._map,i))}mouseup(i){this._map.fire(new Ii(i.type,this._map,i))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Ii(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Ii(i.type,this._map,i))}mouseover(i){this._map.fire(new Ii(i.type,this._map,i))}mouseout(i){this._map.fire(new Ii(i.type,this._map,i))}touchstart(i){return this._firePreventable(new gl(i.type,this._map,i))}touchmove(i){this._map.fire(new gl(i.type,this._map,i))}touchend(i){this._map.fire(new gl(i.type,this._map,i))}touchcancel(i){this._map.fire(new gl(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Q0{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Ii(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ii("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Ii(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fh{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.screenPointToLocation(l.P.convert(i),this._map.terrain)}}class u_{constructor(i,a){this._map=i,this._tr=new Fh(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&($.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const m=a;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=m,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const x=Math.min(g.x,m.x),T=Math.max(g.x,m.x),C=Math.min(g.y,m.y),M=Math.max(g.y,m.y);$.setTransform(this._box,`translate(${x}px,${C}px)`),this._box.style.width=T-x+"px",this._box.style.height=M-C+"px"}mouseupWindow(i,a){if(!this._active||i.button!==0)return;const m=this._startPos,g=a;if(this.reset(),$.suppressClick(),m.x!==g.x||m.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:x=>x.fitScreenCoordinates(m,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new l.k(i,{originalEvent:a}))}}function jp(v,i){if(v.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${i.length}`);const a={};for(let m=0;m<v.length;m++)a[v[m].identifier]=i[m];return a}class c_{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,a,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const x=new l.P(0,0);for(const T of g)x._add(T);return x.div(g.length)}(a),this.touches=jp(m,a)))}touchmove(i,a,m){if(this.aborted||!this.centroid)return;const g=jp(m,a);for(const x in this.touches){const T=g[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(i,a,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class $u{constructor(i){this.singleTap=new c_(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,a,m){this.singleTap.touchstart(i,a,m)}touchmove(i,a,m){this.singleTap.touchmove(i,a,m)}touchend(i,a,m){const g=this.singleTap.touchend(i,a,m);if(g){const x=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(x&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class _l{constructor(i){this._tr=new Fh(i),this._zoomIn=new $u({numTouches:1,numTaps:2}),this._zoomOut=new $u({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,m){this._zoomIn.touchstart(i,a,m),this._zoomOut.touchstart(i,a,m)}touchmove(i,a,m){this._zoomIn.touchmove(i,a,m),this._zoomOut.touchmove(i,a,m)}touchend(i,a,m){const g=this._zoomIn.touchend(i,a,m),x=this._zoomOut.touchend(i,a,m),T=this._tr;return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(g)},{originalEvent:i})}):x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(x)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rt{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const a=this._moveFunction(...i);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(i,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,a){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const g=Array.isArray(a)?a[0]:a;return!this._moved&&g.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(m,g))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&$.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const h_={0:1,2:2};class qu{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const a=$.mouseButton(i);this._eventButton=a}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(a,m){const g=h_[m];return a.buttons===void 0||(a.buttons&g)!==g}(i,this._eventButton)}isValidEndEvent(i){return $.mouseButton(i)===this._eventButton}}class d_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}class Bh{constructor(i=new qu({checkCorrectEvent:()=>!0}),a=new d_){this.mouseMoveStateManager=i,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(i,a,m){return i instanceof MouseEvent?a(i):typeof TouchEvent<"u"&&i instanceof TouchEvent?m(i):void 0}startMove(i){this._executeRelevantHandler(i,a=>this.mouseMoveStateManager.startMove(a),a=>this.oneFingerTouchMoveStateManager.startMove(a))}endMove(i){this._executeRelevantHandler(i,a=>this.mouseMoveStateManager.endMove(a),a=>this.oneFingerTouchMoveStateManager.endMove(a))}isValidStartEvent(i){return this._executeRelevantHandler(i,a=>this.mouseMoveStateManager.isValidStartEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a))}isValidMoveEvent(i){return this._executeRelevantHandler(i,a=>this.mouseMoveStateManager.isValidMoveEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a))}isValidEndEvent(i){return this._executeRelevantHandler(i,a=>this.mouseMoveStateManager.isValidEndEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a))}}const tu=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=i=>{i.preventDefault()}};class f_{constructor(i,a){this._clickTolerance=i.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,a,m){return this._calculateTransform(i,a,m)}touchmove(i,a,m){if(this._active){if(!this._shouldBePrevented(m.length))return i.preventDefault(),this._calculateTransform(i,a,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,a,m){this._calculateTransform(i,a,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,m){m.length>0&&(this._active=!0);const g=jp(m,a),x=new l.P(0,0),T=new l.P(0,0);let C=0;for(const z in g){const V=g[z],q=this._touches[z];q&&(x._add(V),T._add(V.sub(q)),C++,g[z]=V)}if(this._touches=g,this._shouldBePrevented(C)||!T.mag())return;const M=T.div(C);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,a,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,m){if(!this._firstTwoTouches)return;i.preventDefault();const[g,x]=this._firstTwoTouches,T=Rc(m,a,g),C=Rc(m,a,x);if(!T||!C)return;const M=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],M,i)}touchend(i,a,m){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,T=Rc(m,a,g),C=Rc(m,a,x);T&&C||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Rc(v,i,a){for(let m=0;m<v.length;m++)if(v[m].identifier===a)return i[m]}function p_(v,i){return Math.log(v/i)/Math.LN2}class Kd extends Pn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(p_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:p_(this._distance,m),pinchAround:a}}}function m_(v,i){return 180*v.angleWith(i)/Math.PI}class g_ extends Pn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a,m){const g=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:m_(this._vector,g),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,m=m_(i,this._startVector);return Math.abs(m)<a}}function Xd(v){return Math.abs(v.y)>Math.abs(v.x)}class Yd extends Pn{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,a,m){super.touchstart(i,a,m),this._currentTouchCount=m.length}_start(i){this._lastPoints=i,Xd(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=i[0].sub(this._lastPoints[0]),x=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,m.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(i,a,m){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,x=a.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=i.y>0==a.y>0;return Xd(i)&&Xd(a)&&T}}const __={panStep:100,bearingStep:15,pitchStep:10};class y_{constructor(i){this._tr=new Fh(i);const a=__;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,m=0,g=0,x=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),x=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),x=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:C=>{const M=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:v_,zoom:a?Math.round(M.zoom)+a*(i.shiftKey?2:1):M.zoom,bearing:M.bearing+m*this._bearingStep,pitch:M.pitch+g*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:M.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function v_(v){return v*(2-v)}const x_=4.000244140625;class w_{constructor(i,a){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=i,this._tr=new Fh(i),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let a=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=H.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,a!==0&&a%x_==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=$.mousePos(this._map.getCanvas(),i),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(l.N.convert(m.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=i.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>x_?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&M!==0&&(M=1/M);const z=typeof this._targetZoom!="number"?i.scale:l.aG(this._targetZoom);this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,l.a8(z*M))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?i.zoom:this._targetZoom,m=this._startZoom,g=this._easing;let x,T=!1;if(this._type==="wheel"&&m&&g){const C=H.now()-this._lastWheelEventTime,M=Math.min((C+5)/200,1),z=g(M);x=l.y.number(m,a,z),M<1?this._frameId||(this._frameId=!0):T=!0}else x=a,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!T,zoomDelta:x-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=l.c8;if(this._prevEase){const m=this._prevEase,g=(H.now()-m.start)/m.duration,x=m.easing(g+.01)-m.easing(g),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);a=l.c6(T,C,.25,1)}return this._prevEase={start:H.now(),duration:i,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class yl{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zi{constructor(i){this._tr=new Fh(i),this.reset()}reset(){this._active=!1}dblclick(i,a){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qd{constructor(){this._tap=new $u({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,a,m){if(!this._swipePoint)if(this._tapTime){const g=a[0],x=i.timeStamp-this._tapTime<500,T=this._tapPoint.dist(g)<30;x&&T?m.length>0&&(this._swipePoint=g,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(i,a,m)}touchmove(i,a,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=a[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(i,a,m)}touchend(i,a,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const g=this._tap.touchend(i,a,m);g&&(this._tapTime=i.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd{constructor(i,a,m){this._el=i,this._mousePan=a,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Up{constructor(i,a,m,g){this._pitchWithRotate=i.pitchWithRotate,this._rollEnabled=i.rollEnabled,this._mouseRotate=a,this._mousePitch=m,this._mouseRoll=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $p{constructor(i,a,m,g){this._el=i,this._touchZoom=a,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qp{constructor(i,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",i);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=a,this._container.appendChild(g);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=m,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,a){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:i,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ef=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class za extends l.k{}function Lc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class Vt{constructor(i,a){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,x)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=g.type==="renderFrame"?void 0:g,C={needsRenderFrame:!1},M={},z={},V=g.touches,q=V?this._getMapTouches(V):void 0,Z=q?$.touchPos(this._map.getCanvas(),q):$.mousePos(this._map.getCanvas(),g);for(const{handlerName:ye,handler:_e,allowed:xe}of this._handlers){if(!_e.isEnabled())continue;let be;this._blockedByActive(z,xe,ye)?_e.reset():_e[x||g.type]&&(be=_e[x||g.type](g,Z,q),this.mergeHandlerResult(C,M,be,ye,T),be&&be.needsRenderFrame&&this._triggerRenderFrame()),(be||_e.isActive())&&(z[ye]=_e)}const J={};for(const ye in this._previousActiveHandlers)z[ye]||(J[ye]=T);this._previousActiveHandlers=z,(Object.keys(J).length||Lc(C))&&(this._changes.push([C,M,J]),this._triggerRenderFrame()),(Object.keys(z).length||Lc(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ne}=C;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uu(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,T]of this._listeners)$.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[i,a,m]of this._listeners)$.removeEventListener(i,a,i===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const a=this._map,m=a.getCanvasContainer();this._add("mapEvent",new Mc(a,i));const g=a.boxZoom=new u_(a,i);this._add("boxZoom",g),i.interactive&&i.boxZoom&&g.enable();const x=a.cooperativeGestures=new qp(a,i.cooperativeGestures);this._add("cooperativeGestures",x),i.cooperativeGestures&&x.enable();const T=new _l(a),C=new zi(a);a.doubleClickZoom=new yl(C,T),this._add("tapZoom",T),this._add("clickZoom",C),i.interactive&&i.doubleClickZoom&&a.doubleClickZoom.enable();const M=new Qd;this._add("tapDragZoom",M);const z=a.touchPitch=new Yd(a);this._add("touchPitch",z),i.interactive&&i.touchPitch&&a.touchPitch.enable(i.touchPitch);const V=()=>a.project(a.getCenter()),q=function({enable:ke,clickTolerance:Re,aroundCenter:ze=!0,minPixelCenterThreshold:De=100,rotateDegreesPerPixelMoved:Ze=.8},Ke){const st=new qu({checkCorrectEvent:at=>$.mouseButton(at)===0&&at.ctrlKey||$.mouseButton(at)===2&&!at.ctrlKey});return new Rt({clickTolerance:Re,move:(at,tt)=>{const St=Ke();if(ze&&Math.abs(St.y-at.y)>De)return{bearingDelta:l.c7(new l.P(at.x,tt.y),tt,St)};let bt=(tt.x-at.x)*Ze;return ze&&tt.y<St.y&&(bt=-bt),{bearingDelta:bt}},moveStateManager:st,enable:ke,assignEvents:tu})}(i,V),Z=function({enable:ke,clickTolerance:Re,pitchDegreesPerPixelMoved:ze=-.5}){const De=new qu({checkCorrectEvent:Ze=>$.mouseButton(Ze)===0&&Ze.ctrlKey||$.mouseButton(Ze)===2});return new Rt({clickTolerance:Re,move:(Ze,Ke)=>({pitchDelta:(Ke.y-Ze.y)*ze}),moveStateManager:De,enable:ke,assignEvents:tu})}(i),J=function({enable:ke,clickTolerance:Re,rollDegreesPerPixelMoved:ze=.3},De){const Ze=new qu({checkCorrectEvent:Ke=>$.mouseButton(Ke)===2&&Ke.ctrlKey});return new Rt({clickTolerance:Re,move:(Ke,st)=>{const at=De();let tt=(st.x-Ke.x)*ze;return st.y<at.y&&(tt=-tt),{rollDelta:tt}},moveStateManager:Ze,enable:ke,assignEvents:tu})}(i,V);a.dragRotate=new Up(i,q,Z,J),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate","mouseRoll"]),this._add("mouseRoll",J,["mousePitch"]),i.interactive&&i.dragRotate&&a.dragRotate.enable();const ne=function({enable:ke,clickTolerance:Re}){const ze=new qu({checkCorrectEvent:De=>$.mouseButton(De)===0&&!De.ctrlKey});return new Rt({clickTolerance:Re,move:(De,Ze)=>({around:Ze,panDelta:Ze.sub(De)}),activateOnStart:!0,moveStateManager:ze,enable:ke,assignEvents:tu})}(i),ye=new f_(i,a);a.dragPan=new Jd(m,ne,ye),this._add("mousePan",ne),this._add("touchPan",ye,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&a.dragPan.enable(i.dragPan);const _e=new g_,xe=new Kd;a.touchZoomRotate=new $p(m,xe,_e,M),this._add("touchRotate",_e,["touchPan","touchZoom"]),this._add("touchZoom",xe,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&a.touchZoomRotate.enable(i.touchZoomRotate);const be=a.scrollZoom=new w_(a,()=>this._triggerRenderFrame());this._add("scrollZoom",be,["mousePan"]),i.interactive&&i.scrollZoom&&a.scrollZoom.enable(i.scrollZoom);const Ce=a.keyboard=new y_(a);this._add("keyboard",Ce),i.interactive&&i.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Q0(a))}_add(i,a,m){this._handlers.push({handlerName:i,handler:a,allowed:m}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ef(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,a,m){for(const g in i)if(g!==m&&(!a||a.indexOf(g)<0))return!0;return!1}_getMapTouches(i){const a=[];for(const m of i)this._el.contains(m.target)&&a.push(m);return a}mergeHandlerResult(i,a,m,g,x){if(!m)return;l.e(i,m);const T={handlerName:g,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(a.zoom=T),m.panDelta!==void 0&&(a.drag=T),m.rollDelta!==void 0&&(a.roll=T),m.pitchDelta!==void 0&&(a.pitch=T),m.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const i={},a={},m={};for(const[g,x,T]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.rollDelta&&(i.rollDelta=(i.rollDelta||0)+g.rollDelta),g.around!==void 0&&(i.around=g.around),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),l.e(a,x),l.e(m,T);this._updateMapTransform(i,a,m),this._changes=[]}_updateMapTransform(i,a,m){const g=this._map,x=g._getTransformForUpdate(),T=g.terrain;if(!(Lc(i)||T&&this._terrainMovement))return this._fireEvents(a,m,!0);g._stop(!0);let{panDelta:C,zoomDelta:M,bearingDelta:z,pitchDelta:V,rollDelta:q,around:Z,pinchAround:J}=i;J!==void 0&&(Z=J),Z=Z||g.transform.centerPoint,T&&!x.isPointOnMapSurface(Z)&&(Z=x.centerPoint);const ne={panDelta:C,zoomDelta:M,rollDelta:q,pitchDelta:V,bearingDelta:z,around:Z};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(Z)&&(Z=x.centerPoint);const ye=Z.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(C?Z.sub(C):Z);T?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ne,x),this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?x.setCenter(x.screenPointToLocation(x.centerPoint.sub(C))):this._map.cameraHelper.handleMapControlsPan(ne,x,ye):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ne,x,ye))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ne,x),this._map.cameraHelper.handleMapControlsPan(ne,x,ye)),g._applyUpdatedTransform(x),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,m,!0)}_fireEvents(i,a,m){const g=ef(this._eventsInProgress),x=ef(i),T={};for(const q in i){const{originalEvent:Z}=i[q];this._eventsInProgress[q]||(T[`${q}start`]=Z),this._eventsInProgress[q]=i[q]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const q in T)this._fireEvent(q,T[q]);x&&this._fireEvent("move",x.originalEvent);for(const q in i){const{originalEvent:Z}=i[q];this._fireEvent(q,Z)}const C={};let M;for(const q in this._eventsInProgress){const{handlerName:Z,originalEvent:J}=this._eventsInProgress[q];this._handlersById[Z].isActive()||(delete this._eventsInProgress[q],M=a[Z]||J,C[`${q}end`]=M)}for(const q in C)this._fireEvent(q,C[q]);const z=ef(this._eventsInProgress),V=(g||x)&&!z;if(V&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const q=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&q.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(q)}if(m&&V){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!q||!q.essential&&H.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:M})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new l.k(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new za("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Kt extends l.E{constructor(i,a,m){super(),this._renderFrameCallback=()=>{const g=Math.min((H.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=m.bearingSnap,this.cameraHelper=a,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(i,a){i.apply(this.transform),this.transform=i,this.cameraHelper=a}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(i,a){return this.jumpTo({elevation:i},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(i){this._centerClampedToGround=i}panBy(i,a,m){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},a),m)}panTo(i,a,m){return this.easeTo(l.e({center:i},a),m)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,m){return this.easeTo(l.e({zoom:i},a),m)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(i,a){return i!=this.transform.fov&&(this.transform.setFov(i),this.fire(new l.k("movestart",a)).fire(new l.k("move",a)).fire(new l.k("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,m){return this.easeTo(l.e({bearing:i},a),m)}resetNorth(i,a){return this.rotateTo(0,l.e({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}getRoll(){return this.transform.roll}setRoll(i,a){return this.jumpTo({roll:i},a),this}cameraForBounds(i,a){i=wi.convert(i).adjustAntiMeridian();const m=a&&a.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),m,a)}_cameraForBoxAndBearing(i,a,m,g){const x={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const z=g.padding;g.padding={top:z,bottom:z,right:z,left:z}}const T=l.e(x,g.padding);g.padding=T;const C=this.transform,M=new wi(i,a);return this.cameraHelper.cameraForBoxAndBearing(g,T,M,m,C)}fitBounds(i,a,m){return this._fitInternal(this.cameraForBounds(i,a),a,m)}fitScreenCoordinates(i,a,m,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(i)),this.transform.screenPointToLocation(l.P.convert(a)),m,g),g,x)}_fitInternal(i,a,m){return i?(delete(a=l.e(i,a)).padding,a.linear?this.easeTo(a,m):this.flyTo(a,m)):this}jumpTo(i,a){this.stop();const m=this._getTransformForUpdate();let g=!1,x=!1,T=!1;const C=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,i);const M=m.zoom!==C;return"elevation"in i&&m.elevation!==+i.elevation&&m.setElevation(+i.elevation),"bearing"in i&&m.bearing!==+i.bearing&&(g=!0,m.setBearing(+i.bearing)),"pitch"in i&&m.pitch!==+i.pitch&&(x=!0,m.setPitch(+i.pitch)),"roll"in i&&m.roll!==+i.roll&&(T=!0,m.setRoll(+i.roll)),i.padding==null||m.isPaddingEqual(i.padding)||m.setPadding(i.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",a)).fire(new l.k("move",a)),M&&this.fire(new l.k("zoomstart",a)).fire(new l.k("zoom",a)).fire(new l.k("zoomend",a)),g&&this.fire(new l.k("rotatestart",a)).fire(new l.k("rotate",a)).fire(new l.k("rotateend",a)),x&&this.fire(new l.k("pitchstart",a)).fire(new l.k("pitch",a)).fire(new l.k("pitchend",a)),T&&this.fire(new l.k("rollstart",a)).fire(new l.k("roll",a)).fire(new l.k("rollend",a)),this.fire(new l.k("moveend",a))}calculateCameraOptionsFromTo(i,a,m,g=0){const x=l.Y.fromLngLat(i,a),T=l.Y.fromLngLat(m,g),C=T.x-x.x,M=T.y-x.y,z=T.z-x.z,V=Math.hypot(C,M,z);if(V===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(C,M),Z=l.a8(this.transform.cameraToCenterDistance/V/this.transform.tileSize),J=180*Math.atan2(C,-M)/Math.PI;let ne=180*Math.acos(q/V)/Math.PI;return ne=z<0?90-ne:90+ne,{center:T.toLngLat(),elevation:g,zoom:Z,pitch:ne,bearing:J}}calculateCameraOptionsFromCameraLngLatAltRotation(i,a,m,g,x){const T=this.transform.calculateCenterFromCameraLngLatAlt(i,a,m,g);return{center:T.center,elevation:T.elevation,zoom:T.zoom,bearing:m,pitch:g,roll:x}}easeTo(i,a){this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.c8},i)).animate===!1||!i.essential&&H.prefersReducedMotion)&&(i.duration=0);const m=this._getTransformForUpdate(),g=this.getBearing(),x=m.pitch,T=m.roll,C="bearing"in i?this._normalizeBearing(i.bearing,g):g,M="pitch"in i?+i.pitch:x,z="roll"in i?this._normalizeBearing(i.roll,T):T,V="padding"in i?i.padding:m.padding,q=l.P.convert(i.offset);let Z,J;i.around&&(Z=l.N.convert(i.around),J=m.locationToScreenPoint(Z));const ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ye=this.cameraHelper.handleEaseTo(m,{bearing:C,pitch:M,roll:z,padding:V,around:Z,aroundPoint:J,offsetAsPoint:q,offset:i.offset,zoom:i.zoom,center:i.center});return this._rotating=this._rotating||g!==C,this._pitching=this._pitching||M!==x,this._rolling=this._rolling||z!==T,this._padding=!m.isPaddingEqual(V),this._zooming=this._zooming||ye.isZooming,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,ne),this.terrain&&this._prepareElevation(ye.elevationCenter),this._ease(_e=>{ye.easeFunc(_e),this.terrain&&!i.freezeElevation&&this._updateElevation(_e),this._applyUpdatedTransform(m),this._fireMoveEvents(a)},_e=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(a,_e)},i),this}_prepareEase(i,a,m={}){this._moving=!0,a||m.moving||this.fire(new l.k("movestart",i)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",i)),this._rolling&&!m.rolling&&this.fire(new l.k("rollstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&a!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(m-(a-(m*i+this._elevationStart))/(1-i)),this._elevationTarget=a}this.transform.setElevation(l.y.number(this._elevationStart,this._elevationTarget,i))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){if(!this.terrain&&i.elevation>=0&&i.pitch<=90)return{};const a=i.getCameraLngLat(),m=i.getCameraAltitude(),g=this.terrain?this.terrain.getElevationForLngLatZoom(a,i.zoom):0;if(m<g){const x=this.calculateCameraOptionsFromTo(a,g,i.center,i.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(i){const a=[];if(a.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&a.push(g=>this.transformCameraUpdate(g)),!a.length)return;const m=i.clone();for(const g of a){const x=m.clone(),{center:T,zoom:C,roll:M,pitch:z,bearing:V,elevation:q}=g(x);T&&x.setCenter(T),q!==void 0&&x.setElevation(q),C!==void 0&&x.setZoom(C),M!==void 0&&x.setRoll(M),z!==void 0&&x.setPitch(z),V!==void 0&&x.setBearing(V),m.apply(x)}this.transform.apply(m)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i)),this._rolling&&this.fire(new l.k("roll",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const m=this._zooming,g=this._rotating,x=this._pitching,T=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",i)),g&&this.fire(new l.k("rotateend",i)),x&&this.fire(new l.k("pitchend",i)),T&&this.fire(new l.k("rollend",i)),this.fire(new l.k("moveend",i))}flyTo(i,a){if(!i.essential&&H.prefersReducedMotion){const tt=l.M(i,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(tt,a)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.c8},i);const m=this._getTransformForUpdate(),g=m.bearing,x=m.pitch,T=m.roll,C=m.padding,M="bearing"in i?this._normalizeBearing(i.bearing,g):g,z="pitch"in i?+i.pitch:x,V="roll"in i?this._normalizeBearing(i.roll,T):T,q="padding"in i?i.padding:m.padding,Z=l.P.convert(i.offset);let J=m.centerPoint.add(Z);const ne=m.screenPointToLocation(J),ye=this.cameraHelper.handleFlyTo(m,{bearing:M,pitch:z,roll:V,padding:q,locationAtOffset:ne,offsetAsPoint:Z,center:i.center,minZoom:i.minZoom,zoom:i.zoom});let _e=i.curve;const xe=Math.max(m.width,m.height),be=xe/ye.scaleOfZoom,Ce=ye.pixelPathLength;typeof ye.scaleOfMinZoom=="number"&&(_e=Math.sqrt(xe/ye.scaleOfMinZoom/Ce*2));const ke=_e*_e;function Re(tt){const St=(be*be-xe*xe+(tt?-1:1)*ke*ke*Ce*Ce)/(2*(tt?be:xe)*ke*Ce);return Math.log(Math.sqrt(St*St+1)-St)}function ze(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function De(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Ze=Re(!1);let Ke=function(tt){return De(Ze)/De(Ze+_e*tt)},st=function(tt){return xe*((De(Ze)*(ze(St=Ze+_e*tt)/De(St))-ze(Ze))/ke)/Ce;var St},at=(Re(!0)-Ze)/_e;if(Math.abs(Ce)<2e-6||!isFinite(at)){if(Math.abs(xe-be)<1e-6)return this.easeTo(i,a);const tt=be<xe?-1:1;at=Math.abs(Math.log(be/xe))/_e,st=()=>0,Ke=St=>Math.exp(tt*_e*St)}return i.duration="duration"in i?+i.duration:1e3*at/("screenSpeed"in i?+i.screenSpeed/_e:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=g!==M,this._pitching=z!==x,this._rolling=V!==T,this._padding=!m.isPaddingEqual(q),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(ye.targetCenter),this._ease(tt=>{const St=tt*at,bt=1/Ke(St),ht=st(St);this._rotating&&m.setBearing(l.y.number(g,M,tt)),this._pitching&&m.setPitch(l.y.number(x,z,tt)),this._rolling&&m.setRoll(l.y.number(T,V,tt)),this._padding&&(m.interpolatePadding(C,q,tt),J=m.centerPoint.add(Z)),ye.easeFunc(tt,bt,ht,J),this.terrain&&!i.freezeElevation&&this._updateElevation(tt),this._applyUpdatedTransform(m),this._fireMoveEvents(a)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,a){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,a)}return i||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(i,a,m){m.animate===!1||m.duration===0?(i(1),a()):(this._easeStart=H.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,a){i=l.aI(i,-180,180);const m=Math.abs(i-a);return Math.abs(i-360-a)<m&&(i-=360),Math.abs(i+360-a)<m&&(i+=360),i}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(i),this.transform.tileZoom):null}}const Vh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class tf{constructor(i=Vh){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(i,a){const m=this._map._getUIString(`AttributionControl.${a}`);i.title=m,i.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style.sourceCaches;for(const g in a){const x=a[g];if(x.used||x.usedForTerrain){const T=x.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i=i.filter(g=>String(g).trim()),i.sort((g,x)=>g.length-x.length),i=i.filter((g,x)=>{for(let T=x+1;T<i.length;T++)if(i[T].indexOf(g)>=0)return!1;return!0});const m=i.join(" | ");m!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=$.sanitize(m),i.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class nf{constructor(i={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const m=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const a=$.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class qs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,m=a?this._queue.concat(a):this._queue;for(const g of m)if(g.id===i)return void(g.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const m of a)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var b_=l.aA([{name:"a_pos3d",type:"Int16",components:3}]);class Na extends l.E{constructor(i){super(),this._lastTilesetChange=H.now(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=i._source.tileSize*2**this.deltaZoom,i.usedForTerrain=!0,i.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,a){this.sourceCache.update(i,a),this._renderableTilesKeys=[];const m={};for(const g of pe(i,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.terrainRttPosMatrix32f=new Float64Array(16),l.bL(g.terrainRttPosMatrix32f,0,l.X,l.X,0,0,1),this._tiles[g.key]=new So(g,this.tileSize),this._lastTilesetChange=H.now());for(const g in this._tiles)m[g]||delete this._tiles[g]}freeRtt(i){for(const a in this._tiles){const m=this._tiles[a];(!i||m.tileID.equals(i)||m.tileID.isChildOf(i)||i.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const a={};for(const m of this._renderableTilesKeys){const g=this._tiles[m].tileID,x=i.clone(),T=l.a$();if(g.canonical.equals(i.canonical))l.bL(T,0,l.X,l.X,0,0,1);else if(g.canonical.isChildOf(i.canonical)){const C=g.canonical.z-i.canonical.z,M=g.canonical.x-(g.canonical.x>>C<<C),z=g.canonical.y-(g.canonical.y>>C<<C),V=l.X>>C;l.bL(T,0,V,V,0,0,1),l.J(T,T,[-M*V,-z*V,0])}else{if(!i.canonical.isChildOf(g.canonical))continue;{const C=i.canonical.z-g.canonical.z,M=i.canonical.x-(i.canonical.x>>C<<C),z=i.canonical.y-(i.canonical.y>>C<<C),V=l.X>>C;l.bL(T,0,l.X,l.X,0,0,1),l.J(T,T,[M*V,z*V,0]),l.K(T,T,[1/2**C,1/2**C,0])}}x.terrainRttPosMatrix32f=new Float32Array(T),a[m]=x}return a}getSourceTile(i,a){const m=this.sourceCache._source;let g=i.overscaledZ-this.deltaZoom;if(g>m.maxzoom&&(g=m.maxzoom),g<m.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(g).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!x||!x.dem)&&a)for(;g>=m.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(i.scaledTo(g--).key);return x}anyTilesAfterTime(i=Date.now()){return this._lastTilesetChange>=i}}class J0{constructor(i,a,m){this._meshCache={},this.painter=i,this.sourceCache=new Na(a),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,a,m,g=l.X){var x;if(!(a>=0&&a<g&&m>=0&&m<g))return 0;const T=this.getTerrainData(i),C=(x=T.tile)===null||x===void 0?void 0:x.dem;if(!C)return 0;const M=l.c9([],[a/g*l.X,m/g*l.X],T.u_terrain_matrix),z=[M[0]*C.dim,M[1]*C.dim],V=Math.floor(z[0]),q=Math.floor(z[1]),Z=z[0]-V,J=z[1]-q;return C.get(V,q)*(1-Z)*(1-J)+C.get(V+1,q)*Z*(1-J)+C.get(V,q+1)*(1-Z)*J+C.get(V+1,q+1)*Z*J}getElevationForLngLatZoom(i,a){if(!l.ca(a,i.wrap()))return 0;const{tileID:m,mercatorX:g,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(i,a);return this.getElevation(m,g%l.X,x%l.X,l.X)}getElevation(i,a,m,g=l.X){return this.getDEMElevation(i,a,m,g)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const g=this.painter.context,x=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Q(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Q(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.aq([])}const a=this.sourceCache.getSourceTile(i,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const g=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Q(g,a.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),a.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const m=a&&a+a.tileID.key+i.key;if(m&&!this._demMatrixCache[m]){const g=this.sourceCache.sourceCache._source.maxzoom;let x=i.canonical.z-a.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=g?x=i.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=i.canonical.x-(i.canonical.x>>x<<x),C=i.canonical.y-(i.canonical.y>>x<<x),M=l.cb(new Float64Array(16),[1/(l.X<<x),1/(l.X<<x),0]);l.J(M,M,[T*l.X,C*l.X,0]),this._demMatrixCache[i.key]={matrix:M,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(i){const a=this.painter,m=a.width/devicePixelRatio,g=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Q(a.context,{width:m,height:g,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Q(a.context,{width:m,height:g,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(m,g,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,m,g))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,T=0;x<this._coordsTextureSize;x++)for(let C=0;C<this._coordsTextureSize;C++,T+=4)a[T+0]=255&C,a[T+1]=255&x,a[T+2]=C>>8<<4|x>>8,a[T+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),g=new Q(i,m,i.gl.RGBA,{premultiply:!1});return g.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),m=this.painter.context,g=m.gl,x=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(x,C-T-1,1,1,g.RGBA,g.UNSIGNED_BYTE,a),m.bindFramebuffer.set(null);const M=a[0]+(a[2]>>4<<8),z=a[1]+((15&a[2])<<8),V=this.coordsIndex[255-a[3]],q=V&&this.sourceCache.getTileByID(V);if(!q)return null;const Z=this._coordsTextureSize,J=(1<<q.tileID.canonical.z)*Z;return new l.Y((q.tileID.canonical.x*Z+M)/J+q.tileID.wrap,(q.tileID.canonical.y*Z+z)/J,this.getElevation(q.tileID,M,z,Z))}depthAtPoint(i){const a=new Uint8Array(4),m=this.painter.context,g=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,a),m.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(i){var a;const m=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,g=m&&i.canonical.y===0,x=m&&i.canonical.y===(1<<i.canonical.z)-1,T=`m_${g?"n":""}_${x?"s":""}`;if(this._meshCache[T])return this._meshCache[T];const C=this.painter.context,M=new l.cc,z=new l.aE,V=this.meshSize,q=l.X/V,Z=V*V;for(let De=0;De<=V;De++)for(let Ze=0;Ze<=V;Ze++)M.emplaceBack(Ze*q,De*q,0);for(let De=0;De<Z;De+=V+1)for(let Ze=0;Ze<V;Ze++)z.emplaceBack(Ze+De,V+Ze+De+1,V+Ze+De+2),z.emplaceBack(Ze+De,V+Ze+De+2,Ze+De+1);const J=M.length,ne=J+(V+1),ye=(V+1)*V,_e=g?l.b6:0,xe=g?0:1,be=x?l.b7:l.X,Ce=x?0:1;for(let De=0;De<=V;De++)M.emplaceBack(De*q,_e,xe);for(let De=0;De<=V;De++)M.emplaceBack(De*q,be,Ce);for(let De=0;De<V;De++)z.emplaceBack(ye+De,ne+De,ne+De+1),z.emplaceBack(ye+De,ne+De+1,ye+De+1),z.emplaceBack(0+De,J+De+1,J+De),z.emplaceBack(0+De,0+De+1,J+De+1);const ke=M.length,Re=ke+2*(V+1);for(const De of[0,1])for(let Ze=0;Ze<=V;Ze++)for(const Ke of[0,1])M.emplaceBack(De*l.X,Ze*q,Ke);for(let De=0;De<2*V;De+=2)z.emplaceBack(ke+De,ke+De+1,ke+De+3),z.emplaceBack(ke+De,ke+De+3,ke+De+2),z.emplaceBack(Re+De,Re+De+3,Re+De+1),z.emplaceBack(Re+De,Re+De+2,Re+De+3);const ze=new Ur(C.createVertexBuffer(M,b_.members),C.createIndexBuffer(z),l.aD.simpleSegment(0,0,M.length,z.length));return this._meshCache[T]=ze,ze}getMeshFrameDelta(i){return 2*Math.PI*l.bo/Math.pow(2,Math.max(i,0))/5}getMinTileElevationForLngLatZoom(i,a){var m;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(i,a);return(m=this.getMinMaxElevation(g).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(i){const a=this.getTerrainData(i).tile,m={minElevation:null,maxElevation:null};return a&&a.dem&&(m.minElevation=a.dem.min*this.exaggeration,m.maxElevation=a.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(i,a){const m=l.Y.fromLngLat(i.wrap()),g=(1<<a)*l.X,x=m.x*g,T=m.y*g,C=Math.floor(x/l.X),M=Math.floor(T/l.X);return{tileID:new l.S(a,0,a,C,M),mercatorX:x,mercatorY:T}}}class jh{constructor(i,a,m){this._context=i,this._size=a,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new Q(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(m.texture),{id:i,fbo:a,texture:m,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>i.id!==a),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const mi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class rr{constructor(i,a){this.painter=i,this.terrain=a,this.pool=new jh(i.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(m=>!i._layers[m].isHidden(a)),this._coordsAscending={};for(const m in i.sourceCaches){this._coordsAscending[m]={};const g=i.sourceCaches[m].getVisibleCoordinates();for(const x of g){const T=this.terrain.sourceCache.getTerrainCoords(x);for(const C in T)this._coordsAscending[m][C]||(this._coordsAscending[m][C]=[]),this._coordsAscending[m][C].push(T[C])}}this._coordsAscendingStr={};for(const m of i._order){const g=i._layers[m],x=g.source;if(mi[g.type]&&!this._coordsAscendingStr[x]){this._coordsAscendingStr[x]={};for(const T in this._coordsAscending[x])this._coordsAscendingStr[x][T]=this._coordsAscending[x][T].map(C=>C.key).sort().join()}}for(const m of this._renderableTiles)for(const g in this._coordsAscendingStr){const x=this._coordsAscendingStr[g][m.tileID.key];x&&x!==m.rttCoords[g]&&(m.rtt=[])}}renderLayer(i,a){if(i.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),g=i.type,x=this.painter,T=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(mi[g]&&(this._prevType&&mi[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(i.id),!T))return!0;if(mi[this._prevType]||mi[g]&&T){this._prevType=g;const C=this._stacks.length-1,M=this._stacks[C]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(rs(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[C]){const q=this.pool.getObjectForId(z.rtt[C].id);if(q.stamp===z.rtt[C].stamp){this.pool.useObject(q);continue}}const V=this.pool.getOrCreateFreeObject();this.pool.useObject(V),this.pool.stampObject(V),z.rtt[C]={id:V.id,stamp:V.stamp},x.context.bindFramebuffer.set(V.fbo.framebuffer),x.context.clear({color:l.b4.transparent,stencil:0}),x.currentStencilSource=void 0;for(let q=0;q<M.length;q++){const Z=x.style._layers[M[q]],J=Z.source?this._coordsAscending[Z.source][z.tileID.key]:[z.tileID];x.context.viewport.set([0,0,V.fbo.width,V.fbo.height]),x._renderTileClippingMasks(Z,J,!0),x.renderLayer(x,x.style.sourceCaches[Z.source],Z,J,m),Z.source&&(z.rttCoords[Z.source]=this._coordsAscendingStr[Z.source][z.tileID.key])}}return rs(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),mi[g]}return!1}}const T_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Uh=S,$h={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Vh,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Hp={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Gp{constructor(i,a,m=!1){this.mousedown=x=>{this.startMove(x,$.mousePos(this.element,x)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,$.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHanlder.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const g=new Bh;this._rotatePitchHanlder=new Rt({clickTolerance:3,move:(x,T)=>{const C=a.getBoundingClientRect(),M=new l.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:l.c7(new l.P(x.x,T.y),T,M),pitchDelta:m?-.5*(T.y-x.y):void 0}},moveStateManager:g,enable:!0,assignEvents:()=>{}}),this.map=i,$.addEventListener(a,"mousedown",this.mousedown),$.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(a,"touchcancel",this.reset)}startMove(i,a){this._rotatePitchHanlder.dragStart(i,a),$.disableDrag()}move(i,a){const m=this.map,{bearingDelta:g,pitchDelta:x}=this._rotatePitchHanlder.dragMove(i,a)||{};g&&m.setBearing(m.getBearing()+g),x&&m.setPitch(m.getPitch()+x)}off(){const i=this.element;$.removeEventListener(i,"mousedown",this.mousedown),$.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let vl;function Dc(v,i,a){const m=new l.N(v.lng,v.lat);if(v=new l.N(v.lng,v.lat),i){const g=new l.N(v.lng-360,v.lat),x=new l.N(v.lng+360,v.lat),T=a.locationToScreenPoint(v).distSqr(i);a.locationToScreenPoint(g).distSqr(i)<T?v=g:a.locationToScreenPoint(x).distSqr(i)<T&&(v=x)}for(;Math.abs(v.lng-a.center.lng)>180;){const g=a.locationToScreenPoint(v);if(g.x>=0&&g.y>=0&&g.x<=a.width&&g.y<=a.height)break;v.lng>a.center.lng?v.lng-=360:v.lng+=360}return v.lng!==m.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(v))?v:m}const qh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rf(v,i,a){const m=v.classList;for(const g in qh)m.remove(`maplibregl-${a}-anchor-${g}`);m.add(`maplibregl-${a}-anchor-${i}`)}class Hh extends l.E{constructor(i){if(super(),this._onKeyPress=a=>{const m=a.code,g=a.charCode||a.keyCode;m!=="Space"&&m!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=a=>{const m=a.originalEvent.target,g=this._element;this._popup&&(m===g||g.contains(m))&&this.togglePopup()},this._update=a=>{var m;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Dc(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${qh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${x}`),H.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const a=$.createNS("http://www.w3.org/2000/svg","svg"),m=41,g=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${m}px`),a.setAttributeNS(null,"width",`${g}px`),a.setAttributeNS(null,"viewBox",`0 0 ${g} ${m}`);const x=$.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const T=$.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const C=$.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of M){const be=$.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",xe.rx),be.setAttributeNS(null,"ry",xe.ry),C.appendChild(be)}const z=$.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const V=$.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(V);const q=$.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const Z=$.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(Z);const J=$.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const ne=$.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ye=$.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#000000"),ye.setAttributeNS(null,"opacity","0.25"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962");const _e=$.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),ne.appendChild(ye),ne.appendChild(_e),T.appendChild(C),T.appendChild(z),T.appendChild(q),T.appendChild(J),T.appendChild(ne),a.appendChild(T),a.setAttributeNS(null,"height",m*this._scale+"px"),a.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),rf(this._element,this._anchor,"marker"),i&&i.className)for(const a of i.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),i.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.N.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var a,m;if(!(!((a=this._map)===null||a===void 0)&&a.terrain)){const q=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,x=g.terrain.depthAtPoint(this._pos),T=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,T)-x<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/g.transform.pixelsPerMeter,M=Math.sin(g.getPitch()*Math.PI/180)*C,z=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),V=g.transform.lngLatToCameraDepth(this._lngLat,T+M)-z>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,a){return i===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Zp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let zc=0,Hu=!1;const Wp={maxWidth:100,unit:"metric"};function sf(v,i,a){const m=a&&a.maxWidth||100,g=v._container.clientHeight/2,x=v._container.clientWidth/2,T=v.unproject([x-m/2,g]),C=v.unproject([x+m/2,g]),M=Math.round(v.project(C).x-v.project(T).x),z=Math.min(m,M,v._container.clientWidth),V=T.distanceTo(C);if(a&&a.unit==="imperial"){const q=3.2808*V;q>5280?nu(i,z,q/5280,v._getUIString("ScaleControl.Miles")):nu(i,z,q,v._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?nu(i,z,V/1852,v._getUIString("ScaleControl.NauticalMiles")):V>=1e3?nu(i,z,V/1e3,v._getUIString("ScaleControl.Kilometers")):nu(i,z,V,v._getUIString("ScaleControl.Meters"))}function nu(v,i,a,m){const g=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(C),T*C}(a);v.style.width=i*(g/a)+"px",v.innerHTML=`${g}&nbsp;${m}`}const Kp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Xp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gh(v){if(v){if(typeof v=="number"){const i=Math.round(Math.abs(v)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,v),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-v),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(v,0),right:new l.P(-v,0)}}if(v instanceof l.P||Array.isArray(v)){const i=l.P.convert(v);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(v.center||[0,0]),top:l.P.convert(v.top||[0,0]),"top-left":l.P.convert(v["top-left"]||[0,0]),"top-right":l.P.convert(v["top-right"]||[0,0]),bottom:l.P.convert(v.bottom||[0,0]),"bottom-left":l.P.convert(v["bottom-left"]||[0,0]),"bottom-right":l.P.convert(v["bottom-right"]||[0,0]),left:l.P.convert(v.left||[0,0]),right:l.P.convert(v.right||[0,0])}}return Gh(new l.P(0,0))}const Yp=S;f.AJAXError=l.cg,f.Event=l.k,f.Evented=l.E,f.LngLat=l.N,f.MercatorCoordinate=l.Y,f.Point=l.P,f.addProtocol=l.ch,f.config=l.a,f.removeProtocol=l.ci,f.AttributionControl=tf,f.BoxZoomHandler=u_,f.CanvasSource=bo,f.CooperativeGesturesHandler=qp,f.DoubleClickZoomHandler=yl,f.DragPanHandler=Jd,f.DragRotateHandler=Up,f.EdgeInsets=Yi,f.FullscreenControl=class extends l.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var i;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=a==null?void 0:a.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=no,f.GeolocateControl=class extends l.E{constructor(v){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const a=new l.N(i.coords.longitude,i.coords.latitude),m=i.coords.accuracy,g=this._map.getBearing(),x=l.e({bearing:g},this.options.fitBoundsOptions),T=wi.fromLngLat(a,m);this._map.fitBounds(T,x,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const a=new l.N(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&Hu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Hh({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Zp,v)}onAdd(v){return this._map=v,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(i=!1){if(vl!==void 0&&!i)return vl;if(window.navigator.permissions===void 0)return vl=!!window.navigator.geolocation,vl;try{vl=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{vl=!!window.navigator.geolocation}return vl})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zc=0,Hu=!1}_isOutOfMapMaxBounds(v){const i=this._map.getMaxBounds(),a=v.coords;return i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),i=v.getSouthEast(),a=v.getNorthEast(),m=i.distanceTo(a),g=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zc--,Hu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zc++,zc>1?(v={maximumAge:6e5,timeout:0},Hu=!0):(v=this.options.positionOptions,Hu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const i=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(i!=="mercator"&&i?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=$.create("button","maplibregl-ctrl-globe",this._container),$.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=zh,f.ImageSource=hr,f.KeyboardHandler=y_,f.LngLatBounds=wi,f.LogoControl=nf,f.Map=class extends Kt{constructor(v){var i,a;l.cd.mark(l.ce.create);const m=Object.assign(Object.assign(Object.assign({},$h),v),{canvasContextAttributes:Object.assign(Object.assign({},$h.canvasContextAttributes),v.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const g=new Vs,x=new rl;if(m.minZoom!==void 0&&g.setMinZoom(m.minZoom),m.maxZoom!==void 0&&g.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&g.setMinPitch(m.minPitch),m.maxPitch!==void 0&&g.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&g.setRenderWorldCopies(m.renderWorldCopies),super(g,x,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new qs,this._controls=[],this._mapId=l.a1(),this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},T_),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=je.addThrottleControl(()=>this.isMoving()),this._requestManager=new rt(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const M=Da(z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())},50);this._resizeObserver=new ResizeObserver(z=>{C?M(z):C=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Vt(this,m),this._hash=m.hash&&new zh(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.e({},m.fitBoundsOptions,{duration:0}))));const T=typeof m.style=="string"||((a=(i=m.style)===null||i===void 0?void 0:i.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,T),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new tf(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new nf,m.logoPosition),this.on("style.load",()=>{if(T||this._resizeTransform(),this.transform.unmodified){const C=l.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}}),this.on("data",C=>{this._update(C.dataType==="style"),this.fire(new l.k(`${C.dataType}data`,C))}),this.on("dataloading",C=>{this.fire(new l.k(`${C.dataType}dataloading`,C))}),this.on("dataabort",C=>{this.fire(new l.k("sourcedataabort",C))})}_getMapId(){return this._mapId}addControl(v,i){if(i===void 0&&(i=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=v.onAdd(this);this._controls.push(v);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(a,m.firstChild):m.appendChild(a),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(v);return i>-1&&this._controls.splice(i,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,i,a,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,i,a,m)}resize(v,i=!0){const[a,m]=this._containerDimensions(),g=this._getClampedPixelRatio(a,m);if(this._resizeCanvas(a,m,g),this.painter.resize(a,m,g),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const C=this._getClampedPixelRatio(a,m);this._resizeCanvas(a,m,C),this.painter.resize(a,m,C)}this._resizeTransform(i);const x=!this._moving;return x&&(this.stop(),this.fire(new l.k("movestart",v)).fire(new l.k("move",v))),this.fire(new l.k("resize",v)),x&&this.fire(new l.k("moveend",v)),this}_resizeTransform(v=!0){var i;const[a,m]=this._containerDimensions();this.transform.resize(a,m,v),(i=this._requestedCameraState)===null||i===void 0||i.resize(a,m,v)}_getClampedPixelRatio(v,i){const{0:a,1:m}=this._maxCanvasSize,g=this.getPixelRatio(),x=v*g,T=i*g;return Math.min(x>a?a/x:1,T>m?m/T:1)*g}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(wi.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.setMinZoom(v),this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.setMaxZoom(v),this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}project(v){return this.transform.locationToScreenPoint(l.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(l.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,i,a){if(v==="mouseenter"||v==="mouseover"){let m=!1;return{layers:i,listener:a,delegates:{mousemove:x=>{const T=i.filter(M=>this.getLayer(M)),C=T.length!==0?this.queryRenderedFeatures(x.point,{layers:T}):[];C.length?m||(m=!0,a.call(this,new Ii(v,this,x.originalEvent,{features:C}))):m=!1},mouseout:()=>{m=!1}}}}if(v==="mouseleave"||v==="mouseout"){let m=!1;return{layers:i,listener:a,delegates:{mousemove:T=>{const C=i.filter(M=>this.getLayer(M));(C.length!==0?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?m=!0:m&&(m=!1,a.call(this,new Ii(v,this,T.originalEvent)))},mouseout:T=>{m&&(m=!1,a.call(this,new Ii(v,this,T.originalEvent)))}}}}{const m=g=>{const x=i.filter(C=>this.getLayer(C)),T=x.length!==0?this.queryRenderedFeatures(g.point,{layers:x}):[];T.length&&(g.features=T,a.call(this,g),delete g.features)};return{layers:i,listener:a,delegates:{[v]:m}}}}_saveDelegatedListener(v,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(i)}_removeDelegatedListener(v,i,a){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const m=this._delegatedListeners[v];for(let g=0;g<m.length;g++){const x=m[g];if(x.listener===a&&x.layers.length===i.length&&x.layers.every(T=>i.includes(T))){for(const T in x.delegates)this.off(T,x.delegates[T]);return void m.splice(g,1)}}}on(v,i,a){if(a===void 0)return super.on(v,i);const m=typeof i=="string"?[i]:i,g=this._createDelegatedListener(v,m,a);this._saveDelegatedListener(v,g);for(const x in g.delegates)this.on(x,g.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(v,m,a)}}}once(v,i,a){if(a===void 0)return super.once(v,i);const m=typeof i=="string"?[i]:i,g=this._createDelegatedListener(v,m,a);for(const x in g.delegates){const T=g.delegates[x];g.delegates[x]=(...C)=>{this._removeDelegatedListener(v,m,a),T(...C)}}this._saveDelegatedListener(v,g);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(v,i,a){return a===void 0?super.off(v,i):(this._removeDelegatedListener(v,typeof i=="string"?[i]:i,a),this)}queryRenderedFeatures(v,i){if(!this.style)return[];let a;const m=v instanceof l.P||Array.isArray(v),g=m?v:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(m?{}:v)||{},g instanceof l.P||typeof g[0]=="number")a=[l.P.convert(g)];else{const x=l.P.convert(g[0]),T=l.P.convert(g[1]);a=[x,new l.P(T.x,x.y),T,new l.P(x.x,T.y),x]}return this.style.queryRenderedFeatures(a,i,this.transform)}querySourceFeatures(v,i){return this.style.querySourceFeatures(v,i)}setStyle(v,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(v,i))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const i=this._locale[v];if(i==null)throw new Error(`Missing UI string '${v}'`);return i}_updateStyle(v,i){var a,m;if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,i));const g=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new vr(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,i,g):this.style.loadJSON(v,i,g),this):((m=(a=this.style)===null||a===void 0?void 0:a.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,i){if(typeof v=="string"){const a=this._requestManager.transformRequest(v,"Style");l.h(a,new AbortController).then(m=>{this._updateDiff(m.data,i)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof v=="object"&&this._updateDiff(v,i)}_updateDiff(v,i){try{this.style.setState(v,i)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(v,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(v,i){return this._lazyInitEmptyStyle(),this.style.addSource(v,i),this._update(!0)}isSourceLoaded(v){const i=this.style&&this.style.sourceCaches[v];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const i=this.style.sourceCaches[v.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&i.reload();for(const a in this.style._layers){const m=this.style._layers[a];m.type==="hillshade"&&m.source===v.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new J0(this.painter,i,v),this.painter.renderToTexture=new rr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.k("terrain",{terrain:v})),this}getTerrain(){var v,i;return(i=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const i in v){const a=v[i]._tiles;for(const m in a){const g=a[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,i,a={}){const{pixelRatio:m=1,sdf:g=!1,stretchX:x,stretchY:T,content:C,textFitWidth:M,textFitHeight:z}=a;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:V,height:q,data:Z}=i,J=i;return this.style.addImage(v,{data:new l.R({width:V,height:q},new Uint8Array(Z)),pixelRatio:m,stretchX:x,stretchY:T,content:C,textFitWidth:M,textFitHeight:z,sdf:g,version:0,userImage:J}),J.onAdd&&J.onAdd(this,v),this}}{const{width:V,height:q,data:Z}=H.getImageData(i);this.style.addImage(v,{data:new l.R({width:V,height:q},Z),pixelRatio:m,stretchX:x,stretchY:T,content:C,textFitWidth:M,textFitHeight:z,sdf:g,version:0})}}updateImage(v,i){const a=this.style.getImage(v);if(!a)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof HTMLImageElement||l.b(i)?H.getImageData(i):i,{width:g,height:x,data:T}=m;if(g===void 0||x===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==a.data.width||x!==a.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(i instanceof HTMLImageElement||l.b(i));return a.data.replace(T,C),this.style.updateImage(v,a),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return je.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,i){return this._lazyInitEmptyStyle(),this.style.addLayer(v,i),this._update(!0)}moveLayer(v,i){return this.style.moveLayer(v,i),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,i,a){return this.style.setLayerZoomRange(v,i,a),this._update(!0)}setFilter(v,i,a={}){return this.style.setFilter(v,i,a),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,i,a,m={}){return this.style.setPaintProperty(v,i,a,m),this._update(!0)}getPaintProperty(v,i){return this.style.getPaintProperty(v,i)}setLayoutProperty(v,i,a,m={}){return this.style.setLayoutProperty(v,i,a,m),this._update(!0)}getLayoutProperty(v,i){return this.style.getLayoutProperty(v,i)}setGlyphs(v,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,i,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,i,a,m=>{m||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,i,a=>{a||this._update(!0)}),this}setLight(v,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,i={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,i),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,i){return this.style.setFeatureState(v,i),this._update()}removeFeatureState(v,i){return this.style.removeFeatureState(v,i),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,i=0;return this._container&&(v=this._container.clientWidth||400,i=this._container.clientHeight||300),[v,i]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const i=this._canvasContainer=$.create("div","maplibregl-canvas-container",v);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),m=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],m);const g=this._controlContainer=$.create("div","maplibregl-control-container",v),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{x[T]=$.create("div",`maplibregl-ctrl-${T} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,i,a){this._canvas.width=Math.floor(a*v),this._canvas.height=Math.floor(a*i),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let i=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{i={requestedAttributes:v},m&&(i.statusMessage=m.statusMessage,i.type=m.type)},{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!a){const m="Failed to initialize WebGL";throw i?(i.message=m,new Error(JSON.stringify(i))):new Error(m)}this.painter=new ml(a,this.transform),ie.testSupport(a)}migrateProjection(v,i){super.migrateProjection(v,i),this.painter.transform=v,this.fire(new l.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var i,a,m,g,x;const T=this._idleTriggered?this._fadeDuration:0,C=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const q=this.transform.zoom,Z=H.now();this.style.zoomHistory.update(q,Z);const J=new l.z(q,{now:Z,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ne=J.crossFadingFactor();ne===1&&ne===this._crossFadingFactor||(M=!0,this._crossFadingFactor=ne),this.style.update(J)}const z=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==C;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((g=this.style.projection)===null||g===void 0?void 0:g.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cd.mark(l.ce.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const V=this._sourcesDirty||this._styleDirty||this._placementDirty;return V||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||V||(this._fullyLoaded=!0,l.cd.mark(l.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),je.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cd.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,H.frame(this._frameRequest,v=>{l.cd.frame(v),this._frameRequest=null;try{this._render(v)}catch(i){if(!l.cf(i)&&!function(a){return a.message===Ou}(i))throw i}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Uh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},f.MapMouseEvent=Ii,f.MapTouchEvent=gl,f.MapWheelEvent=lo,f.Marker=Hh,f.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const i=this._map.getZoom(),a=i===this._map.getMaxZoom(),m=i===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(i,a)=>{const m=this._map._getUIString(`NavigationControl.${a}`);i.title=m,i.setAttribute("aria-label",m)},this.options=l.e({},Hp,v),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,i){const a=$.create("button",v,this._container);return a.type="button",a.addEventListener("click",i),a}},f.Popup=class extends l.E{constructor(v){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Dc(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!i)return;const m=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationToScreenPoint(this._lngLat));let g=this.options.anchor;const x=Gh(this.options.offset);if(!g){const C=this._container.offsetWidth,M=this._container.offsetHeight;let z;z=m.y+x.bottom.y<M?["top"]:m.y>this._map.transform.height-M?["bottom"]:[],m.x<C/2?z.push("left"):m.x>this._map.transform.width-C/2&&z.push("right"),g=z.length===0?"bottom":z.join("-")}let T=m.add(x[g]);this.options.subpixelPositioning||(T=T.round()),$.setTransform(this._container,`${qh[g]} translate(${T.x}px,${T.y}px)`),rf(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Kp),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=l.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const i=document.createDocumentFragment(),a=document.createElement("body");let m;for(a.innerHTML=v;m=a.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Xp);v&&v.focus()}},f.RasterDEMTileSource=hs,f.RasterTileSource=Br,f.ScaleControl=class{constructor(v){this._onMove=()=>{sf(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,sf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Wp),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=w_,f.Style=vr,f.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=Yd,f.TwoFingersTouchRotateHandler=g_,f.TwoFingersTouchZoomHandler=Kd,f.TwoFingersTouchZoomRotateHandler=$p,f.VectorTileSource=to,f.VideoSource=zs,f.addSourceType=(v,i)=>l._(void 0,void 0,void 0,function*(){if(Xo(v))throw new Error(`A source type called "${v}" already exists.`);((a,m)=>{ds[a]=m})(v,i)}),f.clearPrewarmedResources=function(){const v=vn;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(nn),vn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=oi,f.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Vr().getRTLTextPluginStatus()},f.getVersion=function(){return Yp},f.getWorkerCount=function(){return rn.workerCount},f.getWorkerUrl=function(){return l.a.WORKER_URL},f.importScriptInWorkers=function(v){return Ir().broadcast("IS",v)},f.prewarm=function(){on().acquire(nn)},f.setMaxParallelImageRequests=function(v){l.a.MAX_PARALLEL_IMAGE_REQUESTS=v},f.setRTLTextPlugin=function(v,i){return Vr().setRTLTextPlugin(v,i)},f.setWorkerCount=function(v){rn.workerCount=v},f.setWorkerUrl=function(v){l.a.WORKER_URL=v}});var h=n;return h})})(MD);var h7=MD.exports;const Zt=Xv(h7);function d7(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class f7{constructor(){this._apiKey="",this._fetch=d7(),this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const tp=new f7,p7={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},m7={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!1},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!1},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!1},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!1},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!1},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!1},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!1},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!1},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!1},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!1},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!1},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!1},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!1},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!1},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},o_={...p7,...m7};function g7(t,e=o_){return t in e?t[t]:null}function l1(t,e=o_){for(const n of Object.values(e))if(n.code===t)return n;return null}function u1(t,e=o_){for(const n of Object.values(e))if(n.flag===t)return n;return null}function _7(t){return t!==null&&typeof t=="object"&&"code"in t&&"flag"in t&&"name"in t&&"latin"in t&&"isMode"in t&&"geocoding"in t&&(typeof t.code=="string"||t.code===null)&&typeof t.flag=="string"&&typeof t.name=="string"&&typeof t.latin=="boolean"&&typeof t.isMode=="boolean"&&typeof t.geocoding=="boolean"}function bC(t,e=o_){return _7(t)?u1(t.flag,e):typeof t!="string"?null:g7(t,e)||l1(t,e)||u1(t,e)||null}async function y7(t,e={}){if(tp.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(t).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return tp.fetch(t,e)}const LD={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(LD);class v7 extends Error{constructor(e,n=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${n}`),this.res=e}}const TC={403:"Key is missing, invalid or restricted"};async function x7(t={}){const e=new URL("geolocation/ip.json",LD.maptilerApiURL);e.searchParams.set("key",t.apiKey??tp.apiKey);const n=e.toString(),r=await y7(n);if(!r.ok)throw new v7(r,r.status in TC?TC[r.status]:"");return await r.json()}const SC={info:x7};function DD(t){const e=/^maptiler:\/\/(.*)/;let n;const r=t.trim();let o;return r.startsWith("http://")||r.startsWith("https://")?o=r:(n=e.exec(r))!==null?o=`https://api.maptiler.com/maps/${n[1]}/style.json`:o=`https://api.maptiler.com/maps/${r}/style.json`,o}class zD{constructor(e,n,r,o,h,f){this.name=e,this.variantType=n,this.id=r,this.referenceStyle=o,this.description=h,this.imageURL=f}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){return this.referenceStyle.getVariant(e)}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return DD(this.getId())}}class ND{constructor(e,n){this.name=e,this.id=n,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const og=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function w7(t){return new Proxy(t,{get(e,n,r){return e.hasVariant(n)?e.getVariant(n):n.toString().toUpperCase()===n?t.getDefaultVariant():Reflect.get(e,n,r)}})}function b7(){const t={};for(let e=0;e<og.length;e+=1){const n=og[e],r=w7(new ND(n.name,n.referenceStyleID));for(let o=0;o<n.variants.length;o+=1){const h=n.variants[o],f=new zD(h.name,h.variantType,h.id,r,h.description,h.imageURL);r.addVariant(f)}t[n.referenceStyleID]=r}return t}const ag=b7();var b2={exports:{}},np=typeof Reflect=="object"?Reflect:null,EC=np&&typeof np.apply=="function"?np.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Hy;np&&typeof np.ownKeys=="function"?Hy=np.ownKeys:Object.getOwnPropertySymbols?Hy=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Hy=function(e){return Object.getOwnPropertyNames(e)};function T7(t){console&&console.warn&&console.warn(t)}var OD=Number.isNaN||function(e){return e!==e};function Ai(){Ai.init.call(this)}b2.exports=Ai;b2.exports.once=P7;Ai.EventEmitter=Ai;Ai.prototype._events=void 0;Ai.prototype._eventsCount=0;Ai.prototype._maxListeners=void 0;var IC=10;function D0(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ai,"defaultMaxListeners",{enumerable:!0,get:function(){return IC},set:function(t){if(typeof t!="number"||t<0||OD(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");IC=t}});Ai.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ai.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||OD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function FD(t){return t._maxListeners===void 0?Ai.defaultMaxListeners:t._maxListeners}Ai.prototype.getMaxListeners=function(){return FD(this)};Ai.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var o=e==="error",h=this._events;if(h!==void 0)o=o&&h.error===void 0;else if(!o)return!1;if(o){var f;if(n.length>0&&(f=n[0]),f instanceof Error)throw f;var l=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw l.context=f,l}var S=h[e];if(S===void 0)return!1;if(typeof S=="function")EC(S,this,n);else for(var A=S.length,O=$D(S,A),r=0;r<A;++r)EC(O[r],this,n);return!0};function BD(t,e,n,r){var o,h,f;if(D0(n),h=t._events,h===void 0?(h=t._events=Object.create(null),t._eventsCount=0):(h.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),h=t._events),f=h[e]),f===void 0)f=h[e]=n,++t._eventsCount;else if(typeof f=="function"?f=h[e]=r?[n,f]:[f,n]:r?f.unshift(n):f.push(n),o=FD(t),o>0&&f.length>o&&!f.warned){f.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=f.length,T7(l)}return t}Ai.prototype.addListener=function(e,n){return BD(this,e,n,!1)};Ai.prototype.on=Ai.prototype.addListener;Ai.prototype.prependListener=function(e,n){return BD(this,e,n,!0)};function S7(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function VD(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=S7.bind(r);return o.listener=n,r.wrapFn=o,o}Ai.prototype.once=function(e,n){return D0(n),this.on(e,VD(this,e,n)),this};Ai.prototype.prependOnceListener=function(e,n){return D0(n),this.prependListener(e,VD(this,e,n)),this};Ai.prototype.removeListener=function(e,n){var r,o,h,f,l;if(D0(n),o=this._events,o===void 0)return this;if(r=o[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(h=-1,f=r.length-1;f>=0;f--)if(r[f]===n||r[f].listener===n){l=r[f].listener,h=f;break}if(h<0)return this;h===0?r.shift():E7(r,h),r.length===1&&(o[e]=r[0]),o.removeListener!==void 0&&this.emit("removeListener",e,l||n)}return this};Ai.prototype.off=Ai.prototype.removeListener;Ai.prototype.removeAllListeners=function(e){var n,r,o;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var h=Object.keys(r),f;for(o=0;o<h.length;++o)f=h[o],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(o=n.length-1;o>=0;o--)this.removeListener(e,n[o]);return this};function jD(t,e,n){var r=t._events;if(r===void 0)return[];var o=r[e];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?I7(o):$D(o,o.length)}Ai.prototype.listeners=function(e){return jD(this,e,!0)};Ai.prototype.rawListeners=function(e){return jD(this,e,!1)};Ai.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):UD.call(t,e)};Ai.prototype.listenerCount=UD;function UD(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Ai.prototype.eventNames=function(){return this._eventsCount>0?Hy(this._events):[]};function $D(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function E7(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function I7(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function P7(t,e){return new Promise(function(n,r){function o(f){t.removeListener(e,h),r(f)}function h(){typeof t.removeListener=="function"&&t.removeListener("error",o),n([].slice.call(arguments))}qD(t,e,h,{once:!0}),e!=="error"&&C7(t,o,{once:!0})})}function C7(t,e,n){typeof t.on=="function"&&qD(t,"error",e,n)}function qD(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(h){r.once&&t.removeEventListener(e,o),n(h)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var A7=b2.exports;const k7=Xv(A7),Es=[];for(let t=0;t<256;++t)Es.push((t+256).toString(16).slice(1));function M7(t,e=0){return(Es[t[e+0]]+Es[t[e+1]]+Es[t[e+2]]+Es[t[e+3]]+"-"+Es[t[e+4]]+Es[t[e+5]]+"-"+Es[t[e+6]]+Es[t[e+7]]+"-"+Es[t[e+8]]+Es[t[e+9]]+"-"+Es[t[e+10]]+Es[t[e+11]]+Es[t[e+12]]+Es[t[e+13]]+Es[t[e+14]]+Es[t[e+15]]).toLowerCase()}let Rw;const R7=new Uint8Array(16);function L7(){if(!Rw){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Rw=crypto.getRandomValues.bind(crypto)}return Rw(R7)}const D7=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),PC={randomUUID:D7};function z7(t,e,n){var o;if(PC.randomUUID&&!t)return PC.randomUUID();t=t||{};const r=t.random??((o=t.rng)==null?void 0:o.call(t))??L7();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,M7(r)}const HD="3.7.7",N7=HD,zp=typeof Buffer=="function",CC=typeof TextDecoder=="function"?new TextDecoder:void 0,AC=typeof TextEncoder=="function"?new TextEncoder:void 0,O7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",qm=Array.prototype.slice.call(O7),gy=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(qm),F7=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ps=String.fromCharCode.bind(String),kC=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),GD=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),ZD=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),WD=t=>{let e,n,r,o,h="";const f=t.length%3;for(let l=0;l<t.length;){if((n=t.charCodeAt(l++))>255||(r=t.charCodeAt(l++))>255||(o=t.charCodeAt(l++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,h+=qm[e>>18&63]+qm[e>>12&63]+qm[e>>6&63]+qm[e&63]}return f?h.slice(0,f-3)+"===".substring(f):h},T2=typeof btoa=="function"?t=>btoa(t):zp?t=>Buffer.from(t,"binary").toString("base64"):WD,c1=zp?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(Ps.apply(null,t.subarray(r,r+4096)));return T2(n.join(""))},Gy=(t,e=!1)=>e?GD(c1(t)):c1(t),B7=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?Ps(192|e>>>6)+Ps(128|e&63):Ps(224|e>>>12&15)+Ps(128|e>>>6&63)+Ps(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return Ps(240|e>>>18&7)+Ps(128|e>>>12&63)+Ps(128|e>>>6&63)+Ps(128|e&63)}},V7=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,KD=t=>t.replace(V7,B7),MC=zp?t=>Buffer.from(t,"utf8").toString("base64"):AC?t=>c1(AC.encode(t)):t=>T2(KD(t)),ip=(t,e=!1)=>e?GD(MC(t)):MC(t),RC=t=>ip(t,!0),j7=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,U7=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Ps((n>>>10)+55296)+Ps((n&1023)+56320);case 3:return Ps((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Ps((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},XD=t=>t.replace(j7,U7),YD=t=>{if(t=t.replace(/\s+/g,""),!F7.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let h=0;h<t.length;)e=gy[t.charAt(h++)]<<18|gy[t.charAt(h++)]<<12|(r=gy[t.charAt(h++)])<<6|(o=gy[t.charAt(h++)]),n+=r===64?Ps(e>>16&255):o===64?Ps(e>>16&255,e>>8&255):Ps(e>>16&255,e>>8&255,e&255);return n},S2=typeof atob=="function"?t=>atob(ZD(t)):zp?t=>Buffer.from(t,"base64").toString("binary"):YD,QD=zp?t=>kC(Buffer.from(t,"base64")):t=>kC(S2(t).split("").map(e=>e.charCodeAt(0))),JD=t=>QD(ez(t)),$7=zp?t=>Buffer.from(t,"base64").toString("utf8"):CC?t=>CC.decode(QD(t)):t=>XD(S2(t)),ez=t=>ZD(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),h1=t=>$7(ez(t)),q7=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},tz=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),nz=function(){const t=(e,n)=>Object.defineProperty(String.prototype,e,tz(n));t("fromBase64",function(){return h1(this)}),t("toBase64",function(e){return ip(this,e)}),t("toBase64URI",function(){return ip(this,!0)}),t("toBase64URL",function(){return ip(this,!0)}),t("toUint8Array",function(){return JD(this)})},iz=function(){const t=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,tz(n));t("toBase64",function(e){return Gy(this,e)}),t("toBase64URI",function(){return Gy(this,!0)}),t("toBase64URL",function(){return Gy(this,!0)})},H7=()=>{nz(),iz()},G7={version:HD,VERSION:N7,atob:S2,atobPolyfill:YD,btoa:T2,btoaPolyfill:WD,fromBase64:h1,toBase64:ip,encode:ip,encodeURI:RC,encodeURL:RC,utob:KD,btou:XD,decode:h1,isValid:q7,fromUint8Array:Gy,toUint8Array:JD,extendString:nz,extendUint8Array:iz,extendBuiltins:H7};var Z7=Object.defineProperty,rz=t=>{throw TypeError(t)},W7=(t,e,n)=>e in t?Z7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kn=(t,e,n)=>W7(t,typeof e!="symbol"?e+"":e,n),E2=(t,e,n)=>e.has(t)||rz("Cannot "+n),Hn=(t,e,n)=>(E2(t,e,"read from private field"),n?n.call(t):e.get(t)),ed=(t,e,n)=>e.has(t)?rz("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Af=(t,e,n,r)=>(E2(t,e,"write to private field"),e.set(t,n),n),da=(t,e,n)=>(E2(t,e,"access private method"),n);const K7="@maptiler/sdk",X7="3.0.1",Y7="The Javascript & TypeScript map SDK tailored for MapTiler Cloud",Q7="dist/maptiler-sdk.mjs",J7="dist/maptiler-sdk.d.ts",eq="dist/maptiler-sdk.css",tq="module",nq={".":{import:"./dist/maptiler-sdk.mjs",types:"./dist/maptiler-sdk.d.ts"},"./dist/maptiler-sdk.css":{import:"./dist/maptiler-sdk.css"},"./style.css":{import:"./dist/maptiler-sdk.css"}},iq=["maptiler","map","sdk","webmap","cloud","webGL","maplibre"],rq="https://docs.maptiler.com/sdk-js/",sq="BSD-3-Clause",oq={type:"git",url:"https://github.com/maptiler/maptiler-sdk-js.git"},aq={biome:"biome check --max-diagnostics=1000","biome:fix":"npx @biomejs/biome check --max-diagnostics=1000 --write",doc:"rm -rf docs/* && typedoc --out docs && cp -r images docs/",test:"vitest run -c vite.config-test.ts","build-css":"mkdir -p dist build && node scripts/replace-path-with-content.js src/style/style_template.css dist/tmp_maptiler-sdk.css && cat node_modules/maplibre-gl/dist/maplibre-gl.css dist/tmp_maptiler-sdk.css > dist/maptiler-sdk.css && rm dist/tmp_maptiler-sdk.css && cp dist/maptiler-sdk.css build/maptiler-sdk.css","build-umd":"tsc && NODE_ENV=production vite build -c vite.config-umd.ts","build-es":"tsc && NODE_ENV=production vite build -c vite.config-es.ts",build:"npm run build-es; npm run build-umd; npm run build-css",make:"npm run biome:fix && npm run build",dev:'concurrently "vite -c vite.config-dev.ts" "npm run dev-umd"',"dev-umd":"npm run build-css && tsc && NODE_ENV=development vite build -w -c vite.config-umd.ts",ncu:"npx npm-check-updates"},lq="MapTiler",uq={"@biomejs/biome":"1.9.4","@types/uuid":"^10.0.0","@types/xmldom":"^0.1.31","@xmldom/xmldom":"^0.8.10",concurrently:"^9.1.2",typedoc:"^0.27.6",typescript:"^5.7.3",vite:"^6.0.7","vite-plugin-dts":"^4.5.0",vitest:"^2.1.8"},cq={"@maplibre/maplibre-gl-style-spec":"^23.0.0","@maptiler/client":"^2.2.0",events:"^3.3.0","js-base64":"^3.7.7","maplibre-gl":"^5.0.1",uuid:"^11.0.5"},hq={name:K7,version:X7,description:Y7,module:Q7,types:J7,style:eq,type:tq,exports:nq,keywords:iq,homepage:rq,license:sq,repository:oq,scripts:aq,author:lq,devDependencies:uq,dependencies:cq},Yn={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...o_};function LC(){if(typeof navigator>"u"){const t=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return l1(t)||Yn.ENGLISH}return Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).map(t=>l1(t)).filter(t=>t)[0]??Yn.LOCAL}const yo={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Yn.STYLE,secondaryLanguage:Yn.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(yo);const I2=z7();class dq extends k7{constructor(){super(...arguments),kn(this,"primaryLanguage",yo.primaryLanguage),kn(this,"secondaryLanguage"),kn(this,"session",!0),kn(this,"caching",!0),kn(this,"telemetry",!0),kn(this,"_unit","metric"),kn(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,tp.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){tp.fetch=e}get fetch(){return tp.fetch}}const gr=new dq,{addProtocol:DC}=Zt,d1="localcache_source",f1="localcache",fq="maptiler_sdk",pq=1e3,mq=100,p1=typeof caches<"u";function gq(t,e){if(p1&&gr.caching&&gr.session&&t.host===yo.maptilerApiHost){if(e==="Source"&&t.href.includes("tiles.json"))return t.href.replace("https://",`${d1}://`);if(e==="Tile"||e==="Glyphs")return t.href.replace("https://",`${f1}://`)}return t.href}let Lw;async function sz(){return Lw||(Lw=await caches.open(fq)),Lw}let zC=0;async function _q(){const t=await sz(),e=await t.keys(),n=e.slice(0,Math.max(e.length-pq,0));for(const r of n)t.delete(r)}function yq(){DC(d1,async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace(`${d1}://`,"https://");const n=t;n.signal=e.signal;const r=await fetch(t.url,n),o=await r.json();return o.tiles&&o.tiles.length>0&&(o.tiles[0]+=`&last-modified=${r.headers.get("Last-Modified")}`),{data:o,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}}),DC(f1,async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace(`${f1}://`,"https://");const n=new URL(t.url),r=new URL(n);r.searchParams.delete("mtsid"),r.searchParams.delete("key");const o=r.toString(),h=new URL(n);h.searchParams.delete("last-modified");const f=h.toString(),l=async H=>({data:await H.arrayBuffer(),cacheControl:H.headers.get("Cache-Control"),expires:H.headers.get("Expires")}),S=await sz(),A=await S.match(o);if(A)return l(A);const O=t;O.signal=e.signal;const U=await fetch(f,O);return U.status>=200&&U.status<300&&(S.put(o,U.clone()).catch(()=>{}),++zC>mq&&(_q(),zC=0)),l(U)})}function vq(){if(typeof window>"u")return;const t=Zt.getRTLTextPluginStatus();if(t==="unavailable"||t==="requested")try{Zt.setRTLTextPlugin(yo.rtlPluginURL,!0)}catch{}}function xq(t,e){for(const n of t)typeof e[n]=="function"&&(e[n]=e[n].bind(e))}function sc(t,e,n){const r=window.document.createElement(t);return e!==void 0&&(r.className=e),n&&n.appendChild(r),r}function P2(t){t.parentNode&&t.parentNode.removeChild(t)}function NC(t,e){let n=null;try{n=new URL(t)}catch{return{url:t}}return n.host===yo.maptilerApiHost&&(n.searchParams.has("key")||n.searchParams.append("key",gr.apiKey),gr.session&&n.searchParams.append("mtsid",I2)),{url:gq(n,e)}}function OC(t){return(e,n)=>{if(t!=null){const r=t(e,n),o=NC((r==null?void 0:r.url)??"",n);return{...r,...o}}return NC(e,n)}}function oz(){return Math.random().toString(36).substring(2)}function z0(t){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t)}function wq(t){try{return JSON.parse(t)}catch{}return null}function bq(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function Tq(t){const e=bq();if(!e)return;let n=null;if(typeof t=="string"?n=document.getElementById(t):t instanceof HTMLElement&&(n=t),!n)throw new Error("The Map container must be provided.");const r=document.createElement("div");throw r.innerHTML=e,r.classList.add("webgl-warning-div"),n.appendChild(r),new Error(e)}function Sq(t){const e="The WebGL context was lost.";let n=null;if(typeof t=="string"?n=document.getElementById(t):t instanceof HTMLElement&&(n=t),!n)throw new Error("The Map container must be provided.");const r=document.createElement("div");r.innerHTML=e,r.classList.add("webgl-warning-div"),n.appendChild(r)}function FC(t,e){return!(!Array.isArray(t)||t.length!==2||t[0]!=="get"||typeof t[1]!="string"||e&&!t[1].startsWith("name:")||!e&&t[1]!=="name")}function Eq(t,e,n){const r=structuredClone(t),o=h=>{if(typeof h!="string")for(let f=0;f<h.length;f+=1)FC(h[f],n)?h[f]=structuredClone(e):o(h[f])};return FC(r,n)?e:(o(r),r)}function Iq(t,e){const n=e?/\{name:\S+\}/:/\{name\}/;return{contains:n.test(t),exactMatch:new RegExp(`^${n.source}$`).test(t)}}function Pq(t,e,n){const r=n?/\{name:\S+\}/:/\{name\}/,o=t.split(r);return["concat",...o.flatMap((h,f)=>f===o.length-1?[h]:[h,e])]}function Cq(t){var e;const n=/\{name(?:\:(?<language>\S+))?\}/g,r=[];for(;;){const o=n.exec(t);if(!o)break;const h=((e=o.groups)==null?void 0:e.language)??null;r.push(h)}return r}function Aq(t){return!Array.isArray(t)||t.length!==2||t[0]!=="get"||typeof t[1]!="string"?null:t[1].trim()==="name"?{isLanguage:!0,localization:null}:t[1].trim().startsWith("name:")?{isLanguage:!0,localization:t[1].trim().split(":").pop()}:null}function kq(t){const e=[],n=structuredClone(t),r=o=>{if(typeof o!="string")for(let h=0;h<o.length;h+=1){const f=Aq(o[h]);f?e.push(f.localization):r(o[h])}};return r([n]),e}function Mq(t,e){const n=[];for(const h of t){if(h.type!=="symbol")continue;const f=h,{id:l,layout:S}=f;if(!S||!("text-field"in S))continue;const A=e.getLayoutProperty(l,"text-field");if(A)if(typeof A=="string"){const O=Cq(A);n.push(O)}else{const O=kq(A);n.push(O)}}const r=n.flat(),o={unlocalized:0,localized:{}};for(const h of r)h===null?o.unlocalized+=1:(h in o.localized||(o.localized[h]=0),o.localized[h]+=1);return o}(class extends Zt.Marker{addTo(t){return super.addTo(t)}});class CZ extends Zt.Popup{addTo(e){return super.addTo(e)}}class AZ extends Zt.Style{constructor(e,n={}){super(e,n)}}class kZ extends Zt.CanvasSource{onAdd(e){super.onAdd(e)}}class MZ extends Zt.GeoJSONSource{onAdd(e){super.onAdd(e)}}class RZ extends Zt.ImageSource{onAdd(e){super.onAdd(e)}}class LZ extends Zt.RasterTileSource{onAdd(e){super.onAdd(e)}}class DZ extends Zt.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class zZ extends Zt.VectorTileSource{onAdd(e){super.onAdd(e)}}class NZ extends Zt.VideoSource{onAdd(e){super.onAdd(e)}}class Rq extends Zt.NavigationControl{onAdd(e){return super.onAdd(e)}}class Lq extends Zt.GeolocateControl{onAdd(e){return super.onAdd(e)}}class OZ extends Zt.AttributionControl{onAdd(e){return super.onAdd(e)}}class Dq extends Zt.LogoControl{onAdd(e){return super.onAdd(e)}}class zq extends Zt.ScaleControl{onAdd(e){return super.onAdd(e)}}class Nq extends Zt.FullscreenControl{onAdd(e){return super.onAdd(e)}}class FZ extends Zt.TerrainControl{onAdd(e){return super.onAdd(e)}}class BZ extends Zt.BoxZoomHandler{constructor(e,n){super(e,n)}}class VZ extends Zt.ScrollZoomHandler{constructor(e,n){super(e,n)}}class jZ extends Zt.CooperativeGesturesHandler{constructor(e,n){super(e,n)}}class UZ extends Zt.KeyboardHandler{constructor(e){super(e)}}class $Z extends Zt.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class qZ extends Zt.MapWheelEvent{constructor(e,n,r){super(e,n,r)}}class HZ extends Zt.MapTouchEvent{constructor(e,n,r){super(e,n,r)}}class GZ extends Zt.MapMouseEvent{constructor(e,n,r,o={}){super(e,n,r,o)}}class BC extends Dq{constructor(e={}){super(e),kn(this,"logoURL",""),kn(this,"linkURL",""),this.logoURL=e.logoURL??yo.maptilerLogoURL,this.linkURL=e.linkURL??yo.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const n=window.document.createElement("a");return n.style.backgroundRepeat="no-repeat",n.style.cursor="pointer",n.style.display="block",n.style.height="23px",n.style.margin="0 0 -4px -4px",n.style.overflow="hidden",n.style.width="88px",n.style.backgroundImage=`url(${this.logoURL})`,n.style.backgroundSize="100px 30px",n.style.width="100px",n.style.height="30px",n.target="_blank",n.rel="noopener",n.href=this.linkURL,n.setAttribute("aria-label","MapTiler logo"),n.setAttribute("rel","noopener"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var Oq=8,Fq={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},Bq={"*":{type:"source"}},Vq=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],jq={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Uq={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},$q={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},qq={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},Hq={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Gq={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Zq={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},Wq=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],Kq={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Xq={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Yq={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Qq={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Jq={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},eH={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},tH={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},nH={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},iH={type:"array",value:"*"},rH={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},sH={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},oH={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},aH={type:"array",value:"*",minimum:1},lH={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},uH={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},cH={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},hH={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},dH=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],fH={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},pH={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},mH={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},gH={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},_H={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},yH={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},vH={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},xH={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},wH={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},bH={"*":{type:"string"}},TH={$version:Oq,$root:Fq,sources:Bq,source:Vq,source_vector:jq,source_raster:Uq,source_raster_dem:$q,source_geojson:qq,source_video:Hq,source_image:Gq,layer:Zq,layout:Wq,layout_background:Kq,layout_fill:Xq,layout_circle:Yq,layout_heatmap:Qq,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:Jq,layout_symbol:eH,layout_raster:tH,layout_hillshade:nH,filter:iH,filter_operator:rH,geometry_type:sH,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:oH,expression:aH,light:lH,sky:uH,terrain:cH,projection:hH,paint:dH,paint_fill:fH,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:pH,paint_circle:mH,paint_heatmap:gH,paint_symbol:_H,paint_raster:yH,paint_hillshade:vH,paint_background:xH,transition:wH,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:bH};let Pt=class{constructor(e,n,r,o){this.message=(e?`${e}: `:"")+r,o&&(this.identifier=o),n!=null&&n.__line__&&(this.line=n.__line__)}};function jv(t,...e){for(const n of e)for(const r in n)t[r]=n[r];return t}class du extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class C2{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[r,o]of n)this.bindings[r]=o}concat(e){return new C2(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const N0={kind:"null"},Mt={kind:"number"},On={kind:"string"},Cn={kind:"boolean"},vu={kind:"color"},O0={kind:"projectionDefinition"},rp={kind:"object"},An={kind:"value"},SH={kind:"error"},F0={kind:"collator"},B0={kind:"formatted"},V0={kind:"padding"},a_={kind:"resolvedImage"},j0={kind:"variableAnchorOffsetCollection"};function ma(t,e){return{kind:"array",itemType:t,N:e}}function er(t){if(t.kind==="array"){const e=er(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}else return t.kind}const EH=[N0,Mt,On,Cn,vu,O0,B0,rp,ma(An),V0,a_,j0];function Fg(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Fg(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of EH)if(!Fg(n,e))return null}}return`Expected ${er(t)} but found ${er(e)} instead.`}function A2(t,e){return e.some(n=>n.kind===t.kind)}function gd(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}function Sf(t,e){return t.kind==="array"&&e.kind==="array"?t.itemType.kind===e.itemType.kind&&typeof t.N=="number":t.kind===e.kind}const az=.96422,lz=1,uz=.82521,cz=4/29,sp=6/29,hz=3*sp*sp,IH=sp*sp*sp,PH=Math.PI/180,CH=180/Math.PI;function dz(t){return t=t%360,t<0&&(t+=360),t}function fz([t,e,n,r]){t=Dw(t),e=Dw(e),n=Dw(n);let o,h;const f=zw((.2225045*t+.7168786*e+.0606169*n)/lz);t===e&&e===n?o=h=f:(o=zw((.4360747*t+.3850649*e+.1430804*n)/az),h=zw((.0139322*t+.0971045*e+.7141733*n)/uz));const l=116*f-16;return[l<0?0:l,500*(o-f),200*(f-h),r]}function Dw(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function zw(t){return t>IH?Math.pow(t,1/3):t/hz+cz}function pz([t,e,n,r]){let o=(t+16)/116,h=isNaN(e)?o:o+e/500,f=isNaN(n)?o:o-n/200;return o=lz*Ow(o),h=az*Ow(h),f=uz*Ow(f),[Nw(3.1338561*h-1.6168667*o-.4906146*f),Nw(-.9787684*h+1.9161415*o+.033454*f),Nw(.0719453*h-.2289914*o+1.4052427*f),r]}function Nw(t){return t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055,t<0?0:t>1?1:t}function Ow(t){return t>sp?t*t*t:hz*(t-cz)}function AH(t){const[e,n,r,o]=fz(t),h=Math.sqrt(n*n+r*r);return[Math.round(h*1e4)?dz(Math.atan2(r,n)*CH):NaN,h,e,o]}function kH([t,e,n,r]){return t=isNaN(t)?0:t*PH,pz([n,Math.cos(t)*e,Math.sin(t)*e,r])}function MH([t,e,n,r]){t=dz(t),e/=100,n/=100;function o(h){const f=(h+t/30)%12,l=e*Math.min(n,1-n);return n-l*Math.max(-1,Math.min(f-3,9-f,1))}return[o(0),o(8),o(4),r]}function RH(t){if(t=t.toLowerCase().trim(),t==="transparent")return[0,0,0,0];const e=LH[t];if(e){const[o,h,f]=e;return[o/255,h/255,f/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const o=t.length<6?1:2;let h=1;return[_y(t.slice(h,h+=o)),_y(t.slice(h,h+=o)),_y(t.slice(h,h+=o)),_y(t.slice(h,h+o)||"ff")]}if(t.startsWith("rgb")){const o=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,h=t.match(o);if(h){const[f,l,S,A,O,U,H,$,ie,me,Me,ce]=h,le=[A||" ",H||" ",me].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const ge=[S,U,ie].join(""),je=ge==="%%%"?100:ge===""?255:0;if(je){const rt=[kf(+l/je,0,1),kf(+O/je,0,1),kf(+$/je,0,1),Me?VC(+Me,ce):1];if(jC(rt))return rt}}return}}const n=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=t.match(n);if(r){const[o,h,f,l,S,A,O,U,H]=r,$=[f||" ",S||" ",O].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const ie=[+h,kf(+l,0,100),kf(+A,0,100),U?VC(+U,H):1];if(jC(ie))return MH(ie)}}}function _y(t){return parseInt(t.padEnd(2,t),16)/255}function VC(t,e){return kf(e?t/100:t,0,1)}function kf(t,e,n){return Math.min(Math.max(e,t),n)}function jC(t){return!t.some(Number.isNaN)}const LH={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function _d(t,e,n){return t+n*(e-t)}function Uv(t,e,n){return t.map((r,o)=>_d(r,e[o],n))}class Ci{constructor(e,n,r,o=1,h=!0){this.r=e,this.g=n,this.b=r,this.a=o,h||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[e,n,r,o]))}static parse(e){if(e instanceof Ci)return e;if(typeof e!="string")return;const n=RH(e);if(n)return new Ci(...n,!1)}get rgb(){const{r:e,g:n,b:r,a:o}=this,h=o||1/0;return this.overwriteGetter("rgb",[e/h,n/h,r/h,o])}get hcl(){return this.overwriteGetter("hcl",AH(this.rgb))}get lab(){return this.overwriteGetter("lab",fz(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,r,o]=this.rgb;return`rgba(${[e,n,r].map(h=>Math.round(h*255)).join(",")},${o})`}static interpolate(e,n,r,o="rgb"){switch(o){case"rgb":{const[h,f,l,S]=Uv(e.rgb,n.rgb,r);return new Ci(h,f,l,S,!1)}case"hcl":{const[h,f,l,S]=e.hcl,[A,O,U,H]=n.hcl;let $,ie;if(!isNaN(h)&&!isNaN(A)){let ge=A-h;A>h&&ge>180?ge-=360:A<h&&h-A>180&&(ge+=360),$=h+r*ge}else isNaN(h)?isNaN(A)?$=NaN:($=A,(l===1||l===0)&&(ie=O)):($=h,(U===1||U===0)&&(ie=f));const[me,Me,ce,le]=kH([$,ie??_d(f,O,r),_d(l,U,r),_d(S,H,r)]);return new Ci(me,Me,ce,le,!1)}case"lab":{const[h,f,l,S]=pz(Uv(e.lab,n.lab,r));return new Ci(h,f,l,S,!1)}}}}Ci.black=new Ci(0,0,0,1);Ci.white=new Ci(1,1,1,1);Ci.transparent=new Ci(0,0,0,0);Ci.red=new Ci(1,0,0,1);class k2{constructor(e,n,r){e?this.sensitivity=n?"variant":"case":this.sensitivity=n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class m1{constructor(e,n,r,o,h){this.text=e,this.image=n,this.scale=r,this.fontStack=o,this.textColor=h}}class oc{constructor(e){this.sections=e}static fromString(e){return new oc([new m1(e,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof oc?e:oc.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class qa{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof qa)return e;if(typeof e=="number")return new qa([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new qa(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){return new qa(Uv(e.values,n.values,r))}}class Er{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const DH=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Nl{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Nl)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let n=0;n<e.length;n+=2){const r=e[n],o=e[n+1];if(typeof r!="string"||!DH.has(r)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new Nl(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,r){const o=e.values,h=n.values;if(o.length!==h.length)throw new Er(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const f=[];for(let l=0;l<o.length;l+=2){if(o[l]!==h[l])throw new Er(`Cannot interpolate values containing mismatched anchors. from[${l}]: ${o[l]}, to[${l}]: ${h[l]}`);f.push(o[l]);const[S,A]=o[l+1],[O,U]=h[l+1];f.push([_d(S,O,r),_d(A,U,r)])}return new Nl(f)}}class Ph{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ph({name:e,available:!1}):null}}class kl{constructor(e,n,r){this.from=e,this.to=n,this.transition=r}static interpolate(e,n,r){return new kl(e,n,r)}static parse(e){if(e instanceof kl)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new kl(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new kl(e.from,e.to,e.transition);if(typeof e=="string")return new kl(e,e,1)}}function mz(t,e,n,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,n,r]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bg(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof kl||t instanceof Ci||t instanceof k2||t instanceof oc||t instanceof qa||t instanceof Nl||t instanceof Ph)return!0;if(Array.isArray(t)){for(const e of t)if(!Bg(e))return!1;return!0}else if(typeof t=="object"){for(const e in t)if(!Bg(t[e]))return!1;return!0}else return!1}function es(t){if(t===null)return N0;if(typeof t=="string")return On;if(typeof t=="boolean")return Cn;if(typeof t=="number")return Mt;if(t instanceof Ci)return vu;if(t instanceof kl)return O0;if(t instanceof k2)return F0;if(t instanceof oc)return B0;if(t instanceof qa)return V0;if(t instanceof Nl)return j0;if(t instanceof Ph)return a_;if(Array.isArray(t)){const e=t.length;let n;for(const r of t){const o=es(r);if(!n)n=o;else{if(n===o)continue;n=An;break}}return ma(n||An,e)}else return rp}function lg(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Ci||t instanceof kl||t instanceof oc||t instanceof qa||t instanceof Nl||t instanceof Ph?t.toString():JSON.stringify(t)}class wp{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Bg(e[1]))return n.error("invalid value");const r=e[1];let o=es(r);const h=n.expectedType;return o.kind==="array"&&o.N===0&&h&&h.kind==="array"&&(typeof h.N!="number"||h.N===0)&&(o=h),new wp(o,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const yy={string:On,number:Mt,boolean:Cn,object:rp};class Ml{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r=1,o;const h=e[0];if(h==="array"){let l;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in yy)||A==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);l=yy[A],r++}else l=An;let S;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],r++}o=ma(l,S)}else{if(!yy[h])throw new Error(`Types doesn't contain name = ${h}`);o=yy[h]}const f=[];for(;r<e.length;r++){const l=n.parse(e[r],r,An);if(!l)return null;f.push(l)}return new Ml(o,f)}evaluate(e){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(e);if(Fg(this.type,es(r))){if(n===this.args.length-1)throw new Er(`Expected value to be of type ${er(this.type)}, but found ${er(es(r))} instead.`)}else return r}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const UC={"to-boolean":Cn,"to-color":vu,"to-number":Mt,"to-string":On};class nh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[0];if(!UC[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&e.length!==2)return n.error("Expected one argument.");const o=UC[r],h=[];for(let f=1;f<e.length;f++){const l=n.parse(e[f],f,An);if(!l)return null;h.push(l)}return new nh(o,h)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,r;for(const o of this.args){if(n=o.evaluate(e),r=null,n instanceof Ci)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(n.length<3||n.length>4?r=`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:r=mz(n[0],n[1],n[2],n[3]),!r))return new Ci(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Er(r||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const r of this.args){n=r.evaluate(e);const o=qa.parse(n);if(o)return o}throw new Er(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const r of this.args){n=r.evaluate(e);const o=Nl.parse(n);if(o)return o}throw new Er(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const r of this.args){if(n=r.evaluate(e),n===null)return 0;const o=Number(n);if(!isNaN(o))return o}throw new Er(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return oc.fromString(lg(this.args[0].evaluate(e)));case"resolvedImage":return Ph.fromString(lg(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return lg(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const zH=["Unknown","Point","LineString","Polygon"];class gz{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zH[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Ci.parse(e)),n}}class U0{constructor(e,n,r=[],o,h=new C2,f=[]){this.registry=e,this.path=r,this.key=r.map(l=>`[${l}]`).join(""),this.scope=h,this.errors=f,this.expectedType=o,this._isConstant=n}parse(e,n,r,o,h={}){return n?this.concat(n,r,o)._parse(e,h):this._parse(e,h)}_parse(e,n){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function r(o,h,f){return f==="assert"?new Ml(h,[o]):f==="coerce"?new nh(h,[o]):o}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[o];if(h){let f=h.parse(e,this);if(!f)return null;if(this.expectedType){const l=this.expectedType,S=f.type;if((l.kind==="string"||l.kind==="number"||l.kind==="boolean"||l.kind==="object"||l.kind==="array")&&S.kind==="value")f=r(f,l,n.typeAnnotation||"assert");else if(l.kind==="projectionDefinition"&&(S.kind==="string"||S.kind==="array"))f=r(f,l,n.typeAnnotation||"coerce");else if((l.kind==="color"||l.kind==="formatted"||l.kind==="resolvedImage")&&(S.kind==="value"||S.kind==="string"))f=r(f,l,n.typeAnnotation||"coerce");else if(l.kind==="padding"&&(S.kind==="value"||S.kind==="number"||S.kind==="array"))f=r(f,l,n.typeAnnotation||"coerce");else if(l.kind==="variableAnchorOffsetCollection"&&(S.kind==="value"||S.kind==="array"))f=r(f,l,n.typeAnnotation||"coerce");else if(this.checkSubtype(l,S))return null}if(!(f instanceof wp)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const l=new gz;try{f=new wp(f.type,f.evaluate(l))}catch(S){return this.error(S.message),null}}return f}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,n,r){const o=typeof e=="number"?this.path.concat(e):this.path,h=r?this.scope.concat(r):this.scope;return new U0(this.registry,this._isConstant,o,n||null,h,this.errors)}error(e,...n){const r=`${this.key}${n.map(o=>`[${o}]`).join("")}`;this.errors.push(new du(r,e))}checkSubtype(e,n){const r=Fg(e,n);return r&&this.error(r),r}}class $0{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let h=1;h<e.length-1;h+=2){const f=e[h];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,h);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const l=n.parse(e[h+1],h+1);if(!l)return null;r.push([f,l])}const o=n.parse(e[e.length-1],e.length-1,n.expectedType,r);return o?new $0(r,o):null}outputDefined(){return this.result.outputDefined()}}class q0{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const r=e[1];return n.scope.has(r)?new q0(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class M2{constructor(e,n,r){this.type=e,this.index=n,this.input=r}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,Mt),o=n.parse(e[2],2,ma(n.expectedType||An));if(!r||!o)return null;const h=o.type;return new M2(h.itemType,r,o)}evaluate(e){const n=this.index.evaluate(e),r=this.input.evaluate(e);if(n<0)throw new Er(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new Er(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new Er(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class R2{constructor(e,n){this.type=Cn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,An),o=n.parse(e[2],2,An);return!r||!o?null:A2(r.type,[Cn,On,Mt,N0,An])?new R2(r,o):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${er(r.type)} instead`)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!gd(n,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${er(es(n))} instead.`);if(!gd(r,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${er(es(r))} instead.`);return r.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class $v{constructor(e,n,r){this.type=Mt,this.needle=e,this.haystack=n,this.fromIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,An),o=n.parse(e[2],2,An);if(!r||!o)return null;if(!A2(r.type,[Cn,On,Mt,N0,An]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${er(r.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Mt);return h?new $v(r,o,h):null}else return new $v(r,o)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!gd(n,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${er(es(n))} instead.`);let o;if(this.fromIndex&&(o=this.fromIndex.evaluate(e)),gd(r,["string"])){const h=r.indexOf(n,o);return h===-1?-1:[...r.slice(0,h)].length}else{if(gd(r,["array"]))return r.indexOf(n,o);throw new Er(`Expected second argument to be of type array or string, but found ${er(es(r))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class L2{constructor(e,n,r,o,h,f){this.inputType=e,this.type=n,this.input=r,this.cases=o,this.outputs=h,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return n.error("Expected an even number of arguments.");let r,o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const h={},f=[];for(let A=2;A<e.length-1;A+=2){let O=e[A];const U=e[A+1];Array.isArray(O)||(O=[O]);const H=n.concat(A);if(O.length===0)return H.error("Expected at least one branch label.");for(const ie of O){if(typeof ie!="number"&&typeof ie!="string")return H.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return H.error("Numeric branch labels must be integer values.");if(!r)r=es(ie);else if(H.checkSubtype(r,es(ie)))return null;if(typeof h[String(ie)]<"u")return H.error("Branch labels must be unique.");h[String(ie)]=f.length}const $=n.parse(U,A,o);if(!$)return null;o=o||$.type,f.push($)}const l=n.parse(e[1],1,An);if(!l)return null;const S=n.parse(e[e.length-1],e.length-1,o);return!S||l.type.kind!=="value"&&n.concat(1).checkSubtype(r,l.type)?null:new L2(r,o,l,h,f,S)}evaluate(e){const n=this.input.evaluate(e);return(es(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class D2{constructor(e,n,r){this.type=e,this.branches=n,this.otherwise=r}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const o=[];for(let f=1;f<e.length-1;f+=2){const l=n.parse(e[f],f,Cn);if(!l)return null;const S=n.parse(e[f+1],f+1,r);if(!S)return null;o.push([l,S]),r=r||S.type}const h=n.parse(e[e.length-1],e.length-1,r);if(!h)return null;if(!r)throw new Error("Can't infer output type");return new D2(r,o,h)}evaluate(e){for(const[n,r]of this.branches)if(n.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,r]of this.branches)e(n),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class qv{constructor(e,n,r,o){this.type=e,this.input=n,this.beginIndex=r,this.endIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,An),o=n.parse(e[2],2,Mt);if(!r||!o)return null;if(!A2(r.type,[ma(An),On,An]))return n.error(`Expected first argument to be of type array or string, but found ${er(r.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Mt);return h?new qv(r.type,r,o,h):null}else return new qv(r.type,r,o)}evaluate(e){const n=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let o;if(this.endIndex&&(o=this.endIndex.evaluate(e)),gd(n,["string"]))return[...n].slice(r,o).join("");if(gd(n,["array"]))return n.slice(r,o);throw new Er(`Expected first argument to be of type array or string, but found ${er(es(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function _z(t,e){const n=t.length-1;let r=0,o=n,h=0,f,l;for(;r<=o;)if(h=Math.floor((r+o)/2),f=t[h],l=t[h+1],f<=e){if(h===n||e<l)return h;r=h+1}else if(f>e)o=h-1;else throw new Er("Input is not a number.");return 0}class H0{constructor(e,n,r){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[o,h]of r)this.labels.push(o),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");const r=n.parse(e[1],1,Mt);if(!r)return null;const o=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let f=1;f<e.length;f+=2){const l=f===1?-1/0:e[f],S=e[f+1],A=f,O=f+1;if(typeof l!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(o.length&&o[o.length-1][0]>=l)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const U=n.parse(S,O,h);if(!U)return null;h=h||U.type,o.push([l,U])}return new H0(h,r,o)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const o=this.input.evaluate(e);if(o<=n[0])return r[0].evaluate(e);const h=n.length;if(o>=n[h-1])return r[h-1].evaluate(e);const f=_z(n,o);return r[f].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function NH(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fw,$C;function OH(){if($C)return Fw;$C=1,Fw=t;function t(e,n,r,o){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(o-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=o}return t.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,o=0;o<8;o++){var h=this.sampleCurveX(r)-e;if(Math.abs(h)<n)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r=r-h/f}var l=0,S=1;for(r=e,o=0;o<20&&(h=this.sampleCurveX(r),!(Math.abs(h-e)<n));o++)e>h?l=r:S=r,r=(S-l)*.5+l;return r},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Fw}var FH=OH(),BH=NH(FH);class xu{constructor(e,n,r,o,h){this.type=e,this.operator=n,this.interpolation=r,this.input=o,this.labels=[],this.outputs=[];for(const[f,l]of h)this.labels.push(f),this.outputs.push(l)}static interpolationFactor(e,n,r,o){let h=0;if(e.name==="exponential")h=Bw(n,e.base,r,o);else if(e.name==="linear")h=Bw(n,1,r,o);else if(e.name==="cubic-bezier"){const f=e.controlPoints;h=new BH(f[0],f[1],f[2],f[3]).solve(Bw(n,1,r,o))}return h}static parse(e,n){let[r,o,h,...f]=e;if(!Array.isArray(o)||o.length===0)return n.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const A=o[1];if(typeof A!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:A}}else if(o[0]==="cubic-bezier"){const A=o.slice(1);if(A.length!==4||A.some(O=>typeof O!="number"||O<0||O>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:A}}else return n.error(`Unknown interpolation type ${String(o[0])}`,1,0);if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,Mt),!h)return null;const l=[];let S=null;r==="interpolate-hcl"||r==="interpolate-lab"?S=vu:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let A=0;A<f.length;A+=2){const O=f[A],U=f[A+1],H=A+3,$=A+4;if(typeof O!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(l.length&&l[l.length-1][0]>=O)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const ie=n.parse(U,$,S);if(!ie)return null;S=S||ie.type,l.push([O,ie])}return!Sf(S,Mt)&&!Sf(S,O0)&&!Sf(S,vu)&&!Sf(S,V0)&&!Sf(S,j0)&&!Sf(S,ma(Mt))?n.error(`Type ${er(S)} is not interpolatable.`):new xu(S,r,o,h,l)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const o=this.input.evaluate(e);if(o<=n[0])return r[0].evaluate(e);const h=n.length;if(o>=n[h-1])return r[h-1].evaluate(e);const f=_z(n,o),l=n[f],S=n[f+1],A=xu.interpolationFactor(this.interpolation,o,l,S),O=r[f].evaluate(e),U=r[f+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return _d(O,U,A);case"color":return Ci.interpolate(O,U,A);case"padding":return qa.interpolate(O,U,A);case"variableAnchorOffsetCollection":return Nl.interpolate(O,U,A);case"array":return Uv(O,U,A);case"projectionDefinition":return kl.interpolate(O,U,A)}case"interpolate-hcl":return Ci.interpolate(O,U,A,"hcl");case"interpolate-lab":return Ci.interpolate(O,U,A,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Bw(t,e,n,r){const o=r-n,h=t-n;return o===0?0:e===1?h/o:(Math.pow(e,h)-1)/(Math.pow(e,o)-1)}Ci.interpolate,qa.interpolate,Nl.interpolate;class Vg{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r=null;const o=n.expectedType;o&&o.kind!=="value"&&(r=o);const h=[];for(const f of e.slice(1)){const l=n.parse(f,1+h.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,h.push(l)}if(!r)throw new Error("No output type");return o&&h.some(f=>Fg(o,f.type))?new Vg(An,h):new Vg(r,h)}evaluate(e){let n=null,r=0,o;for(const h of this.args)if(r++,n=h.evaluate(e),n&&n instanceof Ph&&!n.available&&(o||(o=n.name),n=null,r===this.args.length&&(n=o)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function qC(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function VH(t,e,n){return e===n}function jH(t,e,n){return e!==n}function UH(t,e,n){return e<n}function $H(t,e,n){return e>n}function qH(t,e,n){return e<=n}function HH(t,e,n){return e>=n}function yz(t,e,n,r){return r.compare(e,n)===0}function GH(t,e,n,r){return!yz(t,e,n,r)}function ZH(t,e,n,r){return r.compare(e,n)<0}function WH(t,e,n,r){return r.compare(e,n)>0}function KH(t,e,n,r){return r.compare(e,n)<=0}function XH(t,e,n,r){return r.compare(e,n)>=0}function Np(t,e,n){const r=t!=="=="&&t!=="!=";return class vz{constructor(h,f,l){this.type=Cn,this.lhs=h,this.rhs=f,this.collator=l,this.hasUntypedArgument=h.type.kind==="value"||f.type.kind==="value"}static parse(h,f){if(h.length!==3&&h.length!==4)return f.error("Expected two or three arguments.");const l=h[0];let S=f.parse(h[1],1,An);if(!S)return null;if(!qC(l,S.type))return f.concat(1).error(`"${l}" comparisons are not supported for type '${er(S.type)}'.`);let A=f.parse(h[2],2,An);if(!A)return null;if(!qC(l,A.type))return f.concat(2).error(`"${l}" comparisons are not supported for type '${er(A.type)}'.`);if(S.type.kind!==A.type.kind&&S.type.kind!=="value"&&A.type.kind!=="value")return f.error(`Cannot compare types '${er(S.type)}' and '${er(A.type)}'.`);r&&(S.type.kind==="value"&&A.type.kind!=="value"?S=new Ml(A.type,[S]):S.type.kind!=="value"&&A.type.kind==="value"&&(A=new Ml(S.type,[A])));let O=null;if(h.length===4){if(S.type.kind!=="string"&&A.type.kind!=="string"&&S.type.kind!=="value"&&A.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(O=f.parse(h[3],3,F0),!O)return null}return new vz(S,A,O)}evaluate(h){const f=this.lhs.evaluate(h),l=this.rhs.evaluate(h);if(r&&this.hasUntypedArgument){const S=es(f),A=es(l);if(S.kind!==A.kind||!(S.kind==="string"||S.kind==="number"))throw new Er(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const S=es(f),A=es(l);if(S.kind!=="string"||A.kind!=="string")return e(h,f,l)}return this.collator?n(h,f,l,this.collator.evaluate(h)):e(h,f,l)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const YH=Np("==",VH,yz),QH=Np("!=",jH,GH),JH=Np("<",UH,ZH),eG=Np(">",$H,WH),tG=Np("<=",qH,KH),nG=Np(">=",HH,XH);class G0{constructor(e,n,r){this.type=F0,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return n.error("Collator options argument must be an object.");const o=n.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,Cn);if(!o)return null;const h=n.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,Cn);if(!h)return null;let f=null;return r.locale&&(f=n.parse(r.locale,1,On),!f)?null:new G0(o,h,f)}evaluate(e){return new k2(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class z2{constructor(e,n,r,o,h){this.type=On,this.number=e,this.locale=n,this.currency=r,this.minFractionDigits=o,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const r=n.parse(e[1],1,Mt);if(!r)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return n.error("NumberFormat options argument must be an object.");let h=null;if(o.locale&&(h=n.parse(o.locale,1,On),!h))return null;let f=null;if(o.currency&&(f=n.parse(o.currency,1,On),!f))return null;let l=null;if(o["min-fraction-digits"]&&(l=n.parse(o["min-fraction-digits"],1,Mt),!l))return null;let S=null;return o["max-fraction-digits"]&&(S=n.parse(o["max-fraction-digits"],1,Mt),!S)?null:new z2(r,h,f,l,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class N2{constructor(e){this.type=B0,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return n.error("First argument must be an image or text section.");const o=[];let h=!1;for(let f=1;f<=e.length-1;++f){const l=e[f];if(h&&typeof l=="object"&&!Array.isArray(l)){h=!1;let S=null;if(l["font-scale"]&&(S=n.parse(l["font-scale"],1,Mt),!S))return null;let A=null;if(l["text-font"]&&(A=n.parse(l["text-font"],1,ma(On)),!A))return null;let O=null;if(l["text-color"]&&(O=n.parse(l["text-color"],1,vu),!O))return null;const U=o[o.length-1];U.scale=S,U.font=A,U.textColor=O}else{const S=n.parse(e[f],1,An);if(!S)return null;const A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,o.push({content:S,scale:null,font:null,textColor:null})}}return new N2(o)}evaluate(e){const n=r=>{const o=r.content.evaluate(e);return es(o)===a_?new m1("",o,null,null,null):new m1(lg(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)};return new oc(this.sections.map(n))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class O2{constructor(e){this.type=a_,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const r=n.parse(e[1],1,On);return r?new O2(r):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),r=Ph.fromString(n);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(n)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class F2{constructor(e){this.type=Mt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=n.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${er(r.type)} instead.`):new F2(r):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Er(`Expected value to be of type string or array, but found ${er(es(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const wu=8192;function iG(t,e){const n=rG(t[0]),r=oG(t[1]),o=Math.pow(2,e.z);return[Math.round(n*o*wu),Math.round(r*o*wu)]}function B2(t,e){const n=Math.pow(2,e.z),r=(t[0]/wu+e.x)/n,o=(t[1]/wu+e.y)/n;return[sG(r),aG(o)]}function rG(t){return(180+t)/360}function sG(t){return t*360-180}function oG(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function aG(t){return 360/Math.PI*Math.atan(Math.exp((180-t*360)*Math.PI/180))-90}function l_(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function jg(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function lG(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function uG(t,e,n){const r=t[0]-e[0],o=t[1]-e[1],h=t[0]-n[0],f=t[1]-n[1];return r*f-h*o===0&&r*h<=0&&o*f<=0}function Z0(t,e,n,r){const o=[e[0]-t[0],e[1]-t[1]],h=[r[0]-n[0],r[1]-n[1]];return fG(h,o)===0?!1:!!(HC(t,e,n,r)&&HC(n,r,t,e))}function cG(t,e,n){for(const r of n)for(let o=0;o<r.length-1;++o)if(Z0(t,e,r[o],r[o+1]))return!0;return!1}function Op(t,e,n=!1){let r=!1;for(const o of e)for(let h=0;h<o.length-1;h++){if(uG(t,o[h],o[h+1]))return n;lG(t,o[h],o[h+1])&&(r=!r)}return r}function hG(t,e){for(const n of e)if(Op(t,n))return!0;return!1}function xz(t,e){for(const n of t)if(!Op(n,e))return!1;for(let n=0;n<t.length-1;++n)if(cG(t[n],t[n+1],e))return!1;return!0}function dG(t,e){for(const n of e)if(xz(t,n))return!0;return!1}function fG(t,e){return t[0]*e[1]-t[1]*e[0]}function HC(t,e,n,r){const o=t[0]-n[0],h=t[1]-n[1],f=e[0]-n[0],l=e[1]-n[1],S=r[0]-n[0],A=r[1]-n[1],O=o*A-S*h,U=f*A-S*l;return O>0&&U<0||O<0&&U>0}function V2(t,e,n){const r=[];for(let o=0;o<t.length;o++){const h=[];for(let f=0;f<t[o].length;f++){const l=iG(t[o][f],n);l_(e,l),h.push(l)}r.push(h)}return r}function wz(t,e,n){const r=[];for(let o=0;o<t.length;o++){const h=V2(t[o],e,n);r.push(h)}return r}function bz(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){const o=r*.5;let h=t[0]-n[0]>o?-r:n[0]-t[0]>o?r:0;h===0&&(h=t[0]-n[2]>o?-r:n[2]-t[0]>o?r:0),t[0]+=h}l_(e,t)}function pG(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}function GC(t,e,n,r){const o=Math.pow(2,r.z)*wu,h=[r.x*wu,r.y*wu],f=[];for(const l of t)for(const S of l){const A=[S.x+h[0],S.y+h[1]];bz(A,e,n,o),f.push(A)}return f}function ZC(t,e,n,r){const o=Math.pow(2,r.z)*wu,h=[r.x*wu,r.y*wu],f=[];for(const l of t){const S=[];for(const A of l){const O=[A.x+h[0],A.y+h[1]];l_(e,O),S.push(O)}f.push(S)}if(e[2]-e[0]<=o/2){pG(e);for(const l of f)for(const S of l)bz(S,e,n,o)}return f}function mG(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(e.type==="Polygon"){const h=V2(e.coordinates,r,o),f=GC(t.geometry(),n,r,o);if(!jg(n,r))return!1;for(const l of f)if(!Op(l,h))return!1}if(e.type==="MultiPolygon"){const h=wz(e.coordinates,r,o),f=GC(t.geometry(),n,r,o);if(!jg(n,r))return!1;for(const l of f)if(!hG(l,h))return!1}return!0}function gG(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(e.type==="Polygon"){const h=V2(e.coordinates,r,o),f=ZC(t.geometry(),n,r,o);if(!jg(n,r))return!1;for(const l of f)if(!xz(l,h))return!1}if(e.type==="MultiPolygon"){const h=wz(e.coordinates,r,o),f=ZC(t.geometry(),n,r,o);if(!jg(n,r))return!1;for(const l of f)if(!dG(l,h))return!1}return!0}class yd{constructor(e,n){this.type=Cn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bg(e[1])){const r=e[1];if(r.type==="FeatureCollection"){const o=[];for(const h of r.features){const{type:f,coordinates:l}=h.geometry;f==="Polygon"&&o.push(l),f==="MultiPolygon"&&o.push(...l)}if(o.length){const h={type:"MultiPolygon",coordinates:o};return new yd(r,h)}}else if(r.type==="Feature"){const o=r.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new yd(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new yd(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return mG(e,this.geometries);if(e.geometryType()==="LineString")return gG(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Tz{constructor(e=[],n=(r,o)=>r<o?-1:r>o?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,o=n[e];for(;e>0;){const h=e-1>>1,f=n[h];if(r(o,f)>=0)break;n[e]=f,e=h}n[e]=o}_down(e){const{data:n,compare:r}=this,o=this.length>>1,h=n[e];for(;e<o;){let f=(e<<1)+1;const l=f+1;if(l<this.length&&r(n[l],n[f])<0&&(f=l),r(n[f],h)>=0)break;n[e]=n[f],e=f}n[e]=h}}function _G(t,e){if(t.length<=1)return[t];const n=[];let r,o;for(const h of t){const f=yG(h);f!==0&&(h.area=Math.abs(f),o===void 0&&(o=f<0),o===f<0?(r&&n.push(r),r=[h]):r.push(h))}return r&&n.push(r),n}function yG(t){let e=0;for(let n=0,r=t.length,o=r-1,h,f;n<r;o=n++)h=t[n],f=t[o],e+=(f.x-h.x)*(h.y+f.y);return e}const vG=6378.137,WC=1/298.257223563,KC=WC*(2-WC),XC=Math.PI/180;class j2{constructor(e){const n=XC*vG*1e3,r=Math.cos(e*XC),o=1/(1-KC*(1-r*r)),h=Math.sqrt(o);this.kx=n*h*r,this.ky=n*h*o*(1-KC)}distance(e,n){const r=this.wrap(e[0]-n[0])*this.kx,o=(e[1]-n[1])*this.ky;return Math.sqrt(r*r+o*o)}pointOnLine(e,n){let r=1/0,o,h,f,l;for(let S=0;S<e.length-1;S++){let A=e[S][0],O=e[S][1],U=this.wrap(e[S+1][0]-A)*this.kx,H=(e[S+1][1]-O)*this.ky,$=0;(U!==0||H!==0)&&($=(this.wrap(n[0]-A)*this.kx*U+(n[1]-O)*this.ky*H)/(U*U+H*H),$>1?(A=e[S+1][0],O=e[S+1][1]):$>0&&(A+=U/this.kx*$,O+=H/this.ky*$)),U=this.wrap(n[0]-A)*this.kx,H=(n[1]-O)*this.ky;const ie=U*U+H*H;ie<r&&(r=ie,o=A,h=O,f=S,l=$)}return{point:[o,h],index:f,t:Math.max(0,Math.min(1,l))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const g1=100,_1=50;function Sz(t,e){return e[0]-t[0]}function Hv(t){return t[1]-t[0]+1}function _c(t,e){return t[1]>=t[0]&&t[1]<e}function y1(t,e){if(t[0]>t[1])return[null,null];const n=Hv(t);if(e){if(n===2)return[t,null];const o=Math.floor(n/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}if(n===1)return[t,null];const r=Math.floor(n/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}function v1(t,e){if(!_c(e,t.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)l_(n,t[r]);return n}function x1(t){const e=[1/0,1/0,-1/0,-1/0];for(const n of t)for(const r of n)l_(e,r);return e}function YC(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function U2(t,e,n){if(!YC(t)||!YC(e))return NaN;let r=0,o=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(o=t[1]-e[3]),t[3]<e[1]&&(o=e[1]-t[3]),n.distance([0,0],[r,o])}function dd(t,e,n){const r=n.pointOnLine(e,t);return n.distance(t,r.point)}function $2(t,e,n,r,o){const h=Math.min(dd(t,[n,r],o),dd(e,[n,r],o)),f=Math.min(dd(n,[t,e],o),dd(r,[t,e],o));return Math.min(h,f)}function xG(t,e,n,r,o){if(!(_c(e,t.length)&&_c(r,n.length)))return 1/0;let h=1/0;for(let f=e[0];f<e[1];++f){const l=t[f],S=t[f+1];for(let A=r[0];A<r[1];++A){const O=n[A],U=n[A+1];if(Z0(l,S,O,U))return 0;h=Math.min(h,$2(l,S,O,U,o))}}return h}function wG(t,e,n,r,o){if(!(_c(e,t.length)&&_c(r,n.length)))return NaN;let h=1/0;for(let f=e[0];f<=e[1];++f)for(let l=r[0];l<=r[1];++l)if(h=Math.min(h,o.distance(t[f],n[l])),h===0)return h;return h}function bG(t,e,n){if(Op(t,e,!0))return 0;let r=1/0;for(const o of e){const h=o[0],f=o[o.length-1];if(h!==f&&(r=Math.min(r,dd(t,[f,h],n)),r===0))return r;const l=n.pointOnLine(o,t);if(r=Math.min(r,n.distance(t,l.point)),r===0)return r}return r}function TG(t,e,n,r){if(!_c(e,t.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Op(t[h],n,!0))return 0;let o=1/0;for(let h=e[0];h<e[1];++h){const f=t[h],l=t[h+1];for(const S of n)for(let A=0,O=S.length,U=O-1;A<O;U=A++){const H=S[U],$=S[A];if(Z0(f,l,H,$))return 0;o=Math.min(o,$2(f,l,H,$,r))}}return o}function QC(t,e){for(const n of t)for(const r of n)if(Op(r,e,!0))return!0;return!1}function SG(t,e,n,r=1/0){const o=x1(t),h=x1(e);if(r!==1/0&&U2(o,h,n)>=r)return r;if(jg(o,h)){if(QC(t,e))return 0}else if(QC(e,t))return 0;let f=1/0;for(const l of t)for(let S=0,A=l.length,O=A-1;S<A;O=S++){const U=l[O],H=l[S];for(const $ of e)for(let ie=0,me=$.length,Me=me-1;ie<me;Me=ie++){const ce=$[Me],le=$[ie];if(Z0(U,H,ce,le))return 0;f=Math.min(f,$2(U,H,ce,le,n))}}return f}function JC(t,e,n,r,o,h){if(!h)return;const f=U2(v1(r,h),o,n);f<e&&t.push([f,h,[0,0]])}function vy(t,e,n,r,o,h,f){if(!h||!f)return;const l=U2(v1(r,h),v1(o,f),n);l<e&&t.push([l,h,f])}function Gv(t,e,n,r,o=1/0){let h=Math.min(r.distance(t[0],n[0][0]),o);if(h===0)return h;const f=new Tz([[0,[0,t.length-1],[0,0]]],Sz),l=x1(n);for(;f.length>0;){const S=f.pop();if(S[0]>=h)continue;const A=S[1],O=e?_1:g1;if(Hv(A)<=O){if(!_c(A,t.length))return NaN;if(e){const U=TG(t,A,n,r);if(isNaN(U)||U===0)return U;h=Math.min(h,U)}else for(let U=A[0];U<=A[1];++U){const H=bG(t[U],n,r);if(h=Math.min(h,H),h===0)return 0}}else{const U=y1(A,e);JC(f,h,r,t,l,U[0]),JC(f,h,r,t,l,U[1])}}return h}function Zv(t,e,n,r,o,h=1/0){let f=Math.min(h,o.distance(t[0],n[0]));if(f===0)return f;const l=new Tz([[0,[0,t.length-1],[0,n.length-1]]],Sz);for(;l.length>0;){const S=l.pop();if(S[0]>=f)continue;const A=S[1],O=S[2],U=e?_1:g1,H=r?_1:g1;if(Hv(A)<=U&&Hv(O)<=H){if(!_c(A,t.length)&&_c(O,n.length))return NaN;let $;if(e&&r)$=xG(t,A,n,O,o),f=Math.min(f,$);else if(e&&!r){const ie=t.slice(A[0],A[1]+1);for(let me=O[0];me<=O[1];++me)if($=dd(n[me],ie,o),f=Math.min(f,$),f===0)return f}else if(!e&&r){const ie=n.slice(O[0],O[1]+1);for(let me=A[0];me<=A[1];++me)if($=dd(t[me],ie,o),f=Math.min(f,$),f===0)return f}else $=wG(t,A,n,O,o),f=Math.min(f,$)}else{const $=y1(A,e),ie=y1(O,r);vy(l,f,o,t,n,$[0],ie[0]),vy(l,f,o,t,n,$[0],ie[1]),vy(l,f,o,t,n,$[1],ie[0]),vy(l,f,o,t,n,$[1],ie[1])}}return f}function EG(t,e){const n=t.geometry(),r=n.flat().map(f=>B2([f.x,f.y],t.canonical));if(n.length===0)return NaN;const o=new j2(r[0][1]);let h=1/0;for(const f of e){switch(f.type){case"Point":h=Math.min(h,Zv(r,!1,[f.coordinates],!1,o,h));break;case"LineString":h=Math.min(h,Zv(r,!1,f.coordinates,!0,o,h));break;case"Polygon":h=Math.min(h,Gv(r,!1,f.coordinates,o,h));break}if(h===0)return h}return h}function IG(t,e){const n=t.geometry(),r=n.flat().map(f=>B2([f.x,f.y],t.canonical));if(n.length===0)return NaN;const o=new j2(r[0][1]);let h=1/0;for(const f of e){switch(f.type){case"Point":h=Math.min(h,Zv(r,!0,[f.coordinates],!1,o,h));break;case"LineString":h=Math.min(h,Zv(r,!0,f.coordinates,!0,o,h));break;case"Polygon":h=Math.min(h,Gv(r,!0,f.coordinates,o,h));break}if(h===0)return h}return h}function PG(t,e){const n=t.geometry();if(n.length===0||n[0].length===0)return NaN;const r=_G(n).map(f=>f.map(l=>l.map(S=>B2([S.x,S.y],t.canonical)))),o=new j2(r[0][0][0][1]);let h=1/0;for(const f of e)for(const l of r){switch(f.type){case"Point":h=Math.min(h,Gv([f.coordinates],!1,l,o,h));break;case"LineString":h=Math.min(h,Gv(f.coordinates,!0,l,o,h));break;case"Polygon":h=Math.min(h,SG(l,f.coordinates,o,h));break}if(h===0)return h}return h}function Vw(t){return t.type==="MultiPolygon"?t.coordinates.map(e=>({type:"Polygon",coordinates:e})):t.type==="MultiLineString"?t.coordinates.map(e=>({type:"LineString",coordinates:e})):t.type==="MultiPoint"?t.coordinates.map(e=>({type:"Point",coordinates:e})):[t]}class vd{constructor(e,n){this.type=Mt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bg(e[1])){const r=e[1];if(r.type==="FeatureCollection")return new vd(r,r.features.map(o=>Vw(o.geometry)).flat());if(r.type==="Feature")return new vd(r,Vw(r.geometry));if("type"in r&&"coordinates"in r)return new vd(r,Vw(r))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return EG(e,this.geometries);if(e.geometryType()==="LineString")return IG(e,this.geometries);if(e.geometryType()==="Polygon")return PG(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const q2={"==":YH,"!=":QH,">":eG,"<":JH,">=":nG,"<=":tG,array:Ml,at:M2,boolean:Ml,case:D2,coalesce:Vg,collator:G0,format:N2,image:O2,in:R2,"index-of":$v,interpolate:xu,"interpolate-hcl":xu,"interpolate-lab":xu,length:F2,let:$0,literal:wp,match:L2,number:Ml,"number-format":z2,object:Ml,slice:qv,step:H0,string:Ml,"to-boolean":nh,"to-color":nh,"to-number":nh,"to-string":nh,var:q0,within:yd,distance:vd};class Ll{constructor(e,n,r,o){this.name=e,this.type=n,this._evaluate=r,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const r=e[0],o=Ll.definitions[r];if(!o)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(o)?o[0]:o.type,f=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,l=f.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let S=null;for(const[A,O]of l){S=new U0(n.registry,Wv,n.path,null,n.scope);const U=[];let H=!1;for(let $=1;$<e.length;$++){const ie=e[$],me=Array.isArray(A)?A[$-1]:A.type,Me=S.parse(ie,1+U.length,me);if(!Me){H=!0;break}U.push(Me)}if(!H){if(Array.isArray(A)&&A.length!==U.length){S.error(`Expected ${A.length} arguments, but found ${U.length} instead.`);continue}for(let $=0;$<U.length;$++){const ie=Array.isArray(A)?A[$]:A.type,me=U[$];S.concat($+1).checkSubtype(ie,me.type)}if(S.errors.length===0)return new Ll(r,h,O,U)}}if(l.length===1)n.errors.push(...S.errors);else{const A=(l.length?l:f).map(([U])=>AG(U)).join(" | "),O=[];for(let U=1;U<e.length;U++){const H=n.parse(e[U],1+O.length);if(!H)return null;O.push(er(H.type))}n.error(`Expected arguments of type ${A}, but found (${O.join(", ")}) instead.`)}return null}static register(e,n){Ll.definitions=n;for(const r in n)e[r]=Ll}}function eA(t,[e,n,r,o]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const h=o?o.evaluate(t):1,f=mz(e,n,r,h);if(f)throw new Er(f);return new Ci(e/255,n/255,r/255,h,!1)}function tA(t,e){return t in e}function jw(t,e){const n=e[t];return typeof n>"u"?null:n}function CG(t,e,n,r){for(;n<=r;){const o=n+r>>1;if(e[o]===t)return!0;e[o]>t?r=o-1:n=o+1}return!1}function td(t){return{type:t}}Ll.register(q2,{error:[SH,[On],(t,[e])=>{throw new Er(e.evaluate(t))}],typeof:[On,[An],(t,[e])=>er(es(e.evaluate(t)))],"to-rgba":[ma(Mt,4),[vu],(t,[e])=>{const[n,r,o,h]=e.evaluate(t).rgb;return[n*255,r*255,o*255,h]}],rgb:[vu,[Mt,Mt,Mt],eA],rgba:[vu,[Mt,Mt,Mt,Mt],eA],has:{type:Cn,overloads:[[[On],(t,[e])=>tA(e.evaluate(t),t.properties())],[[On,rp],(t,[e,n])=>tA(e.evaluate(t),n.evaluate(t))]]},get:{type:An,overloads:[[[On],(t,[e])=>jw(e.evaluate(t),t.properties())],[[On,rp],(t,[e,n])=>jw(e.evaluate(t),n.evaluate(t))]]},"feature-state":[An,[On],(t,[e])=>jw(e.evaluate(t),t.featureState||{})],properties:[rp,[],t=>t.properties()],"geometry-type":[On,[],t=>t.geometryType()],id:[An,[],t=>t.id()],zoom:[Mt,[],t=>t.globals.zoom],"heatmap-density":[Mt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Mt,[],t=>t.globals.lineProgress||0],accumulated:[An,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Mt,td(Mt),(t,e)=>{let n=0;for(const r of e)n+=r.evaluate(t);return n}],"*":[Mt,td(Mt),(t,e)=>{let n=1;for(const r of e)n*=r.evaluate(t);return n}],"-":{type:Mt,overloads:[[[Mt,Mt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Mt],(t,[e])=>-e.evaluate(t)]]},"/":[Mt,[Mt,Mt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Mt,[Mt,Mt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Mt,[Mt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Mt,[Mt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Mt,[Mt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Mt,[Mt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Mt,[Mt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Mt,[Mt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Mt,[Mt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Mt,td(Mt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Mt,td(Mt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Mt,[Mt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Mt,[Mt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Mt,[Mt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Mt,[Mt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Cn,[On,An],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Cn,[An],(t,[e])=>t.id()===e.value],"filter-type-==":[Cn,[On],(t,[e])=>t.geometryType()===e.value],"filter-<":[Cn,[On,An],(t,[e,n])=>{const r=t.properties()[e.value],o=n.value;return typeof r==typeof o&&r<o}],"filter-id-<":[Cn,[An],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[Cn,[On,An],(t,[e,n])=>{const r=t.properties()[e.value],o=n.value;return typeof r==typeof o&&r>o}],"filter-id->":[Cn,[An],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[Cn,[On,An],(t,[e,n])=>{const r=t.properties()[e.value],o=n.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[Cn,[An],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[Cn,[On,An],(t,[e,n])=>{const r=t.properties()[e.value],o=n.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[Cn,[An],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[Cn,[An],(t,[e])=>e.value in t.properties()],"filter-has-id":[Cn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Cn,[ma(On)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Cn,[ma(An)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Cn,[On,ma(An)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Cn,[On,ma(An)],(t,[e,n])=>CG(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[td(Cn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[td(Cn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Cn,[Cn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Cn,[On],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return n?n(e.evaluate(t)):!0}],upcase:[On,[On],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[On,[On],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[On,td(An),(t,e)=>e.map(n=>lg(n.evaluate(t))).join("")],"resolved-locale":[On,[F0],(t,[e])=>e.evaluate(t).resolvedLocale()]});function AG(t){return Array.isArray(t)?`(${t.map(er).join(", ")})`:`(${er(t.type)}...)`}function Wv(t){if(t instanceof q0)return Wv(t.boundExpression);if(t instanceof Ll&&t.name==="error"||t instanceof G0||t instanceof yd||t instanceof vd)return!1;const e=t instanceof nh||t instanceof Ml;let n=!0;return t.eachChild(r=>{e?n=n&&Wv(r):n=n&&r instanceof wp}),n?W0(t)&&K0(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]):!1}function W0(t){if(t instanceof Ll&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof yd||t instanceof vd)return!1;let e=!0;return t.eachChild(n=>{e&&!W0(n)&&(e=!1)}),e}function Ug(t){if(t instanceof Ll&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Ug(n)&&(e=!1)}),e}function K0(t,e){if(t instanceof Ll&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(r=>{n&&!K0(r,e)&&(n=!1)}),n}function w1(t){return{result:"success",value:t}}function Mf(t){return{result:"error",value:t}}function Kv(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Ez(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Iz(t){return!!t.expression&&t.expression.interpolated}function li(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function H2(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}class kG{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new gz,this._defaultValue=n?LG(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,r,o,h,f){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=o,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,n,r,o,h,f){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=o,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f||null;try{const l=this.expression.evaluate(this._evaluator);if(l==null||typeof l=="number"&&l!==l)return this._defaultValue;if(this._enumValues&&!(l in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(l)} instead.`);return l}catch(l){return this._warningHistory[l.message]||(this._warningHistory[l.message]=!0,typeof console<"u"&&console.warn(l.message)),this._defaultValue}}}function Pz(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in q2}function Cz(t,e){const n=new U0(q2,Wv,[],e?RG(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?w1(new kG(r,e)):Mf(n.errors)}class nA{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Ug(n.expression)}evaluateWithoutErrorHandling(e,n,r,o,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,o,h,f)}evaluate(e,n,r,o,h,f){return this._styleExpression.evaluate(e,n,r,o,h,f)}}class iA{constructor(e,n,r,o){this.kind=e,this.zoomStops=r,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ug(n.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,n,r,o,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,o,h,f)}evaluate(e,n,r,o,h,f){return this._styleExpression.evaluate(e,n,r,o,h,f)}interpolationFactor(e,n,r){return this.interpolationType?xu.interpolationFactor(this.interpolationType,e,n,r):0}}function MG(t,e){const n=Cz(t,e);if(n.result==="error")return n;const r=n.value.expression,o=W0(r);if(!o&&!Kv(e))return Mf([new du("","data expressions not supported")]);const h=K0(r,["zoom"]);if(!h&&!Ez(e))return Mf([new du("","zoom expressions not supported")]);const f=Zy(r);if(!f&&!h)return Mf([new du("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(f instanceof du)return Mf([f]);if(f instanceof xu&&!Iz(e))return Mf([new du("",'"interpolate" expressions cannot be used with this property')]);if(!f)return w1(o?new nA("constant",n.value):new nA("source",n.value));const l=f instanceof xu?f.interpolation:void 0;return w1(o?new iA("camera",n.value,f.labels,l):new iA("composite",n.value,f.labels,l))}function Zy(t){let e=null;if(t instanceof $0)e=Zy(t.result);else if(t instanceof Vg){for(const n of t.args)if(e=Zy(n),e)break}else(t instanceof H0||t instanceof xu)&&t.input instanceof Ll&&t.input.name==="zoom"&&(e=t);return e instanceof du||t.eachChild(n=>{const r=Zy(n);r instanceof du?e=r:!e&&r?e=new du("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new du("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function RG(t){const e={color:vu,string:On,number:Mt,enum:On,boolean:Cn,formatted:B0,padding:V0,projectionDefinition:O0,resolvedImage:a_,variableAnchorOffsetCollection:j0};return t.type==="array"?ma(e[t.value]||An,t.length):e[t.type]}function LG(t){return t.type==="color"&&H2(t.default)?new Ci(0,0,0,0):t.type==="color"?Ci.parse(t.default)||null:t.type==="padding"?qa.parse(t.default)||null:t.type==="variableAnchorOffsetCollection"?Nl.parse(t.default)||null:t.type==="projectionDefinition"?kl.parse(t.default)||null:t.default===void 0?null:t.default}function Az(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Az(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function kz(t){const e=t.key,n=t.value;return n?[new Pt(e,n,"constants have been deprecated as of v8")]:[]}function yr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Md(t){if(Array.isArray(t))return t.map(Md);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Md(t[n]);return e}return yr(t)}function Ha(t){const e=t.key,n=t.value,r=t.valueSpec||{},o=t.objectElementValidators||{},h=t.style,f=t.styleSpec,l=t.validateSpec;let S=[];const A=li(n);if(A!=="object")return[new Pt(e,n,`object expected, ${A} found`)];for(const O in n){const U=O.split(".")[0],H=r[U]||r["*"];let $;if(o[U])$=o[U];else if(r[U])$=l;else if(o["*"])$=o["*"];else if(r["*"])$=l;else{S.push(new Pt(e,n[O],`unknown property "${O}"`));continue}S=S.concat($({key:(e&&`${e}.`)+O,value:n[O],valueSpec:H,style:h,styleSpec:f,object:n,objectKey:O,validateSpec:l},n))}for(const O in r)o[O]||r[O].required&&r[O].default===void 0&&n[O]===void 0&&S.push(new Pt(e,n,`missing required property "${O}"`));return S}function G2(t){const e=t.value,n=t.valueSpec,r=t.validateSpec,o=t.style,h=t.styleSpec,f=t.key,l=t.arrayElementValidator||r;if(li(e)!=="array")return[new Pt(f,e,`array expected, ${li(e)} found`)];if(n.length&&e.length!==n.length)return[new Pt(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Pt(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let S={type:n.value,values:n.values};h.$version<7&&(S.function=n.function),li(n.value)==="object"&&(S=n.value);let A=[];for(let O=0;O<e.length;O++)A=A.concat(l({array:e,arrayIndex:O,value:e[O],valueSpec:S,validateSpec:t.validateSpec,style:o,styleSpec:h,key:`${f}[${O}]`}));return A}function Z2(t){const e=t.key,n=t.value,r=t.valueSpec;let o=li(n);return o==="number"&&n!==n&&(o="NaN"),o!=="number"?[new Pt(e,n,`number expected, ${o} found`)]:"minimum"in r&&n<r.minimum?[new Pt(e,n,`${n} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&n>r.maximum?[new Pt(e,n,`${n} is greater than the maximum value ${r.maximum}`)]:[]}function Mz(t){const e=t.valueSpec,n=yr(t.value.type);let r,o={},h,f;const l=n!=="categorical"&&t.value.property===void 0,S=!l,A=li(t.value.stops)==="array"&&li(t.value.stops[0])==="array"&&li(t.value.stops[0][0])==="object",O=Ha({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:U,default:ie}});return n==="identity"&&l&&O.push(new Pt(t.key,t.value,'missing required property "property"')),n!=="identity"&&!t.value.stops&&O.push(new Pt(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!Iz(t.valueSpec)&&O.push(new Pt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(S&&!Kv(t.valueSpec)?O.push(new Pt(t.key,t.value,"property functions not supported")):l&&!Ez(t.valueSpec)&&O.push(new Pt(t.key,t.value,"zoom functions not supported"))),(n==="categorical"||A)&&t.value.property===void 0&&O.push(new Pt(t.key,t.value,'"property" property is required')),O;function U(me){if(n==="identity")return[new Pt(me.key,me.value,'identity function may not have a "stops" property')];let Me=[];const ce=me.value;return Me=Me.concat(G2({key:me.key,value:ce,valueSpec:me.valueSpec,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:H})),li(ce)==="array"&&ce.length===0&&Me.push(new Pt(me.key,ce,"array must have at least one stop")),Me}function H(me){let Me=[];const ce=me.value,le=me.key;if(li(ce)!=="array")return[new Pt(le,ce,`array expected, ${li(ce)} found`)];if(ce.length!==2)return[new Pt(le,ce,`array length 2 expected, length ${ce.length} found`)];if(A){if(li(ce[0])!=="object")return[new Pt(le,ce,`object expected, ${li(ce[0])} found`)];if(ce[0].zoom===void 0)return[new Pt(le,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new Pt(le,ce,"object stop key must have value")];if(f&&f>yr(ce[0].zoom))return[new Pt(le,ce[0].zoom,"stop zoom values must appear in ascending order")];yr(ce[0].zoom)!==f&&(f=yr(ce[0].zoom),h=void 0,o={}),Me=Me.concat(Ha({key:`${le}[0]`,value:ce[0],valueSpec:{zoom:{}},validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:Z2,value:$}}))}else Me=Me.concat($({key:`${le}[0]`,value:ce[0],valueSpec:{},validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec},ce));return Pz(Md(ce[1]))?Me.concat([new Pt(`${le}[1]`,ce[1],"expressions are not allowed in function stops.")]):Me.concat(me.validateSpec({key:`${le}[1]`,value:ce[1],valueSpec:e,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec}))}function $(me,Me){const ce=li(me.value),le=yr(me.value),ge=me.value!==null?me.value:Me;if(!r)r=ce;else if(ce!==r)return[new Pt(me.key,ge,`${ce} stop domain type must match previous stop domain type ${r}`)];if(ce!=="number"&&ce!=="string"&&ce!=="boolean")return[new Pt(me.key,ge,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&n!=="categorical"){let je=`number expected, ${ce} found`;return Kv(e)&&n===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(me.key,ge,je)]}return n==="categorical"&&ce==="number"&&(!isFinite(le)||Math.floor(le)!==le)?[new Pt(me.key,ge,`integer expected, found ${le}`)]:n!=="categorical"&&ce==="number"&&h!==void 0&&le<h?[new Pt(me.key,ge,"stop domain values must appear in ascending order")]:(h=le,n==="categorical"&&le in o?[new Pt(me.key,ge,"stop domain values must be unique")]:(o[le]=!0,[]))}function ie(me){return me.validateSpec({key:me.key,value:me.value,valueSpec:e,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec})}}function bp(t){const e=(t.expressionContext==="property"?MG:Cz)(Md(t.value),t.valueSpec);if(e.result==="error")return e.value.map(r=>new Pt(`${t.key}${r.key}`,t.value,r.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new Pt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ug(n))return[new Pt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Ug(n))return[new Pt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!K0(n,["zoom","feature-state"]))return[new Pt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!W0(n))return[new Pt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function DG(t){const e=t.value,n=t.key,r=li(e);return r!=="boolean"?[new Pt(n,e,`boolean expected, ${r} found`)]:[]}function zG(t){const e=t.key,n=t.value,r=li(n);return r!=="string"?[new Pt(e,n,`color expected, ${r} found`)]:Ci.parse(String(n))?[]:[new Pt(e,n,`color expected, "${n}" found`)]}function $g(t){const e=t.key,n=t.value,r=t.valueSpec,o=[];return Array.isArray(r.values)?r.values.indexOf(yr(n))===-1&&o.push(new Pt(e,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(r.values).indexOf(yr(n))===-1&&o.push(new Pt(e,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),o}function W2(t){return Az(Md(t.value))?bp(jv({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rz(t)}function Rz(t){const e=t.value,n=t.key;if(li(e)!=="array")return[new Pt(n,e,`array expected, ${li(e)} found`)];const r=t.styleSpec;let o,h=[];if(e.length<1)return[new Pt(n,e,"filter array must have at least 1 element")];switch(h=h.concat($g({key:`${n}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),yr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&yr(e[1])==="$type"&&h.push(new Pt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Pt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(o=li(e[1]),o!=="string"&&h.push(new Pt(`${n}[1]`,e[1],`string expected, ${o} found`)));for(let f=2;f<e.length;f++)o=li(e[f]),yr(e[1])==="$type"?h=h.concat($g({key:`${n}[${f}]`,value:e[f],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):o!=="string"&&o!=="number"&&o!=="boolean"&&h.push(new Pt(`${n}[${f}]`,e[f],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)h=h.concat(Rz({key:`${n}[${f}]`,value:e[f],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":o=li(e[1]),e.length!==2?h.push(new Pt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="string"&&h.push(new Pt(`${n}[1]`,e[1],`string expected, ${o} found`));break}return h}function Lz(t,e){const n=t.key,r=t.validateSpec,o=t.style,h=t.styleSpec,f=t.value,l=t.objectKey,S=h[`${e}_${t.layerType}`];if(!S)return[];const A=l.match(/^(.*)-transition$/);if(e==="paint"&&A&&S[A[1]]&&S[A[1]].transition)return r({key:n,value:f,valueSpec:h.transition,style:o,styleSpec:h});const O=t.valueSpec||S[l];if(!O)return[new Pt(n,f,`unknown property "${l}"`)];let U;if(li(f)==="string"&&Kv(O)&&!O.tokens&&(U=/^{([^}]+)}$/.exec(f)))return[new Pt(n,f,`"${l}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const H=[];return t.layerType==="symbol"&&(l==="text-field"&&o&&!o.glyphs&&H.push(new Pt(n,f,'use of "text-field" requires a style "glyphs" property')),l==="text-font"&&H2(Md(f))&&yr(f.type)==="identity"&&H.push(new Pt(n,f,'"text-font" does not support identity functions'))),H.concat(r({key:t.key,value:f,valueSpec:O,style:o,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:l}))}function Dz(t){return Lz(t,"paint")}function zz(t){return Lz(t,"layout")}function Nz(t){let e=[];const n=t.value,r=t.key,o=t.style,h=t.styleSpec;!n.type&&!n.ref&&e.push(new Pt(r,n,'either "type" or "ref" is required'));let f=yr(n.type);const l=yr(n.ref);if(n.id){const S=yr(n.id);for(let A=0;A<t.arrayIndex;A++){const O=o.layers[A];yr(O.id)===S&&e.push(new Pt(r,n.id,`duplicate layer id "${n.id}", previously used at line ${O.id.__line__}`))}}if("ref"in n){["type","source","source-layer","filter","layout"].forEach(A=>{A in n&&e.push(new Pt(r,n[A],`"${A}" is prohibited for ref layers`))});let S;o.layers.forEach(A=>{yr(A.id)===l&&(S=A)}),S?S.ref?e.push(new Pt(r,n.ref,"ref cannot reference another ref layer")):f=yr(S.type):e.push(new Pt(r,n.ref,`ref layer "${l}" not found`))}else if(f!=="background")if(!n.source)e.push(new Pt(r,n,'missing required property "source"'));else{const S=o.sources&&o.sources[n.source],A=S&&yr(S.type);S?A==="vector"&&f==="raster"?e.push(new Pt(r,n.source,`layer "${n.id}" requires a raster source`)):A!=="raster-dem"&&f==="hillshade"?e.push(new Pt(r,n.source,`layer "${n.id}" requires a raster-dem source`)):A==="raster"&&f!=="raster"?e.push(new Pt(r,n.source,`layer "${n.id}" requires a vector source`)):A==="vector"&&!n["source-layer"]?e.push(new Pt(r,n,`layer "${n.id}" must specify a "source-layer"`)):A==="raster-dem"&&f!=="hillshade"?e.push(new Pt(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):f==="line"&&n.paint&&n.paint["line-gradient"]&&(A!=="geojson"||!S.lineMetrics)&&e.push(new Pt(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Pt(r,n.source,`source "${n.source}" not found`))}return e=e.concat(Ha({key:r,value:n,valueSpec:h.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*"(){return[]},type(){return t.validateSpec({key:`${r}.type`,value:n.type,valueSpec:h.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:n,objectKey:"type"})},filter:W2,layout(S){return Ha({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*"(A){return zz(jv({layerType:f},A))}}})},paint(S){return Ha({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*"(A){return Dz(jv({layerType:f},A))}}})}}})),e}function Rd(t){const e=t.value,n=t.key,r=li(e);return r!=="string"?[new Pt(n,e,`string expected, ${r} found`)]:[]}function NG(t){var e;const n=(e=t.sourceName)!==null&&e!==void 0?e:"",r=t.value,o=t.styleSpec,h=o.source_raster_dem,f=t.style;let l=[];const S=li(r);if(r===void 0)return l;if(S!=="object")return l.push(new Pt("source_raster_dem",r,`object expected, ${S} found`)),l;const A=yr(r.encoding)==="custom",O=["redFactor","greenFactor","blueFactor","baseShift"],U=t.value.encoding?`"${t.value.encoding}"`:"Default";for(const H in r)!A&&O.includes(H)?l.push(new Pt(H,r[H],`In "${n}": "${H}" is only valid when "encoding" is set to "custom". ${U} encoding found`)):h[H]?l=l.concat(t.validateSpec({key:H,value:r[H],valueSpec:h[H],validateSpec:t.validateSpec,style:f,styleSpec:o})):l.push(new Pt(H,r[H],`unknown property "${H}"`));return l}const rA={promoteId:OG};function Oz(t){const e=t.value,n=t.key,r=t.styleSpec,o=t.style,h=t.validateSpec;if(!e.type)return[new Pt(n,e,'"type" is required')];const f=yr(e.type);let l;switch(f){case"vector":case"raster":return l=Ha({key:n,value:e,valueSpec:r[`source_${f.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:rA,validateSpec:h}),l;case"raster-dem":return l=NG({sourceName:n,value:e,style:t.style,styleSpec:r,validateSpec:h}),l;case"geojson":if(l=Ha({key:n,value:e,valueSpec:r.source_geojson,style:o,styleSpec:r,validateSpec:h,objectElementValidators:rA}),e.cluster)for(const S in e.clusterProperties){const[A,O]=e.clusterProperties[S],U=typeof A=="string"?[A,["accumulated"],["get",S]]:A;l.push(...bp({key:`${n}.${S}.map`,value:O,validateSpec:h,expressionContext:"cluster-map"})),l.push(...bp({key:`${n}.${S}.reduce`,value:U,validateSpec:h,expressionContext:"cluster-reduce"}))}return l;case"video":return Ha({key:n,value:e,valueSpec:r.source_video,style:o,validateSpec:h,styleSpec:r});case"image":return Ha({key:n,value:e,valueSpec:r.source_image,style:o,validateSpec:h,styleSpec:r});case"canvas":return[new Pt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $g({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:o,validateSpec:h,styleSpec:r})}}function OG({key:t,value:e}){if(li(e)==="string")return Rd({key:t,value:e});{const n=[];for(const r in e)n.push(...Rd({key:`${t}.${r}`,value:e[r]}));return n}}function Fz(t){const e=t.value,n=t.styleSpec,r=n.light,o=t.style;let h=[];const f=li(e);if(e===void 0)return h;if(f!=="object")return h=h.concat([new Pt("light",e,`object expected, ${f} found`)]),h;for(const l in e){const S=l.match(/^(.*)-transition$/);S&&r[S[1]]&&r[S[1]].transition?h=h.concat(t.validateSpec({key:l,value:e[l],valueSpec:n.transition,validateSpec:t.validateSpec,style:o,styleSpec:n})):r[l]?h=h.concat(t.validateSpec({key:l,value:e[l],valueSpec:r[l],validateSpec:t.validateSpec,style:o,styleSpec:n})):h=h.concat([new Pt(l,e[l],`unknown property "${l}"`)])}return h}function Bz(t){const e=t.value,n=t.styleSpec,r=n.sky,o=t.style,h=li(e);if(e===void 0)return[];if(h!=="object")return[new Pt("sky",e,`object expected, ${h} found`)];let f=[];for(const l in e)r[l]?f=f.concat(t.validateSpec({key:l,value:e[l],valueSpec:r[l],style:o,styleSpec:n})):f=f.concat([new Pt(l,e[l],`unknown property "${l}"`)]);return f}function Vz(t){const e=t.value,n=t.styleSpec,r=n.terrain,o=t.style;let h=[];const f=li(e);if(e===void 0)return h;if(f!=="object")return h=h.concat([new Pt("terrain",e,`object expected, ${f} found`)]),h;for(const l in e)r[l]?h=h.concat(t.validateSpec({key:l,value:e[l],valueSpec:r[l],validateSpec:t.validateSpec,style:o,styleSpec:n})):h=h.concat([new Pt(l,e[l],`unknown property "${l}"`)]);return h}function FG(t){return Rd(t).length===0?[]:bp(t)}function BG(t){return Rd(t).length===0?[]:bp(t)}function VG(t){const e=t.key,n=t.value;if(li(n)==="array"){if(n.length<1||n.length>4)return[new Pt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const r={type:"number"};let o=[];for(let h=0;h<n.length;h++)o=o.concat(t.validateSpec({key:`${e}[${h}]`,value:n[h],validateSpec:t.validateSpec,valueSpec:r}));return o}else return Z2({key:e,value:n,valueSpec:{}})}function jG(t){const e=t.key,n=t.value,r=li(n),o=t.styleSpec;if(r!=="array"||n.length<1||n.length%2!==0)return[new Pt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let f=0;f<n.length;f+=2)h=h.concat($g({key:`${e}[${f}]`,value:n[f],valueSpec:o.layout_symbol["text-anchor"]})),h=h.concat(G2({key:`${e}[${f+1}]`,value:n[f+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:o}));return h}function jz(t){let e=[];const n=t.value,r=t.key;if(Array.isArray(n)){const o=[],h=[];for(const f in n){n[f].id&&o.includes(n[f].id)&&e.push(new Pt(r,n,`all the sprites' ids must be unique, but ${n[f].id} is duplicated`)),o.push(n[f].id),n[f].url&&h.includes(n[f].url)&&e.push(new Pt(r,n,`all the sprites' URLs must be unique, but ${n[f].url} is duplicated`)),h.push(n[f].url);const l={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(Ha({key:`${r}[${f}]`,value:n[f],valueSpec:l,validateSpec:t.validateSpec}))}return e}else return Rd({key:r,value:n})}function UG(t){const e=t.value,n=t.styleSpec,r=n.projection,o=t.style,h=li(e);if(e===void 0)return[];if(h!=="object")return[new Pt("projection",e,`object expected, ${h} found`)];let f=[];for(const l in e)r[l]?f=f.concat(t.validateSpec({key:l,value:e[l],valueSpec:r[l],style:o,styleSpec:n})):f=f.concat([new Pt(l,e[l],`unknown property "${l}"`)]);return f}function $G(t){const e=t.key;let n=t.value;n=n instanceof String?n.valueOf():n;const r=li(n);return r==="array"&&!HG(n)&&!qG(n)?[new Pt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]:["array","string"].includes(r)?[]:[new Pt(e,n,`projection expected, invalid type "${r}" found`)]}function qG(t){return!!["interpolate","step","literal"].includes(t[0])}function HG(t){return Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"}const sA={"*"(){return[]},array:G2,boolean:DG,number:Z2,color:zG,constants:kz,enum:$g,filter:W2,function:Mz,layer:Nz,object:Ha,source:Oz,light:Fz,sky:Bz,terrain:Vz,projection:UG,projectionDefinition:$G,string:Rd,formatted:FG,resolvedImage:BG,padding:VG,variableAnchorOffsetCollection:jG,sprite:jz};function ug(t){const e=t.value,n=t.valueSpec,r=t.styleSpec;return t.validateSpec=ug,n.expression&&H2(yr(e))?Mz(t):n.expression&&Pz(Md(e))?bp(t):n.type&&sA[n.type]?sA[n.type](t):Ha(jv({},t,{valueSpec:n.type?r[n.type]:n}))}function Uz(t){const e=t.value,n=t.key,r=Rd(t);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new Pt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new Pt(n,e,'"glyphs" url must include a "{range}" token'))),r}function Ya(t,e=TH){let n=[];return n=n.concat(ug({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:ug,objectElementValidators:{glyphs:Uz,"*"(){return[]}}})),t.constants&&(n=n.concat(kz({key:"constants",value:t.constants,style:t,styleSpec:e,validateSpec:ug}))),$z(n)}Ya.source=Pu(Iu(Oz));Ya.sprite=Pu(Iu(jz));Ya.glyphs=Pu(Iu(Uz));Ya.light=Pu(Iu(Fz));Ya.sky=Pu(Iu(Bz));Ya.terrain=Pu(Iu(Vz));Ya.layer=Pu(Iu(Nz));Ya.filter=Pu(Iu(W2));Ya.paintProperty=Pu(Iu(Dz));Ya.layoutProperty=Pu(Iu(zz));function Iu(t){return function(e){return t({...e,validateSpec:ug})}}function $z(t){return[].concat(t).sort((e,n)=>e.line-n.line)}function Pu(t){return function(...e){return $z(t.apply(this,e))}}function oA(t){if(!t)return{style:ag[og[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof t=="string"){const e=ZG(t);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:ag[og[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:t.startsWith("http")?{style:t,requiresUrlMonitoring:!0,isFallback:!1}:t.toLowerCase().includes(".json")?{style:GG(t),requiresUrlMonitoring:!0,isFallback:!1}:{style:DD(t),requiresUrlMonitoring:!0,isFallback:!1}}return t instanceof zD?{style:t.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:t instanceof ND?{style:t.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Ya(t).length===0?{style:t,requiresUrlMonitoring:!1,isFallback:!1}:{style:ag[og[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function GG(t){try{return new URL(t).href}catch{}return new URL(t,location.origin).href}function ZG(t){try{const e=JSON.parse(t),n=Ya(e);return{isValidJSON:!0,isValidStyle:n.length===0,styleObject:n.length===0?e:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}class WG{constructor(){kn(this,"_map"),kn(this,"_container"),kn(this,"_terrainButton"),xq(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=sc("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=sc("button","maplibregl-ctrl-terrain",this._container),sc("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P2(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}class KG extends Rq{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),kn(this,"_rotateCompassArrow",()=>{const n=this._map.getBearing(),r=this._map.getPitch(),o=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(r*(Math.PI/180))**.5)}) rotateX(${Math.min(70,r)}deg) rotateZ(${-n}deg)`:`rotate(${-n}deg)`;this._compassIcon.style.transform=o}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",n=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}))}_createButton(e,n){const r=super._createButton(e,n);return r.clickFunction=n,r}}const aA=Zt.Marker,lA=Zt.LngLat,XG=Zt.LngLatBounds;class YG extends Lq{constructor(){super(...arguments),kn(this,"lastUpdatedCenter",new lA(0,0)),kn(this,"_updateCamera",e=>{var n,r;const o=new lA(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,f={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},l=this._map.getZoom();l>(((r=(n=this.options)==null?void 0:n.fitBoundsOptions)==null?void 0:r.maxZoom)??30)&&(f.zoom=l),this._map.fitBounds(XG.fromLngLat(o,h),f,{geolocateSource:!0});let S=!1;const A=()=>{S=!0};this._map.once("click",A),this._map.once("dblclick",A),this._map.once("dragstart",A),this._map.once("mousedown",A),this._map.once("touchstart",A),this._map.once("wheel",A),this._map.once("moveend",()=>{this._map.off("click",A),this._map.off("dblclick",A),this._map.off("dragstart",A),this._map.off("mousedown",A),this._map.off("touchstart",A),this._map.off("wheel",A),!S&&(this.lastUpdatedCenter=this._map.getCenter())})}),kn(this,"_finishSetupUI",e=>{if(this._map){if(e===!1){const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=sc("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new aA({element:this._dotElement}),this._circleElement=sc("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new aA({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",n=>{const r=n.originalEvent&&n.originalEvent.type==="resize",o=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!n.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!r&&o>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),kn(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],n=this._map.project(e),r=this._map.unproject([n.x,n.y]),o=this._map.unproject([n.x+20,n.y]),h=r.distanceTo(o)/20,f=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var fa,uu,sd,od,Fa,Wy,go,qz,Ba,Hz;class Uw{constructor(e,n){ed(this,go),ed(this,fa),kn(this,"map"),ed(this,uu),ed(this,sd),ed(this,od),ed(this,Fa,!1),ed(this,Wy),e.style!==void 0&&Af(this,Fa,!0),Af(this,fa,{zoomAdjust:-4,position:"top-right",...n,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),e.lockZoom!==void 0&&(Hn(this,fa).minZoom=e.lockZoom,Hn(this,fa).maxZoom=e.lockZoom)}setStyle(e,n){Hn(this,Fa)||this.map.setStyle(e,n),da(this,go,Ba).call(this)}addLayer(e,n){return Hn(this,Fa)||this.map.addLayer(e,n),da(this,go,Ba).call(this),this.map}moveLayer(e,n){return Hn(this,Fa)||this.map.moveLayer(e,n),da(this,go,Ba).call(this),this.map}removeLayer(e){return Hn(this,Fa)||this.map.removeLayer(e),da(this,go,Ba).call(this),this}setLayerZoomRange(e,n,r){return Hn(this,Fa)||this.map.setLayerZoomRange(e,n,r),da(this,go,Ba).call(this),this}setFilter(e,n,r){return Hn(this,Fa)||this.map.setFilter(e,n,r),da(this,go,Ba).call(this),this}setPaintProperty(e,n,r,o){return Hn(this,Fa)||this.map.setPaintProperty(e,n,r,o),da(this,go,Ba).call(this),this}setLayoutProperty(e,n,r,o){return Hn(this,Fa)||this.map.setLayoutProperty(e,n,r,o),da(this,go,Ba).call(this),this}setGlyphs(e,n){return Hn(this,Fa)||this.map.setGlyphs(e,n),da(this,go,Ba).call(this),this}onAdd(e){Af(this,uu,e),Af(this,sd,sc("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[n,r]of Object.entries(Hn(this,fa).containerStyle))Hn(this,sd).style.setProperty(n,r);return Hn(this,fa).container=Hn(this,sd),Hn(this,fa).zoom=e.getZoom()+Hn(this,fa).zoomAdjust,this.map=new Gz(Hn(this,fa)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{da(this,go,qz).call(this,Hn(this,fa).parentRect),Af(this,Wy,da(this,go,Hz).call(this))}),Hn(this,sd)}onRemove(){var e;(e=Hn(this,Wy))==null||e.call(this),P2(Hn(this,sd))}}fa=new WeakMap,uu=new WeakMap,sd=new WeakMap,od=new WeakMap,Fa=new WeakMap,Wy=new WeakMap,go=new WeakSet,qz=function(t){t===void 0||t.linePaint===void 0&&t.fillPaint===void 0||(Af(this,od,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Hn(this,od)}),(t.lineLayout!==void 0||t.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...t.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...t.linePaint}}),t.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...t.fillPaint}}),da(this,go,Ba).call(this))},Ba=function(){if(Hn(this,od)===void 0)return;const{devicePixelRatio:t}=window,e=Hn(this,uu).getCanvas(),n=e.width/t,r=e.height/t,o=Hn(this,uu).unproject.bind(Hn(this,uu)),h=o([0,0]),f=o([n,0]),l=o([0,r]),S=o([n,r]);Hn(this,od).geometry.coordinates=[[l.toArray(),S.toArray(),f.toArray(),h.toArray(),l.toArray()]],this.map.getSource("parentRect").setData(Hn(this,od))},Hz=function(){const{pitchAdjust:t}=Hn(this,fa),e=()=>{h("parent")},n=()=>{h("minimap")},r=()=>{Hn(this,uu).on("move",e),this.map.on("move",n)},o=()=>{Hn(this,uu).off("move",e),this.map.off("move",n)},h=f=>{o();const l=f==="parent"?Hn(this,uu):this.map,S=f==="parent"?this.map:Hn(this,uu),A=l.getCenter(),O=l.getZoom()+Hn(this,fa).zoomAdjust*(f==="parent"?1:-1),U=l.getBearing(),H=l.getPitch();S.jumpTo({center:A,zoom:O,bearing:U,pitch:t?H:0}),da(this,go,Ba).call(this),r()};return r(),()=>{o()}};class QG{constructor(){kn(this,"map"),kn(this,"container"),kn(this,"projectionButton")}onAdd(e){return this.map=e,this.container=sc("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=sc("button","maplibregl-ctrl-projection",this.container),sc("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){P2(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}class JG{constructor(e,n=2e3){kn(this,"map"),kn(this,"registeredModules",new Set),this.map=e,setTimeout(async()=>{if(!gr.telemetry)return;const r=this.preparePayload();try{(await fetch(r,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(o){console.warn("The metrics could not be sent to MapTiler Cloud",o)}},Math.max(1e3,n))}registerModule(e,n){this.registeredModules.add(`${e}:${n}`)}preparePayload(){const e=new URL(yo.telemetryURL);return e.searchParams.append("sdk",hq.version),e.searchParams.append("key",gr.apiKey),e.searchParams.append("mtsid",I2),e.searchParams.append("session",gr.session?"1":"0"),e.searchParams.append("caching",gr.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}const eZ={POINT:"POINT",COUNTRY:"COUNTRY"};class Gz extends Zt.Map{constructor(e){Tq(e.container),e.apiKey&&(gr.apiKey=e.apiKey);const{style:n,requiresUrlMonitoring:r,isFallback:o}=oA(e.style);o&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),gr.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const h=location.hash;let f={compact:!1};e.customAttribution?f.customAttribution=e.customAttribution:e.attributionControl&&typeof e.attributionControl=="object"&&(f={...f,...e.attributionControl});const l={...e,style:n,maplibreLogo:!1,transformRequest:OC(e.transformRequest),attributionControl:e.forceNoAttributionControl===!0?!1:f};delete l.style,super(l),kn(this,"telemetry"),kn(this,"isTerrainEnabled",!1),kn(this,"terrainExaggeration",1),kn(this,"primaryLanguage"),kn(this,"terrainGrowing",!1),kn(this,"terrainFlattening",!1),kn(this,"minimap"),kn(this,"forceLanguageUpdate"),kn(this,"languageAlwaysBeenStyle"),kn(this,"isReady",!1),kn(this,"terrainAnimationDuration",1e3),kn(this,"monitoredStyleUrls"),kn(this,"styleInProcess",!1),kn(this,"curentProjection"),kn(this,"originalLabelStyle",new window.Map),kn(this,"isStyleLocalized",!1),kn(this,"languageIsUpdated",!1),this.setStyle(n),r&&this.monitorStyleUrl(n);const S=()=>{let $="The distant style could not be loaded.";this.getStyle()?$+="Leaving the style as is.":(this.setStyle(ag.STREETS),$+=`Loading default MapTiler Cloud style "${ag.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn($)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",$=>{if($.error instanceof Zt.AJAXError){const ie=$.error.url,me=new URL(ie);me.search="";const Me=me.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Me)&&(this.monitoredStyleUrls.delete(Me),S());return}if(this.styleInProcess)return S()}),gr.caching&&!p1&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),gr.caching&&p1&&yq(),typeof e.language>"u")this.primaryLanguage=gr.primaryLanguage;else{const $=bC(e.language,Yn);this.primaryLanguage=$??gr.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Yn.STYLE||this.primaryLanguage===Yn.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Yn.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!e.geolocate||e.center||e.hash&&h)return;try{if(e.geolocate===eZ.COUNTRY){await this.fitToIpBounds();return}}catch(ie){console.warn(ie.message)}let $;try{await this.centerOnIpPoint(e.zoom),$=this.getCameraHash()}catch(ie){console.warn(ie.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(ie=>{$===this.getCameraHash()&&(this.terrain?this.easeTo({center:[ie.coords.longitude,ie.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[ie.coords.longitude,ie.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let $={logo:null};try{const ie=Object.keys(this.style.sourceCaches).map(Me=>this.getSource(Me)).filter(Me=>Me&&"url"in Me&&typeof Me.url=="string"&&(Me==null?void 0:Me.url.includes("tiles.json"))),me=new URL(ie[0].url);me.searchParams.has("key")||me.searchParams.append("key",gr.apiKey),$=await(await fetch(me.href)).json()}catch{}if(e.forceNoAttributionControl!==!0)if("logo"in $&&$.logo){const ie=$.logo;this.addControl(new BC({logoURL:ie}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new BC,e.logoPosition);if(e.scaleControl){const ie=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,me=new zq({unit:gr.unit});this.addControl(me,ie),gr.on("unit",Me=>{me.setUnit(Me)})}if(e.navigationControl!==!1){const ie=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new KG,ie)}if(e.geolocateControl!==!1){const ie=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new YG({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),ie)}if(e.terrainControl){const ie=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new WG,ie)}if(e.projectionControl){const ie=e.projectionControl===!0||e.projectionControl===void 0?"top-right":e.projectionControl;this.addControl(new QG,ie)}if(e.fullscreenControl){const ie=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new Nq({}),ie)}this.isReady=!0,this.fire("ready",{target:this})});let A=!1,O=!1,U;this.once("ready",()=>{A=!0,O&&this.fire("loadWithTerrain",U)}),this.once("style.load",()=>{const{minimap:$}=e;if(typeof $=="object"){const{zoom:ie,center:me,style:Me,language:ce,apiKey:le,maptilerLogo:ge,canvasContextAttributes:je,refreshExpiredTiles:rt,maxBounds:qe,scrollZoom:fe,minZoom:Q,maxZoom:ue,boxZoom:ve,locale:Pe,fadeDuration:Ve,crossSourceCollisions:Ee,clickTolerance:Xt,bounds:tr,fitBoundsOptions:Yt,pixelRatio:vi,validateStyle:lt}=e;this.minimap=new Uw($,{zoom:ie,center:me,style:Me,language:ce,apiKey:le,container:"null",maptilerLogo:ge,canvasContextAttributes:je,refreshExpiredTiles:rt,maxBounds:qe,scrollZoom:fe,minZoom:Q,maxZoom:ue,boxZoom:ve,locale:Pe,fadeDuration:Ve,crossSourceCollisions:Ee,clickTolerance:Xt,bounds:tr,fitBoundsOptions:Yt,pixelRatio:vi,validateStyle:lt}),this.addControl(this.minimap,$.position??"bottom-left")}else $===!0?(this.minimap=new Uw({},e),this.addControl(this.minimap,"bottom-left")):$!==void 0&&$!==!1&&(this.minimap=new Uw({},e),this.addControl(this.minimap,$))});const H=$=>{$.terrain&&(O=!0,U={type:"loadWithTerrain",target:this,terrain:$.terrain},this.off("terrain",H),A&&this.fire("loadWithTerrain",U))};this.on("terrain",H),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",$=>{console.warn($),Sq(e.container),this.fire("webglContextLost",{error:$})})}),this.telemetry=new JG(this)}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise(e=>{if(this.loaded())return e(this);this.once("load",()=>{e(this)})})}async onReadyAsync(){return new Promise(e=>{if(this.isReady)return e(this);this.once("ready",()=>{e(this)})})}async onLoadWithTerrainAsync(){return new Promise(e=>{if(this.isReady&&this.terrain)return e(this);this.once("loadWithTerrain",()=>{e(this)})})}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const n=new URL(e);n.search="",this.monitoredStyleUrls.add(n.href)}setStyle(e,n){var r;this.originalLabelStyle.clear(),(r=this.minimap)==null||r.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const o=oA(e);if(o.requiresUrlMonitoring&&this.monitorStyleUrl(o.style),o.isFallback){if(this.getStyle())return console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}return this.styleInProcess=!0,super.setStyle(o.style,n),this}addLayer(e,n){var r;return(r=this.minimap)==null||r.addLayer(e,n),super.addLayer(e,n)}moveLayer(e,n){var r;return(r=this.minimap)==null||r.moveLayer(e,n),super.moveLayer(e,n)}removeLayer(e){var n;return(n=this.minimap)==null||n.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,n,r){var o;return(o=this.minimap)==null||o.setLayerZoomRange(e,n,r),super.setLayerZoomRange(e,n,r)}setFilter(e,n,r){var o;return(o=this.minimap)==null||o.setFilter(e,n,r),super.setFilter(e,n,r)}setPaintProperty(e,n,r,o){var h;return(h=this.minimap)==null||h.setPaintProperty(e,n,r,o),super.setPaintProperty(e,n,r,o)}setLayoutProperty(e,n,r,o){var h;return(h=this.minimap)==null||h.setLayoutProperty(e,n,r,o),super.setLayoutProperty(e,n,r,o)}setGlyphs(e,n){var r;return(r=this.minimap)==null||r.setGlyphs(e,n),super.setGlyphs(e,n)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?u1(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var n,r;(r=(n=this.minimap)==null?void 0:n.map)==null||r.setLanguage(e),this.onStyleReady(()=>{this.setPrimaryLanguage(e)})}setPrimaryLanguage(e){const n=this.getStyleLanguage(),r=bC(e,Yn);if(!r){console.warn(`The language "${r}" is not supported.`);return}if(!(r.flag===Yn.STYLE.flag&&n&&(n.flag===Yn.AUTO.flag||n.flag===Yn.VISITOR.flag))&&(r.flag!==Yn.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===r&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Yn.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=r;let o=r;if(r.flag===Yn.STYLE.flag){if(!n){console.warn("The style has no default languages or has an invalid one.");return}o=n}let h=Yn.LOCAL.flag,f=["get",h];o.flag===Yn.VISITOR.flag?(h=LC().flag,f=["case",["all",["has",h],["has",Yn.LOCAL.flag]],["case",["==",["get",h],["get",Yn.LOCAL.flag]],["get",Yn.LOCAL.flag],["format",["get",h],{"font-scale":.8},`
`,["get",Yn.LOCAL.flag],{"font-scale":1.1}]],["get",Yn.LOCAL.flag]]):o.flag===Yn.VISITOR_ENGLISH.flag?(h=Yn.ENGLISH.flag,f=["case",["all",["has",h],["has",Yn.LOCAL.flag]],["case",["==",["get",h],["get",Yn.LOCAL.flag]],["get",Yn.LOCAL.flag],["format",["get",h],{"font-scale":.8},`
`,["get",Yn.LOCAL.flag],{"font-scale":1.1}]],["get",Yn.LOCAL.flag]]):o.flag===Yn.AUTO.flag?(h=LC().flag,f=["coalesce",["get",h],["get",Yn.LOCAL.flag]]):o===Yn.LOCAL?(h=Yn.LOCAL.flag,f=["get",h]):(h=o.flag,f=["coalesce",["get",h],["get",Yn.LOCAL.flag]]);const{layers:l}=this.getStyle(),S=this.originalLabelStyle.size===0;if(S){const A=Mq(l,this);this.isStyleLocalized=Object.keys(A.localized).length>0}for(const A of l){if(A.type!=="symbol")continue;const O=A,U=this.getSource(O.source);if(!U||!("url"in U&&typeof U.url=="string")||new URL(U.url).host!==yo.maptilerApiHost)continue;const{id:H,layout:$}=O;if(!$||!("text-field"in $))continue;let ie;if(S?(ie=this.getLayoutProperty(H,"text-field"),this.originalLabelStyle.set(H,ie)):ie=this.originalLabelStyle.get(H),typeof ie=="string"){const{contains:me,exactMatch:Me}=Iq(ie,this.isStyleLocalized);if(!me)continue;if(Me)this.setLayoutProperty(H,"text-field",f);else{const ce=Pq(ie,f,this.isStyleLocalized);this.setLayoutProperty(H,"text-field",ce)}}else{const me=Eq(ie,f,this.isStyleLocalized);this.setLayoutProperty(H,"text-field",me)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const n=performance.now(),r=this.terrain.exaggeration,o=e-r,h=()=>{if(!this.terrain||this.terrainFlattening)return;const f=(performance.now()-n)/this.terrainAnimationDuration;if(f<.99){const l=1-(1-f)**4,S=r+l*o;this.terrain.exaggeration=S,requestAnimationFrame(h)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(h)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const n=async o=>{!this.terrain||o.type!=="data"||o.dataType!=="source"||!("source"in o)||o.sourceId!=="maptiler-terrain"||o.source.type!=="raster-dem"||o.isSourceLoaded&&(this.off("data",n),this.growTerrain(e))},r=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",n),this.addSource(yo.terrainSourceId,{type:"raster-dem",url:yo.terrainSourceURL}),this.setTerrain({source:yo.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}this.loaded()||this.isTerrainEnabled?r():this.once("load",()=>{this.getTerrain()&&this.getSource(yo.terrainSourceId)||r()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),n=this.terrain.exaggeration,r=()=>{if(!this.terrain||this.terrainGrowing)return;const o=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,o<.99){const h=(1-o)**4,f=n*h;this.terrain.exaggeration=f,requestAnimationFrame(r)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(yo.terrainSourceId)&&this.removeSource(yo.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(r)}setTerrainExaggeration(e,n=!0){!n&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}async fitToIpBounds(){const e=await SC.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const n=await SC.info();this.jumpTo({center:[(n==null?void 0:n.longitude)??0,(n==null?void 0:n.latitude)??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),n=this.getCenter();return e[0]=n.lng,e[1]=n.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),G7.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return gr}getMaptilerSessionId(){return I2}setTransformRequest(e){return super.setTransformRequest(OC(e)),this}isGlobeProjection(){const e=this.getProjection();return(e==null?void 0:e.type)==="globe"}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}}function K2(t){if(typeof DOMParser<"u"){const e=new DOMParser().parseFromString(t,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function Zz(t,e){if(!t.hasChildNodes())return!1;for(const n of Array.from(t.childNodes)){const r=n.nodeName;if(typeof r=="string"&&r.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function uA(t){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(t);throw new Error("No XML serializer found")}function Wz(t){const e=typeof t=="string"?K2(t):t;if(!Zz(e,"gpx"))throw new Error("The XML document is not valid GPX");const n=us(e,"trk"),r=us(e,"rte"),o=us(e,"wpt"),h={type:"FeatureCollection",features:[]};for(const f of Array.from(n)){const l=rZ(f);l&&h.features.push(l)}for(const f of Array.from(r)){const l=sZ(f);l&&h.features.push(l)}for(const f of Array.from(o))h.features.push(oZ(f));return h}function Kz(t,e){let n=t;if(typeof n=="string"&&(n=K2(n)),!Zz(n,"kml"))throw new Error("The XML document is not valid KML");const r={type:"FeatureCollection",features:[]},o={},h={},f={},l=us(n,"Placemark"),S=us(n,"Style"),A=us(n,"StyleMap");for(const O of Array.from(S)){const U=hA(uA(O)).toString(16);o[`#${xd(O,"id")}`]=U,h[U]=O}for(const O of Array.from(A)){o[`#${xd(O,"id")}`]=hA(uA(O)).toString(16);const U=us(O,"Pair"),H={};for(const $ of Array.from(U))H[gi(_n($,"key"))??""]=gi(_n($,"styleUrl"));f[`#${xd(O,"id")}`]=H}for(const O of Array.from(l))r.features=r.features.concat(iZ(O,o,h,f));return r}function cA(t){if(t===null)return["#000000",1];let e="",n=1,r=t;return r.substring(0,1)==="#"&&(r=r.substring(1)),(r.length===6||r.length===3)&&(e=r),r.length===8&&(n=Number.parseInt(r.substring(0,2),16)/255,e=`#${r.substring(6,8)}${r.substring(4,6)}${r.substring(2,4)}`),[e??"#000000",n??1]}function tZ(t){return Qz(t.split(" "))}function nZ(t){let e=us(t,"coord");const n=[],r=[];e.length===0&&(e=us(t,"gx:coord"));for(const h of Array.from(e))n.push(tZ(gi(h)??""));const o=us(t,"when");for(const h of Array.from(o))r.push(gi(h));return{coords:n,times:r}}function Ky(t){const e=["Polygon","LineString","Point","Track","gx:Track"];let n,r,o,h,f;const l=[],S=[];if(_n(t,"MultiGeometry")!==null)return Ky(_n(t,"MultiGeometry"));if(_n(t,"MultiTrack")!==null)return Ky(_n(t,"MultiTrack"));if(_n(t,"gx:MultiTrack")!==null)return Ky(_n(t,"gx:MultiTrack"));for(o=0;o<e.length;o++)if(r=us(t,e[o]),r){for(h=0;h<r.length;h++)if(n=r[h],e[o]==="Point")l.push({type:"Point",coordinates:Jz(gi(_n(n,"coordinates"))??"")});else if(e[o]==="LineString")l.push({type:"LineString",coordinates:fA(gi(_n(n,"coordinates"))??"")});else if(e[o]==="Polygon"){const A=us(n,"LinearRing"),O=[];for(f=0;f<A.length;f++)O.push(fA(gi(_n(A[f],"coordinates"))??""));l.push({type:"Polygon",coordinates:O})}else if(e[o]==="Track"||e[o]==="gx:Track"){const A=nZ(n);l.push({type:"LineString",coordinates:A.coords}),A.times.length&&S.push(A.times)}}return{geoms:l,coordTimes:S}}function iZ(t,e,n,r){const o=Ky(t),h={},f=gi(_n(t,"name")),l=gi(_n(t,"address")),S=gi(_n(t,"description")),A=_n(t,"TimeSpan"),O=_n(t,"TimeStamp"),U=_n(t,"ExtendedData"),H=_n(t,"visibility");let $,ie=gi(_n(t,"styleUrl")),me=_n(t,"LineStyle"),Me=_n(t,"PolyStyle");if(!o.geoms.length)return[];if(f&&(h.name=f),l&&(h.address=l),ie){ie[0]!=="#"&&(ie=`#${ie}`),h.styleUrl=ie,e[ie]&&(h.styleHash=e[ie]),r[ie]&&(h.styleMapHash=r[ie],h.styleHash=e[r[ie].normal??""]);const le=n[h.styleHash??""];if(le){me||(me=_n(le,"LineStyle")),Me||(Me=_n(le,"PolyStyle"));const ge=_n(le,"IconStyle");if(ge){const je=_n(ge,"Icon");if(je){const rt=gi(_n(je,"href"));rt&&(h.icon=rt)}}}}if(S&&(h.description=S),A){const le=gi(_n(A,"begin")),ge=gi(_n(A,"end"));le&&ge&&(h.timespan={begin:le,end:ge})}if(O!==null&&(h.timestamp=gi(_n(O,"when"))??new Date().toISOString()),me!==null){const le=cA(gi(_n(me,"color"))),ge=le[0],je=le[1],rt=Number.parseFloat(gi(_n(me,"width"))??"");ge&&(h.stroke=ge),Number.isNaN(je)||(h["stroke-opacity"]=je),Number.isNaN(rt)||(h["stroke-width"]=rt)}if(Me){const le=cA(gi(_n(Me,"color"))),ge=le[0],je=le[1],rt=gi(_n(Me,"fill")),qe=gi(_n(Me,"outline"));ge&&(h.fill=ge),Number.isNaN(je)||(h["fill-opacity"]=je),rt&&(h["fill-opacity"]=rt==="1"?h["fill-opacity"]||1:0),qe&&(h["stroke-opacity"]=qe==="1"?h["stroke-opacity"]||1:0)}if(U){const le=us(U,"Data"),ge=us(U,"SimpleData");for($=0;$<le.length;$++)h[le[$].getAttribute("name")??""]=gi(_n(le[$],"value"))??"";for($=0;$<ge.length;$++)h[ge[$].getAttribute("name")??""]=gi(ge[$])??""}H!==null&&(h.visibility=gi(H)??""),o.coordTimes.length!==0&&(h.coordTimes=o.coordTimes.length===1?o.coordTimes[0]:o.coordTimes);const ce={type:"Feature",geometry:o.geoms.length===1?o.geoms[0]:{type:"GeometryCollection",geometries:o.geoms},properties:h};return xd(t,"id")&&(ce.id=xd(t,"id")??void 0),[ce]}function Xz(t,e){const n=us(t,e),r=[],o=[];let h=[];const f=n.length;if(!(f<2)){for(let l=0;l<f;l++){const S=e5(n[l]);r.push(S.coordinates),S.time&&o.push(S.time),(S.heartRate||h.length)&&(h.length===0&&(h=new Array(l).fill(null)),h.push(S.heartRate))}return{line:r,times:o,heartRates:h}}}function rZ(t){const e=us(t,"trkseg"),n=[],r=[],o=[];let h;for(let l=0;l<e.length;l++)if(h=Xz(e[l],"trkpt"),h!==void 0&&(h.line&&n.push(h.line),h.times&&h.times.length&&r.push(h.times),o.length||h.heartRates&&h.heartRates.length)){if(!o.length)for(let S=0;S<l;S++)o.push(new Array(n[S].length).fill(null));h.heartRates&&h.heartRates.length?o.push(h.heartRates):o.push(new Array(h.line.length).fill(null))}if(n.length===0)return;const f={...X2(t),...Yz(_n(t,"extensions"))};return r.length!==0&&(f.coordTimes=n.length===1?r[0]:r),o.length!==0&&(f.heartRates=n.length===1?o[0]:o),n.length===1?{type:"Feature",properties:f,geometry:{type:"LineString",coordinates:n[0]}}:{type:"Feature",properties:f,geometry:{type:"MultiLineString",coordinates:n}}}function sZ(t){const e=Xz(t,"rtept");return e===void 0?void 0:{type:"Feature",properties:{...X2(t),...Yz(_n(t,"extensions"))},geometry:{type:"LineString",coordinates:e.line}}}function oZ(t){return{type:"Feature",properties:{...X2(t),...b1(t,["sym"])},geometry:{type:"Point",coordinates:e5(t).coordinates}}}function Yz(t){const e={};if(t){const n=_n(t,"line");if(n){const r=gi(_n(n,"color")),o=Number.parseFloat(gi(_n(n,"opacity"))??"0"),h=Number.parseFloat(gi(_n(n,"width"))??"0");r&&(e.stroke=r),Number.isNaN(o)||(e["stroke-opacity"]=o),Number.isNaN(h)||(e["stroke-width"]=h*96/25.4)}}return e}function X2(t){const e=b1(t,["name","cmt","desc","type","time","keywords"]),n=us(t,"link");if(n.length!==0){e.links=[];for(const r of Array.from(n)){const o={href:xd(r,"href"),...b1(r,["text","type"])};e.links.push(o)}}return e}function hA(t){let e=0;if(!t||!t.length)return e;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)|0;return e}function us(t,e){return t.getElementsByTagName(e)}function xd(t,e){return t.getAttribute(e)}function dA(t,e){return Number.parseFloat(xd(t,e)??"0")}function _n(t,e){const n=us(t,e);return n.length?n[0]:null}function aZ(t){return t.normalize&&t.normalize(),t}function Qz(t){return t.map(Number.parseFloat).map(e=>Number.isNaN(e)?null:e)}function gi(t){return t&&aZ(t),t&&t.textContent}function b1(t,e){const n={};let r,o;for(o=0;o<e.length;o++)r=_n(t,e[o]),r&&(n[e[o]]=gi(r)??"");return n}function Jz(t){return Qz(t.replace(/\s*/g,"").split(","))}function fA(t){const e=t.replace(/^\s*|\s*$/g,"").split(/\s+/),n=[];for(const r of e)n.push(Jz(r));return n}function e5(t){const e=[dA(t,"lon"),dA(t,"lat")],n=_n(t,"ele"),r=_n(t,"gpxtpx:hr")||_n(t,"hr"),o=_n(t,"time");let h;return n&&(h=Number.parseFloat(gi(n)??"0"),Number.isNaN(h)||e.push(h)),{coordinates:e,time:o?gi(o):null,heartRate:r!==null?Number.parseFloat(gi(r)??"0"):null}}function lZ(t){let e=t;try{typeof e=="string"&&(e=K2(e))}catch{return null}try{return Wz(e)}catch{}try{return Kz(e)}catch{}return null}function xy(t){const e=t.toString(16);return e.length===1?`0${e}`:e}function uZ(t){return`#${xy(t[0])}${xy(t[1])}${xy(t[2])}${t.length===4?xy(t[3]):""}`}class sn extends Array{constructor(e={}){super(),kn(this,"min",0),kn(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new sn({stops:e.map(n=>({value:n[0],color:n[1]}))})}setStops(e,n={clone:!0}){const r=n.clone?this.clone():this;r.length=0;let o=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(let f=0;f<e.length;f+=1)o=Math.min(o,e[f].value),h=Math.max(h,e[f].value),r.push({value:e[f].value,color:e[f].color.slice()});return r.sort((f,l)=>f.value<l.value?-1:1),this.min=o,this.max=h,r}scale(e,n,r={clone:!0}){const o=r.clone,h=this[0].value,f=this.at(-1).value-h,l=n-e,S=[];for(let A=0;A<this.length;A+=1){const O=(this[A].value-h)/f*l+e;o?S.push({value:O,color:this[A].color.slice()}):this[A].value=O}return o?new sn({stops:S}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new sn({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let n=0;n<this.length;n+=1)e.push({value:this[n].value,color:this[n].color});return e}reverse(e={clone:!0}){const n=e.clone?this.clone():this;for(let r=0;r<~~(n.length/2);r+=1){const o=n[r].color;n[r].color=n.at(-(r+1)).color,n.at(-(r+1)).color=o}return n}getBounds(){return{min:this.min,max:this.max}}getColor(e,n={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let r=0;r<this.length-1;r+=1){if(e>this[r+1].value)continue;const o=this[r].color;if(!n.smooth)return o.slice();const h=this[r].value,f=this[r+1].value,l=this[r+1].color,S=(f-e)/(f-h);return o.map((A,O)=>Math.round(A*S+l[O]*(1-S)))}return[0,0,0]}getColorHex(e,n={smooth:!0,withAlpha:!1}){return uZ(this.getColor(e,n))}getColorRelative(e,n={smooth:!0}){const r=this.getBounds();return this.getColor(r.min+e*(r.max-r.min),n)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const n=document.createElement("canvas");n.width=e.horizontal?e.size:1,n.height=e.horizontal?1:e.size;const r=n.getContext("2d");if(!r)throw new Error("Canvs context is missing");const o=r.getImageData(0,0,n.width,n.height),h=o.data,f=e.size,l=this[0].value,S=(this.at(-1).value-l)/f;for(let A=0;A<f;A+=1){const O=this.getColor(l+A*S,{smooth:e.smooth});h[A*4]=O[0],h[A*4+1]=O[1],h[A*4+2]=O[2],h[A*4+3]=O.length>3?O[3]:255}return r.putImageData(o,0,0),n}resample(e,n=15){const r=this.getBounds(),o=this.scale(0,1),h=1/(n-1);let f;if(e==="ease-in-square")f=Array.from({length:n},(l,S)=>{const A=S*h,O=A**2,U=o.getColor(O);return{value:A,color:U}});else if(e==="ease-out-square")f=Array.from({length:n},(l,S)=>{const A=S*h,O=1-(1-A)**2,U=o.getColor(O);return{value:A,color:U}});else if(e==="ease-out-sqrt")f=Array.from({length:n},(l,S)=>{const A=S*h,O=A**.5,U=o.getColor(O);return{value:A,color:U}});else if(e==="ease-in-sqrt")f=Array.from({length:n},(l,S)=>{const A=S*h,O=1-(1-A)**.5,U=o.getColor(O);return{value:A,color:U}});else if(e==="ease-out-exp")f=Array.from({length:n},(l,S)=>{const A=S*h,O=1-2**(-10*A),U=o.getColor(O);return{value:A,color:U}});else if(e==="ease-in-exp")f=Array.from({length:n},(l,S)=>{const A=S*h,O=2**(10*A-10),U=o.getColor(O);return{value:A,color:U}});else throw new Error("Invalid ressampling method.");return new sn({stops:f}).scale(r.min,r.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const n of e)n.color.length===3&&n.color.push(255);return e[0].color[3]=0,new sn({stops:e})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const t5={NULL:new sn({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new sn({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new sn({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new sn({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new sn({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new sn({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new sn({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new sn({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new sn({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new sn({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new sn({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new sn({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new sn({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new sn({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new sn({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new sn({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new sn({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new sn({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new sn({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new sn({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new sn({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new sn({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new sn({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new sn({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new sn({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new sn({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new sn({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new sn({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new sn({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new sn({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new sn({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new sn({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new sn({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new sn({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new sn({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new sn({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new sn({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new sn({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new sn({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new sn({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new sn({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new sn({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new sn({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new sn({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new sn({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new sn({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new sn({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new sn({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new sn({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function cZ(t,e={}){const n=e.download??!1,r=await hZ(t);if(n){const o=e.filename??"maptiler_screenshot.png",h=document.createElement("a");h.style.display="none",document.body.appendChild(h),h.href=URL.createObjectURL(r),h.download=o,h.click(),setTimeout(()=>{document.body.removeChild(h),URL.revokeObjectURL(h.href)},0)}return r}function hZ(t){return new Promise((e,n)=>{t.redraw(),t.once("idle",()=>{t.getCanvas().toBlob(r=>{if(!r)return n(Error("Screenshot could not be created."));e(r)},"image/png")})})}const pA=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Y2(){return pA[~~(Math.random()*pA.length)][~~(Math.random()*4)]}function X0(){return`maptiler_source_${oz()}`}function Y0(){return`maptiler_layer_${oz()}`}function mA(t,e){if(e<=t[0].zoom)return t[0].value;if(e>=t[t.length-1].zoom)return t[t.length-1].value;for(let n=0;n<t.length-1;n+=1)if(e>=t[n].zoom&&e<t[n+1].zoom){const r=t[n+1].zoom-t[n].zoom,o=(e-t[n].zoom)/r;return o*t[n+1].value+(1-o)*t[n].value}return 0}function wd(t){return["interpolate",["linear"],["zoom"],...t.flatMap(e=>[e.zoom,e.value])]}function _i(t){return["interpolate",["linear"],["zoom"],...t.flatMap(e=>[e.zoom,e.value])]}function dZ(t,e){if(typeof e=="number"&&typeof t=="number")return 2*e+t;if(typeof e=="number"&&Array.isArray(t))return["interpolate",["linear"],["zoom"],...t.flatMap(n=>[n.zoom,2*e+n.value])];if(typeof t=="number"&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(n=>[n.zoom,2*n.value+t])];if(Array.isArray(t)&&Array.isArray(e)){const n=Array.from(new Set([...t.map(r=>r.zoom),...e.map(r=>r.zoom)])).sort((r,o)=>r<o?-1:1);return["interpolate",["linear"],["zoom"],...n.flatMap(r=>[r,2*mA(e,r)+mA(t,r)])]}return 0}function fZ(t,e){return["interpolate",["linear"],["get",e],...t.flatMap(n=>[n.propertyValue,n.value])]}function n5(t){const e=t.trimStart(),n=`${e}${" ".repeat(t.length-e.length)}`,r=Array.from(n);if(!r.every(h=>h===" "||h==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(r.some(h=>h==="_")&&r.some(h=>h===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const o=[1];for(let h=1;h<r.length;h+=1){const f=r[h-1],l=r[h];f===l?o[o.length-1]+=1:o.push(1)}return o}function gA(t,e){return["interpolate",["linear"],["get",e],...t.flatMap(n=>[n.value,n.color])]}function _A(t,e,n=!0){return n?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.value,r.pointRadius*.025])],2,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.value,r.pointRadius*.05])],4,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.value,r.pointRadius*.1])],8,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.value,r.pointRadius*.25])],16,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.value,r.pointRadius])]]:["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.value,r.pointRadius])]}function pZ(t,e,n=!0){return n?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.propertyValue,r.value*.025])],2,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.propertyValue,r.value*.05])],4,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.propertyValue,r.value*.1])],8,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.propertyValue,r.value*.25])],16,["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.propertyValue,r.value])]]:["interpolate",["linear"],["get",e],...t.flatMap(r=>[r.propertyValue,r.value])]}function yA(t,e){return t.every(n=>n.color[3]===t[0].color[3])?t[0].color[3]?t[0].color[3]/255:1:["interpolate",["linear"],["get",e],...t.getRawColorStops().flatMap(n=>{const r=n.value,o=n.color;return[r,o.length===4?o[3]/255:1]})]}function mZ(t,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(n,r)=>{const o=r/e;return[o,t.getColorHex(o)]}).flat()]}async function gZ(t,e,n={}){var r,o;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let h=e.data;if(typeof h=="string"){if(z0(h))h=`https://api.maptiler.com/data/${e.data}/features.json?key=${gr.apiKey}`;else if(((r=h.split(".").pop())==null?void 0:r.toLowerCase().trim())==="gpx"){const f=await(await fetch(h,n)).text();h=Wz(f)}else if(((o=h.split(".").pop())==null?void 0:o.toLowerCase().trim())==="kml"){const f=await(await fetch(h,n)).text();h=Kz(f)}else{const f=wq(h)??lZ(h);f&&(h=f)}if(!h)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return _Z(t,{...e,data:h})}function _Z(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.sourceId??X0(),r=e.layerId??Y0(),o={polylineLayerId:r,polylineOutlineLayerId:"",polylineSourceId:n};e.data&&!t.getSource(n)&&t.addSource(n,{type:"geojson",data:e.data});const h=e.lineWidth??3,f=e.lineColor??Y2(),l=e.lineOpacity??1,S=e.lineBlur??0,A=e.lineGapWidth??0;let O=e.lineDashArray??null;const U=e.outlineWidth??1,H=e.outlineColor??"#FFFFFF",$=e.outlineOpacity??1,ie=e.outlineBlur??0;if(typeof O=="string"&&(O=n5(O)),e.outline===!0){const me=`${r}_outline`;o.polylineOutlineLayerId=me,t.addLayer({id:me,type:"line",source:n,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof $=="number"?$:_i($),"line-color":typeof H=="string"?H:wd(H),"line-width":dZ(h,U),"line-blur":typeof ie=="number"?ie:_i(ie)}},e.beforeId)}return t.addLayer({id:r,type:"line",source:n,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof l=="number"?l:_i(l),"line-color":typeof f=="string"?f:wd(f),"line-width":typeof h=="number"?h:_i(h),"line-blur":typeof S=="number"?S:_i(S),"line-gap-width":typeof A=="number"?A:_i(A),...O&&{"line-dasharray":O}}},e.beforeId),o}function yZ(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.sourceId??X0(),r=e.layerId??Y0(),o={polygonLayerId:r,polygonOutlineLayerId:e.outline?`${r}_outline`:"",polygonSourceId:n};if(e.data&&!t.getSource(n)){let me=e.data;typeof me=="string"&&z0(me)&&(me=`https://api.maptiler.com/data/${me}/features.json?key=${gr.apiKey}`),t.addSource(n,{type:"geojson",data:me})}let h=e.outlineDashArray??null;const f=e.outlineWidth??1,l=e.outlineColor??"#FFFFFF",S=e.outlineOpacity??1,A=e.outlineBlur??0,O=e.fillColor??Y2(),U=e.fillOpacity??1,H=e.outlinePosition??"center",$=e.pattern??null;typeof h=="string"&&(h=n5(h));const ie=(me=null)=>{if(t.addLayer({id:r,type:"fill",source:n,minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"fill-color":typeof O=="string"?O:wd(O),"fill-opacity":typeof U=="number"?U:_i(U),...me&&{"fill-pattern":me}}},e.beforeId),e.outline===!0){let Me;H==="inside"?typeof f=="number"?Me=.5*f:Me=_i(f.map(({zoom:ce,value:le})=>({zoom:ce,value:.5*le}))):H==="outside"?typeof f=="number"?Me=-.5*f:Me=_i(f.map(ce=>({zoom:ce.zoom,value:-.5*ce.value}))):Me=0,t.addLayer({id:o.polygonOutlineLayerId,type:"line",source:n,layout:{"line-join":e.outlineJoin??"round","line-cap":e.outlineCap??"butt"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof S=="number"?S:_i(S),"line-color":typeof l=="string"?l:wd(l),"line-width":typeof f=="number"?f:_i(f),"line-blur":typeof A=="number"?A:_i(A),"line-offset":Me,...h&&{"line-dasharray":h}}},e.beforeId)}};return $?t.hasImage($)?ie($):t.loadImage($).then(me=>{t.addImage($,me.data),ie($)}).catch(me=>(console.error("Could not load the pattern image.",me.message),ie())):ie(),o}function vZ(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.minPointRadius??10,r=e.maxPointRadius??50,o=e.cluster??!1,h=20,f=Array.isArray(e.pointColor)?e.pointColor:t5.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),l=f.getBounds(),S=e.sourceId??X0(),A=e.layerId??Y0(),O=e.showLabel??o,U=e.alignOnViewport??!0,H=e.outline??!1,$=e.outlineOpacity??1,ie=e.outlineWidth??1,me=e.outlineColor??"#FFFFFF";let Me;const ce=e.zoomCompensation??!0,le=e.minzoom??0,ge=e.maxzoom??23;typeof e.pointOpacity=="number"?Me=e.pointOpacity:Array.isArray(e.pointOpacity)?Me=_i(e.pointOpacity):e.cluster?Me=yA(f,"point_count"):e.property?Me=yA(f,e.property):Me=_i([{zoom:le,value:0},{zoom:le+.25,value:1},{zoom:ge-.25,value:1},{zoom:ge,value:0}]);const je={pointLayerId:A,clusterLayerId:"",labelLayerId:"",pointSourceId:S};if(e.data&&!t.getSource(S)){let rt=e.data;typeof rt=="string"&&z0(rt)&&(rt=`https://api.maptiler.com/data/${rt}/features.json?key=${gr.apiKey}`),t.addSource(S,{type:"geojson",data:rt,cluster:o})}if(o){je.clusterLayerId=`${A}_cluster`;const rt=Array.from({length:h},(qe,fe)=>{const Q=l.min+fe*(l.max-l.min)/(h-1);return{value:Q,pointRadius:n+(r-n)*(fe/(h-1))**.5,color:f.getColorHex(Q)}});t.addLayer({id:je.clusterLayerId,type:"circle",source:S,filter:["has","point_count"],paint:{"circle-color":typeof e.pointColor=="string"?e.pointColor:gA(rt,"point_count"),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?_i(e.pointRadius):_A(rt,"point_count",!1),"circle-pitch-alignment":U?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Me,...H&&{"circle-stroke-opacity":typeof $=="number"?$:_i($),"circle-stroke-width":typeof ie=="number"?ie:_i(ie),"circle-stroke-color":typeof me=="string"?me:wd(me)}},minzoom:le,maxzoom:ge},e.beforeId),t.addLayer({id:je.pointLayerId,type:"circle",source:S,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":U?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof e.pointColor=="string"?e.pointColor:f.getColorHex(f.getBounds().min),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?_i(e.pointRadius):rt[0].pointRadius*.75,"circle-opacity":Me,...H&&{"circle-stroke-opacity":typeof $=="number"?$:_i($),"circle-stroke-width":typeof ie=="number"?ie:_i(ie),"circle-stroke-color":typeof me=="string"?me:wd(me)}},minzoom:le,maxzoom:ge},e.beforeId)}else{let rt=typeof e.pointColor=="string"?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):Y2(),qe=typeof e.pointRadius=="number"?ce?_i([{zoom:0,value:e.pointRadius*.025},{zoom:2,value:e.pointRadius*.05},{zoom:4,value:e.pointRadius*.1},{zoom:8,value:e.pointRadius*.25},{zoom:16,value:e.pointRadius*1}]):e.pointRadius:Array.isArray(e.pointRadius)?_i(e.pointRadius):ce?_i([{zoom:0,value:n*.05},{zoom:2,value:n*.1},{zoom:4,value:n*.2},{zoom:8,value:n*.5},{zoom:16,value:n*1}]):n;if(e.property&&Array.isArray(e.pointColor)){const fe=Array.from({length:h},(Q,ue)=>{const ve=l.min+ue*(l.max-l.min)/(h-1);return{value:ve,pointRadius:typeof e.pointRadius=="number"?e.pointRadius:n+(r-n)*(ue/(h-1))**.5,color:typeof e.pointColor=="string"?e.pointColor:f.getColorHex(ve)}});rt=gA(fe,e.property),qe=_A(fe,e.property,ce)}t.addLayer({id:je.pointLayerId,type:"circle",source:S,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:{"circle-pitch-alignment":U?"viewport":"map","circle-pitch-scale":"map","circle-color":rt,"circle-opacity":Me,"circle-radius":qe,...H&&{"circle-stroke-opacity":typeof $=="number"?$:_i($),"circle-stroke-width":typeof ie=="number"?ie:_i(ie),"circle-stroke-color":typeof me=="string"?me:wd(me)}},minzoom:le,maxzoom:ge},e.beforeId)}if(O!==!1&&(e.cluster||e.property)){je.labelLayerId=`${A}_label`;const rt=e.labelColor??"#fff",qe=e.labelSize??12;t.addLayer({id:je.labelLayerId,type:"symbol",source:S,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":qe,"text-pitch-alignment":U?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":rt,"text-opacity":Me},minzoom:le,maxzoom:ge},e.beforeId)}return je}function xZ(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.sourceId??X0(),r=e.layerId??Y0(),o=e.minzoom??0,h=e.maxzoom??23,f=e.zoomCompensation??!0,l=e.opacity??[{zoom:o,value:0},{zoom:o+.25,value:1},{zoom:h-.25,value:1},{zoom:h,value:0}];let S=Array.isArray(e.colorRamp)?e.colorRamp:t5.TURBO.transparentStart();const A=S.getBounds();(A.min!==0||A.max!==1)&&(S=S.scale(0,1)),S.hasTransparentStart()||(S=S.transparentStart());const O=e.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],U=e.property??null,H=e.weight??1;let $=1;U?typeof H=="number"?($=H,typeof e.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(H)?$=fZ(H,U):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof H=="number"?$=H:Array.isArray(H)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const ie=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],me=e.radius??(f?ie:10);let Me=1;typeof me=="number"?Me=me:Array.isArray(me)&&"zoom"in me[0]?Me=_i(me):U&&Array.isArray(me)&&"propertyValue"in me[0]?Me=pZ(me,U,f):!U&&Array.isArray(me)&&"propertyValue"in me[0]?(Me=_i(ie),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Me=_i(ie);const ce={heatmapLayerId:r,heatmapSourceId:n};if(e.data&&!t.getSource(n)){let le=e.data;typeof le=="string"&&z0(le)&&(le=`https://api.maptiler.com/data/${le}/features.json?key=${gr.apiKey}`),t.addSource(n,{type:"geojson",data:le})}return t.addLayer({id:r,type:"heatmap",source:n,minzoom:o,maxzoom:h,paint:{"heatmap-weight":$,"heatmap-intensity":typeof O=="number"?O:_i(O),"heatmap-color":mZ(S),"heatmap-radius":Me,"heatmap-opacity":typeof l=="number"?l:_i(l)}},e.beforeId),ce}const Lm={addPolyline:gZ,addPolygon:yZ,addPoint:vZ,addHeatmap:xZ,takeScreenshot:cZ};vq();Zt.Map;Zt.Marker;Zt.Popup;Zt.Style;Zt.CanvasSource;Zt.GeoJSONSource;Zt.ImageSource;Zt.RasterTileSource;Zt.RasterDEMTileSource;Zt.VectorTileSource;Zt.VideoSource;Zt.NavigationControl;Zt.GeolocateControl;Zt.AttributionControl;Zt.LogoControl;Zt.ScaleControl;Zt.FullscreenControl;Zt.TerrainControl;Zt.BoxZoomHandler;Zt.ScrollZoomHandler;Zt.CooperativeGesturesHandler;Zt.KeyboardHandler;Zt.TwoFingersTouchPitchHandler;Zt.MapWheelEvent;Zt.MapTouchEvent;Zt.MapMouseEvent;Zt.config;Zt.getVersion;const wZ="@maptiler/leaflet-maptilersdk",bZ="4.0.2",TZ=ji.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(t){ji.setOptions(this,t),this._throttledUpdate=ji.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(t){var e;this._container||this._initContainer();const n=this.getPaneName();(e=t.getPane(n))==null||e.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&ji.DomEvent.on(t._proxy,ji.DomUtil.TRANSITION_END,this._transitionEnd,this),t.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(t){var e;this._map._proxy&&this._map.options.zoomAnimation&&ji.DomEvent.off(this._map._proxy,ji.DomUtil.TRANSITION_END,this._transitionEnd,this);const n=this.getPaneName();(e=t.getPane(n))==null||e.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const t=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return ji.latLngBounds(this._map.containerPointToLatLng(e.subtract(t)),this._map.containerPointToLatLng(e.add(t)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(t){this._maptilerMap.setStyle(t)},setLanguage:function(t){this._maptilerMap.setLanguage(t)},_roundPoint:t=>({x:Math.round(t.x),y:Math.round(t.y)}),_initContainer:function(){this._container=ji.DomUtil.create("div","leaflet-gl-layer");const t=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${t.x}px`,this._container.style.height=`${t.y}px`;const n=this._map.containerPointToLayerPoint([0,0]).subtract(e);ji.DomUtil.setPosition(this._container,this._roundPoint(n))},_initMaptilerSDK:function(){const t=this._map.getCenter(),e={...this.options,projection:"mercator",container:this._container,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(e.center=void 0,e.zoom=void 0),this._maptilerMap=new Gz(e),this._maptilerMap.telemetry.registerModule(wZ,bZ),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let r={logo:null};try{const o=Object.keys(this._maptilerMap.style.sourceCaches).map(f=>this._maptilerMap.getSource(f)).filter(f=>f&&"url"in f&&typeof f.url=="string"&&(f==null?void 0:f.url.includes("tiles.json"))),h=new URL(o[0].url);h.searchParams.has("key")||h.searchParams.append("key",e.apiKey),r=await(await fetch(h.href)).json()}catch{}if(r.logo||e.maptilerLogo){const o=r.logo??"https://api.maptiler.com/resources/logo.svg",h=document.createElement("a");h.href="https://www.maptiler.com",h.style.setProperty("position","absolute"),h.style.setProperty("left","10px"),h.style.setProperty("bottom","2px"),h.style.setProperty("z-index","999");const f=document.createElement("img");f.src=o,f.alt="MapTiler logo",f.width=100,f.height=30,h.appendChild(f),this._map.getContainer().appendChild(h)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const n=this._maptilerMap._actualCanvas;ji.DomUtil.addClass(n,"leaflet-image-layer"),ji.DomUtil.addClass(n,"leaflet-zoom-animated"),this.options.interactive&&ji.DomUtil.addClass(n,"leaflet-interactive"),this.options.className&&ji.DomUtil.addClass(n,this.options.className),this.addHeatmap=r=>Lm.addHeatmap(this._maptilerMap,r),this.addPolygon=r=>Lm.addPolygon(this._maptilerMap,r),this.addPoint=r=>Lm.addPoint(this._maptilerMap,r),this.addPolyline=r=>Lm.addPolyline(this._maptilerMap,r),this.takeScreenshot=r=>Lm.takeScreenshot(this._maptilerMap,r)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const t=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding),n=this._map.containerPointToLayerPoint([0,0]).subtract(e);ji.DomUtil.setPosition(this._container,this._roundPoint(n)),this._transformGL(),this._maptilerMap.transform.width!==t.x||this._maptilerMap.transform.height!==t.y?(this._container.style.width=`${t.x}px`,this._container.style.height=`${t.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){const e=this._map.getZoomScale(t.zoom),n=this._map.getSize().multiplyBy(this.options.padding*e),r=this.getSize()._divideBy(2),o=this._map.project(t.center,t.zoom)._subtract(r)._add(this._map._getMapPanePos().add(n))._round(),h=this._map.project(this._map.getBounds().getNorthWest(),t.zoom)._subtract(o);ji.DomUtil.setTransform(this._maptilerMap.getCanvas(),h.subtract(this._offset),e)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const t=this._map.getZoomScale(this._map.getZoom());ji.DomUtil.setTransform(this._maptilerMap.getCanvas(),new ji.Point(0,0),t),this._zooming=!1,this._update()},_transitionEnd:function(){ji.Util.requestAnimFrame(()=>{const t=this._map.getZoom(),e=this._map.getCenter(),n=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());ji.DomUtil.setTransform(this._maptilerMap._actualCanvas,n,1),this._maptilerMap.once("moveend",ji.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:e,zoom:t-1})},this)},_resize:function(t){this._transitionEnd(t)}});function vA({reports:t=[],onReportClick:e}){const[n,r]=ut.useState([]),[o,h]=ut.useState([]),[f,l]=ut.useState([]),[S,A]=ut.useState(!0),[O,U]=ut.useState(null),[H,$]=ut.useState({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:!1}),ie=ut.useRef(null),me=["All",...Array.from(new Set(Bm.map(Q=>Q.location)))],Me=()=>{const Q=new Set;return n.forEach(ue=>{const ve=new Date(ue.Time),Pe=`${ve.getFullYear()}-${String(ve.getMonth()+1).padStart(2,"0")}`;Q.add(Pe)}),["All",...Array.from(Q).sort().reverse()]},ce=[{id:0,name:"Uncomfortable Situation",color:"#de9e36"},{id:1,name:"Sexual Harassment",color:"#ca3c25"},{id:2,name:"Physical",color:"#701d52"},{id:3,name:"Verbal Aggression",color:"#212475"},{id:4,name:"Discrimination",color:"#1d1a05"}],le=()=>{const Q={};return Bm.forEach(ue=>{Q[ue.name]={hallName:ue.name,coordinates:[ue.latitude,ue.longitude],totalIncidents:0,incidentCounts:{0:0,1:0,2:0,3:0,4:0},buildingType:ue.buildingType,location:ue.location,recentIncidents:[]}}),Q},ge=Q=>Q.filter(ue=>{if(H.selectedCampus!=="All"){const ve=Bm.find(Pe=>Pe.name===ue.Dorm);if(!ve||ve.location!==H.selectedCampus)return!1}if(H.selectedMonth!=="All"){const ve=new Date(ue.Time);if(`${ve.getFullYear()}-${String(ve.getMonth()+1).padStart(2,"0")}`!==H.selectedMonth)return!1}return!(H.selectedTypes.length>0&&!H.selectedTypes.includes(ue.Type))}),je=(Q,ue)=>{$(ve=>({...ve,[Q]:ue}))},rt=Q=>{$(ue=>({...ue,selectedTypes:ue.selectedTypes.includes(Q)?ue.selectedTypes.filter(ve=>ve!==Q):[...ue.selectedTypes,Q]}))},qe=Q=>{if(ie.current)if(Q==="All")ie.current.setView([41.7002,-86.2379],15);else{const ue=Bm.filter(ve=>ve.location===Q);if(ue.length>0){const ve=ji.latLngBounds(ue.map(Pe=>[Pe.latitude,Pe.longitude]));ie.current.fitBounds(ve,{padding:[50,50]})}}};ut.useEffect(()=>{const Q=async()=>{try{A(!0),U(null);const ue=await Vv.getReports(1e3);if(ue.length===0){const Ve=(await(await fetch("https://red-report.vercel.app/api/import")).json()).map(Ee=>({id:Ee.id,Dorm:Ee.Dorm,Time:new Date(Ee.Time),Type:Ee.Type}));r(Ve)}else r(ue)}catch(ue){console.error("Error fetching data:",ue),U("Failed to load incident data")}finally{A(!1)}};ie.current||(ie.current=ji.map("map",{maxZoom:19}).setView([41.7002,-86.2379],15).setMinZoom(15).setMaxBounds([[41.7152,-86.2079],[41.6852,-86.2679]]),new TZ({style:"80390579-ac14-4623-ba3e-80bdbcb7bd5f",apiKey:"4XUdc4BtSv2psaIP6grE"}).addTo(ie.current)),Q()},[]),ut.useEffect(()=>{h(ge(n))},[n,H]),ut.useEffect(()=>{if(!ie.current||o.length===0)return;ie.current.eachLayer(ue=>{ue instanceof ji.Circle&&ie.current.removeLayer(ue)});const Q=le();o.forEach(ue=>{try{const ve=ue.Dorm;Q[ve]&&(Q[ve].totalIncidents++,Q[ve].incidentCounts[ue.Type]++,Q[ve].recentIncidents.push(ue),Q[ve].recentIncidents.length>10&&Q[ve].recentIncidents.shift())}catch(ve){console.warn(`Error processing incident for ${ue.Dorm}:`,ve)}}),l(Object.values(Q)),Object.values(Q).forEach(ue=>{if(ue.totalIncidents>0){const ve=Math.min(ue.totalIncidents*5,30),Pe=Object.entries(ue.incidentCounts).sort(([,tr],[,Yt])=>Yt-tr)[0][0],Ee={0:"#de9e36",1:"#ca3c25",2:"#701d52",3:"#212475",4:"#1d1a05"}[parseInt(Pe)]||"#666666";ji.circle(ue.coordinates,{color:Ee,fillColor:Ee,fillOpacity:.7,radius:ve,weight:2}).addTo(ie.current);const Xt=fe(ue);ji.circle(ue.coordinates,{color:"black",fillColor:"black",fillOpacity:.9,radius:3}).addTo(ie.current).bindPopup(Xt,{maxWidth:400,className:"enhanced-popup"})}}),$m.logMapView()},[o]);const fe=Q=>{const ue=new Date;ue.setDate(ue.getDate()-7);const ve=Q.recentIncidents.filter(Xt=>new Date(Xt.Time)>=ue);let Pe=1;ve.length>=5?Pe=5:ve.length>=3?Pe=4:ve.length>=2?Pe=3:ve.length>=1?Pe=2:Pe=1;const Ve=Pe>=4?"#ca3c25":Pe>=3?"#de9e36":Pe>=2?"#212475":"#28a745",Ee=[{name:"Uncomfortable Situation",color:"#de9e36"},{name:"Sexual Harassment",color:"#ca3c25"},{name:"Physical",color:"#701d52"},{name:"Verbal Aggression",color:"#212475"},{name:"Discrimination",color:"#1d1a05"}];return`
      <div class="enhanced-popup-content">
        <h3 style="margin: 0 0 10px 0; color: #333;">${Q.hallName}</h3>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Location:</span> ${Q.location}<br>
          <span style="font-weight: bold; color: #666;">Building Type:</span> ${Q.buildingType}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Total Cases:</span> ${Q.totalIncidents}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Cases by Type:</span><br>
          ${Object.entries(Q.incidentCounts).filter(([,Xt])=>Xt>0).map(([Xt,tr])=>{const Yt=parseInt(Xt),vi=Ee[Yt];return`<div style="margin: 2px 0; font-size: 12px;">
                <span style="color: ${vi.color}; font-weight: bold;"></span> 
                ${vi.name}: ${tr}
              </div>`}).join("")}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Risk Score:</span> 
          <span style="color: ${Ve}; font-weight: bold; font-size: 16px;">
            ${Pe}/5
          </span>
          ${ve.length>0?`<br><span style="font-size: 12px; color: #666;">
              (${ve.length} recent case${ve.length>1?"s":""} in last 7 days)
            </span>`:'<br><span style="font-size: 12px; color: #28a745;">(No recent activity)</span>'}
        </div>
      </div>
    `};return Lt.jsxs("div",{className:"fullscreen-map-container",children:[Lt.jsxs("div",{className:`map-filter-menu ${H.showMenu?"menu-open":""}`,children:[Lt.jsx("button",{className:"menu-toggle-btn",onClick:()=>je("showMenu",!H.showMenu),children:H.showMenu?"":""}),Lt.jsxs("div",{className:"filter-content",children:[Lt.jsx("h3",{children:"Map Filters"}),Lt.jsxs("div",{className:"filter-section",children:[Lt.jsx("label",{children:"Campus:"}),Lt.jsx("select",{value:H.selectedCampus,onChange:Q=>{je("selectedCampus",Q.target.value),qe(Q.target.value)},children:me.map(Q=>Lt.jsx("option",{value:Q,children:Q},Q))})]}),Lt.jsxs("div",{className:"filter-section",children:[Lt.jsx("label",{children:"Month:"}),Lt.jsx("select",{value:H.selectedMonth,onChange:Q=>je("selectedMonth",Q.target.value),children:Me().map(Q=>Lt.jsx("option",{value:Q,children:Q==="All"?"All Time":Q},Q))})]}),Lt.jsxs("div",{className:"filter-section",children:[Lt.jsx("label",{children:"Incident Types:"}),Lt.jsx("div",{className:"type-filters",children:ce.map(Q=>Lt.jsxs("label",{className:"type-checkbox",children:[Lt.jsx("input",{type:"checkbox",checked:H.selectedTypes.includes(Q.id),onChange:()=>rt(Q.id)}),Lt.jsx("span",{className:"type-color-dot",style:{backgroundColor:Q.color}}),Q.name]},Q.id))})]}),Lt.jsx("button",{className:"clear-filters-btn",onClick:()=>$({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:H.showMenu}),children:"Clear All Filters"}),Lt.jsxs("div",{className:"results-summary",children:[Lt.jsxs("p",{children:["Showing ",o.length," incidents"]}),H.selectedCampus!=="All"&&Lt.jsxs("p",{children:["Campus: ",H.selectedCampus]}),H.selectedMonth!=="All"&&Lt.jsxs("p",{children:["Period: ",H.selectedMonth]}),H.selectedTypes.length>0&&Lt.jsxs("p",{children:["Types: ",H.selectedTypes.map(Q=>{var ue;return(ue=ce.find(ve=>ve.id===Q))==null?void 0:ue.name}).join(", ")]})]})]})]}),Lt.jsx("a",{href:"../",className:"back-button",children:Lt.jsx("button",{className:"buttion disc abs back",children:"Back"})}),S&&Lt.jsx("div",{className:"loading-overlay",children:Lt.jsx("div",{className:"loading-content",children:"Loading incident data..."})}),O&&Lt.jsx("div",{className:"error-overlay",children:O}),Lt.jsx("div",{id:"map",className:"fullscreen-map"})]})}$w.createRoot(document.getElementById("root")).render(Lt.jsx(QN.StrictMode,{children:Lt.jsx(R4,{children:Lt.jsxs(l4,{children:[Lt.jsx(Fm,{path:"/",element:Lt.jsx(wC,{})}),Lt.jsx(Fm,{path:"/client",element:Lt.jsx(wC,{})}),Lt.jsx(Fm,{path:"/map",element:Lt.jsx(vA,{})}),Lt.jsx(Fm,{path:"/client/map",element:Lt.jsx(vA,{})})]})})}));
